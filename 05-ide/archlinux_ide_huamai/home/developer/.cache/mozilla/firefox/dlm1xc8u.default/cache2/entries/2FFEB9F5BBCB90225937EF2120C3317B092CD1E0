!function e(t,n,r){function o(a,s){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[a]={exports:{}};t[a][0].call(c.exports,function(e){var n=t[a][1][e];return o(n?n:e)},c,c.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t,n){function r(){if(!s){s=!0;for(var e,t=a.length;t;){e=a,a=[];for(var n=-1;++n<t;)e[n]();t=a.length}s=!1}}function o(){}var i=t.exports={},a=[],s=!1;i.nextTick=function(e){a.push(e),s||setTimeout(r,0)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=o,i.addListener=o,i.once=o,i.off=o,i.removeListener=o,i.removeAllListeners=o,i.emit=o,i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],2:[function(e,t,n){function r(){avalon.filters.calendarTime||(avalon.filters.calendarTime=function(e){var t=o(),n=o(e),r=t.diff(n,"hour",!0);return 1>=r?n.fromNow():n.calendar()})}var o=e("../moment/moment");o.locale(wizUI.util.getLocale()),t.exports={init:r}},{"../moment/moment":4}],3:[function(e,t,n){(function(e){(function(){function e(e){this.tokens=[],this.tokens.links={},this.options=e||d.defaults,this.rules=g.normal,this.options.gfm&&(this.rules=this.options.tables?g.tables:g.gfm),this.options.mathjax||(this.rules.math=l)}function r(e,t){if(this.options=t||d.defaults,this.links=e,this.rules=f.normal,this.renderer=this.options.renderer||new o,this.renderer.options=this.options,!this.links)throw new Error("Tokens array requires a `links` property.");this.options.gfm?this.rules=this.options.breaks?f.breaks:f.gfm:this.options.pedantic&&(this.rules=f.pedantic),this.options.mathjax||(this.rules.math=l)}function o(e){this.options=e||{}}function i(e){this.tokens=[],this.token=null,this.options=e||d.defaults,this.options.renderer=this.options.renderer||new o,this.renderer=this.options.renderer,this.renderer.options=this.options}function a(e,t){return e.replace(t?/&/g:/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function s(e){return e.replace(/&([#\w]+);/g,function(e,t){return t=t.toLowerCase(),"colon"===t?":":"#"===t.charAt(0)?String.fromCharCode("x"===t.charAt(1)?parseInt(t.substring(2),16):+t.substring(1)):""})}function u(e,t){return e=e.source,t=t||"",function n(r,o){return r?(o=o.source||o,o=o.replace(/(^|[^\[])\^/g,"$1"),e=e.replace(r,o),n):new RegExp(e,t)}}function l(){}function c(e){for(var t,n,r=1;r<arguments.length;r++){t=arguments[r];for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}function d(t,n,r){if(r||"function"==typeof n){r||(r=n,n=null),n=c({},d.defaults,n||{});var o,s,u=n.highlight,l=0;try{o=e.lex(t,n)}catch(g){return r(g)}s=o.length;var f=function(e){if(e)return n.highlight=u,r(e);var t;try{t=i.parse(o,n)}catch(a){e=a}return n.highlight=u,e?r(e):r(null,t)};if(!u||u.length<3)return f();if(delete n.highlight,!s)return f();for(;l<o.length;l++)!function(e){return"code"!==e.type?--s||f():u(e.text,e.lang,function(t,n){return t?f(t):null==n||n===e.text?--s||f():(e.text=n,e.escaped=!0,void(--s||f()))})}(o[l])}else try{return n&&(n=c({},d.defaults,n)),i.parse(e.lex(t,n),n)}catch(g){if(g.message+="\nPlease report this to https://github.com/GitbookIO/kramed.",(n||d.defaults).silent)return"<p>An error occured:</p><pre>"+a(g.message+"",!0)+"</pre>";throw g}}var g={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:l,hr:/^( *[-*_]){3,} *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,nptable:l,lheading:/^([^\n]+)\n *(=|-){2,} *(?:\n+|$)/,blockquote:/^( *>[^\n]+(\n(?!def)[^\n]+)*\n*)+/,list:/^( *)(bull) [\s\S]+?(?:hr|def|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:/^ *(?:comment *(?:\n|\s*$)|closed *(?:\n{2,}|\s*$)|closing *(?:\n{2,}|\s*$))/,def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +["(]([^\n]+)[")])? *(?:\n+|$)/,footnote:/^\[\^([^\]]+)\]: ([^\n]+)/,table:l,paragraph:/^((?:[^\n]+\n?(?!hr|heading|lheading|blockquote|tag|def|math))+)\n*/,text:/^[^\n]+/,math:/^ *(\${2,}) *([\s\S]+?)\s*\1 *(?:\n+|$)/};g.bullet=/(?:[*+-]|\d+\.)/,g.item=/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/,g.item=u(g.item,"gm")(/bull/g,g.bullet)(),g.list=u(g.list)(/bull/g,g.bullet)("hr","\\n+(?=\\1?(?:[-*_] *){3,}(?:\\n+|$))")("def","\\n+(?="+g.def.source+")")("footnote",g.footnote)(),g.blockquote=u(g.blockquote)("def",g.def)(),g._tag="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:/|[^\\w\\s@]*@)\\b",g.html=u(g.html)("comment",/<!--[\s\S]*?-->/)("closed",/<(tag)[\s\S]+?<\/\1>/)("closing",/<tag(?:"[^"]*"|'[^']*'|[^'">])*?>/)(/tag/g,g._tag)(),g.paragraph=u(g.paragraph)("hr",g.hr)("heading",g.heading)("lheading",g.lheading)("blockquote",g.blockquote)("tag","<"+g._tag)("def",g.def)("math",g.math)(),g.normal=c({},g),g.gfm=c({},g.normal,{fences:/^ *(`{3,}|~{3,}) *(\S+)? *\n([\s\S]+?)\s*\1 *(?:\n+|$)/,paragraph:/^/}),g.gfm.paragraph=u(g.paragraph)("(?!","(?!"+g.gfm.fences.source.replace("\\1","\\2")+"|"+g.list.source.replace("\\1","\\3")+"|")(),g.tables=c({},g.gfm,{nptable:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/,table:/^ *\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/}),e.rules=g,e.lex=function(t,n){var r=new e(n);return r.lex(t)},e.prototype.lex=function(e){return e=e.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n"),this.token(e,!0)},e.prototype.token=function(e,t,n){for(var r,o,i,a,s,u,l,c,d,e=e.replace(/^ +$/gm,"");e;)if((i=this.rules.newline.exec(e))&&(e=e.substring(i[0].length),i[0].length>1&&this.tokens.push({type:"space"})),i=this.rules.code.exec(e))e=e.substring(i[0].length),i=i[0].replace(/^ {4}/gm,""),this.tokens.push({type:"code",text:this.options.pedantic?i:i.replace(/\n+$/,"")});else if(i=this.rules.fences.exec(e))e=e.substring(i[0].length),this.tokens.push({type:"code",lang:i[2],text:i[3]});else if(i=this.rules.footnote.exec(e))e=e.substring(i[0].length),this.tokens.push({type:"footnote",refname:i[1],text:i[2]});else if(i=this.rules.math.exec(e))e=e.substring(i[0].length),this.tokens.push({type:"math",text:i[2]});else if(i=this.rules.heading.exec(e))e=e.substring(i[0].length),this.tokens.push({type:"heading",depth:i[1].length,text:i[2]});else if(t&&(i=this.rules.nptable.exec(e))){for(e=e.substring(i[0].length),u={type:"table",header:i[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:i[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:i[3].replace(/\n$/,"").split("\n")},c=0;c<u.align.length;c++)u.align[c]=/^ *-+: *$/.test(u.align[c])?"right":/^ *:-+: *$/.test(u.align[c])?"center":/^ *:-+ *$/.test(u.align[c])?"left":null;for(c=0;c<u.cells.length;c++)u.cells[c]=u.cells[c].split(/ *\| */);this.tokens.push(u)}else if(i=this.rules.lheading.exec(e))e=e.substring(i[0].length),this.tokens.push({type:"heading",depth:"="===i[2]?1:2,text:i[1]});else if(i=this.rules.hr.exec(e))e=e.substring(i[0].length),this.tokens.push({type:"hr"});else if(i=this.rules.blockquote.exec(e))e=e.substring(i[0].length),this.tokens.push({type:"blockquote_start"}),i=i[0].replace(/^ *> ?/gm,""),this.token(i,t,!0),this.tokens.push({type:"blockquote_end"});else if(i=this.rules.list.exec(e)){for(e=e.substring(i[0].length),a=i[2],this.tokens.push({type:"list_start",ordered:a.length>1}),i=i[0].match(this.rules.item),r=!1,d=i.length,c=0;d>c;c++)u=i[c],l=u.length,u=u.replace(/^ *([*+-]|\d+\.) +/,""),~u.indexOf("\n ")&&(l-=u.length,u=this.options.pedantic?u.replace(/^ {1,4}/gm,""):u.replace(new RegExp("^ {1,"+l+"}","gm"),"")),this.options.smartLists&&c!==d-1&&(s=g.bullet.exec(i[c+1])[0],a===s||a.length>1&&s.length>1||(e=i.slice(c+1).join("\n")+e,c=d-1)),o=r||/\n\n(?!\s*$)/.test(u),c!==d-1&&(r="\n"===u.charAt(u.length-1),o||(o=r)),this.tokens.push({type:o?"loose_item_start":"list_item_start"}),this.token(u,!1,n),this.tokens.push({type:"list_item_end"});this.tokens.push({type:"list_end"})}else if(i=this.rules.html.exec(e))e=e.substring(i[0].length),this.tokens.push({type:this.options.sanitize?"paragraph":"html",pre:"pre"===i[1]||"script"===i[1]||"style"===i[1],text:i[0]});else if(!n&&t&&(i=this.rules.def.exec(e)))e=e.substring(i[0].length),this.tokens.links[i[1].toLowerCase()]={href:i[2],title:i[3]};else if(t&&(i=this.rules.table.exec(e))){for(e=e.substring(i[0].length),u={type:"table",header:i[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:i[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:i[3].replace(/(?: *\| *)?\n$/,"").split("\n")},c=0;c<u.align.length;c++)u.align[c]=/^ *-+: *$/.test(u.align[c])?"right":/^ *:-+: *$/.test(u.align[c])?"center":/^ *:-+ *$/.test(u.align[c])?"left":null;for(c=0;c<u.cells.length;c++)u.cells[c]=u.cells[c].replace(/^ *\| *| *\| *$/g,"").split(/ *\| */);this.tokens.push(u)}else if(t&&(i=this.rules.paragraph.exec(e)))e=e.substring(i[0].length),this.tokens.push({type:"paragraph",text:"\n"===i[1].charAt(i[1].length-1)?i[1].slice(0,-1):i[1]});else if(i=this.rules.text.exec(e))e=e.substring(i[0].length),this.tokens.push({type:"text",text:i[0]});else if(e)throw new Error("Infinite loop on byte: "+e.charCodeAt(0));return this.tokens};var f={escape:/^\\([\\`*{}\[\]()#$+\-.!_>])/,autolink:/^<([^ >]+(@|:\/)[^ >]+)>/,url:l,tag:/^<!--[\s\S]*?-->|^<\/?\w+(?:"[^"]*"|'[^']*'|[^'">])*?>/,link:/^!?\[(inside)\]\(href\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\]]*\]|[^\[\]])*)\]/,reffn:/^!?\[\^(inside)\]/,strong:/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,em:/^\b_((?:__|[\s\S])+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/,code:/^(`+)\s*([\s\S]*?[^`])\s*\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,del:l,text:/^[\s\S]+?(?=[\\<!\[_*`$]| {2,}\n|$)/,math:/^\$\$\s*([\s\S]*?[^\$])\s*\$\$(?!\$)/};f._inside=/(?:\[[^\]]*\]|[^\[\]]|\](?=[^\[]*\]))*/,f._href=/\s*<?([\s\S]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*/,f.link=u(f.link)("inside",f._inside)("href",f._href)(),f.reflink=u(f.reflink)("inside",f._inside)(),f.reffn=u(f.reffn)("inside",f._inside)(),f.normal=c({},f),f.pedantic=c({},f.normal,{strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/}),f.gfm=c({},f.normal,{escape:u(f.escape)("])","~|])")(),url:/^(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/,del:/^~~(?=\S)([\s\S]*?\S)~~/,text:u(f.text)("]|","~]|")("|","|https?://|")()}),f.breaks=c({},f.gfm,{br:u(f.br)("{2,}","*")(),text:u(f.gfm.text)("{2,}","*")()}),r.rules=f,r.output=function(e,t,n){var o=new r(t,n);return o.output(e)},r.prototype.output=function(e){for(var t,n,r,o,i="";e;)if(o=this.rules.escape.exec(e))e=e.substring(o[0].length),i+=o[1];else if(o=this.rules.autolink.exec(e))e=e.substring(o[0].length),"@"===o[2]?(n=this.mangle(":"===o[1].charAt(6)?o[1].substring(7):o[1]),r=this.mangle("mailto:")+n):(n=a(o[1]),r=n),i+=this.renderer.link(r,null,n);else if(this.inLink||!(o=this.rules.url.exec(e))){if(o=this.rules.tag.exec(e))!this.inLink&&/^<a /i.test(o[0])?this.inLink=!0:this.inLink&&/^<\/a>/i.test(o[0])&&(this.inLink=!1),e=e.substring(o[0].length),i+=this.options.sanitize?a(o[0]):o[0];else if(o=this.rules.link.exec(e))e=e.substring(o[0].length),this.inLink=!0,i+=this.outputLink(o,{href:o[2],title:o[3]}),this.inLink=!1;else if(o=this.rules.reffn.exec(e))e=e.substring(o[0].length),i+=this.renderer.reffn(o[1]);else if((o=this.rules.reflink.exec(e))||(o=this.rules.nolink.exec(e))){if(e=e.substring(o[0].length),t=(o[2]||o[1]).replace(/\s+/g," "),t=this.links[t.toLowerCase()],!t||!t.href){i+=o[0].charAt(0),e=o[0].substring(1)+e;continue}this.inLink=!0,i+=this.outputLink(o,t),this.inLink=!1}else if(o=this.rules.strong.exec(e))e=e.substring(o[0].length),i+=this.renderer.strong(this.output(o[2]||o[1]));else if(o=this.rules.em.exec(e))e=e.substring(o[0].length),i+=this.renderer.em(this.output(o[2]||o[1]));else if(o=this.rules.code.exec(e))e=e.substring(o[0].length),i+=this.renderer.codespan(a(o[2],!0));else if(o=this.rules.math.exec(e))e=e.substring(o[0].length),i+=this.renderer.math(o[1],"math/tex",!1);else if(o=this.rules.br.exec(e))e=e.substring(o[0].length),i+=this.renderer.br();else if(o=this.rules.del.exec(e))e=e.substring(o[0].length),i+=this.renderer.del(this.output(o[1]));else if(o=this.rules.text.exec(e))e=e.substring(o[0].length),i+=a(this.smartypants(o[0]));else if(e)throw new Error("Infinite loop on byte: "+e.charCodeAt(0))}else e=e.substring(o[0].length),n=a(o[1]),r=n,i+=this.renderer.link(r,null,n);return i},r.prototype.outputLink=function(e,t){var n=a(t.href),r=t.title?a(t.title):null;return"!"!==e[0].charAt(0)?this.renderer.link(n,r,this.output(e[1])):this.renderer.image(n,r,a(e[1]))},r.prototype.smartypants=function(e){return this.options.smartypants?e.replace(/--/g,"—").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1‘").replace(/'/g,"’").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1“").replace(/"/g,"”").replace(/\.{3}/g,"…"):e},r.prototype.mangle=function(e){for(var t,n="",r=e.length,o=0;r>o;o++)t=e.charCodeAt(o),Math.random()>.5&&(t="x"+t.toString(16)),n+="&#"+t+";";return n},o.prototype.code=function(e,t,n){if(this.options.highlight){var r=this.options.highlight(e,t);null!=r&&r!==e&&(n=!0,e=r)}return t?'<pre><code class="'+this.options.langPrefix+a(t,!0)+'">'+(n?e:a(e,!0))+"\n</code></pre>\n":"<pre><code>"+(n?e:a(e,!0))+"\n</code></pre>"},o.prototype.blockquote=function(e){return"<blockquote>\n"+e+"</blockquote>\n"},o.prototype.html=function(e){return e},o.prototype.heading=function(e,t,n){return"<h"+t+' id="'+this.options.headerPrefix+n.toLowerCase().replace(/[^\w]+/g,"-")+'">'+e+"</h"+t+">\n"},o.prototype.hr=function(){return this.options.xhtml?"<hr/>\n":"<hr>\n"},o.prototype.list=function(e,t){var n=t?"ol":"ul";return"<"+n+">\n"+e+"</"+n+">\n"},o.prototype.listitem=function(e){return"<li>"+e+"</li>\n"},o.prototype.paragraph=function(e){return"<p>"+e+"</p>\n"},o.prototype.table=function(e,t){return"<table>\n<thead>\n"+e+"</thead>\n<tbody>\n"+t+"</tbody>\n</table>\n"},o.prototype.tablerow=function(e){return"<tr>\n"+e+"</tr>\n"},o.prototype.tablecell=function(e,t){var n=t.header?"th":"td",r=t.align?"<"+n+' style="text-align:'+t.align+'">':"<"+n+">";return r+e+"</"+n+">\n"},o.prototype.math=function(e,t,n){return mode=n?"; mode=display":"",'<script type="'+t+mode+'">'+e+"</script>"},o.prototype.strong=function(e){return"<strong>"+e+"</strong>"},o.prototype.em=function(e){return"<em>"+e+"</em>"},o.prototype.codespan=function(e){return"<code>"+e+"</code>"},o.prototype.br=function(){return this.options.xhtml?"<br/>":"<br>"},o.prototype.del=function(e){return"<del>"+e+"</del>"},o.prototype.reffn=function(e){return'<sup><a href="#fn_'+e+'" id="reffn_'+e+'">'+e+"</a></sup>"},o.prototype.footnote=function(e,t){return'<blockquote id="fn_'+e+'">\n<sup>'+e+"</sup>. "+t+'<a href="#reffn_'+e+'" title="Jump back to footnote ['+e+'] in the text."> &#8617;</a>\n</blockquote>\n'},o.prototype.link=function(e,t,n){if(this.options.sanitize){try{var r=decodeURIComponent(s(e)).replace(/[^\w:]/g,"").toLowerCase()}catch(o){return""}if(0===r.indexOf("javascript:"))return""}var i='<a href="'+e+'"';return t&&(i+=' title="'+t+'"'),i+=">"+n+"</a>"},o.prototype.image=function(e,t,n){var r='<img src="'+e+'" alt="'+n+'"';return t&&(r+=' title="'+t+'"'),r+=this.options.xhtml?"/>":">"},i.parse=function(e,t,n){var r=new i(t,n);return r.parse(e)},i.prototype.parse=function(e){this.inline=new r(e.links,this.options,this.renderer),this.tokens=e.reverse();for(var t="";this.next();)t+=this.tok();return t},i.prototype.next=function(){return this.token=this.tokens.pop()},i.prototype.peek=function(){return this.tokens[this.tokens.length-1]||0},i.prototype.parseText=function(){for(var e=this.token.text;"text"===this.peek().type;)e+="\n"+this.next().text;return this.inline.output(e)},i.prototype.tok=function(){if("undefined"==typeof this.token||!this.token.hasOwnProperty("type"))return"";switch(this.token.type){case"space":return"";case"hr":return this.renderer.hr();case"heading":return this.renderer.heading(this.inline.output(this.token.text),this.token.depth,this.token.text);case"footnote":return this.renderer.footnote(this.token.refname,this.inline.output(this.token.text));case"code":return this.renderer.code(this.token.text,this.token.lang,this.token.escaped);case"math":return this.renderer.math(this.token.text,"math/tex",!0);case"table":var e,t,n,r,o,i="",a="";for(n="",e=0;e<this.token.header.length;e++)r={header:!0,align:this.token.align[e]},n+=this.renderer.tablecell(this.inline.output(this.token.header[e]),{header:!0,align:this.token.align[e]});for(i+=this.renderer.tablerow(n),e=0;e<this.token.cells.length;e++){for(t=this.token.cells[e],n="",o=0;o<t.length;o++)n+=this.renderer.tablecell(this.inline.output(t[o]),{header:!1,align:this.token.align[o]});a+=this.renderer.tablerow(n)}return this.renderer.table(i,a);case"blockquote_start":for(var a="";"blockquote_end"!==this.next().type;)a+=this.tok();return this.renderer.blockquote(a);case"list_start":for(var a="",s=this.token.ordered;"list_end"!==this.next().type;)a+=this.tok();return this.renderer.list(a,s);case"list_item_start":for(var a="";"list_item_end"!==this.next().type;)a+="text"===this.token.type?this.parseText():this.tok();return this.renderer.listitem(a);case"loose_item_start":for(var a="";"list_item_end"!==this.next().type;)a+=this.tok();return this.renderer.listitem(a);case"html":var u=this.token.pre||this.options.pedantic?this.token.text:this.inline.output(this.token.text);return this.renderer.html(u);case"paragraph":return this.renderer.paragraph(this.inline.output(this.token.text));case"text":return this.renderer.paragraph(this.parseText())}},l.exec=l,d.options=d.setOptions=function(e){return c(d.defaults,e),d},d.defaults={gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,smartLists:!1,silent:!1,highlight:null,langPrefix:"lang-",smartypants:!1,headerPrefix:"",renderer:new o,xhtml:!1,mathjax:!0},d.Parser=i,d.parser=i.parse,d.Renderer=o,d.Lexer=e,d.lexer=e.lex,d.InlineLexer=r,d.inlineLexer=r.output,d.parse=d,"undefined"!=typeof t&&"object"==typeof n?t.exports=d:"function"==typeof define?define(function(){return d}):this.kramed=d}).call(function(){return this||("undefined"!=typeof window?window:e)}())}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],4:[function(e,t,n){(function(n){(function(r){function o(e,t,n){switch(arguments.length){case 2:return null!=e?e:t;case 3:return null!=e?e:null!=t?t:n;default:throw new Error("Implement me")}}function i(e,t){return xe.call(e,t)}function a(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function s(e){Ce.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+e)}function u(e,t){var n=!0;return p(function(){return n&&(s(e),n=!1),t.apply(this,arguments)},t)}function l(e,t){bt[e]||(s(t),bt[e]=!0)}function c(e,t){return function(n){return b(e.call(this,n),t)}}function d(e,t){return function(n){return this.localeData().ordinal(e.call(this,n),t)}}function g(){}function f(e,t){t!==!1&&A(e),m(this,e),this._d=new Date(+e._d)}function h(e){var t=T(e),n=t.year||0,r=t.quarter||0,o=t.month||0,i=t.week||0,a=t.day||0,s=t.hour||0,u=t.minute||0,l=t.second||0,c=t.millisecond||0;this._milliseconds=+c+1e3*l+6e4*u+36e5*s,this._days=+a+7*i,this._months=+o+3*r+12*n,this._data={},this._locale=Ce.localeData(),this._bubble()}function p(e,t){for(var n in t)i(t,n)&&(e[n]=t[n]);return i(t,"toString")&&(e.toString=t.toString),i(t,"valueOf")&&(e.valueOf=t.valueOf),e}function m(e,t){var n,r,o;if("undefined"!=typeof t._isAMomentObject&&(e._isAMomentObject=t._isAMomentObject),"undefined"!=typeof t._i&&(e._i=t._i),"undefined"!=typeof t._f&&(e._f=t._f),"undefined"!=typeof t._l&&(e._l=t._l),"undefined"!=typeof t._strict&&(e._strict=t._strict),"undefined"!=typeof t._tzm&&(e._tzm=t._tzm),"undefined"!=typeof t._isUTC&&(e._isUTC=t._isUTC),"undefined"!=typeof t._offset&&(e._offset=t._offset),"undefined"!=typeof t._pf&&(e._pf=t._pf),"undefined"!=typeof t._locale&&(e._locale=t._locale),Oe.length>0)for(n in Oe)r=Oe[n],o=t[r],"undefined"!=typeof o&&(e[r]=o);return e}function v(e){return 0>e?Math.ceil(e):Math.floor(e)}function b(e,t,n){for(var r=""+Math.abs(e),o=e>=0;r.length<t;)r="0"+r;return(o?n?"+":"":"-")+r}function y(e,t){var n={milliseconds:0,months:0};return n.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(n.months,"M").isAfter(t)&&--n.months,n.milliseconds=+t-+e.clone().add(n.months,"M"),n}function _(e,t){var n;return t=P(t,e),e.isBefore(t)?n=y(e,t):(n=y(t,e),n.milliseconds=-n.milliseconds,n.months=-n.months),n}function w(e,t){return function(n,r){var o,i;return null===r||isNaN(+r)||(l(t,"moment()."+t+"(period, number) is deprecated. Please use moment()."+t+"(number, period)."),i=n,n=r,r=i),n="string"==typeof n?+n:n,o=Ce.duration(n,r),C(this,o,e),this}}function C(e,t,n,r){var o=t._milliseconds,i=t._days,a=t._months;r=null==r?!0:r,o&&e._d.setTime(+e._d+o*n),i&&me(e,"Date",pe(e,"Date")+i*n),a&&he(e,pe(e,"Month")+a*n),r&&Ce.updateOffset(e,i||a)}function k(e){return"[object Array]"===Object.prototype.toString.call(e)}function M(e){return"[object Date]"===Object.prototype.toString.call(e)||e instanceof Date}function L(e,t,n){var r,o=Math.min(e.length,t.length),i=Math.abs(e.length-t.length),a=0;for(r=0;o>r;r++)(n&&e[r]!==t[r]||!n&&z(e[r])!==z(t[r]))&&a++;return a+i}function S(e){if(e){var t=e.toLowerCase().replace(/(.)s$/,"$1");e=dt[e]||gt[t]||t}return e}function T(e){var t,n,r={};for(n in e)i(e,n)&&(t=S(n),t&&(r[t]=e[n]));return r}function x(e){var t,n;if(0===e.indexOf("week"))t=7,n="day";else{if(0!==e.indexOf("month"))return;t=12,n="month"}Ce[e]=function(o,i){var a,s,u=Ce._locale[e],l=[];if("number"==typeof o&&(i=o,o=r),s=function(e){var t=Ce().utc().set(n,e);return u.call(Ce._locale,t,o||"")},null!=i)return s(i);for(a=0;t>a;a++)l.push(s(a));return l}}function z(e){var t=+e,n=0;return 0!==t&&isFinite(t)&&(n=t>=0?Math.floor(t):Math.ceil(t)),n}function I(e,t){return new Date(Date.UTC(e,t+1,0)).getUTCDate()}function D(e,t,n){return ce(Ce([e,11,31+t-n]),t,n).week}function E(e){return G(e)?366:365}function G(e){return e%4===0&&e%100!==0||e%400===0}function A(e){var t;e._a&&-2===e._pf.overflow&&(t=e._a[Ie]<0||e._a[Ie]>11?Ie:e._a[De]<1||e._a[De]>I(e._a[ze],e._a[Ie])?De:e._a[Ee]<0||e._a[Ee]>23?Ee:e._a[Ge]<0||e._a[Ge]>59?Ge:e._a[Ae]<0||e._a[Ae]>59?Ae:e._a[Ne]<0||e._a[Ne]>999?Ne:-1,e._pf._overflowDayOfYear&&(ze>t||t>De)&&(t=De),e._pf.overflow=t)}function N(e){return null==e._isValid&&(e._isValid=!isNaN(e._d.getTime())&&e._pf.overflow<0&&!e._pf.empty&&!e._pf.invalidMonth&&!e._pf.nullInput&&!e._pf.invalidFormat&&!e._pf.userInvalidated,e._strict&&(e._isValid=e._isValid&&0===e._pf.charsLeftOver&&0===e._pf.unusedTokens.length)),e._isValid}function B(e){return e?e.toLowerCase().replace("_","-"):e}function O(e){for(var t,n,r,o,i=0;i<e.length;){for(o=B(e[i]).split("-"),t=o.length,n=B(e[i+1]),n=n?n.split("-"):null;t>0;){if(r=F(o.slice(0,t).join("-")))return r;if(n&&n.length>=t&&L(o,n,!0)>=t-1)break;t--}i++}return null}function F(t){var n=null;if(!Be[t]&&Fe)try{n=Ce.locale(),e("./locale/"+t),Ce.locale(n)}catch(r){}return Be[t]}function P(e,t){return t._isUTC?Ce(e).zone(t._offset||0):Ce(e).local()}function U(e){return e.match(/\[[\s\S]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function $(e){var t,n,r=e.match(We);for(t=0,n=r.length;n>t;t++)r[t]=vt[r[t]]?vt[r[t]]:U(r[t]);return function(o){var i="";for(t=0;n>t;t++)i+=r[t]instanceof Function?r[t].call(o,e):r[t];return i}}function W(e,t){return e.isValid()?(t=R(t,e.localeData()),ft[t]||(ft[t]=$(t)),ft[t](e)):e.localeData().invalidDate()}function R(e,t){function n(e){return t.longDateFormat(e)||e}var r=5;for(Re.lastIndex=0;r>=0&&Re.test(e);)e=e.replace(Re,n),Re.lastIndex=0,r-=1;return e}function H(e,t){var n,r=t._strict;switch(e){case"Q":return Qe;case"DDDD":return tt;case"YYYY":case"GGGG":case"gggg":return r?nt:Ke;case"Y":case"G":case"g":return ot;case"YYYYYY":case"YYYYY":case"GGGGG":case"ggggg":return r?rt:Ve;case"S":if(r)return Qe;case"SS":if(r)return et;case"SSS":if(r)return tt;case"DDD":return Ye;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return je;case"a":case"A":return t._locale._meridiemParse;case"X":return Je;case"Z":case"ZZ":return qe;case"T":return Xe;case"SSSS":return Ze;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"ww":case"WW":return r?et:He;case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"W":case"e":case"E":return He;case"Do":return r?t._locale._ordinalParse:t._locale._ordinalParseLenient;default:return n=new RegExp(Q(J(e.replace("\\","")),"i"))}}function Y(e){e=e||"";var t=e.match(qe)||[],n=t[t.length-1]||[],r=(n+"").match(lt)||["-",0,0],o=+(60*r[1])+z(r[2]);return"+"===r[0]?-o:o}function K(e,t,n){var r,o=n._a;switch(e){case"Q":null!=t&&(o[Ie]=3*(z(t)-1));break;case"M":case"MM":null!=t&&(o[Ie]=z(t)-1);break;case"MMM":case"MMMM":r=n._locale.monthsParse(t),null!=r?o[Ie]=r:n._pf.invalidMonth=t;break;case"D":case"DD":null!=t&&(o[De]=z(t));break;case"Do":null!=t&&(o[De]=z(parseInt(t.match(/\d{1,2}/)[0],10)));break;case"DDD":case"DDDD":null!=t&&(n._dayOfYear=z(t));break;case"YY":o[ze]=Ce.parseTwoDigitYear(t);break;case"YYYY":case"YYYYY":case"YYYYYY":o[ze]=z(t);break;case"a":case"A":n._isPm=n._locale.isPM(t);break;case"H":case"HH":case"h":case"hh":o[Ee]=z(t);break;case"m":case"mm":o[Ge]=z(t);break;case"s":case"ss":o[Ae]=z(t);break;case"S":case"SS":case"SSS":case"SSSS":o[Ne]=z(1e3*("0."+t));break;case"X":n._d=new Date(1e3*parseFloat(t));break;case"Z":case"ZZ":n._useUTC=!0,n._tzm=Y(t);break;case"dd":case"ddd":case"dddd":r=n._locale.weekdaysParse(t),null!=r?(n._w=n._w||{},n._w.d=r):n._pf.invalidWeekday=t;break;case"w":case"ww":case"W":case"WW":case"d":case"e":case"E":e=e.substr(0,1);case"gggg":case"GGGG":case"GGGGG":e=e.substr(0,2),t&&(n._w=n._w||{},n._w[e]=z(t));break;case"gg":case"GG":n._w=n._w||{},n._w[e]=Ce.parseTwoDigitYear(t)}}function V(e){var t,n,r,i,a,s,u;t=e._w,null!=t.GG||null!=t.W||null!=t.E?(a=1,s=4,n=o(t.GG,e._a[ze],ce(Ce(),1,4).year),r=o(t.W,1),i=o(t.E,1)):(a=e._locale._week.dow,s=e._locale._week.doy,n=o(t.gg,e._a[ze],ce(Ce(),a,s).year),r=o(t.w,1),null!=t.d?(i=t.d,a>i&&++r):i=null!=t.e?t.e+a:a),u=de(n,r,i,s,a),e._a[ze]=u.year,e._dayOfYear=u.dayOfYear}function Z(e){var t,n,r,i,a=[];if(!e._d){for(r=q(e),e._w&&null==e._a[De]&&null==e._a[Ie]&&V(e),e._dayOfYear&&(i=o(e._a[ze],r[ze]),e._dayOfYear>E(i)&&(e._pf._overflowDayOfYear=!0),n=ae(i,0,e._dayOfYear),e._a[Ie]=n.getUTCMonth(),e._a[De]=n.getUTCDate()),t=0;3>t&&null==e._a[t];++t)e._a[t]=a[t]=r[t];for(;7>t;t++)e._a[t]=a[t]=null==e._a[t]?2===t?1:0:e._a[t];e._d=(e._useUTC?ae:ie).apply(null,a),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()+e._tzm)}}function j(e){var t;e._d||(t=T(e._i),e._a=[t.year,t.month,t.day,t.hour,t.minute,t.second,t.millisecond],Z(e))}function q(e){var t=new Date;return e._useUTC?[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]:[t.getFullYear(),t.getMonth(),t.getDate()]}function X(e){if(e._f===Ce.ISO_8601)return void te(e);e._a=[],e._pf.empty=!0;var t,n,r,o,i,a=""+e._i,s=a.length,u=0;for(r=R(e._f,e._locale).match(We)||[],t=0;t<r.length;t++)o=r[t],n=(a.match(H(o,e))||[])[0],n&&(i=a.substr(0,a.indexOf(n)),i.length>0&&e._pf.unusedInput.push(i),a=a.slice(a.indexOf(n)+n.length),u+=n.length),vt[o]?(n?e._pf.empty=!1:e._pf.unusedTokens.push(o),K(o,n,e)):e._strict&&!n&&e._pf.unusedTokens.push(o);e._pf.charsLeftOver=s-u,a.length>0&&e._pf.unusedInput.push(a),e._isPm&&e._a[Ee]<12&&(e._a[Ee]+=12),e._isPm===!1&&12===e._a[Ee]&&(e._a[Ee]=0),Z(e),A(e)}function J(e){return e.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,n,r,o){return t||n||r||o})}function Q(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function ee(e){var t,n,r,o,i;if(0===e._f.length)return e._pf.invalidFormat=!0,void(e._d=new Date(0/0));for(o=0;o<e._f.length;o++)i=0,t=m({},e),null!=e._useUTC&&(t._useUTC=e._useUTC),t._pf=a(),t._f=e._f[o],X(t),N(t)&&(i+=t._pf.charsLeftOver,i+=10*t._pf.unusedTokens.length,t._pf.score=i,(null==r||r>i)&&(r=i,n=t));p(e,n||t)}function te(e){var t,n,r=e._i,o=it.exec(r);if(o){for(e._pf.iso=!0,t=0,n=st.length;n>t;t++)if(st[t][1].exec(r)){e._f=st[t][0]+(o[6]||" ");break}for(t=0,n=ut.length;n>t;t++)if(ut[t][1].exec(r)){e._f+=ut[t][0];break}r.match(qe)&&(e._f+="Z"),X(e)}else e._isValid=!1}function ne(e){te(e),e._isValid===!1&&(delete e._isValid,Ce.createFromInputFallback(e))}function re(e,t){var n,r=[];for(n=0;n<e.length;++n)r.push(t(e[n],n));return r}function oe(e){var t,n=e._i;n===r?e._d=new Date:M(n)?e._d=new Date(+n):null!==(t=Pe.exec(n))?e._d=new Date(+t[1]):"string"==typeof n?ne(e):k(n)?(e._a=re(n.slice(0),function(e){return parseInt(e,10)}),Z(e)):"object"==typeof n?j(e):"number"==typeof n?e._d=new Date(n):Ce.createFromInputFallback(e)}function ie(e,t,n,r,o,i,a){var s=new Date(e,t,n,r,o,i,a);return 1970>e&&s.setFullYear(e),s}function ae(e){var t=new Date(Date.UTC.apply(null,arguments));return 1970>e&&t.setUTCFullYear(e),t}function se(e,t){if("string"==typeof e)if(isNaN(e)){if(e=t.weekdaysParse(e),"number"!=typeof e)return null}else e=parseInt(e,10);return e}function ue(e,t,n,r,o){return o.relativeTime(t||1,!!n,e,r)}function le(e,t,n){var r=Ce.duration(e).abs(),o=Te(r.as("s")),i=Te(r.as("m")),a=Te(r.as("h")),s=Te(r.as("d")),u=Te(r.as("M")),l=Te(r.as("y")),c=o<ht.s&&["s",o]||1===i&&["m"]||i<ht.m&&["mm",i]||1===a&&["h"]||a<ht.h&&["hh",a]||1===s&&["d"]||s<ht.d&&["dd",s]||1===u&&["M"]||u<ht.M&&["MM",u]||1===l&&["y"]||["yy",l];return c[2]=t,c[3]=+e>0,c[4]=n,ue.apply({},c)}function ce(e,t,n){var r,o=n-t,i=n-e.day();return i>o&&(i-=7),o-7>i&&(i+=7),r=Ce(e).add(i,"d"),{week:Math.ceil(r.dayOfYear()/7),year:r.year()}}function de(e,t,n,r,o){var i,a,s=ae(e,0,1).getUTCDay();return s=0===s?7:s,n=null!=n?n:o,i=o-s+(s>r?7:0)-(o>s?7:0),a=7*(t-1)+(n-o)+i+1,{year:a>0?e:e-1,dayOfYear:a>0?a:E(e-1)+a}}function ge(e){var t=e._i,n=e._f;return e._locale=e._locale||Ce.localeData(e._l),null===t||n===r&&""===t?Ce.invalid({nullInput:!0}):("string"==typeof t&&(e._i=t=e._locale.preparse(t)),Ce.isMoment(t)?new f(t,!0):(n?k(n)?ee(e):X(e):oe(e),new f(e)))}function fe(e,t){var n,r;if(1===t.length&&k(t[0])&&(t=t[0]),!t.length)return Ce();for(n=t[0],r=1;r<t.length;++r)t[r][e](n)&&(n=t[r]);return n}function he(e,t){var n;return"string"==typeof t&&(t=e.localeData().monthsParse(t),"number"!=typeof t)?e:(n=Math.min(e.date(),I(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,n),e)}function pe(e,t){return e._d["get"+(e._isUTC?"UTC":"")+t]()}function me(e,t,n){return"Month"===t?he(e,n):e._d["set"+(e._isUTC?"UTC":"")+t](n)}function ve(e,t){return function(n){return null!=n?(me(this,e,n),Ce.updateOffset(this,t),this):pe(this,e)}}function be(e){return 400*e/146097}function ye(e){return 146097*e/400}function _e(e){Ce.duration.fn[e]=function(){return this._data[e]}}function we(e){"undefined"==typeof ender&&(ke=Se.moment,Se.moment=e?u("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.",Ce):Ce)}for(var Ce,ke,Me,Le="2.8.3",Se="undefined"!=typeof n?n:this,Te=Math.round,xe=Object.prototype.hasOwnProperty,ze=0,Ie=1,De=2,Ee=3,Ge=4,Ae=5,Ne=6,Be={},Oe=[],Fe="undefined"!=typeof t&&t.exports,Pe=/^\/?Date\((\-?\d+)/i,Ue=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,$e=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,We=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|X|zz?|ZZ?|.)/g,Re=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,He=/\d\d?/,Ye=/\d{1,3}/,Ke=/\d{1,4}/,Ve=/[+\-]?\d{1,6}/,Ze=/\d+/,je=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,qe=/Z|[\+\-]\d\d:?\d\d/gi,Xe=/T/i,Je=/[\+\-]?\d+(\.\d{1,3})?/,Qe=/\d/,et=/\d\d/,tt=/\d{3}/,nt=/\d{4}/,rt=/[+-]?\d{6}/,ot=/[+-]?\d+/,it=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,at="YYYY-MM-DDTHH:mm:ssZ",st=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],ut=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],lt=/([\+\-]|\d\d)/gi,ct=("Date|Hours|Minutes|Seconds|Milliseconds".split("|"),
{Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6}),dt={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",Q:"quarter",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},gt={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},ft={},ht={s:45,m:45,h:22,d:26,M:11},pt="DDD w W M D d".split(" "),mt="M D H h m s w W".split(" "),vt={M:function(){return this.month()+1},MMM:function(e){return this.localeData().monthsShort(this,e)},MMMM:function(e){return this.localeData().months(this,e)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(e){return this.localeData().weekdaysMin(this,e)},ddd:function(e){return this.localeData().weekdaysShort(this,e)},dddd:function(e){return this.localeData().weekdays(this,e)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return b(this.year()%100,2)},YYYY:function(){return b(this.year(),4)},YYYYY:function(){return b(this.year(),5)},YYYYYY:function(){var e=this.year(),t=e>=0?"+":"-";return t+b(Math.abs(e),6)},gg:function(){return b(this.weekYear()%100,2)},gggg:function(){return b(this.weekYear(),4)},ggggg:function(){return b(this.weekYear(),5)},GG:function(){return b(this.isoWeekYear()%100,2)},GGGG:function(){return b(this.isoWeekYear(),4)},GGGGG:function(){return b(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.localeData().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.localeData().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return z(this.milliseconds()/100)},SS:function(){return b(z(this.milliseconds()/10),2)},SSS:function(){return b(this.milliseconds(),3)},SSSS:function(){return b(this.milliseconds(),3)},Z:function(){var e=-this.zone(),t="+";return 0>e&&(e=-e,t="-"),t+b(z(e/60),2)+":"+b(z(e)%60,2)},ZZ:function(){var e=-this.zone(),t="+";return 0>e&&(e=-e,t="-"),t+b(z(e/60),2)+b(z(e)%60,2)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()},Q:function(){return this.quarter()}},bt={},yt=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"];pt.length;)Me=pt.pop(),vt[Me+"o"]=d(vt[Me],Me);for(;mt.length;)Me=mt.pop(),vt[Me+Me]=c(vt[Me],2);vt.DDDD=c(vt.DDD,3),p(g.prototype,{set:function(e){var t,n;for(n in e)t=e[n],"function"==typeof t?this[n]=t:this["_"+n]=t;this._ordinalParseLenient=new RegExp(this._ordinalParse.source+"|"+/\d{1,2}/.source)},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(e){return this._months[e.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(e){return this._monthsShort[e.month()]},monthsParse:function(e){var t,n,r;for(this._monthsParse||(this._monthsParse=[]),t=0;12>t;t++)if(this._monthsParse[t]||(n=Ce.utc([2e3,t]),r="^"+this.months(n,"")+"|^"+this.monthsShort(n,""),this._monthsParse[t]=new RegExp(r.replace(".",""),"i")),this._monthsParse[t].test(e))return t},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(e){return this._weekdays[e.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(e){return this._weekdaysShort[e.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(e){return this._weekdaysMin[e.day()]},weekdaysParse:function(e){var t,n,r;for(this._weekdaysParse||(this._weekdaysParse=[]),t=0;7>t;t++)if(this._weekdaysParse[t]||(n=Ce([2e3,1]).day(t),r="^"+this.weekdays(n,"")+"|^"+this.weekdaysShort(n,"")+"|^"+this.weekdaysMin(n,""),this._weekdaysParse[t]=new RegExp(r.replace(".",""),"i")),this._weekdaysParse[t].test(e))return t},_longDateFormat:{LT:"HH:mm",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY LT",LLLL:"dddd, MMMM D, YYYY LT"},longDateFormat:function(e){var t=this._longDateFormat[e];return!t&&this._longDateFormat[e.toUpperCase()]&&(t=this._longDateFormat[e.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e]=t),t},isPM:function(e){return"p"===(e+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(e,t,n){return e>11?n?"pm":"PM":n?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"YYYY-MM-DD LT"},calendar:function(e,t){var n=this._calendar[e];return"function"==typeof n?n.apply(t):n},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(e,t,n,r){var o=this._relativeTime[n];return"function"==typeof o?o(e,t,n,r):o.replace(/%d/i,e)},pastFuture:function(e,t){var n=this._relativeTime[e>0?"future":"past"];return"function"==typeof n?n(t):n.replace(/%s/i,t)},ordinal:function(e){return this._ordinal.replace("%d",e)},_ordinal:"%d",_ordinalParse:/\d{1,2}/,preparse:function(e){return e},postformat:function(e){return e},week:function(e){return ce(e,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),Ce=function(e,t,n,o){var i;return"boolean"==typeof n&&(o=n,n=r),i={},i._isAMomentObject=!0,i._i=e,i._f=t,i._l=n,i._strict=o,i._isUTC=!1,i._pf=a(),ge(i)},Ce.suppressDeprecationWarnings=!1,Ce.createFromInputFallback=u("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(e){e._d=new Date(e._i)}),Ce.min=function(){var e=[].slice.call(arguments,0);return fe("isBefore",e)},Ce.max=function(){var e=[].slice.call(arguments,0);return fe("isAfter",e)},Ce.utc=function(e,t,n,o){var i;return"boolean"==typeof n&&(o=n,n=r),i={},i._isAMomentObject=!0,i._useUTC=!0,i._isUTC=!0,i._l=n,i._i=e,i._f=t,i._strict=o,i._pf=a(),ge(i).utc()},Ce.unix=function(e){return Ce(1e3*e)},Ce.duration=function(e,t){var n,r,o,a,s=e,u=null;return Ce.isDuration(e)?s={ms:e._milliseconds,d:e._days,M:e._months}:"number"==typeof e?(s={},t?s[t]=e:s.milliseconds=e):(u=Ue.exec(e))?(n="-"===u[1]?-1:1,s={y:0,d:z(u[De])*n,h:z(u[Ee])*n,m:z(u[Ge])*n,s:z(u[Ae])*n,ms:z(u[Ne])*n}):(u=$e.exec(e))?(n="-"===u[1]?-1:1,o=function(e){var t=e&&parseFloat(e.replace(",","."));return(isNaN(t)?0:t)*n},s={y:o(u[2]),M:o(u[3]),d:o(u[4]),h:o(u[5]),m:o(u[6]),s:o(u[7]),w:o(u[8])}):"object"==typeof s&&("from"in s||"to"in s)&&(a=_(Ce(s.from),Ce(s.to)),s={},s.ms=a.milliseconds,s.M=a.months),r=new h(s),Ce.isDuration(e)&&i(e,"_locale")&&(r._locale=e._locale),r},Ce.version=Le,Ce.defaultFormat=at,Ce.ISO_8601=function(){},Ce.momentProperties=Oe,Ce.updateOffset=function(){},Ce.relativeTimeThreshold=function(e,t){return ht[e]===r?!1:t===r?ht[e]:(ht[e]=t,!0)},Ce.lang=u("moment.lang is deprecated. Use moment.locale instead.",function(e,t){return Ce.locale(e,t)}),Ce.locale=function(e,t){var n;return e&&(n="undefined"!=typeof t?Ce.defineLocale(e,t):Ce.localeData(e),n&&(Ce.duration._locale=Ce._locale=n)),Ce._locale._abbr},Ce.defineLocale=function(e,t){return null!==t?(t.abbr=e,Be[e]||(Be[e]=new g),Be[e].set(t),Ce.locale(e),Be[e]):(delete Be[e],null)},Ce.langData=u("moment.langData is deprecated. Use moment.localeData instead.",function(e){return Ce.localeData(e)}),Ce.localeData=function(e){var t;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return Ce._locale;if(!k(e)){if(t=F(e))return t;e=[e]}return O(e)},Ce.isMoment=function(e){return e instanceof f||null!=e&&i(e,"_isAMomentObject")},Ce.isDuration=function(e){return e instanceof h};for(Me=yt.length-1;Me>=0;--Me)x(yt[Me]);Ce.normalizeUnits=function(e){return S(e)},Ce.invalid=function(e){var t=Ce.utc(0/0);return null!=e?p(t._pf,e):t._pf.userInvalidated=!0,t},Ce.parseZone=function(){return Ce.apply(null,arguments).parseZone()},Ce.parseTwoDigitYear=function(e){return z(e)+(z(e)>68?1900:2e3)},p(Ce.fn=f.prototype,{clone:function(){return Ce(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){var e=Ce(this).utc();return 0<e.year()&&e.year()<=9999?W(e,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):W(e,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var e=this;return[e.year(),e.month(),e.date(),e.hours(),e.minutes(),e.seconds(),e.milliseconds()]},isValid:function(){return N(this)},isDSTShifted:function(){return this._a?this.isValid()&&L(this._a,(this._isUTC?Ce.utc(this._a):Ce(this._a)).toArray())>0:!1},parsingFlags:function(){return p({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(e){return this.zone(0,e)},local:function(e){return this._isUTC&&(this.zone(0,e),this._isUTC=!1,e&&this.add(this._dateTzOffset(),"m")),this},format:function(e){var t=W(this,e||Ce.defaultFormat);return this.localeData().postformat(t)},add:w(1,"add"),subtract:w(-1,"subtract"),diff:function(e,t,n){var r,o,i,a=P(e,this),s=6e4*(this.zone()-a.zone());return t=S(t),"year"===t||"month"===t?(r=432e5*(this.daysInMonth()+a.daysInMonth()),o=12*(this.year()-a.year())+(this.month()-a.month()),i=this-Ce(this).startOf("month")-(a-Ce(a).startOf("month")),i-=6e4*(this.zone()-Ce(this).startOf("month").zone()-(a.zone()-Ce(a).startOf("month").zone())),o+=i/r,"year"===t&&(o/=12)):(r=this-a,o="second"===t?r/1e3:"minute"===t?r/6e4:"hour"===t?r/36e5:"day"===t?(r-s)/864e5:"week"===t?(r-s)/6048e5:r),n?o:v(o)},from:function(e,t){return Ce.duration({to:this,from:e}).locale(this.locale()).humanize(!t)},fromNow:function(e){return this.from(Ce(),e)},calendar:function(e){var t=e||Ce(),n=P(t,this).startOf("day"),r=this.diff(n,"days",!0),o=-1>r?"sameElse":0>r?"lastDay":1>r?"sameDay":2>r?"nextDay":7>r?"nextWeek":"sameElse";return this.format(this.localeData().calendar(o,this))},isLeapYear:function(){return G(this.year())},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(e){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(e=se(e,this.localeData()),this.add(e-t,"d")):t},month:ve("Month",!0),startOf:function(e){switch(e=S(e)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===e?this.weekday(0):"isoWeek"===e&&this.isoWeekday(1),"quarter"===e&&this.month(3*Math.floor(this.month()/3)),this},endOf:function(e){return e=S(e),this.startOf(e).add(1,"isoWeek"===e?"week":e).subtract(1,"ms")},isAfter:function(e,t){return t=S("undefined"!=typeof t?t:"millisecond"),"millisecond"===t?(e=Ce.isMoment(e)?e:Ce(e),+this>+e):+this.clone().startOf(t)>+Ce(e).startOf(t)},isBefore:function(e,t){return t=S("undefined"!=typeof t?t:"millisecond"),"millisecond"===t?(e=Ce.isMoment(e)?e:Ce(e),+e>+this):+this.clone().startOf(t)<+Ce(e).startOf(t)},isSame:function(e,t){return t=S(t||"millisecond"),"millisecond"===t?(e=Ce.isMoment(e)?e:Ce(e),+this===+e):+this.clone().startOf(t)===+P(e,this).startOf(t)},min:u("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(e){return e=Ce.apply(null,arguments),this>e?this:e}),max:u("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(e){return e=Ce.apply(null,arguments),e>this?this:e}),zone:function(e,t){var n,r=this._offset||0;return null==e?this._isUTC?r:this._dateTzOffset():("string"==typeof e&&(e=Y(e)),Math.abs(e)<16&&(e=60*e),!this._isUTC&&t&&(n=this._dateTzOffset()),this._offset=e,this._isUTC=!0,null!=n&&this.subtract(n,"m"),r!==e&&(!t||this._changeInProgress?C(this,Ce.duration(r-e,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,Ce.updateOffset(this,!0),this._changeInProgress=null)),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return this._tzm?this.zone(this._tzm):"string"==typeof this._i&&this.zone(this._i),this},hasAlignedHourOffset:function(e){return e=e?Ce(e).zone():0,(this.zone()-e)%60===0},daysInMonth:function(){return I(this.year(),this.month())},dayOfYear:function(e){var t=Te((Ce(this).startOf("day")-Ce(this).startOf("year"))/864e5)+1;return null==e?t:this.add(e-t,"d")},quarter:function(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)},weekYear:function(e){var t=ce(this,this.localeData()._week.dow,this.localeData()._week.doy).year;return null==e?t:this.add(e-t,"y")},isoWeekYear:function(e){var t=ce(this,1,4).year;return null==e?t:this.add(e-t,"y")},week:function(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")},isoWeek:function(e){var t=ce(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")},weekday:function(e){var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,"d")},isoWeekday:function(e){return null==e?this.day()||7:this.day(this.day()%7?e:e-7)},isoWeeksInYear:function(){return D(this.year(),1,4)},weeksInYear:function(){var e=this.localeData()._week;return D(this.year(),e.dow,e.doy)},get:function(e){return e=S(e),this[e]()},set:function(e,t){return e=S(e),"function"==typeof this[e]&&this[e](t),this},locale:function(e){var t;return e===r?this._locale._abbr:(t=Ce.localeData(e),null!=t&&(this._locale=t),this)},lang:u("moment().lang() is deprecated. Use moment().localeData() instead.",function(e){return e===r?this.localeData():this.locale(e)}),localeData:function(){return this._locale},_dateTzOffset:function(){return 15*Math.round(this._d.getTimezoneOffset()/15)}}),Ce.fn.millisecond=Ce.fn.milliseconds=ve("Milliseconds",!1),Ce.fn.second=Ce.fn.seconds=ve("Seconds",!1),Ce.fn.minute=Ce.fn.minutes=ve("Minutes",!1),Ce.fn.hour=Ce.fn.hours=ve("Hours",!0),Ce.fn.date=ve("Date",!0),Ce.fn.dates=u("dates accessor is deprecated. Use date instead.",ve("Date",!0)),Ce.fn.year=ve("FullYear",!0),Ce.fn.years=u("years accessor is deprecated. Use year instead.",ve("FullYear",!0)),Ce.fn.days=Ce.fn.day,Ce.fn.months=Ce.fn.month,Ce.fn.weeks=Ce.fn.week,Ce.fn.isoWeeks=Ce.fn.isoWeek,Ce.fn.quarters=Ce.fn.quarter,Ce.fn.toJSON=Ce.fn.toISOString,p(Ce.duration.fn=h.prototype,{_bubble:function(){var e,t,n,r=this._milliseconds,o=this._days,i=this._months,a=this._data,s=0;a.milliseconds=r%1e3,e=v(r/1e3),a.seconds=e%60,t=v(e/60),a.minutes=t%60,n=v(t/60),a.hours=n%24,o+=v(n/24),s=v(be(o)),o-=v(ye(s)),i+=v(o/30),o%=30,s+=v(i/12),i%=12,a.days=o,a.months=i,a.years=s},abs:function(){return this._milliseconds=Math.abs(this._milliseconds),this._days=Math.abs(this._days),this._months=Math.abs(this._months),this._data.milliseconds=Math.abs(this._data.milliseconds),this._data.seconds=Math.abs(this._data.seconds),this._data.minutes=Math.abs(this._data.minutes),this._data.hours=Math.abs(this._data.hours),this._data.months=Math.abs(this._data.months),this._data.years=Math.abs(this._data.years),this},weeks:function(){return v(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*z(this._months/12)},humanize:function(e){var t=le(this,!e,this.localeData());return e&&(t=this.localeData().pastFuture(+this,t)),this.localeData().postformat(t)},add:function(e,t){var n=Ce.duration(e,t);return this._milliseconds+=n._milliseconds,this._days+=n._days,this._months+=n._months,this._bubble(),this},subtract:function(e,t){var n=Ce.duration(e,t);return this._milliseconds-=n._milliseconds,this._days-=n._days,this._months-=n._months,this._bubble(),this},get:function(e){return e=S(e),this[e.toLowerCase()+"s"]()},as:function(e){var t,n;if(e=S(e),"month"===e||"year"===e)return t=this._days+this._milliseconds/864e5,n=this._months+12*be(t),"month"===e?n:n/12;switch(t=this._days+ye(this._months/12),e){case"week":return t/7+this._milliseconds/6048e5;case"day":return t+this._milliseconds/864e5;case"hour":return 24*t+this._milliseconds/36e5;case"minute":return 24*t*60+this._milliseconds/6e4;case"second":return 24*t*60*60+this._milliseconds/1e3;case"millisecond":return Math.floor(24*t*60*60*1e3)+this._milliseconds;default:throw new Error("Unknown unit "+e)}},lang:Ce.fn.lang,locale:Ce.fn.locale,toIsoString:u("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",function(){return this.toISOString()}),toISOString:function(){var e=Math.abs(this.years()),t=Math.abs(this.months()),n=Math.abs(this.days()),r=Math.abs(this.hours()),o=Math.abs(this.minutes()),i=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(e?e+"Y":"")+(t?t+"M":"")+(n?n+"D":"")+(r||o||i?"T":"")+(r?r+"H":"")+(o?o+"M":"")+(i?i+"S":""):"P0D"},localeData:function(){return this._locale}}),Ce.duration.fn.toString=Ce.duration.fn.toISOString;for(Me in ct)i(ct,Me)&&_e(Me.toLowerCase());Ce.duration.fn.asMilliseconds=function(){return this.as("ms")},Ce.duration.fn.asSeconds=function(){return this.as("s")},Ce.duration.fn.asMinutes=function(){return this.as("m")},Ce.duration.fn.asHours=function(){return this.as("h")},Ce.duration.fn.asDays=function(){return this.as("d")},Ce.duration.fn.asWeeks=function(){return this.as("weeks")},Ce.duration.fn.asMonths=function(){return this.as("M")},Ce.duration.fn.asYears=function(){return this.as("y")},Ce.locale("en",{ordinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10,n=1===z(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th";return e+n}}),function(e){e(Ce)}(function(e){return e.defineLocale("zh-cn",{months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),longDateFormat:{LT:"HH:mm",L:"YYYY-MM-DD",LL:"YYYY年MMMD日",LLL:"YYYY年MMMD日LT",LLLL:"YYYY年MMMD日ddddLT",l:"YYYY-MM-DD",ll:"YYYY年MMMD日",lll:"YYYY年MMMD日LT",llll:"YYYY年MMMD日ddddLT"},meridiem:function(e,t,n){var r=100*e+t;return 600>r?"凌晨":900>r?"早上":1130>r?"上午":1230>r?"中午":1800>r?"下午":"晚上"},calendar:{sameDay:"[今天] LT",nextDay:"[明天] LT",lastDay:"[昨天] LT",nextWeek:function(){var t,n;return t=e().startOf("week"),n=this.unix()-t.unix()>=604800?"[下]":"[本]",0===this.minutes()?n+"dddAh点整":n+"dddAh点mm"},lastWeek:function(){var t,n;return t=e().startOf("week"),n=this.unix()<t.unix()?"[上]":"[本]",0===this.minutes()?n+"dddAh点整":n+"dddAh点mm"},sameElse:"YYYY-MM-DD LT"},ordinalParse:/\d{1,2}(日|月|周)/,ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+"日";case"M":return e+"月";case"w":case"W":return e+"周";default:return e}},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1分钟",mm:"%d分钟",h:"1小时",hh:"%d小时",d:"1天",dd:"%d天",M:"1个月",MM:"%d个月",y:"1年",yy:"%d年"},week:{dow:1,doy:4}})}),function(e){e(Ce)}(function(e){return e.defineLocale("zh-tw",{months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"週日_週一_週二_週三_週四_週五_週六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),longDateFormat:{LT:"HH:mm",L:"YYYY年MMMD日",LL:"YYYY年MMMD日",LLL:"YYYY年MMMD日LT",LLLL:"YYYY年MMMD日ddddLT",l:"YYYY年MMMD日",ll:"YYYY年MMMD日",lll:"YYYY年MMMD日LT",llll:"YYYY年MMMD日ddddLT"},meridiem:function(e,t,n){var r=100*e+t;return 900>r?"早上":1130>r?"上午":1230>r?"中午":1800>r?"下午":"晚上"},calendar:{sameDay:"[今天] LT",nextDay:"[明天] LT",nextWeek:"[下]ddddLT",lastDay:"[昨天] LT",lastWeek:"[上]ddddLT",sameElse:"YYYY-MM-DD LT"},ordinalParse:/\d{1,2}(日|月|週)/,ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+"日";case"M":return e+"月";case"w":case"W":return e+"週";default:return e}},relativeTime:{future:"%s內",past:"%s前",s:"幾秒",m:"一分鐘",mm:"%d分鐘",h:"一小時",hh:"%d小時",d:"一天",dd:"%d天",M:"一個月",MM:"%d個月",y:"一年",yy:"%d年"}})}),Ce.locale("en"),Fe?t.exports=Ce:"function"==typeof define&&define.amd?(define("moment",function(e,t,n){return n.config&&n.config()&&n.config().noGlobal===!0&&(Se.moment=ke),Ce}),we(!0)):we()}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],5:[function(e,t,n){!function(){var e=null;window.PR_SHOULD_USE_CONTINUATION=!0,function(){function t(e){function t(e){var t=e.charCodeAt(0);if(92!==t)return t;var n=e.charAt(1);return(t=d[n])?t:n>="0"&&"7">=n?parseInt(e.substring(1),8):"u"===n||"x"===n?parseInt(e.substring(2),16):e.charCodeAt(1)}function n(e){return 32>e?(16>e?"\\x0":"\\x")+e.toString(16):(e=String.fromCharCode(e),"\\"===e||"-"===e||"]"===e||"^"===e?"\\"+e:e)}function r(e){var r=e.substring(1,e.length-1).match(/\\u[\dA-Fa-f]{4}|\\x[\dA-Fa-f]{2}|\\[0-3][0-7]{0,2}|\\[0-7]{1,2}|\\[\S\s]|[^\\]/g),e=[],o="^"===r[0],i=["["];o&&i.push("^");for(var o=o?1:0,a=r.length;a>o;++o){var s=r[o];if(/\\[bdsw]/i.test(s))i.push(s);else{var u,s=t(s);a>o+2&&"-"===r[o+1]?(u=t(r[o+2]),o+=2):u=s,e.push([s,u]),65>u||s>122||(65>u||s>90||e.push([32|Math.max(65,s),32|Math.min(u,90)]),97>u||s>122||e.push([-33&Math.max(97,s),-33&Math.min(u,122)]))}}for(e.sort(function(e,t){return e[0]-t[0]||t[1]-e[1]}),r=[],a=[],o=0;o<e.length;++o)s=e[o],s[0]<=a[1]+1?a[1]=Math.max(a[1],s[1]):r.push(a=s);for(o=0;o<r.length;++o)s=r[o],i.push(n(s[0])),s[1]>s[0]&&(s[1]+1>s[0]&&i.push("-"),i.push(n(s[1])));return i.push("]"),i.join("")}function o(e){for(var t=e.source.match(/\[(?:[^\\\]]|\\[\S\s])*]|\\u[\dA-Fa-f]{4}|\\x[\dA-Fa-f]{2}|\\\d+|\\[^\dux]|\(\?[!:=]|[()^]|[^()[\\^]+/g),o=t.length,s=[],u=0,l=0;o>u;++u){var c=t[u];"("===c?++l:"\\"===c.charAt(0)&&(c=+c.substring(1))&&(l>=c?s[c]=-1:t[u]=n(c))}for(u=1;u<s.length;++u)-1===s[u]&&(s[u]=++i);for(l=u=0;o>u;++u)c=t[u],"("===c?(++l,s[l]||(t[u]="(?:")):"\\"===c.charAt(0)&&(c=+c.substring(1))&&l>=c&&(t[u]="\\"+s[c]);for(u=0;o>u;++u)"^"===t[u]&&"^"!==t[u+1]&&(t[u]="");if(e.ignoreCase&&a)for(u=0;o>u;++u)c=t[u],e=c.charAt(0),c.length>=2&&"["===e?t[u]=r(c):"\\"!==e&&(t[u]=c.replace(/[A-Za-z]/g,function(e){return e=e.charCodeAt(0),"["+String.fromCharCode(-33&e,32|e)+"]"}));return t.join("")}for(var i=0,a=!1,s=!1,u=0,l=e.length;l>u;++u){var c=e[u];if(c.ignoreCase)s=!0;else if(/[a-z]/i.test(c.source.replace(/\\u[\da-f]{4}|\\x[\da-f]{2}|\\[^UXux]/gi,""))){a=!0,s=!1;break}}for(var d={b:8,t:9,n:10,v:11,f:12,r:13},g=[],u=0,l=e.length;l>u;++u){if(c=e[u],c.global||c.multiline)throw Error(""+c);g.push("(?:"+o(c)+")")}return RegExp(g.join("|"),s?"gi":"g")}function n(e,t){function n(e){var u=e.nodeType;if(1==u){if(!r.test(e.className)){for(u=e.firstChild;u;u=u.nextSibling)n(u);u=e.nodeName.toLowerCase(),("br"===u||"li"===u)&&(o[s]="\n",a[s<<1]=i++,a[s++<<1|1]=e)}}else(3==u||4==u)&&(u=e.nodeValue,u.length&&(u=t?u.replace(/\r\n?/g,"\n"):u.replace(/[\t\n\r ]+/g," "),o[s]=u,a[s<<1]=i,i+=u.length,a[s++<<1|1]=e))}var r=/(?:^|\s)nocode(?:\s|$)/,o=[],i=0,a=[],s=0;return n(e),{a:o.join("").replace(/\n$/,""),d:a}}function r(e,t,n,r){t&&(e={a:t,e:e},n(e),r.push.apply(r,e.g))}function o(e){for(var t=void 0,n=e.firstChild;n;n=n.nextSibling)var r=n.nodeType,t=1===r?t?e:n:3===r&&w.test(n.nodeValue)?e:t;return t===e?void 0:t}function i(n,o){function i(e){for(var t=e.e,n=[t,"pln"],c=0,d=e.a.match(a)||[],g={},f=0,h=d.length;h>f;++f){var p,m=d[f],v=g[m],b=void 0;if("string"==typeof v)p=!1;else{var y=s[m.charAt(0)];if(y)b=m.match(y[1]),v=y[0];else{for(p=0;u>p;++p)if(y=o[p],b=m.match(y[1])){v=y[0];break}b||(v="pln")}!(p=v.length>=5&&"lang-"===v.substring(0,5))||b&&"string"==typeof b[1]||(p=!1,v="src"),p||(g[m]=v)}if(y=c,c+=m.length,p){p=b[1];var _=m.indexOf(p),w=_+p.length;b[2]&&(w=m.length-b[2].length,_=w-p.length),v=v.substring(5),r(t+y,m.substring(0,_),i,n),r(t+y+_,p,l(v,p),n),r(t+y+w,m.substring(w),i,n)}else n.push(t+y,v)}e.g=n}var a,s={};!function(){for(var r=n.concat(o),i=[],u={},l=0,c=r.length;c>l;++l){var d=r[l],g=d[3];if(g)for(var f=g.length;--f>=0;)s[g.charAt(f)]=d;d=d[1],g=""+d,u.hasOwnProperty(g)||(i.push(d),u[g]=e)}i.push(/[\S\s]/),a=t(i)}();var u=o.length;return i}function a(t){var n=[],r=[];n.push(t.tripleQuotedStrings?["str",/^(?:'''(?:[^'\\]|\\[\S\s]|''?(?=[^']))*(?:'''|$)|"""(?:[^"\\]|\\[\S\s]|""?(?=[^"]))*(?:"""|$)|'(?:[^'\\]|\\[\S\s])*(?:'|$)|"(?:[^"\\]|\\[\S\s])*(?:"|$))/,e,"'\""]:t.multiLineStrings?["str",/^(?:'(?:[^'\\]|\\[\S\s])*(?:'|$)|"(?:[^"\\]|\\[\S\s])*(?:"|$)|`(?:[^\\`]|\\[\S\s])*(?:`|$))/,e,"'\"`"]:["str",/^(?:'(?:[^\n\r'\\]|\\.)*(?:'|$)|"(?:[^\n\r"\\]|\\.)*(?:"|$))/,e,"\"'"]),t.verbatimStrings&&r.push(["str",/^@"(?:[^"]|"")*(?:"|$)/,e]);var o=t.hashComments;if(o&&(t.cStyleComments?(n.push(o>1?["com",/^#(?:##(?:[^#]|#(?!##))*(?:###|$)|.*)/,e,"#"]:["com",/^#(?:(?:define|e(?:l|nd)if|else|error|ifn?def|include|line|pragma|undef|warning)\b|[^\n\r]*)/,e,"#"]),r.push(["str",/^<(?:(?:(?:\.\.\/)*|\/?)(?:[\w-]+(?:\/[\w-]+)+)?[\w-]+\.h(?:h|pp|\+\+)?|[a-z]\w*)>/,e])):n.push(["com",/^#[^\n\r]*/,e,"#"])),t.cStyleComments&&(r.push(["com",/^\/\/[^\n\r]*/,e]),r.push(["com",/^\/\*[\S\s]*?(?:\*\/|$)/,e])),o=t.regexLiterals){var a=(o=o>1?"":"\n\r")?".":"[\\S\\s]";r.push(["lang-regex",RegExp("^(?:^^\\.?|[+-]|[!=]=?=?|\\#|%=?|&&?=?|\\(|\\*=?|[+\\-]=|->|\\/=?|::?|<<?=?|>>?>?=?|,|;|\\?|@|\\[|~|{|\\^\\^?=?|\\|\\|?=?|break|case|continue|delete|do|else|finally|instanceof|return|throw|try|typeof)\\s*("+("/(?=[^/*"+o+"])(?:[^/\\x5B\\x5C"+o+"]|\\x5C"+a+"|\\x5B(?:[^\\x5C\\x5D"+o+"]|\\x5C"+a+")*(?:\\x5D|$))+/")+")")])}return(o=t.types)&&r.push(["typ",o]),o=(""+t.keywords).replace(/^ | $/g,""),o.length&&r.push(["kwd",RegExp("^(?:"+o.replace(/[\s,]+/g,"|")+")\\b"),e]),n.push(["pln",/^\s+/,e," \r\n	 "]),o="^.[^\\s\\w.$@'\"`/\\\\]*",t.regexLiterals&&(o+="(?!s*/)"),r.push(["lit",/^@[$_a-z][\w$@]*/i,e],["typ",/^(?:[@_]?[A-Z]+[a-z][\w$@]*|\w+_t\b)/,e],["pln",/^[$_a-z][\w$@]*/i,e],["lit",/^(?:0x[\da-f]+|(?:\d(?:_\d+)*\d*(?:\.\d*)?|\.\d\+)(?:e[+-]?\d+)?)[a-z]*/i,e,"0123456789"],["pln",/^\\[\S\s]?/,e],["pun",RegExp(o),e]),i(n,r)}function s(e,t,n){function r(e){var t=e.nodeType;if(1!=t||i.test(e.className)){if((3==t||4==t)&&n){var u=e.nodeValue,l=u.match(a);l&&(t=u.substring(0,l.index),e.nodeValue=t,(u=u.substring(l.index+l[0].length))&&e.parentNode.insertBefore(s.createTextNode(u),e.nextSibling),o(e),t||e.parentNode.removeChild(e))}}else if("br"===e.nodeName)o(e),e.parentNode&&e.parentNode.removeChild(e);else for(e=e.firstChild;e;e=e.nextSibling)r(e)}function o(e){function t(e,n){var r=n?e.cloneNode(!1):e,o=e.parentNode;if(o){var o=t(o,1),i=e.nextSibling;o.appendChild(r);for(var a=i;a;a=i)i=a.nextSibling,o.appendChild(a)}return r}for(;!e.nextSibling;)if(e=e.parentNode,!e)return;for(var n,e=t(e.nextSibling,0);(n=e.parentNode)&&1===n.nodeType;)e=n;l.push(e)}for(var i=/(?:^|\s)nocode(?:\s|$)/,a=/\r\n?|\n/,s=e.ownerDocument,u=s.createElement("li");e.firstChild;)u.appendChild(e.firstChild);for(var l=[u],c=0;c<l.length;++c)r(l[c]);t===(0|t)&&l[0].setAttribute("value",t);var d=s.createElement("ol");d.className="linenums";for(var t=Math.max(0,t-1|0)||0,c=0,g=l.length;g>c;++c)u=l[c],u.className="L"+(c+t)%10,u.firstChild||u.appendChild(s.createTextNode(" ")),d.appendChild(u);e.appendChild(d)}function u(e,t){for(var n=t.length;--n>=0;){var r=t[n];k.hasOwnProperty(r)?d.console&&console.warn("cannot override language handler %s",r):k[r]=e}}function l(e,t){return e&&k.hasOwnProperty(e)||(e=/^\s*</.test(t)?"default-markup":"default-code"),k[e]}function c(e){var t=e.h;try{var r=n(e.c,e.i),o=r.a;e.a=o,e.d=r.d,e.e=0,l(t,o)(e);var i=/\bMSIE\s(\d+)/.exec(navigator.userAgent),i=i&&+i[1]<=8,t=/\n/g,a=e.a,s=a.length,r=0,u=e.d,c=u.length,o=0,g=e.g,f=g.length,h=0;g[f]=s;var p,m;for(m=p=0;f>m;)g[m]!==g[m+2]?(g[p++]=g[m++],g[p++]=g[m++]):m+=2;for(f=p,m=p=0;f>m;){for(var v=g[m],b=g[m+1],y=m+2;f>=y+2&&g[y+1]===b;)y+=2;g[p++]=v,g[p++]=b,m=y}g.length=p;var _,w=e.c;w&&(_=w.style.display,w.style.display="none");try{for(;c>o;){var C,k=u[o+2]||s,M=g[h+2]||s,y=Math.min(k,M),L=u[o+1];if(1!==L.nodeType&&(C=a.substring(r,y))){i&&(C=C.replace(t,"\r")),L.nodeValue=C;var S=L.ownerDocument,T=S.createElement("span");T.className=g[h+1];var x=L.parentNode;x.replaceChild(T,L),T.appendChild(L),k>r&&(u[o+1]=L=S.createTextNode(a.substring(y,k)),x.insertBefore(L,T.nextSibling))}r=y,r>=k&&(o+=2),r>=M&&(h+=2)}}finally{w&&(w.style.display=_)}}catch(z){d.console&&console.log(z&&z.stack||z)}}var d=window,g=["break,continue,do,else,for,if,return,while"],f=[[g,"auto,case,char,const,default,double,enum,extern,float,goto,inline,int,long,register,short,signed,sizeof,static,struct,switch,typedef,union,unsigned,void,volatile"],"catch,class,delete,false,import,new,operator,private,protected,public,this,throw,true,try,typeof"],h=[f,"alignof,align_union,asm,axiom,bool,concept,concept_map,const_cast,constexpr,decltype,delegate,dynamic_cast,explicit,export,friend,generic,late_check,mutable,namespace,nullptr,property,reinterpret_cast,static_assert,static_cast,template,typeid,typename,using,virtual,where"],p=[f,"abstract,assert,boolean,byte,extends,final,finally,implements,import,instanceof,interface,null,native,package,strictfp,super,synchronized,throws,transient"],m=[p,"as,base,by,checked,decimal,delegate,descending,dynamic,event,fixed,foreach,from,group,implicit,in,internal,into,is,let,lock,object,out,override,orderby,params,partial,readonly,ref,sbyte,sealed,stackalloc,string,select,uint,ulong,unchecked,unsafe,ushort,var,virtual,where"],f=[f,"debugger,eval,export,function,get,null,set,undefined,var,with,Infinity,NaN"],v=[g,"and,as,assert,class,def,del,elif,except,exec,finally,from,global,import,in,is,lambda,nonlocal,not,or,pass,print,raise,try,with,yield,False,True,None"],b=[g,"alias,and,begin,case,class,def,defined,elsif,end,ensure,false,in,module,next,nil,not,or,redo,rescue,retry,self,super,then,true,undef,unless,until,when,yield,BEGIN,END"],y=[g,"as,assert,const,copy,drop,enum,extern,fail,false,fn,impl,let,log,loop,match,mod,move,mut,priv,pub,pure,ref,self,static,struct,true,trait,type,unsafe,use"],g=[g,"case,done,elif,esac,eval,fi,function,in,local,set,then,until"],_=/^(DIR|FILE|vector|(de|priority_)?queue|list|stack|(const_)?iterator|(multi)?(set|map)|bitset|u?(int|float)\d*)\b/,w=/\S/,C=a({keywords:[h,m,f,"caller,delete,die,do,dump,elsif,eval,exit,foreach,for,goto,if,import,last,local,my,next,no,our,print,package,redo,require,sub,undef,unless,until,use,wantarray,while,BEGIN,END",v,b,g],hashComments:!0,cStyleComments:!0,multiLineStrings:!0,regexLiterals:!0}),k={};u(C,["default-code"]),u(i([],[["pln",/^[^<?]+/],["dec",/^<!\w[^>]*(?:>|$)/],["com",/^<\!--[\S\s]*?(?:--\>|$)/],["lang-",/^<\?([\S\s]+?)(?:\?>|$)/],["lang-",/^<%([\S\s]+?)(?:%>|$)/],["pun",/^(?:<[%?]|[%?]>)/],["lang-",/^<xmp\b[^>]*>([\S\s]+?)<\/xmp\b[^>]*>/i],["lang-js",/^<script\b[^>]*>([\S\s]*?)(<\/script\b[^>]*>)/i],["lang-css",/^<style\b[^>]*>([\S\s]*?)(<\/style\b[^>]*>)/i],["lang-in.tag",/^(<\/?[a-z][^<>]*>)/i]]),["default-markup","htm","html","mxml","xhtml","xml","xsl"]),u(i([["pln",/^\s+/,e," 	\r\n"],["atv",/^(?:"[^"]*"?|'[^']*'?)/,e,"\"'"]],[["tag",/^^<\/?[a-z](?:[\w-.:]*\w)?|\/?>$/i],["atn",/^(?!style[\s=]|on)[a-z](?:[\w:-]*\w)?/i],["lang-uq.val",/^=\s*([^\s"'>]*(?:[^\s"'/>]|\/(?=\s)))/],["pun",/^[/<->]+/],["lang-js",/^on\w+\s*=\s*"([^"]+)"/i],["lang-js",/^on\w+\s*=\s*'([^']+)'/i],["lang-js",/^on\w+\s*=\s*([^\s"'>]+)/i],["lang-css",/^style\s*=\s*"([^"]+)"/i],["lang-css",/^style\s*=\s*'([^']+)'/i],["lang-css",/^style\s*=\s*([^\s"'>]+)/i]]),["in.tag"]),u(i([],[["atv",/^[\S\s]+/]]),["uq.val"]),u(a({keywords:h,hashComments:!0,cStyleComments:!0,types:_}),["c","cc","cpp","cxx","cyc","m"]),u(a({keywords:"null,true,false"}),["json"]),u(a({keywords:m,hashComments:!0,cStyleComments:!0,verbatimStrings:!0,
types:_}),["cs"]),u(a({keywords:p,cStyleComments:!0}),["java"]),u(a({keywords:g,hashComments:!0,multiLineStrings:!0}),["bash","bsh","csh","sh"]),u(a({keywords:v,hashComments:!0,multiLineStrings:!0,tripleQuotedStrings:!0}),["cv","py","python"]),u(a({keywords:"caller,delete,die,do,dump,elsif,eval,exit,foreach,for,goto,if,import,last,local,my,next,no,our,print,package,redo,require,sub,undef,unless,until,use,wantarray,while,BEGIN,END",hashComments:!0,multiLineStrings:!0,regexLiterals:2}),["perl","pl","pm"]),u(a({keywords:b,hashComments:!0,multiLineStrings:!0,regexLiterals:!0}),["rb","ruby"]),u(a({keywords:f,cStyleComments:!0,regexLiterals:!0}),["javascript","js"]),u(a({keywords:"all,and,by,catch,class,else,extends,false,finally,for,if,in,is,isnt,loop,new,no,not,null,of,off,on,or,return,super,then,throw,true,try,unless,until,when,while,yes",hashComments:3,cStyleComments:!0,multilineStrings:!0,tripleQuotedStrings:!0,regexLiterals:!0}),["coffee"]),u(a({keywords:y,cStyleComments:!0,multilineStrings:!0}),["rc","rs","rust"]),u(i([],[["str",/^[\S\s]+/]]),["regex"]);var M=d.PR={createSimpleLexer:i,registerLangHandler:u,sourceDecorator:a,PR_ATTRIB_NAME:"atn",PR_ATTRIB_VALUE:"atv",PR_COMMENT:"com",PR_DECLARATION:"dec",PR_KEYWORD:"kwd",PR_LITERAL:"lit",PR_NOCODE:"nocode",PR_PLAIN:"pln",PR_PUNCTUATION:"pun",PR_SOURCE:"src",PR_STRING:"str",PR_TAG:"tag",PR_TYPE:"typ",prettyPrintOne:d.prettyPrintOne=function(e,t,n){var r=document.createElement("div");return r.innerHTML="<pre>"+e+"</pre>",r=r.firstChild,n&&s(r,n,!0),c({h:t,j:n,c:r,i:1}),r.innerHTML},prettyPrint:d.prettyPrint=function(t,n){function r(){for(var n=d.PR_SHOULD_USE_CONTINUATION?h.now()+250:1/0;m<u.length&&h.now()<n;m++){for(var i=u[m],l=k,g=i;g=g.previousSibling;){var f=g.nodeType,M=(7===f||8===f)&&g.nodeValue;if(M?!/^\??prettify\b/.test(M):3!==f||/\S/.test(g.nodeValue))break;if(M){l={},M.replace(/\b(\w+)=([\w%+\-.:]+)/g,function(e,t,n){l[t]=n});break}}if(g=i.className,(l!==k||b.test(g))&&!y.test(g)){for(f=!1,M=i.parentNode;M;M=M.parentNode)if(C.test(M.tagName)&&M.className&&b.test(M.className)){f=!0;break}if(!f){if(i.className+=" prettyprinted",f=l.lang,!f){var L,f=g.match(v);!f&&(L=o(i))&&w.test(L.tagName)&&(f=L.className.match(v)),f&&(f=f[1])}if(_.test(i.tagName))M=1;else var M=i.currentStyle,S=a.defaultView,M=(M=M?M.whiteSpace:S&&S.getComputedStyle?S.getComputedStyle(i,e).getPropertyValue("white-space"):0)&&"pre"===M.substring(0,3);S=l.linenums,(S="true"===S||+S)||(S=(S=g.match(/\blinenums\b(?::(\d+))?/))?S[1]&&S[1].length?+S[1]:!0:!1),S&&s(i,S,M),p={h:f,c:i,j:S,i:M},c(p)}}}m<u.length?setTimeout(r,250):"function"==typeof t&&t()}for(var i=n||document.body,a=i.ownerDocument||document,i=[i.getElementsByTagName("pre"),i.getElementsByTagName("code"),i.getElementsByTagName("xmp")],u=[],l=0;l<i.length;++l)for(var g=0,f=i[l].length;f>g;++g)u.push(i[l][g]);var i=e,h=Date;h.now||(h={now:function(){return+new Date}});var p,m=0,v=/\blang(?:uage)?-([\w.]+)(?!\S)/,b=/\bprettyprint\b/,y=/\bprettyprinted\b/,_=/pre|xmp/i,w=/^code$/i,C=/^(?:pre|code|xmp)$/i,k={};r()}};"function"==typeof define&&define.amd&&define("google-code-prettify",[],function(){return M})}()}()},{}],6:[function(e,t,n){var r;!function(){function e(e){this.mode=c.MODE_8BIT_BYTE,this.data=e,this.parsedData=[];for(var t=0,n=this.data.length;n>t;t++){var r=[],o=this.data.charCodeAt(t);o>65536?(r[0]=240|(1835008&o)>>>18,r[1]=128|(258048&o)>>>12,r[2]=128|(4032&o)>>>6,r[3]=128|63&o):o>2048?(r[0]=224|(61440&o)>>>12,r[1]=128|(4032&o)>>>6,r[2]=128|63&o):o>128?(r[0]=192|(1984&o)>>>6,r[1]=128|63&o):r[0]=o,this.parsedData.push(r)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function t(e,t){this.typeNumber=e,this.errorCorrectLevel=t,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function n(e,t){if(void 0==e.length)throw new Error(e.length+"/"+t);for(var n=0;n<e.length&&0==e[n];)n++;this.num=new Array(e.length-n+t);for(var r=0;r<e.length-n;r++)this.num[r]=e[r+n]}function o(e,t){this.totalCount=e,this.dataCount=t}function i(){this.buffer=[],this.length=0}function a(){return"undefined"!=typeof CanvasRenderingContext2D}function s(){var e=!1,t=navigator.userAgent;if(/android/i.test(t)){e=!0;var n=t.toString().match(/android ([0-9]\.[0-9])/i);n&&n[1]&&(e=parseFloat(n[1]))}return e}function u(e,t){for(var n=1,r=l(e),o=0,i=m.length;i>=o;o++){var a=0;switch(t){case d.L:a=m[o][0];break;case d.M:a=m[o][1];break;case d.Q:a=m[o][2];break;case d.H:a=m[o][3]}if(a>=r)break;n++}if(n>m.length)throw new Error("Too long data");return n}function l(e){var t=encodeURI(e).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return t.length+(t.length!=e?3:0)}e.prototype={getLength:function(e){return this.parsedData.length},write:function(e){for(var t=0,n=this.parsedData.length;n>t;t++)e.put(this.parsedData[t],8)}},t.prototype={addData:function(t){var n=new e(t);this.dataList.push(n),this.dataCache=null},isDark:function(e,t){if(0>e||this.moduleCount<=e||0>t||this.moduleCount<=t)throw new Error(e+","+t);return this.modules[e][t]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(e,n){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++){this.modules[r]=new Array(this.moduleCount);for(var o=0;o<this.moduleCount;o++)this.modules[r][o]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(e,n),this.typeNumber>=7&&this.setupTypeNumber(e),null==this.dataCache&&(this.dataCache=t.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,n)},setupPositionProbePattern:function(e,t){for(var n=-1;7>=n;n++)if(!(-1>=e+n||this.moduleCount<=e+n))for(var r=-1;7>=r;r++)-1>=t+r||this.moduleCount<=t+r||(this.modules[e+n][t+r]=n>=0&&6>=n&&(0==r||6==r)||r>=0&&6>=r&&(0==n||6==n)||n>=2&&4>=n&&r>=2&&4>=r?!0:!1)},getBestMaskPattern:function(){for(var e=0,t=0,n=0;8>n;n++){this.makeImpl(!0,n);var r=f.getLostPoint(this);(0==n||e>r)&&(e=r,t=n)}return t},createMovieClip:function(e,t,n){var r=e.createEmptyMovieClip(t,n),o=1;this.make();for(var i=0;i<this.modules.length;i++)for(var a=i*o,s=0;s<this.modules[i].length;s++){var u=s*o,l=this.modules[i][s];l&&(r.beginFill(0,100),r.moveTo(u,a),r.lineTo(u+o,a),r.lineTo(u+o,a+o),r.lineTo(u,a+o),r.endFill())}return r},setupTimingPattern:function(){for(var e=8;e<this.moduleCount-8;e++)null==this.modules[e][6]&&(this.modules[e][6]=e%2==0);for(var t=8;t<this.moduleCount-8;t++)null==this.modules[6][t]&&(this.modules[6][t]=t%2==0)},setupPositionAdjustPattern:function(){for(var e=f.getPatternPosition(this.typeNumber),t=0;t<e.length;t++)for(var n=0;n<e.length;n++){var r=e[t],o=e[n];if(null==this.modules[r][o])for(var i=-2;2>=i;i++)for(var a=-2;2>=a;a++)this.modules[r+i][o+a]=-2==i||2==i||-2==a||2==a||0==i&&0==a?!0:!1}},setupTypeNumber:function(e){for(var t=f.getBCHTypeNumber(this.typeNumber),n=0;18>n;n++){var r=!e&&1==(t>>n&1);this.modules[Math.floor(n/3)][n%3+this.moduleCount-8-3]=r}for(var n=0;18>n;n++){var r=!e&&1==(t>>n&1);this.modules[n%3+this.moduleCount-8-3][Math.floor(n/3)]=r}},setupTypeInfo:function(e,t){for(var n=this.errorCorrectLevel<<3|t,r=f.getBCHTypeInfo(n),o=0;15>o;o++){var i=!e&&1==(r>>o&1);6>o?this.modules[o][8]=i:8>o?this.modules[o+1][8]=i:this.modules[this.moduleCount-15+o][8]=i}for(var o=0;15>o;o++){var i=!e&&1==(r>>o&1);8>o?this.modules[8][this.moduleCount-o-1]=i:9>o?this.modules[8][15-o-1+1]=i:this.modules[8][15-o-1]=i}this.modules[this.moduleCount-8][8]=!e},mapData:function(e,t){for(var n=-1,r=this.moduleCount-1,o=7,i=0,a=this.moduleCount-1;a>0;a-=2)for(6==a&&a--;;){for(var s=0;2>s;s++)if(null==this.modules[r][a-s]){var u=!1;i<e.length&&(u=1==(e[i]>>>o&1));var l=f.getMask(t,r,a-s);l&&(u=!u),this.modules[r][a-s]=u,o--,-1==o&&(i++,o=7)}if(r+=n,0>r||this.moduleCount<=r){r-=n,n=-n;break}}}},t.PAD0=236,t.PAD1=17,t.createData=function(e,n,r){for(var a=o.getRSBlocks(e,n),s=new i,u=0;u<r.length;u++){var l=r[u];s.put(l.mode,4),s.put(l.getLength(),f.getLengthInBits(l.mode,e)),l.write(s)}for(var c=0,u=0;u<a.length;u++)c+=a[u].dataCount;if(s.getLengthInBits()>8*c)throw new Error("code length overflow. ("+s.getLengthInBits()+">"+8*c+")");for(s.getLengthInBits()+4<=8*c&&s.put(0,4);s.getLengthInBits()%8!=0;)s.putBit(!1);for(;;){if(s.getLengthInBits()>=8*c)break;if(s.put(t.PAD0,8),s.getLengthInBits()>=8*c)break;s.put(t.PAD1,8)}return t.createBytes(s,a)},t.createBytes=function(e,t){for(var r=0,o=0,i=0,a=new Array(t.length),s=new Array(t.length),u=0;u<t.length;u++){var l=t[u].dataCount,c=t[u].totalCount-l;o=Math.max(o,l),i=Math.max(i,c),a[u]=new Array(l);for(var d=0;d<a[u].length;d++)a[u][d]=255&e.buffer[d+r];r+=l;var g=f.getErrorCorrectPolynomial(c),h=new n(a[u],g.getLength()-1),p=h.mod(g);s[u]=new Array(g.getLength()-1);for(var d=0;d<s[u].length;d++){var m=d+p.getLength()-s[u].length;s[u][d]=m>=0?p.get(m):0}}for(var v=0,d=0;d<t.length;d++)v+=t[d].totalCount;for(var b=new Array(v),y=0,d=0;o>d;d++)for(var u=0;u<t.length;u++)d<a[u].length&&(b[y++]=a[u][d]);for(var d=0;i>d;d++)for(var u=0;u<t.length;u++)d<s[u].length&&(b[y++]=s[u][d]);return b};for(var c={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},d={L:1,M:0,Q:3,H:2},g={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},f={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(e){for(var t=e<<10;f.getBCHDigit(t)-f.getBCHDigit(f.G15)>=0;)t^=f.G15<<f.getBCHDigit(t)-f.getBCHDigit(f.G15);return(e<<10|t)^f.G15_MASK},getBCHTypeNumber:function(e){for(var t=e<<12;f.getBCHDigit(t)-f.getBCHDigit(f.G18)>=0;)t^=f.G18<<f.getBCHDigit(t)-f.getBCHDigit(f.G18);return e<<12|t},getBCHDigit:function(e){for(var t=0;0!=e;)t++,e>>>=1;return t},getPatternPosition:function(e){return f.PATTERN_POSITION_TABLE[e-1]},getMask:function(e,t,n){switch(e){case g.PATTERN000:return(t+n)%2==0;case g.PATTERN001:return t%2==0;case g.PATTERN010:return n%3==0;case g.PATTERN011:return(t+n)%3==0;case g.PATTERN100:return(Math.floor(t/2)+Math.floor(n/3))%2==0;case g.PATTERN101:return t*n%2+t*n%3==0;case g.PATTERN110:return(t*n%2+t*n%3)%2==0;case g.PATTERN111:return(t*n%3+(t+n)%2)%2==0;default:throw new Error("bad maskPattern:"+e)}},getErrorCorrectPolynomial:function(e){for(var t=new n([1],0),r=0;e>r;r++)t=t.multiply(new n([1,h.gexp(r)],0));return t},getLengthInBits:function(e,t){if(t>=1&&10>t)switch(e){case c.MODE_NUMBER:return 10;case c.MODE_ALPHA_NUM:return 9;case c.MODE_8BIT_BYTE:return 8;case c.MODE_KANJI:return 8;default:throw new Error("mode:"+e)}else if(27>t)switch(e){case c.MODE_NUMBER:return 12;case c.MODE_ALPHA_NUM:return 11;case c.MODE_8BIT_BYTE:return 16;case c.MODE_KANJI:return 10;default:throw new Error("mode:"+e)}else{if(!(41>t))throw new Error("type:"+t);switch(e){case c.MODE_NUMBER:return 14;case c.MODE_ALPHA_NUM:return 13;case c.MODE_8BIT_BYTE:return 16;case c.MODE_KANJI:return 12;default:throw new Error("mode:"+e)}}},getLostPoint:function(e){for(var t=e.getModuleCount(),n=0,r=0;t>r;r++)for(var o=0;t>o;o++){for(var i=0,a=e.isDark(r,o),s=-1;1>=s;s++)if(!(0>r+s||r+s>=t))for(var u=-1;1>=u;u++)0>o+u||o+u>=t||(0!=s||0!=u)&&a==e.isDark(r+s,o+u)&&i++;i>5&&(n+=3+i-5)}for(var r=0;t-1>r;r++)for(var o=0;t-1>o;o++){var l=0;e.isDark(r,o)&&l++,e.isDark(r+1,o)&&l++,e.isDark(r,o+1)&&l++,e.isDark(r+1,o+1)&&l++,(0==l||4==l)&&(n+=3)}for(var r=0;t>r;r++)for(var o=0;t-6>o;o++)e.isDark(r,o)&&!e.isDark(r,o+1)&&e.isDark(r,o+2)&&e.isDark(r,o+3)&&e.isDark(r,o+4)&&!e.isDark(r,o+5)&&e.isDark(r,o+6)&&(n+=40);for(var o=0;t>o;o++)for(var r=0;t-6>r;r++)e.isDark(r,o)&&!e.isDark(r+1,o)&&e.isDark(r+2,o)&&e.isDark(r+3,o)&&e.isDark(r+4,o)&&!e.isDark(r+5,o)&&e.isDark(r+6,o)&&(n+=40);for(var c=0,o=0;t>o;o++)for(var r=0;t>r;r++)e.isDark(r,o)&&c++;var d=Math.abs(100*c/t/t-50)/5;return n+=10*d}},h={glog:function(e){if(1>e)throw new Error("glog("+e+")");return h.LOG_TABLE[e]},gexp:function(e){for(;0>e;)e+=255;for(;e>=256;)e-=255;return h.EXP_TABLE[e]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},p=0;8>p;p++)h.EXP_TABLE[p]=1<<p;for(var p=8;256>p;p++)h.EXP_TABLE[p]=h.EXP_TABLE[p-4]^h.EXP_TABLE[p-5]^h.EXP_TABLE[p-6]^h.EXP_TABLE[p-8];for(var p=0;255>p;p++)h.LOG_TABLE[h.EXP_TABLE[p]]=p;n.prototype={get:function(e){return this.num[e]},getLength:function(){return this.num.length},multiply:function(e){for(var t=new Array(this.getLength()+e.getLength()-1),r=0;r<this.getLength();r++)for(var o=0;o<e.getLength();o++)t[r+o]^=h.gexp(h.glog(this.get(r))+h.glog(e.get(o)));return new n(t,0)},mod:function(e){if(this.getLength()-e.getLength()<0)return this;for(var t=h.glog(this.get(0))-h.glog(e.get(0)),r=new Array(this.getLength()),o=0;o<this.getLength();o++)r[o]=this.get(o);for(var o=0;o<e.getLength();o++)r[o]^=h.gexp(h.glog(e.get(o))+t);return new n(r,0).mod(e)}},o.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],o.getRSBlocks=function(e,t){var n=o.getRsBlockTable(e,t);if(void 0==n)throw new Error("bad rs block @ typeNumber:"+e+"/errorCorrectLevel:"+t);for(var r=n.length/3,i=[],a=0;r>a;a++)for(var s=n[3*a+0],u=n[3*a+1],l=n[3*a+2],c=0;s>c;c++)i.push(new o(u,l));return i},o.getRsBlockTable=function(e,t){switch(t){case d.L:return o.RS_BLOCK_TABLE[4*(e-1)+0];case d.M:return o.RS_BLOCK_TABLE[4*(e-1)+1];case d.Q:return o.RS_BLOCK_TABLE[4*(e-1)+2];case d.H:return o.RS_BLOCK_TABLE[4*(e-1)+3];default:return void 0}},i.prototype={get:function(e){var t=Math.floor(e/8);return 1==(this.buffer[t]>>>7-e%8&1)},put:function(e,t){for(var n=0;t>n;n++)this.putBit(1==(e>>>t-n-1&1))},getLengthInBits:function(){return this.length},putBit:function(e){var t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}};var m=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],v=function(){var e=function(e,t){this._el=e,this._htOption=t};return e.prototype.draw=function(e){function t(e,t){var n=document.createElementNS("http://www.w3.org/2000/svg",e);for(var r in t)t.hasOwnProperty(r)&&n.setAttribute(r,t[r]);return n}{var n=this._htOption,r=this._el,o=e.getModuleCount();Math.floor(n.width/o),Math.floor(n.height/o)}this.clear();var i=t("svg",{viewBox:"0 0 "+String(o)+" "+String(o),width:"100%",height:"100%",fill:n.colorLight});i.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),r.appendChild(i),i.appendChild(t("rect",{fill:n.colorLight,width:"100%",height:"100%"})),i.appendChild(t("rect",{fill:n.colorDark,width:"1",height:"1",id:"template"}));for(var a=0;o>a;a++)for(var s=0;o>s;s++)if(e.isDark(a,s)){var u=t("use",{x:String(a),y:String(s)});u.setAttributeNS("http://www.w3.org/1999/xlink","href","#template"),i.appendChild(u)}},e.prototype.clear=function(){for(;this._el.hasChildNodes();)this._el.removeChild(this._el.lastChild)},e}(),b="svg"===document.documentElement.tagName.toLowerCase(),y=b?v:a()?function(){function e(){this._elImage.src=this._elCanvas.toDataURL("image/png"),this._elImage.style.display="block",this._elCanvas.style.display="none"}function t(e,t){var n=this;if(n._fFail=t,n._fSuccess=e,null===n._bSupportDataURI){var r=document.createElement("img"),o=function(){n._bSupportDataURI=!1,n._fFail&&n._fFail.call(n)},i=function(){n._bSupportDataURI=!0,n._fSuccess&&n._fSuccess.call(n)};return r.onabort=o,r.onerror=o,r.onload=i,void(r.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==")}n._bSupportDataURI===!0&&n._fSuccess?n._fSuccess.call(n):n._bSupportDataURI===!1&&n._fFail&&n._fFail.call(n)}if(this._android&&this._android<=2.1){var n=1/window.devicePixelRatio,r=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(e,t,o,i,a,s,u,l,c){if("nodeName"in e&&/img/i.test(e.nodeName))for(var d=arguments.length-1;d>=1;d--)arguments[d]=arguments[d]*n;else"undefined"==typeof l&&(arguments[1]*=n,arguments[2]*=n,arguments[3]*=n,arguments[4]*=n);r.apply(this,arguments)}}var o=function(e,t){this._bIsPainted=!1,this._android=s(),this._htOption=t,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=t.width,this._elCanvas.height=t.height,e.appendChild(this._elCanvas),this._el=e,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._elImage=document.createElement("img"),this._elImage.alt="Scan me!",this._elImage.style.display="none",this._el.appendChild(this._elImage),this._bSupportDataURI=null};return o.prototype.draw=function(e){var t=this._elImage,n=this._oContext,r=this._htOption,o=e.getModuleCount(),i=r.width/o,a=r.height/o,s=Math.round(i),u=Math.round(a);t.style.display="none",this.clear();for(var l=0;o>l;l++)for(var c=0;o>c;c++){var d=e.isDark(l,c),g=c*i,f=l*a;n.strokeStyle=d?r.colorDark:r.colorLight,n.lineWidth=1,n.fillStyle=d?r.colorDark:r.colorLight,n.fillRect(g,f,i,a),n.strokeRect(Math.floor(g)+.5,Math.floor(f)+.5,s,u),n.strokeRect(Math.ceil(g)-.5,Math.ceil(f)-.5,s,u)}this._bIsPainted=!0},o.prototype.makeImage=function(){this._bIsPainted&&t.call(this,e)},o.prototype.isPainted=function(){return this._bIsPainted},o.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},o.prototype.round=function(e){return e?Math.floor(1e3*e)/1e3:e},o}():function(){var e=function(e,t){this._el=e,this._htOption=t};return e.prototype.draw=function(e){for(var t=this._htOption,n=this._el,r=e.getModuleCount(),o=Math.floor(t.width/r),i=Math.floor(t.height/r),a=['<table style="border:0;border-collapse:collapse;">'],s=0;r>s;s++){a.push("<tr>");for(var u=0;r>u;u++)a.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+o+"px;height:"+i+"px;background-color:"+(e.isDark(s,u)?t.colorDark:t.colorLight)+';"></td>');a.push("</tr>")}a.push("</table>"),n.innerHTML=a.join("");var l=n.childNodes[0],c=(t.width-l.offsetWidth)/2,d=(t.height-l.offsetHeight)/2;c>0&&d>0&&(l.style.margin=d+"px "+c+"px")},e.prototype.clear=function(){this._el.innerHTML=""},e}();r=function(e,t){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:d.H},"string"==typeof t&&(t={text:t}),t)for(var n in t)this._htOption[n]=t[n];"string"==typeof e&&(e=document.getElementById(e)),this._htOption.useSVG&&(y=v),this._android=s(),this._el=e,this._oQRCode=null,this._oDrawing=new y(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)},r.prototype.makeCode=function(e){this._oQRCode=new t(u(e,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(e),this._oQRCode.make(),this._el.title=e,this._oDrawing.draw(this._oQRCode),this.makeImage()},r.prototype.makeImage=function(){"function"==typeof this._oDrawing.makeImage&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},r.prototype.clear=function(){this._oDrawing.clear()},r.CorrectLevel=d}(),t.exports=r},{}],7:[function(e,t,n){function r(e){return e=k?e.replace("Ctrl","Cmd"):e.replace("Cmd","Ctrl")}function o(e,t){t=t||{};var n=document.createElement("a"),o=t.shortcut||M[e];return o&&(o=r(o),n.title=o,n.title=n.title.replace("Cmd","⌘"),k&&(n.title=n.title.replace("Alt","⌥"))),t.title&&(n.title=t.title),n.className=t.className||"icon-"+e,n}function i(){return el=document.createElement("i"),el.className="separator",el.innerHTML="|",el}function a(e,t){t=t||e.getCursor("start");var n=e.getTokenAt(t);if(!n.type)return{};for(var r,o,i=n.type.split(" "),a={},s=0;s<i.length;s++)r=i[s],"strong"===r?a.bold=!0:"variable-2"===r?(o=e.getLine(t.line),/^\s*\d+\.\s/.test(o)?a["ordered-list"]=!0:a["unordered-list"]=!0):"atom"===r?a.quote=!0:"em"===r&&(a.italic=!0);return a}function s(e){var t=e.codemirror.getWrapperElement(),n=document,r=n.fullScreen||n.mozFullScreen||n.webkitFullScreen,o=function(){t.requestFullScreen?t.requestFullScreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullScreen&&t.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)},i=function(){n.cancelFullScreen?n.cancelFullScreen():n.mozCancelFullScreen?n.mozCancelFullScreen():n.webkitCancelFullScreen&&n.webkitCancelFullScreen()};r?i&&i():o()}function u(e){if(L)return!1;var t,n=e.codemirror,r=a(n),o="**",i="**",s=n.getCursor("start"),u=n.getCursor("end");r.bold?(t=n.getLine(s.line),o=t.slice(0,s.ch),i=t.slice(s.ch),o=o.replace(/^(.*)?(\*|\_){2}(\S+.*)?$/,"$1$3"),i=i.replace(/^(.*\S+)?(\*|\_){2}(\s+.*)?$/,"$1$3"),s.ch-=2,u.ch-=2,n.setLine(s.line,o+i)):(t=n.getSelection(),n.replaceSelection(o+t+i),s.ch+=2,u.ch+=2),n.setSelection(s,u),n.focus()}function l(e){if(L)return!1;var t,n=e.codemirror,r=a(n),o="*",i="*",s=n.getCursor("start"),u=n.getCursor("end");r.italic?(t=n.getLine(s.line),o=t.slice(0,s.ch),i=t.slice(s.ch),o=o.replace(/^(.*)?(\*|\_)(\S+.*)?$/,"$1$3"),i=i.replace(/^(.*\S+)?(\*|\_)(\s+.*)?$/,"$1$3"),s.ch-=1,u.ch-=1,n.setLine(s.line,o+i)):(t=n.getSelection(),n.replaceSelection(o+t+i),s.ch+=1,u.ch+=1),n.setSelection(s,u),n.focus()}function c(e){if(L)return!1;var t=e.codemirror;y(t,"quote")}function d(e){if(L)return!1;var t=e.codemirror;y(t,"unordered-list")}function g(e){if(L)return!1;var t=e.codemirror;y(t,"ordered-list")}function f(e){if(L)return!1;var t=e.codemirror,n=a(t);b(t,n.link,"[标题","](http://)")}function h(e){if(L)return!1;var t=e.codemirror,n=a(t);b(t,n.image,"![","](http://)")}function p(e){var t=e.codemirror;t.undo(),t.focus()}function m(e){var t=e.codemirror;t.redo(),t.focus()}function v(e){var t=e.toolbar.preview,n=e.constructor.markdown,r=e.codemirror,o=r.getWrapperElement(),i=o.lastChild;/editor-preview/.test(i.className)||(i=document.createElement("div"),i.className="editor-preview markdown-body",i.title="预览模式，退出后可进行编辑！",o.appendChild(i),L=!1),/editor-preview-active/.test(i.className)?(i.className=i.className.replace(/\s*editor-preview-active\s*/g,""),L=!1,t.className=t.className.replace(/\s*active\s*/g,"")):(setTimeout(function(){i.className+=" editor-preview-active"},1),t.className+=" active",L=!0);var a=r.getValue();i.innerHTML=n(a)}function b(e,t,n,r){var o,i=e.getCursor("start"),a=e.getCursor("end");t?(o=e.getLine(i.line),n=o.slice(0,i.ch),r=o.slice(i.ch),e.setLine(i.line,n+r)):(o=e.getSelection(),e.replaceSelection(n+o+r),i.ch+=n.length,a.ch+=n.length),e.setSelection(i,a),e.focus()}function y(e,t){for(var n=a(e),r=e.getCursor("start"),o=e.getCursor("end"),i={quote:/^(\s*)\>\s+/,"unordered-list":/^(\s*)(\*|\-|\+)\s+/,"ordered-list":/^(\s*)\d+\.\s+/},s={quote:"> ","unordered-list":"* ","ordered-list":"1. "},u=r.line;u<=o.line;u++)!function(r){var o=e.getLine(r);o=n[t]?o.replace(i[t],"$1"):s[t]+o,e.setLine(r,o)}(u);e.focus()}function _(e){var t=/[a-zA-Z0-9_\u0392-\u03c9]+|[\u4E00-\u9FFF\u3400-\u4dbf\uf900-\ufaff\u3040-\u309f\uac00-\ud7af]+/g,n=e.match(t),r=0;if(null===n)return r;for(var o=0;o<n.length;o++)r+=n[o].charCodeAt(0)>=19968?n[o].length:1;return r}function w(e){e=e||{},e.element&&(this.element=e.element),e.toolbar=e.toolbar||w.toolbar,e.hasOwnProperty("status")||(e.status=["lines","words","cursor"]),this.options=e,this.element&&this.render()}var C=function(){"use strict";function e(n,r){if(!(this instanceof e))return new e(n,r);this.options=r=r||{};for(var o in ro)!r.hasOwnProperty(o)&&ro.hasOwnProperty(o)&&(r[o]=ro[o]);g(r);var i="string"==typeof r.value?0:r.value.first,a=this.display=t(n,i);a.wrapper.CodeMirror=this,l(this),r.autofocus&&!Or&&fe(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,draggingText:!1,highlight:new Yn},s(this),r.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap");var u=r.value;"string"==typeof u&&(u=new bo(r.value,r.mode)),ie(this,cn)(this,u),Mr&&setTimeout(er(ge,this,!0),20),pe(this);var c;try{c=document.activeElement==a.input}catch(d){}c||r.autofocus&&!Or?setTimeout(er(De,this),20):Ee(this),ie(this,function(){for(var e in no)no.propertyIsEnumerable(e)&&no[e](this,r[e],oo);for(var t=0;t<uo.length;++t)uo[t](this)})()}function t(e,t){var n={},r=n.input=rr("textarea",null,null,"position: absolute; padding: 0; width: 1px; height: 1em; outline: none; font-size: 4px;");return Tr?r.style.width="1000px":r.setAttribute("wrap","off"),Br&&(r.style.border="1px solid black"),r.setAttribute("autocorrect","off"),r.setAttribute("autocapitalize","off"),r.setAttribute("spellcheck","false"),n.inputDiv=rr("div",[r],null,"overflow: hidden; position: relative; width: 3px; height: 0px;"),n.scrollbarH=rr("div",[rr("div",null,null,"height: 1px")],"CodeMirror-hscrollbar"),n.scrollbarV=rr("div",[rr("div",null,null,"width: 1px")],"CodeMirror-vscrollbar"),n.scrollbarFiller=rr("div",null,"CodeMirror-scrollbar-filler"),n.gutterFiller=rr("div",null,"CodeMirror-gutter-filler"),n.lineDiv=rr("div",null,"CodeMirror-code"),n.selectionDiv=rr("div",null,null,"position: relative; z-index: 1"),n.cursor=rr("div"," ","CodeMirror-cursor"),n.otherCursor=rr("div"," ","CodeMirror-cursor CodeMirror-secondarycursor"),n.measure=rr("div",null,"CodeMirror-measure"),n.lineSpace=rr("div",[n.measure,n.selectionDiv,n.lineDiv,n.cursor,n.otherCursor],null,"position: relative; outline: none"),n.mover=rr("div",[rr("div",[n.lineSpace],"CodeMirror-lines")],null,"position: relative"),n.sizer=rr("div",[n.mover],"CodeMirror-sizer"),n.heightForcer=rr("div",null,null,"position: absolute; height: "+ko+"px; width: 1px;"),n.gutters=rr("div",null,"CodeMirror-gutters"),n.lineGutter=null,n.scroller=rr("div",[n.sizer,n.heightForcer,n.gutters],"CodeMirror-scroll"),n.scroller.setAttribute("tabIndex","-1"),n.wrapper=rr("div",[n.inputDiv,n.scrollbarH,n.scrollbarV,n.scrollbarFiller,n.gutterFiller,n.scroller],"CodeMirror"),Lr&&(n.gutters.style.zIndex=-1,n.scroller.style.paddingRight=0),e.appendChild?e.appendChild(n.wrapper):e(n.wrapper),Br&&(r.style.width="0px"),Tr||(n.scroller.draggable=!0),Er?(n.inputDiv.style.height="1px",n.inputDiv.style.position="absolute"):Lr&&(n.scrollbarH.style.minWidth=n.scrollbarV.style.minWidth="18px"),n.viewOffset=n.lastSizeC=0,n.showingFrom=n.showingTo=t,n.lineNumWidth=n.lineNumInnerWidth=n.lineNumChars=null,n.prevInput="",n.alignWidgets=!1,n.pollingFast=!1,n.poll=new Yn,n.cachedCharWidth=n.cachedTextHeight=null,n.measureLineCache=[],n.measureLineCachePos=0,n.inaccurateSelection=!1,n.maxLine=null,n.maxLineLength=0,n.maxLineChanged=!1,n.wheelDX=n.wheelDY=n.wheelStartX=n.wheelStartY=null,n}function n(t){t.doc.mode=e.getMode(t.options,t.doc.modeOption),t.doc.iter(function(e){e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null)}),t.doc.frontier=t.doc.first,E(t,100),t.state.modeGen++,t.curOp&&ue(t)}function r(e){e.options.lineWrapping?(e.display.wrapper.className+=" CodeMirror-wrap",e.display.sizer.style.minWidth=""):(e.display.wrapper.className=e.display.wrapper.className.replace(" CodeMirror-wrap",""),d(e)),i(e),ue(e),Y(e),setTimeout(function(){f(e)},100)}function o(e){var t=te(e.display),n=e.options.lineWrapping,r=n&&Math.max(5,e.display.scroller.clientWidth/ne(e.display)-3);return function(o){return Pt(e.doc,o)?0:n?(Math.ceil(o.text.length/r)||1)*t:t}}function i(e){var t=e.doc,n=o(e);t.iter(function(e){var t=n(e);t!=e.height&&hn(e,t)})}function a(e){var t=go[e.options.keyMap],n=t.style;e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-keymap-\S+/g,"")+(n?" cm-keymap-"+n:""),e.state.disableInput=t.disableInput}function s(e){e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+e.options.theme.replace(/(^|\s)\s*/g," cm-s-"),Y(e)}function u(e){l(e),ue(e),setTimeout(function(){p(e)},20)}function l(e){var t=e.display.gutters,n=e.options.gutters;or(t);for(var r=0;r<n.length;++r){var o=n[r],i=t.appendChild(rr("div",null,"CodeMirror-gutter "+o));"CodeMirror-linenumbers"==o&&(e.display.lineGutter=i,
i.style.width=(e.display.lineNumWidth||1)+"px")}t.style.display=r?"":"none"}function c(e,t){if(0==t.height)return 0;for(var n,r=t.text.length,o=t;n=Bt(o);){var i=n.find();o=dn(e,i.from.line),r+=i.from.ch-i.to.ch}for(o=t;n=Ot(o);){var i=n.find();r-=o.text.length-i.from.ch,o=dn(e,i.to.line),r+=o.text.length-i.to.ch}return r}function d(e){var t=e.display,n=e.doc;t.maxLine=dn(n,n.first),t.maxLineLength=c(n,t.maxLine),t.maxLineChanged=!0,n.iter(function(e){var r=c(n,e);r>t.maxLineLength&&(t.maxLineLength=r,t.maxLine=e)})}function g(e){for(var t=!1,n=0;n<e.gutters.length;++n)"CodeMirror-linenumbers"==e.gutters[n]&&(e.lineNumbers?t=!0:e.gutters.splice(n--,1));!t&&e.lineNumbers&&e.gutters.push("CodeMirror-linenumbers")}function f(e){var t=e.display,n=e.doc.height,r=n+O(t);t.sizer.style.minHeight=t.heightForcer.style.top=r+"px",t.gutters.style.height=Math.max(r,t.scroller.clientHeight-ko)+"px";var o=Math.max(r,t.scroller.scrollHeight),i=t.scroller.scrollWidth>t.scroller.clientWidth+1,a=o>t.scroller.clientHeight+1;a?(t.scrollbarV.style.display="block",t.scrollbarV.style.bottom=i?lr(t.measure)+"px":"0",t.scrollbarV.firstChild.style.height=o-t.scroller.clientHeight+t.scrollbarV.clientHeight+"px"):t.scrollbarV.style.display="",i?(t.scrollbarH.style.display="block",t.scrollbarH.style.right=a?lr(t.measure)+"px":"0",t.scrollbarH.firstChild.style.width=t.scroller.scrollWidth-t.scroller.clientWidth+t.scrollbarH.clientWidth+"px"):t.scrollbarH.style.display="",i&&a?(t.scrollbarFiller.style.display="block",t.scrollbarFiller.style.height=t.scrollbarFiller.style.width=lr(t.measure)+"px"):t.scrollbarFiller.style.display="",i&&e.options.coverGutterNextToScrollbar&&e.options.fixedGutter?(t.gutterFiller.style.display="block",t.gutterFiller.style.height=lr(t.measure)+"px",t.gutterFiller.style.width=t.gutters.offsetWidth+"px"):t.gutterFiller.style.display="",Gr&&0===lr(t.measure)&&(t.scrollbarV.style.minWidth=t.scrollbarH.style.minHeight=Ar?"18px":"12px")}function h(e,t,n){var r=e.scroller.scrollTop,o=e.wrapper.clientHeight;"number"==typeof n?r=n:n&&(r=n.top,o=n.bottom-n.top),r=Math.floor(r-B(e));var i=Math.ceil(r+o);return{from:mn(t,r),to:mn(t,i)}}function p(e){var t=e.display;if(t.alignWidgets||t.gutters.firstChild&&e.options.fixedGutter){for(var n=b(t)-t.scroller.scrollLeft+e.doc.scrollLeft,r=t.gutters.offsetWidth,o=n+"px",i=t.lineDiv.firstChild;i;i=i.nextSibling)if(i.alignable)for(var a=0,s=i.alignable;a<s.length;++a)s[a].style.left=o;e.options.fixedGutter&&(t.gutters.style.left=n+r+"px")}}function m(e){if(!e.options.lineNumbers)return!1;var t=e.doc,n=v(e.options,t.first+t.size-1),r=e.display;if(n.length!=r.lineNumChars){var o=r.measure.appendChild(rr("div",[rr("div",n)],"CodeMirror-linenumber CodeMirror-gutter-elt")),i=o.firstChild.offsetWidth,a=o.offsetWidth-i;return r.lineGutter.style.width="",r.lineNumInnerWidth=Math.max(i,r.lineGutter.offsetWidth-a),r.lineNumWidth=r.lineNumInnerWidth+a,r.lineNumChars=r.lineNumInnerWidth?n.length:-1,r.lineGutter.style.width=r.lineNumWidth+"px",!0}return!1}function v(e,t){return String(e.lineNumberFormatter(t+e.firstLineNumber))}function b(e){return sr(e.scroller).left-sr(e.sizer).left}function y(e,t,n,r){for(var o,i=e.display.showingFrom,a=e.display.showingTo,s=h(e.display,e.doc,n);_(e,t,s,r)&&(r=!1,o=!0,x(e),f(e),n&&(n=Math.min(e.display.scroller.scrollHeight-e.display.scroller.clientHeight,"number"==typeof n?n:n.top)),s=h(e.display,e.doc,n),!(s.from>=e.display.showingFrom&&s.to<=e.display.showingTo));)t=[];return o&&(Un(e,"update",e),(e.display.showingFrom!=i||e.display.showingTo!=a)&&Un(e,"viewportChange",e,e.display.showingFrom,e.display.showingTo)),o}function _(e,t,n,r){var o=e.display,i=e.doc;if(!o.wrapper.clientWidth)return o.showingFrom=o.showingTo=i.first,void(o.viewOffset=0);if(!(!r&&0==t.length&&n.from>o.showingFrom&&n.to<o.showingTo)){m(e)&&(t=[{from:i.first,to:i.first+i.size}]);var a=o.sizer.style.marginLeft=o.gutters.offsetWidth+"px";o.scrollbarH.style.left=e.options.fixedGutter?a:"0";var s=1/0;if(e.options.lineNumbers)for(var u=0;u<t.length;++u)if(t[u].diff){s=t[u].from;break}var l=i.first+i.size,c=Math.max(n.from-e.options.viewportMargin,i.first),d=Math.min(l,n.to+e.options.viewportMargin);if(o.showingFrom<c&&c-o.showingFrom<20&&(c=Math.max(i.first,o.showingFrom)),o.showingTo>d&&o.showingTo-d<20&&(d=Math.min(l,o.showingTo)),Vr)for(c=pn(Ft(i,dn(i,c)));l>d&&Pt(i,dn(i,d));)++d;var g=[{from:Math.max(o.showingFrom,i.first),to:Math.min(o.showingTo,l)}];if(g=g[0].from>=g[0].to?[]:k(g,t),Vr)for(var u=0;u<g.length;++u)for(var f,h=g[u];f=Ot(dn(i,h.to-1));){var p=f.find().from.line;if(!(p>h.from)){g.splice(u--,1);break}h.to=p}for(var v=0,u=0;u<g.length;++u){var h=g[u];h.from<c&&(h.from=c),h.to>d&&(h.to=d),h.from>=h.to?g.splice(u--,1):v+=h.to-h.from}if(!r&&v==d-c&&c==o.showingFrom&&d==o.showingTo)return void C(e);g.sort(function(e,t){return e.from-t.from});try{var b=document.activeElement}catch(y){}.7*(d-c)>v&&(o.lineDiv.style.display="none"),L(e,c,d,g,s),o.lineDiv.style.display="",b&&document.activeElement!=b&&b.offsetHeight&&b.focus();var _=c!=o.showingFrom||d!=o.showingTo||o.lastSizeC!=o.wrapper.clientHeight;return _&&(o.lastSizeC=o.wrapper.clientHeight,E(e,400)),o.showingFrom=c,o.showingTo=d,w(e),C(e),!0}}function w(e){for(var t,n=e.display,r=n.lineDiv.offsetTop,o=n.lineDiv.firstChild;o;o=o.nextSibling)if(o.lineObj){if(Lr){var i=o.offsetTop+o.offsetHeight;t=i-r,r=i}else{var a=sr(o);t=a.bottom-a.top}var s=o.lineObj.height-t;if(2>t&&(t=te(n)),s>.001||-.001>s){hn(o.lineObj,t);var u=o.lineObj.widgets;if(u)for(var l=0;l<u.length;++l)u[l].height=u[l].node.offsetHeight}}}function C(e){var t=e.display.viewOffset=vn(e,dn(e.doc,e.display.showingFrom));e.display.mover.style.top=t+"px"}function k(e,t){for(var n=0,r=t.length||0;r>n;++n){for(var o=t[n],i=[],a=o.diff||0,s=0,u=e.length;u>s;++s){var l=e[s];o.to<=l.from&&o.diff?i.push({from:l.from+a,to:l.to+a}):o.to<=l.from||o.from>=l.to?i.push(l):(o.from>l.from&&i.push({from:l.from,to:o.from}),o.to<l.to&&i.push({from:o.to+a,to:l.to+a}))}e=i}return e}function M(e){for(var t=e.display,n={},r={},o=t.gutters.firstChild,i=0;o;o=o.nextSibling,++i)n[e.options.gutters[i]]=o.offsetLeft,r[e.options.gutters[i]]=o.offsetWidth;return{fixedPos:b(t),gutterTotalWidth:t.gutters.offsetWidth,gutterLeft:n,gutterWidth:r,wrapperWidth:t.wrapper.clientWidth}}function L(e,t,n,r,o){function i(t){var n=t.nextSibling;return Tr&&Fr&&e.display.currentWheelTarget==t?(t.style.display="none",t.lineObj=null):t.parentNode.removeChild(t),n}var a=M(e),s=e.display,u=e.options.lineNumbers;r.length||Tr&&e.display.currentWheelTarget||or(s.lineDiv);var l=s.lineDiv,c=l.firstChild,d=r.shift(),g=t;for(e.doc.iter(t,n,function(t){if(d&&d.to==g&&(d=r.shift()),Pt(e.doc,t)){if(0!=t.height&&hn(t,0),t.widgets&&c.previousSibling)for(var n=0;n<t.widgets.length;++n){var s=t.widgets[n];if(s.showIfHidden){var f=c.previousSibling;if(/pre/i.test(f.nodeName)){var h=rr("div",null,null,"position: relative");f.parentNode.replaceChild(h,f),h.appendChild(f),f=h}var p=f.appendChild(rr("div",[s.node],"CodeMirror-linewidget"));s.handleMouseEvents||(p.ignoreEvents=!0),T(s,p,f,a)}}}else if(d&&d.from<=g&&d.to>g){for(;c.lineObj!=t;)c=i(c);u&&g>=o&&c.lineNumber&&ar(c.lineNumber,v(e.options,g)),c=c.nextSibling}else{if(t.widgets)for(var m,b=0,y=c;y&&20>b;++b,y=y.nextSibling)if(y.lineObj==t&&/div/i.test(y.nodeName)){m=y;break}var _=S(e,t,g,a,m);if(_!=m)l.insertBefore(_,c);else{for(;c!=m;)c=i(c);c=c.nextSibling}_.lineObj=t}++g});c;)c=i(c)}function S(e,t,n,r,o){var i,a=Qt(e,t),s=t.gutterMarkers,u=e.display;if(!(e.options.lineNumbers||s||t.bgClass||t.wrapClass||t.widgets))return a;if(o){o.alignable=null;for(var l,c=!0,d=0,g=null,f=o.firstChild;f;f=l)if(l=f.nextSibling,/\bCodeMirror-linewidget\b/.test(f.className)){for(var h=0;h<t.widgets.length;++h){var p=t.widgets[h];if(p.node==f.firstChild){p.above||g||(g=f),T(p,f,o,r),++d;break}}if(h==t.widgets.length){c=!1;break}}else o.removeChild(f);o.insertBefore(a,g),c&&d==t.widgets.length&&(i=o,o.className=t.wrapClass||"")}if(i||(i=rr("div",null,t.wrapClass,"position: relative"),i.appendChild(a)),t.bgClass&&i.insertBefore(rr("div",null,t.bgClass+" CodeMirror-linebackground"),i.firstChild),e.options.lineNumbers||s){var m=i.insertBefore(rr("div",null,null,"position: absolute; left: "+(e.options.fixedGutter?r.fixedPos:-r.gutterTotalWidth)+"px"),i.firstChild);if(e.options.fixedGutter&&(i.alignable||(i.alignable=[])).push(m),!e.options.lineNumbers||s&&s["CodeMirror-linenumbers"]||(i.lineNumber=m.appendChild(rr("div",v(e.options,n),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+r.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+u.lineNumInnerWidth+"px"))),s)for(var b=0;b<e.options.gutters.length;++b){var y=e.options.gutters[b],_=s.hasOwnProperty(y)&&s[y];_&&m.appendChild(rr("div",[_],"CodeMirror-gutter-elt","left: "+r.gutterLeft[y]+"px; width: "+r.gutterWidth[y]+"px"))}}if(Lr&&(i.style.zIndex=2),t.widgets&&i!=o)for(var h=0,w=t.widgets;h<w.length;++h){var p=w[h],C=rr("div",[p.node],"CodeMirror-linewidget");p.handleMouseEvents||(C.ignoreEvents=!0),T(p,C,i,r),p.above?i.insertBefore(C,e.options.lineNumbers&&0!=t.height?m:a):i.appendChild(C),Un(p,"redraw")}return i}function T(e,t,n,r){if(e.noHScroll){(n.alignable||(n.alignable=[])).push(t);var o=r.wrapperWidth;t.style.left=r.fixedPos+"px",e.coverGutter||(o-=r.gutterTotalWidth,t.style.paddingLeft=r.gutterTotalWidth+"px"),t.style.width=o+"px"}e.coverGutter&&(t.style.zIndex=5,t.style.position="relative",e.noHScroll||(t.style.marginLeft=-r.gutterTotalWidth+"px"))}function x(e){var t=e.display,n=Ye(e.doc.sel.from,e.doc.sel.to);if(n||e.options.showCursorWhenSelecting?z(e):t.cursor.style.display=t.otherCursor.style.display="none",n?t.selectionDiv.style.display="none":I(e),e.options.moveInputWithCursor){var r=X(e,e.doc.sel.head,"div"),o=sr(t.wrapper),i=sr(t.lineDiv);t.inputDiv.style.top=Math.max(0,Math.min(t.wrapper.clientHeight-10,r.top+i.top-o.top))+"px",t.inputDiv.style.left=Math.max(0,Math.min(t.wrapper.clientWidth-10,r.left+i.left-o.left))+"px"}}function z(e){var t=e.display,n=X(e,e.doc.sel.head,"div");t.cursor.style.left=n.left+"px",t.cursor.style.top=n.top+"px",t.cursor.style.height=Math.max(0,n.bottom-n.top)*e.options.cursorHeight+"px",t.cursor.style.display="",n.other?(t.otherCursor.style.display="",t.otherCursor.style.left=n.other.left+"px",t.otherCursor.style.top=n.other.top+"px",t.otherCursor.style.height=.85*(n.other.bottom-n.other.top)+"px"):t.otherCursor.style.display="none"}function I(e){function t(e,t,n,r){0>t&&(t=0),a.appendChild(rr("div",null,"CodeMirror-selected","position: absolute; left: "+e+"px; top: "+t+"px; width: "+(null==n?s-e:n)+"px; height: "+(r-t)+"px"))}function n(n,r,i){function a(t,r){return q(e,He(n,t),"div",d,r)}var l,c,d=dn(o,n),g=d.text.length;return dr(bn(d),r||0,null==i?g:i,function(e,n,o){var d,f,h,p=a(e,"left");if(e==n)d=p,f=h=p.left;else{if(d=a(n-1,"right"),"rtl"==o){var m=p;p=d,d=m}f=p.left,h=d.right}null==r&&0==e&&(f=u),d.top-p.top>3&&(t(f,p.top,null,p.bottom),f=u,p.bottom<d.top&&t(f,p.bottom,null,d.top)),null==i&&n==g&&(h=s),(!l||p.top<l.top||p.top==l.top&&p.left<l.left)&&(l=p),(!c||d.bottom>c.bottom||d.bottom==c.bottom&&d.right>c.right)&&(c=d),u+1>f&&(f=u),t(f,d.top,h-f,d.bottom)}),{start:l,end:c}}var r=e.display,o=e.doc,i=e.doc.sel,a=document.createDocumentFragment(),s=r.lineSpace.offsetWidth,u=F(e.display);if(i.from.line==i.to.line)n(i.from.line,i.from.ch,i.to.ch);else{var l=dn(o,i.from.line),c=dn(o,i.to.line),d=Ft(o,l)==Ft(o,c),g=n(i.from.line,i.from.ch,d?l.text.length:null).end,f=n(i.to.line,d?0:null,i.to.ch).start;d&&(g.top<f.top-2?(t(g.right,g.top,null,g.bottom),t(u,f.top,f.left,f.bottom)):t(g.right,g.top,f.left-g.right,g.bottom)),g.bottom<f.top&&t(u,g.bottom,null,f.top)}ir(r.selectionDiv,a),r.selectionDiv.style.display=""}function D(e){if(e.state.focused){var t=e.display;clearInterval(t.blinker);var n=!0;t.cursor.style.visibility=t.otherCursor.style.visibility="",t.blinker=setInterval(function(){t.cursor.style.visibility=t.otherCursor.style.visibility=(n=!n)?"":"hidden"},e.options.cursorBlinkRate)}}function E(e,t){e.doc.mode.startState&&e.doc.frontier<e.display.showingTo&&e.state.highlight.set(t,er(G,e))}function G(e){var t=e.doc;if(t.frontier<t.first&&(t.frontier=t.first),!(t.frontier>=e.display.showingTo)){var n,r=+new Date+e.options.workTime,o=mt(t.mode,N(e,t.frontier)),i=[];t.iter(t.frontier,Math.min(t.first+t.size,e.display.showingTo+500),function(a){if(t.frontier>=e.display.showingFrom){var s=a.styles;a.styles=jt(e,a,o);for(var u=!s||s.length!=a.styles.length,l=0;!u&&l<s.length;++l)u=s[l]!=a.styles[l];u&&(n&&n.end==t.frontier?n.end++:i.push(n={start:t.frontier,end:t.frontier+1})),a.stateAfter=mt(t.mode,o)}else Xt(e,a,o),a.stateAfter=t.frontier%5==0?mt(t.mode,o):null;return++t.frontier,+new Date>r?(E(e,e.options.workDelay),!0):void 0}),i.length&&ie(e,function(){for(var e=0;e<i.length;++e)ue(this,i[e].start,i[e].end)})()}}function A(e,t,n){for(var r,o,i=e.doc,a=t,s=t-100;a>s;--a){if(a<=i.first)return i.first;var u=dn(i,a-1);if(u.stateAfter&&(!n||a<=i.frontier))return a;var l=Kn(u.text,null,e.options.tabSize);(null==o||r>l)&&(o=a-1,r=l)}return o}function N(e,t,n){var r=e.doc,o=e.display;if(!r.mode.startState)return!0;var i=A(e,t,n),a=i>r.first&&dn(r,i-1).stateAfter;return a=a?mt(r.mode,a):vt(r.mode),r.iter(i,t,function(n){Xt(e,n,a);var s=i==t-1||i%5==0||i>=o.showingFrom&&i<o.showingTo;n.stateAfter=s?mt(r.mode,a):null,++i}),a}function B(e){return e.lineSpace.offsetTop}function O(e){return e.mover.offsetHeight-e.lineSpace.offsetHeight}function F(e){var t=ir(e.measure,rr("pre",null,null,"text-align: left")).appendChild(rr("span","x"));return t.offsetLeft}function P(e,t,n,r,o){var i=-1;r=r||W(e,t);for(var a=n;;a+=i){var s=r[a];if(s)break;0>i&&0==a&&(i=1)}return o=a>n?"left":n>a?"right":o,"left"==o&&s.leftSide?s=s.leftSide:"right"==o&&s.rightSide&&(s=s.rightSide),{left:n>a?s.right:s.left,right:a>n?s.left:s.right,top:s.top,bottom:s.bottom}}function U(e,t){for(var n=e.display.measureLineCache,r=0;r<n.length;++r){var o=n[r];if(o.text==t.text&&o.markedSpans==t.markedSpans&&e.display.scroller.clientWidth==o.width&&o.classes==t.textClass+"|"+t.bgClass+"|"+t.wrapClass)return o}}function $(e,t){var n=U(e,t);n&&(n.text=n.measure=n.markedSpans=null)}function W(e,t){var n=U(e,t);if(n)return n.measure;var r=R(e,t),o=e.display.measureLineCache,i={text:t.text,width:e.display.scroller.clientWidth,markedSpans:t.markedSpans,measure:r,classes:t.textClass+"|"+t.bgClass+"|"+t.wrapClass};return 16==o.length?o[++e.display.measureLineCachePos%16]=i:o.push(i),r}function R(e,t){function n(e){var t=e.top-h.top,n=e.bottom-h.top;n>v&&(n=v),0>t&&(t=0);for(var r=p.length-2;r>=0;r-=2){var o=p[r],i=p[r+1];if(!(o>n||t>i)&&(t>=o&&i>=n||o>=t&&n>=i||Math.min(n,i)-Math.max(t,o)>=n-t>>1)){p[r]=Math.min(t,o),p[r+1]=Math.max(n,i);break}}return 0>r&&(r=p.length,p.push(t,n)),{left:e.left-h.left,right:e.right-h.left,top:r,bottom:null}}function r(e){e.bottom=p[e.top+1],e.top=p[e.top]}var o=e.display,i=Qn(t.text.length),a=Qt(e,t,i,!0);if(Mr&&!Lr&&!e.options.lineWrapping&&a.childNodes.length>100){for(var s=document.createDocumentFragment(),u=10,l=a.childNodes.length,c=0,d=Math.ceil(l/u);d>c;++c){for(var g=rr("div",null,null,"display: inline-block"),f=0;u>f&&l;++f)g.appendChild(a.firstChild),--l;s.appendChild(g)}a.appendChild(s)}ir(o.measure,a);var h=sr(o.lineDiv),p=[],m=Qn(t.text.length),v=a.offsetHeight;Sr&&o.measure.first!=a&&ir(o.measure,a);for(var b,c=0;c<i.length;++c)if(b=i[c]){var y=b,_=null;if(/\bCodeMirror-widget\b/.test(b.className)&&b.getClientRects){1==b.firstChild.nodeType&&(y=b.firstChild);var w=y.getClientRects();w.length>1&&(_=m[c]=n(w[0]),_.rightSide=n(w[w.length-1]))}_||(_=m[c]=n(sr(y))),b.measureRight&&(_.right=sr(b.measureRight).left),b.leftSide&&(_.leftSide=n(sr(b.leftSide)))}for(var b,c=0;c<m.length;++c)(b=m[c])&&(r(b),b.leftSide&&r(b.leftSide),b.rightSide&&r(b.rightSide));return m}function H(e,t){var n=!1;if(t.markedSpans)for(var r=0;r<t.markedSpans;++r){var o=t.markedSpans[r];!o.collapsed||null!=o.to&&o.to!=t.text.length||(n=!0)}var i=!n&&U(e,t);if(i)return P(e,t,t.text.length,i.measure,"right").right;var a=Qt(e,t,null,!0),s=a.appendChild(cr(e.display.measure));return ir(e.display.measure,a),sr(s).right-sr(e.display.lineDiv).left}function Y(e){e.display.measureLineCache.length=e.display.measureLineCachePos=0,e.display.cachedCharWidth=e.display.cachedTextHeight=null,e.options.lineWrapping||(e.display.maxLineChanged=!0),e.display.lineNumChars=null}function K(){return window.pageXOffset||(document.documentElement||document.body).scrollLeft}function V(){return window.pageYOffset||(document.documentElement||document.body).scrollTop}function Z(e,t,n,r){if(t.widgets)for(var o=0;o<t.widgets.length;++o)if(t.widgets[o].above){var i=Ht(t.widgets[o]);n.top+=i,n.bottom+=i}if("line"==r)return n;r||(r="local");var a=vn(e,t);if("local"==r?a+=B(e.display):a-=e.display.viewOffset,"page"==r||"window"==r){var s=sr(e.display.lineSpace);a+=s.top+("window"==r?0:V());var u=s.left+("window"==r?0:K());n.left+=u,n.right+=u}return n.top+=a,n.bottom+=a,n}function j(e,t,n){if("div"==n)return t;var r=t.left,o=t.top;if("page"==n)r-=K(),o-=V();else if("local"==n||!n){var i=sr(e.display.sizer);r+=i.left,o+=i.top}var a=sr(e.display.lineSpace);return{left:r-a.left,top:o-a.top}}function q(e,t,n,r,o){return r||(r=dn(e.doc,t.line)),Z(e,r,P(e,r,t.ch,null,o),n)}function X(e,t,n,r,o){function i(t,i){var a=P(e,r,t,o,i?"right":"left");return i?a.left=a.right:a.right=a.left,Z(e,r,a,n)}function a(e,t){var n=s[t],r=n.level%2;return e==gr(n)&&t&&n.level<s[t-1].level?(n=s[--t],e=fr(n)-(n.level%2?0:1),r=!0):e==fr(n)&&t<s.length-1&&n.level<s[t+1].level&&(n=s[++t],e=gr(n)-n.level%2,r=!1),r&&e==n.to&&e>n.from?i(e-1):i(e,r)}r=r||dn(e.doc,t.line),o||(o=W(e,r));var s=bn(r),u=t.ch;if(!s)return i(u);var l=yr(s,u),c=a(u,l);return null!=No&&(c.other=a(u,No)),c}function J(e,t,n,r){var o=new He(e,t);return o.xRel=r,n&&(o.outside=!0),o}function Q(e,t,n){var r=e.doc;if(n+=e.display.viewOffset,0>n)return J(r.first,0,!0,-1);var o=mn(r,n),i=r.first+r.size-1;if(o>i)return J(r.first+r.size-1,dn(r,i).text.length,!0,1);for(0>t&&(t=0);;){var a=dn(r,o),s=ee(e,a,o,t,n),u=Ot(a),l=u&&u.find();if(!u||!(s.ch>l.from.ch||s.ch==l.from.ch&&s.xRel>0))return s;o=l.to.line}}function ee(e,t,n,r,o){function i(r){var o=X(e,He(n,r),"line",t,l);return s=!0,a>o.bottom?o.left-u:a<o.top?o.left+u:(s=!1,o.left)}var a=o-vn(e,t),s=!1,u=2*e.display.wrapper.clientWidth,l=W(e,t),c=bn(t),d=t.text.length,g=hr(t),f=pr(t),h=i(g),p=s,m=i(f),v=s;if(r>m)return J(n,f,v,1);for(;;){if(c?f==g||f==wr(t,g,1):1>=f-g){for(var b=h>r||m-r>=r-h?g:f,y=r-(b==g?h:m);To.test(t.text.charAt(b));)++b;var _=J(n,b,b==g?p:v,0>y?-1:y?1:0);return _}var w=Math.ceil(d/2),C=g+w;if(c){C=g;for(var k=0;w>k;++k)C=wr(t,C,1)}var M=i(C);M>r?(f=C,m=M,(v=s)&&(m+=1e3),d=w):(g=C,h=M,p=s,d-=w)}}function te(e){if(null!=e.cachedTextHeight)return e.cachedTextHeight;if(null==$r){$r=rr("pre");for(var t=0;49>t;++t)$r.appendChild(document.createTextNode("x")),$r.appendChild(rr("br"));$r.appendChild(document.createTextNode("x"))}ir(e.measure,$r);var n=$r.offsetHeight/50;return n>3&&(e.cachedTextHeight=n),or(e.measure),n||1}function ne(e){if(null!=e.cachedCharWidth)return e.cachedCharWidth;var t=rr("span","x"),n=rr("pre",[t]);ir(e.measure,n);var r=t.offsetWidth;return r>2&&(e.cachedCharWidth=r),r||10}function re(e){e.curOp={changes:[],forceUpdate:!1,updateInput:null,userSelChange:null,textChanged:null,selectionChanged:!1,cursorActivity:!1,updateMaxLine:!1,updateScrollPos:!1,id:++Zr},Co++||(wo=[])}function oe(e){var t=e.curOp,n=e.doc,r=e.display;if(e.curOp=null,t.updateMaxLine&&d(e),r.maxLineChanged&&!e.options.lineWrapping&&r.maxLine){var o=H(e,r.maxLine);r.sizer.style.minWidth=Math.max(0,o+3+ko)+"px",r.maxLineChanged=!1;var i=Math.max(0,r.sizer.offsetLeft+r.sizer.offsetWidth-r.scroller.clientWidth);i<n.scrollLeft&&!t.updateScrollPos&&ke(e,Math.min(r.scroller.scrollLeft,i),!0)}var a,s;if(t.updateScrollPos)a=t.updateScrollPos;else if(t.selectionChanged&&r.scroller.clientHeight){var u=X(e,n.sel.head);a=at(e,u.left,u.top,u.left,u.bottom)}(t.changes.length||t.forceUpdate||a&&null!=a.scrollTop)&&(s=y(e,t.changes,a&&a.scrollTop,t.forceUpdate),e.display.scroller.offsetHeight&&(e.doc.scrollTop=e.display.scroller.scrollTop)),!s&&t.selectionChanged&&x(e),t.updateScrollPos?(r.scroller.scrollTop=r.scrollbarV.scrollTop=n.scrollTop=a.scrollTop,r.scroller.scrollLeft=r.scrollbarH.scrollLeft=n.scrollLeft=a.scrollLeft,p(e),t.scrollToPos&&ot(e,je(e.doc,t.scrollToPos),t.scrollToPosMargin)):a&&rt(e),t.selectionChanged&&D(e),e.state.focused&&t.updateInput&&ge(e,t.userSelChange);var l=t.maybeHiddenMarkers,c=t.maybeUnhiddenMarkers;if(l)for(var g=0;g<l.length;++g)l[g].lines.length||Pn(l[g],"hide");if(c)for(var g=0;g<c.length;++g)c[g].lines.length&&Pn(c[g],"unhide");var f;if(--Co||(f=wo,wo=null),t.textChanged&&Pn(e,"change",e,t.textChanged),t.cursorActivity&&Pn(e,"cursorActivity",e),f)for(var g=0;g<f.length;++g)f[g]()}function ie(e,t){return function(){var n=e||this,r=!n.curOp;r&&re(n);try{var o=t.apply(n,arguments)}finally{r&&oe(n)}return o}}function ae(e){return function(){var t,n=this.cm&&!this.cm.curOp;n&&re(this.cm);try{t=e.apply(this,arguments)}finally{n&&oe(this.cm)}return t}}function se(e,t){var n,r=!e.curOp;r&&re(e);try{n=t()}finally{r&&oe(e)}return n}function ue(e,t,n,r){null==t&&(t=e.doc.first),null==n&&(n=e.doc.first+e.doc.size),e.curOp.changes.push({from:t,to:n,diff:r})}function le(e){e.display.pollingFast||e.display.poll.set(e.options.pollInterval,function(){de(e),e.state.focused&&le(e)})}function ce(e){function t(){var r=de(e);r||n?(e.display.pollingFast=!1,le(e)):(n=!0,e.display.poll.set(60,t))}var n=!1;e.display.pollingFast=!0,e.display.poll.set(20,t)}function de(e){var t=e.display.input,n=e.display.prevInput,r=e.doc,o=r.sel;if(!e.state.focused||Eo(t)||he(e)||e.state.disableInput)return!1;var i=t.value;if(i==n&&Ye(o.from,o.to))return!1;if(Mr&&!Sr&&e.display.inputHasSelection===i)return ge(e,!0),!1;var a=!e.curOp;a&&re(e),o.shift=!1;for(var s=0,u=Math.min(n.length,i.length);u>s&&n.charCodeAt(s)==i.charCodeAt(s);)++s;var l=o.from,c=o.to;s<n.length?l=He(l.line,l.ch-(n.length-s)):e.state.overwrite&&Ye(l,c)&&!e.state.pasteIncoming&&(c=He(c.line,Math.min(dn(r,c.line).text.length,c.ch+(i.length-s))));var d=e.curOp.updateInput,g={from:l,to:c,text:Do(i.slice(s)),origin:e.state.pasteIncoming?"paste":"+input"};return Oe(e.doc,g,"end"),e.curOp.updateInput=d,Un(e,"inputRead",e,g),i.length>1e3||i.indexOf("\n")>-1?t.value=e.display.prevInput="":e.display.prevInput=i,a&&oe(e),e.state.pasteIncoming=!1,!0}function ge(e,t){var n,r,o=e.doc;if(Ye(o.sel.from,o.sel.to))t&&(e.display.prevInput=e.display.input.value="",Mr&&!Sr&&(e.display.inputHasSelection=null));else{e.display.prevInput="",n=Go&&(o.sel.to.line-o.sel.from.line>100||(r=e.getSelection()).length>1e3);var i=n?"-":r||e.getSelection();e.display.input.value=i,e.state.focused&&jn(e.display.input),Mr&&!Sr&&(e.display.inputHasSelection=i)}e.display.inaccurateSelection=n}function fe(e){"nocursor"==e.options.readOnly||Or&&document.activeElement==e.display.input||e.display.input.focus()}function he(e){return e.options.readOnly||e.doc.cantEdit}function pe(e){function t(){e.state.focused&&setTimeout(er(fe,e),0)}function n(){null==s&&(s=setTimeout(function(){s=null,a.cachedCharWidth=a.cachedTextHeight=zo=null,Y(e),se(e,er(ue,e))},100))}function r(){for(var e=a.wrapper.parentNode;e&&e!=document.body;e=e.parentNode);e?setTimeout(r,5e3):Fn(window,"resize",n)}function o(t){$n(e,t)||e.options.onDragEvent&&e.options.onDragEvent(e,In(t))||An(t)}function i(){a.inaccurateSelection&&(a.prevInput="",a.inaccurateSelection=!1,a.input.value=e.getSelection(),jn(a.input))}var a=e.display;On(a.scroller,"mousedown",ie(e,be)),Mr?On(a.scroller,"dblclick",ie(e,function(t){if(!$n(e,t)){var n=ve(e,t);if(n&&!ye(e,t)&&!me(e.display,t)){Dn(t);var r=ft(dn(e.doc,n.line).text,n);Je(e.doc,r.from,r.to)}}})):On(a.scroller,"dblclick",function(t){$n(e,t)||Dn(t)}),On(a.lineSpace,"selectstart",function(e){me(a,e)||Dn(e)}),Yr||On(a.scroller,"contextmenu",function(t){Ge(e,t)}),On(a.scroller,"scroll",function(){a.scroller.clientHeight&&(Ce(e,a.scroller.scrollTop),ke(e,a.scroller.scrollLeft,!0),Pn(e,"scroll",e))}),On(a.scrollbarV,"scroll",function(){a.scroller.clientHeight&&Ce(e,a.scrollbarV.scrollTop)}),On(a.scrollbarH,"scroll",function(){a.scroller.clientHeight&&ke(e,a.scrollbarH.scrollLeft)}),On(a.scroller,"mousewheel",function(t){Me(e,t)}),On(a.scroller,"DOMMouseScroll",function(t){Me(e,t)}),On(a.scrollbarH,"mousedown",t),On(a.scrollbarV,"mousedown",t),On(a.wrapper,"scroll",function(){a.wrapper.scrollTop=a.wrapper.scrollLeft=0});var s;On(window,"resize",n),setTimeout(r,5e3),On(a.input,"keyup",ie(e,function(t){$n(e,t)||e.options.onKeyEvent&&e.options.onKeyEvent(e,In(t))||16==t.keyCode&&(e.doc.sel.shift=!1)})),On(a.input,"input",er(ce,e)),On(a.input,"keydown",ie(e,ze)),On(a.input,"keypress",ie(e,Ie)),On(a.input,"focus",er(De,e)),On(a.input,"blur",er(Ee,e)),e.options.dragDrop&&(On(a.scroller,"dragstart",function(t){we(e,t)}),On(a.scroller,"dragenter",o),On(a.scroller,"dragover",o),On(a.scroller,"drop",ie(e,_e))),On(a.scroller,"paste",function(t){me(a,t)||(fe(e),ce(e))}),On(a.input,"paste",function(){e.state.pasteIncoming=!0,ce(e)}),On(a.input,"cut",i),On(a.input,"copy",i),Er&&On(a.sizer,"mouseup",function(){document.activeElement==a.input&&a.input.blur(),fe(e)})}function me(e,t){for(var n=Nn(t);n!=e.wrapper;n=n.parentNode)if(!n||n.ignoreEvents||n.parentNode==e.sizer&&n!=e.mover)return!0}function ve(e,t,n){var r=e.display;if(!n){var o=Nn(t);if(o==r.scrollbarH||o==r.scrollbarH.firstChild||o==r.scrollbarV||o==r.scrollbarV.firstChild||o==r.scrollbarFiller||o==r.gutterFiller)return null}var i,a,s=sr(r.lineSpace);try{i=t.clientX,a=t.clientY}catch(t){return null}return Q(e,i-s.left,a-s.top)}function be(e){function t(e){if(!Ye(v,e)){if(v=e,"single"==c)return void Je(o.doc,je(a,u),e);if(p=je(a,p),m=je(a,m),"double"==c){var t=ft(dn(a,e.line).text,e);Ke(e,p)?Je(o.doc,t.from,m):Je(o.doc,p,t.to)}else"triple"==c&&(Ke(e,p)?Je(o.doc,m,je(a,He(e.line,0))):Je(o.doc,p,je(a,He(e.line+1,0))))}}function n(e){var r=++y,s=ve(o,e,!0);if(s)if(Ye(s,g)){var u=e.clientY<b.top?-20:e.clientY>b.bottom?20:0;u&&setTimeout(ie(o,function(){y==r&&(i.scroller.scrollTop+=u,n(e))}),50)}else{o.state.focused||De(o),g=s,t(s);var l=h(i,a);(s.line>=l.to||s.line<l.from)&&setTimeout(ie(o,function(){y==r&&n(e)}),150)}}function r(e){y=1/0,Dn(e),fe(o),Fn(document,"mousemove",_),Fn(document,"mouseup",w)}if(!$n(this,e)){var o=this,i=o.display,a=o.doc,s=a.sel;if(s.shift=e.shiftKey,me(i,e))return void(Tr||(i.scroller.draggable=!1,setTimeout(function(){i.scroller.draggable=!0},100)));if(!ye(o,e)){var u=ve(o,e);switch(Bn(e)){case 3:return void(Yr&&Ge.call(o,o,e));case 2:return u&&Je(o.doc,u),setTimeout(er(fe,o),20),void Dn(e)}if(!u)return void(Nn(e)==i.scroller&&Dn(e));o.state.focused||De(o);var l=+new Date,c="single";if(Rr&&Rr.time>l-400&&Ye(Rr.pos,u))c="triple",Dn(e),setTimeout(er(fe,o),20),ht(o,u.line);else if(Wr&&Wr.time>l-400&&Ye(Wr.pos,u)){c="double",Rr={time:l,pos:u},Dn(e);var d=ft(dn(a,u.line).text,u);Je(o.doc,d.from,d.to)}else Wr={time:l,pos:u};var g=u;if(o.options.dragDrop&&xo&&!he(o)&&!Ye(s.from,s.to)&&!Ke(u,s.from)&&!Ke(s.to,u)&&"single"==c){var f=ie(o,function(t){Tr&&(i.scroller.draggable=!1),o.state.draggingText=!1,Fn(document,"mouseup",f),Fn(i.scroller,"drop",f),Math.abs(e.clientX-t.clientX)+Math.abs(e.clientY-t.clientY)<10&&(Dn(t),Je(o.doc,u),fe(o))});return Tr&&(i.scroller.draggable=!0),o.state.draggingText=f,i.scroller.dragDrop&&i.scroller.dragDrop(),On(document,"mouseup",f),void On(i.scroller,"drop",f)}Dn(e),"single"==c&&Je(o.doc,je(a,u));var p=s.from,m=s.to,v=u,b=sr(i.wrapper),y=0,_=ie(o,function(e){Mr||Bn(e)?n(e):r(e)}),w=ie(o,r);On(document,"mousemove",_),On(document,"mouseup",w)}}}function ye(e,t){var n=e.display;try{var r=t.clientX,o=t.clientY}catch(t){return!1}if(r>=Math.floor(sr(n.gutters).right))return!1;if(Dn(t),!Rn(e,"gutterClick"))return!0;var i=sr(n.lineDiv);if(o>i.bottom)return!0;o-=i.top-n.viewOffset;for(var a=0;a<e.options.gutters.length;++a){var s=n.gutters.childNodes[a];if(s&&sr(s).right>=r){var u=mn(e.doc,o),l=e.options.gutters[a];Un(e,"gutterClick",e,u,l,t);break}}return!0}function _e(e){var t=this;if(!($n(t,e)||me(t.display,e)||t.options.onDragEvent&&t.options.onDragEvent(t,In(e)))){Dn(e),Mr&&(jr=+new Date);var n=ve(t,e,!0),r=e.dataTransfer.files;if(n&&!he(t))if(r&&r.length&&window.FileReader&&window.File)for(var o=r.length,i=Array(o),a=0,s=function(e,r){var s=new FileReader;s.onload=function(){i[r]=s.result,++a==o&&(n=je(t.doc,n),Oe(t.doc,{from:n,to:n,text:Do(i.join("\n")),origin:"paste"},"around"))},s.readAsText(e)},u=0;o>u;++u)s(r[u],u);else{if(t.state.draggingText&&!Ke(n,t.doc.sel.from)&&!Ke(t.doc.sel.to,n))return t.state.draggingText(e),void setTimeout(er(fe,t),20);try{var i=e.dataTransfer.getData("Text");if(i){var l=t.doc.sel.from,c=t.doc.sel.to;et(t.doc,n,n),t.state.draggingText&&Re(t.doc,"",l,c,"paste"),t.replaceSelection(i,null,"paste"),fe(t),De(t)}}catch(e){}}}}function we(e,t){if(Mr&&(!e.state.draggingText||+new Date-jr<100))return void An(t);if(!$n(e,t)&&!me(e.display,t)){var n=e.getSelection();if(t.dataTransfer.setData("Text",n),t.dataTransfer.setDragImage&&!Dr){var r=rr("img",null,null,"position: fixed; left: 0; top: 0;");Ir&&(r.width=r.height=1,e.display.wrapper.appendChild(r),r._top=r.offsetTop),t.dataTransfer.setDragImage(r,0,0),Ir&&r.parentNode.removeChild(r)}}}function Ce(e,t){Math.abs(e.doc.scrollTop-t)<2||(e.doc.scrollTop=t,kr||y(e,[],t),e.display.scroller.scrollTop!=t&&(e.display.scroller.scrollTop=t),e.display.scrollbarV.scrollTop!=t&&(e.display.scrollbarV.scrollTop=t),kr&&y(e,[]),E(e,100))}function ke(e,t,n){(n?t==e.doc.scrollLeft:Math.abs(e.doc.scrollLeft-t)<2)||(t=Math.min(t,e.display.scroller.scrollWidth-e.display.scroller.clientWidth),e.doc.scrollLeft=t,p(e),e.display.scroller.scrollLeft!=t&&(e.display.scroller.scrollLeft=t),e.display.scrollbarH.scrollLeft!=t&&(e.display.scrollbarH.scrollLeft=t))}function Me(e,t){var n=t.wheelDeltaX,r=t.wheelDeltaY;null==n&&t.detail&&t.axis==t.HORIZONTAL_AXIS&&(n=t.detail),null==r&&t.detail&&t.axis==t.VERTICAL_AXIS?r=t.detail:null==r&&(r=t.wheelDelta);var o=e.display,i=o.scroller;if(n&&i.scrollWidth>i.clientWidth||r&&i.scrollHeight>i.clientHeight){if(r&&Fr&&Tr)for(var a=t.target;a!=i;a=a.parentNode)if(a.lineObj){e.display.currentWheelTarget=a;break}if(n&&!kr&&!Ir&&null!=Xr)return r&&Ce(e,Math.max(0,Math.min(i.scrollTop+r*Xr,i.scrollHeight-i.clientHeight))),ke(e,Math.max(0,Math.min(i.scrollLeft+n*Xr,i.scrollWidth-i.clientWidth))),Dn(t),void(o.wheelStartX=null);if(r&&null!=Xr){var s=r*Xr,u=e.doc.scrollTop,l=u+o.wrapper.clientHeight;0>s?u=Math.max(0,u+s-50):l=Math.min(e.doc.height,l+s+50),y(e,[],{top:u,bottom:l})}20>qr&&(null==o.wheelStartX?(o.wheelStartX=i.scrollLeft,o.wheelStartY=i.scrollTop,o.wheelDX=n,o.wheelDY=r,setTimeout(function(){if(null!=o.wheelStartX){var e=i.scrollLeft-o.wheelStartX,t=i.scrollTop-o.wheelStartY,n=t&&o.wheelDY&&t/o.wheelDY||e&&o.wheelDX&&e/o.wheelDX;o.wheelStartX=o.wheelStartY=null,n&&(Xr=(Xr*qr+n)/(qr+1),++qr)}},200)):(o.wheelDX+=n,o.wheelDY+=r))}}function Le(e,t,n){if("string"==typeof t&&(t=co[t],!t))return!1;e.display.pollingFast&&de(e)&&(e.display.pollingFast=!1);var r=e.doc,o=r.sel.shift,i=!1;try{he(e)&&(e.state.suppressEdits=!0),n&&(r.sel.shift=!1),i=t(e)!=Mo}finally{r.sel.shift=o,e.state.suppressEdits=!1}return i}function Se(e){var t=e.state.keyMaps.slice(0);return e.options.extraKeys&&t.push(e.options.extraKeys),t.push(e.options.keyMap),t}function Te(e,t){var n=bt(e.options.keyMap),r=n.auto;clearTimeout(Jr),r&&!_t(t)&&(Jr=setTimeout(function(){bt(e.options.keyMap)==n&&(e.options.keyMap=r.call?r.call(null,e):r,a(e))},50));var o=wt(t,!0),i=!1;if(!o)return!1;var s=Se(e);return i=t.shiftKey?yt("Shift-"+o,s,function(t){return Le(e,t,!0)})||yt(o,s,function(t){return("string"==typeof t?/^go[A-Z]/.test(t):t.motion)?Le(e,t):void 0}):yt(o,s,function(t){return Le(e,t)}),i&&(Dn(t),D(e),Sr&&(t.oldKeyCode=t.keyCode,
t.keyCode=0),Un(e,"keyHandled",e,o,t)),i}function xe(e,t,n){var r=yt("'"+n+"'",Se(e),function(t){return Le(e,t,!0)});return r&&(Dn(t),D(e),Un(e,"keyHandled",e,"'"+n+"'",t)),r}function ze(e){var t=this;if(t.state.focused||De(t),Mr&&27==e.keyCode&&(e.returnValue=!1),!($n(t,e)||t.options.onKeyEvent&&t.options.onKeyEvent(t,In(e)))){var n=e.keyCode;t.doc.sel.shift=16==n||e.shiftKey;var r=Te(t,e);Ir&&(eo=r?n:null,!r&&88==n&&!Go&&(Fr?e.metaKey:e.ctrlKey)&&t.replaceSelection(""))}}function Ie(e){var t=this;if(!($n(t,e)||t.options.onKeyEvent&&t.options.onKeyEvent(t,In(e)))){var n=e.keyCode,r=e.charCode;if(Ir&&n==eo)return eo=null,void Dn(e);if(!(Ir&&(!e.which||e.which<10)||Er)||!Te(t,e)){var o=String.fromCharCode(null==r?n:r);this.options.electricChars&&this.doc.mode.electricChars&&this.options.smartIndent&&!he(this)&&this.doc.mode.electricChars.indexOf(o)>-1&&setTimeout(ie(t,function(){lt(t,t.doc.sel.to.line,"smart")}),75),xe(t,e,o)||(Mr&&!Sr&&(t.display.inputHasSelection=null),ce(t))}}}function De(e){"nocursor"!=e.options.readOnly&&(e.state.focused||(Pn(e,"focus",e),e.state.focused=!0,-1==e.display.wrapper.className.search(/\bCodeMirror-focused\b/)&&(e.display.wrapper.className+=" CodeMirror-focused"),ge(e,!0)),le(e),D(e))}function Ee(e){e.state.focused&&(Pn(e,"blur",e),e.state.focused=!1,e.display.wrapper.className=e.display.wrapper.className.replace(" CodeMirror-focused","")),clearInterval(e.display.blinker),setTimeout(function(){e.state.focused||(e.doc.sel.shift=!1)},150)}function Ge(e,t){function n(){if(null!=o.input.selectionStart){var e=o.input.value=" "+(Ye(i.from,i.to)?"":o.input.value);o.prevInput=" ",o.input.selectionStart=1,o.input.selectionEnd=e.length}}function r(){if(o.inputDiv.style.position="relative",o.input.style.cssText=u,Sr&&(o.scrollbarV.scrollTop=o.scroller.scrollTop=s),le(e),null!=o.input.selectionStart){(!Mr||Sr)&&n(),clearTimeout(Qr);var t=0,r=function(){" "==o.prevInput&&0==o.input.selectionStart?ie(e,co.selectAll)(e):t++<10?Qr=setTimeout(r,500):ge(e)};Qr=setTimeout(r,200)}}if(!$n(e,t,"contextmenu")){var o=e.display,i=e.doc.sel;if(!me(o,t)){var a=ve(e,t),s=o.scroller.scrollTop;if(a&&!Ir){(Ye(i.from,i.to)||Ke(a,i.from)||!Ke(a,i.to))&&ie(e,et)(e.doc,a,a);var u=o.input.style.cssText;if(o.inputDiv.style.position="absolute",o.input.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(t.clientY-5)+"px; left: "+(t.clientX-5)+"px; z-index: 1000; background: white; outline: none;border-width: 0; outline: none; overflow: hidden; opacity: .05; -ms-opacity: .05; filter: alpha(opacity=5);",fe(e),ge(e,!0),Ye(i.from,i.to)&&(o.input.value=o.prevInput=" "),Mr&&!Sr&&n(),Yr){An(t);var l=function(){Fn(window,"mouseup",l),setTimeout(r,20)};On(window,"mouseup",l)}else setTimeout(r,50)}}}}function Ae(e,t,n){if(!Ke(t.from,n))return je(e,n);var r=t.text.length-1-(t.to.line-t.from.line);if(n.line>t.to.line+r){var o=n.line-r,i=e.first+e.size-1;return o>i?He(i,dn(e,i).text.length):qe(n,dn(e,o).text.length)}if(n.line==t.to.line+r)return qe(n,Zn(t.text).length+(1==t.text.length?t.from.ch:0)+dn(e,t.to.line).text.length-t.to.ch);var a=n.line-t.from.line;return qe(n,t.text[a].length+(a?0:t.from.ch))}function Ne(e,t,n){if(n&&"object"==typeof n)return{anchor:Ae(e,t,n.anchor),head:Ae(e,t,n.head)};if("start"==n)return{anchor:t.from,head:t.from};var r=to(t);if("around"==n)return{anchor:t.from,head:r};if("end"==n)return{anchor:r,head:r};var o=function(e){if(Ke(e,t.from))return e;if(!Ke(t.to,e))return r;var n=e.line+t.text.length-(t.to.line-t.from.line)-1,o=e.ch;return e.line==t.to.line&&(o+=r.ch-t.to.ch),He(n,o)};return{anchor:o(e.sel.anchor),head:o(e.sel.head)}}function Be(e,t,n){var r={canceled:!1,from:t.from,to:t.to,text:t.text,origin:t.origin,cancel:function(){this.canceled=!0}};return n&&(r.update=function(t,n,r,o){t&&(this.from=je(e,t)),n&&(this.to=je(e,n)),r&&(this.text=r),void 0!==o&&(this.origin=o)}),Pn(e,"beforeChange",e,r),e.cm&&Pn(e.cm,"beforeChange",e.cm,r),r.canceled?null:{from:r.from,to:r.to,text:r.text,origin:r.origin}}function Oe(e,t,n,r){if(e.cm){if(!e.cm.curOp)return ie(e.cm,Oe)(e,t,n,r);if(e.cm.state.suppressEdits)return}if(!(Rn(e,"beforeChange")||e.cm&&Rn(e.cm,"beforeChange"))||(t=Be(e,t,!0))){var o=Kr&&!r&&At(e,t.from,t.to);if(o){for(var i=o.length-1;i>=1;--i)Fe(e,{from:o[i].from,to:o[i].to,text:[""]});o.length&&Fe(e,{from:o[0].from,to:o[0].to,text:t.text},n)}else Fe(e,t,n)}}function Fe(e,t,n){var r=Ne(e,t,n);Cn(e,t,r,e.cm?e.cm.curOp.id:0/0),$e(e,t,r,Et(e,t));var o=[];ln(e,function(e,n){n||-1!=qn(o,e.history)||(xn(e.history,t),o.push(e.history)),$e(e,t,null,Et(e,t))})}function Pe(e,t){if(!e.cm||!e.cm.state.suppressEdits){var n=e.history,r=("undo"==t?n.done:n.undone).pop();if(r){var o={changes:[],anchorBefore:r.anchorAfter,headBefore:r.headAfter,anchorAfter:r.anchorBefore,headAfter:r.headBefore,generation:n.generation};("undo"==t?n.undone:n.done).push(o),n.generation=r.generation||++n.maxGeneration;for(var i=Rn(e,"beforeChange")||e.cm&&Rn(e.cm,"beforeChange"),a=r.changes.length-1;a>=0;--a){var s=r.changes[a];if(s.origin=t,i&&!Be(e,s,!1))return void(("undo"==t?n.done:n.undone).length=0);o.changes.push(wn(e,s));var u=a?Ne(e,s,null):{anchor:r.anchorBefore,head:r.headBefore};$e(e,s,u,Gt(e,s));var l=[];ln(e,function(e,t){t||-1!=qn(l,e.history)||(xn(e.history,s),l.push(e.history)),$e(e,s,null,Gt(e,s))})}}}}function Ue(e,t){function n(e){return He(e.line+t,e.ch)}e.first+=t,e.cm&&ue(e.cm,e.first,e.first,t),e.sel.head=n(e.sel.head),e.sel.anchor=n(e.sel.anchor),e.sel.from=n(e.sel.from),e.sel.to=n(e.sel.to)}function $e(e,t,n,r){if(e.cm&&!e.cm.curOp)return ie(e.cm,$e)(e,t,n,r);if(t.to.line<e.first)return void Ue(e,t.text.length-1-(t.to.line-t.from.line));if(!(t.from.line>e.lastLine())){if(t.from.line<e.first){var o=t.text.length-1-(e.first-t.from.line);Ue(e,o),t={from:He(e.first,0),to:He(t.to.line+o,t.to.ch),text:[Zn(t.text)],origin:t.origin}}var i=e.lastLine();t.to.line>i&&(t={from:t.from,to:He(i,dn(e,i).text.length),text:[t.text[0]],origin:t.origin}),t.removed=gn(e,t.from,t.to),n||(n=Ne(e,t,null)),e.cm?We(e.cm,t,r,n):an(e,t,r,n)}}function We(e,t,n,r){var i=e.doc,a=e.display,s=t.from,u=t.to,l=!1,d=s.line;e.options.lineWrapping||(d=pn(Ft(i,dn(i,s.line))),i.iter(d,u.line+1,function(e){return e==a.maxLine?(l=!0,!0):void 0})),Ke(i.sel.head,t.from)||Ke(t.to,i.sel.head)||(e.curOp.cursorActivity=!0),an(i,t,n,r,o(e)),e.options.lineWrapping||(i.iter(d,s.line+t.text.length,function(e){var t=c(i,e);t>a.maxLineLength&&(a.maxLine=e,a.maxLineLength=t,a.maxLineChanged=!0,l=!1)}),l&&(e.curOp.updateMaxLine=!0)),i.frontier=Math.min(i.frontier,s.line),E(e,400);var g=t.text.length-(u.line-s.line)-1;if(ue(e,s.line,u.line+1,g),Rn(e,"change")){var f={from:s,to:u,text:t.text,removed:t.removed,origin:t.origin};if(e.curOp.textChanged){for(var h=e.curOp.textChanged;h.next;h=h.next);h.next=f}else e.curOp.textChanged=f}}function Re(e,t,n,r,o){if(r||(r=n),Ke(r,n)){var i=r;r=n,n=i}"string"==typeof t&&(t=Do(t)),Oe(e,{from:n,to:r,text:t,origin:o},null)}function He(e,t){return this instanceof He?(this.line=e,void(this.ch=t)):new He(e,t)}function Ye(e,t){return e.line==t.line&&e.ch==t.ch}function Ke(e,t){return e.line<t.line||e.line==t.line&&e.ch<t.ch}function Ve(e){return He(e.line,e.ch)}function Ze(e,t){return Math.max(e.first,Math.min(t,e.first+e.size-1))}function je(e,t){if(t.line<e.first)return He(e.first,0);var n=e.first+e.size-1;return t.line>n?He(n,dn(e,n).text.length):qe(t,dn(e,t.line).text.length)}function qe(e,t){var n=e.ch;return null==n||n>t?He(e.line,t):0>n?He(e.line,0):e}function Xe(e,t){return t>=e.first&&t<e.first+e.size}function Je(e,t,n,r){if(e.sel.shift||e.sel.extend){var o=e.sel.anchor;if(n){var i=Ke(t,o);i!=Ke(n,o)?(o=t,t=n):i!=Ke(t,n)&&(t=n)}et(e,o,t,r)}else et(e,t,n||t,r);e.cm&&(e.cm.curOp.userSelChange=!0)}function Qe(e,t,n){var r={anchor:t,head:n};return Pn(e,"beforeSelectionChange",e,r),e.cm&&Pn(e.cm,"beforeSelectionChange",e.cm,r),r.anchor=je(e,r.anchor),r.head=je(e,r.head),r}function et(e,t,n,r,o){if(!o&&Rn(e,"beforeSelectionChange")||e.cm&&Rn(e.cm,"beforeSelectionChange")){var i=Qe(e,t,n);n=i.head,t=i.anchor}var a=e.sel;if(a.goalColumn=null,(o||!Ye(t,a.anchor))&&(t=nt(e,t,r,"push"!=o)),(o||!Ye(n,a.head))&&(n=nt(e,n,r,"push"!=o)),!Ye(a.anchor,t)||!Ye(a.head,n)){a.anchor=t,a.head=n;var s=Ke(n,t);a.from=s?n:t,a.to=s?t:n,e.cm&&(e.cm.curOp.updateInput=e.cm.curOp.selectionChanged=e.cm.curOp.cursorActivity=!0),Un(e,"cursorActivity",e)}}function tt(e){et(e.doc,e.doc.sel.from,e.doc.sel.to,null,"push")}function nt(e,t,n,r){var o=!1,i=t,a=n||1;e.cantEdit=!1;e:for(;;){var s=dn(e,i.line);if(s.markedSpans)for(var u=0;u<s.markedSpans.length;++u){var l=s.markedSpans[u],c=l.marker;if((null==l.from||(c.inclusiveLeft?l.from<=i.ch:l.from<i.ch))&&(null==l.to||(c.inclusiveRight?l.to>=i.ch:l.to>i.ch))){if(r&&(Pn(c,"beforeCursorEnter"),c.explicitlyCleared)){if(s.markedSpans){--u;continue}break}if(!c.atomic)continue;var d=c.find()[0>a?"from":"to"];if(Ye(d,i)&&(d.ch+=a,d.ch<0?d=d.line>e.first?je(e,He(d.line-1)):null:d.ch>s.text.length&&(d=d.line<e.first+e.size-1?He(d.line+1,0):null),!d)){if(o)return r?(e.cantEdit=!0,He(e.first,0)):nt(e,t,n,!0);o=!0,d=t,a=-a}i=d;continue e}}return i}}function rt(e){var t=ot(e,e.doc.sel.head,e.options.cursorScrollMargin);if(e.state.focused){var n=e.display,r=sr(n.sizer),o=null;if(t.top+r.top<0?o=!0:t.bottom+r.top>(window.innerHeight||document.documentElement.clientHeight)&&(o=!1),null!=o&&!Nr){var i="none"==n.cursor.style.display;i&&(n.cursor.style.display="",n.cursor.style.left=t.left+"px",n.cursor.style.top=t.top-n.viewOffset+"px"),n.cursor.scrollIntoView(o),i&&(n.cursor.style.display="none")}}}function ot(e,t,n){for(null==n&&(n=0);;){var r=!1,o=X(e,t),i=at(e,o.left,o.top-n,o.left,o.bottom+n),a=e.doc.scrollTop,s=e.doc.scrollLeft;if(null!=i.scrollTop&&(Ce(e,i.scrollTop),Math.abs(e.doc.scrollTop-a)>1&&(r=!0)),null!=i.scrollLeft&&(ke(e,i.scrollLeft),Math.abs(e.doc.scrollLeft-s)>1&&(r=!0)),!r)return o}}function it(e,t,n,r,o){var i=at(e,t,n,r,o);null!=i.scrollTop&&Ce(e,i.scrollTop),null!=i.scrollLeft&&ke(e,i.scrollLeft)}function at(e,t,n,r,o){var i=e.display,a=te(e.display);0>n&&(n=0);var s=i.scroller.clientHeight-ko,u=i.scroller.scrollTop,l={},c=e.doc.height+O(i),d=a>n,g=o>c-a;if(u>n)l.scrollTop=d?0:n;else if(o>u+s){var f=Math.min(n,(g?c:o)-s);f!=u&&(l.scrollTop=f)}var h=i.scroller.clientWidth-ko,p=i.scroller.scrollLeft;t+=i.gutters.offsetWidth,r+=i.gutters.offsetWidth;var m=i.gutters.offsetWidth,v=m+10>t;return p+m>t||v?(v&&(t=0),l.scrollLeft=Math.max(0,t-10-m)):r>h+p-3&&(l.scrollLeft=r+10-h),l}function st(e,t,n){e.curOp.updateScrollPos={scrollLeft:null==t?e.doc.scrollLeft:t,scrollTop:null==n?e.doc.scrollTop:n}}function ut(e,t,n){var r=e.curOp.updateScrollPos||(e.curOp.updateScrollPos={scrollLeft:e.doc.scrollLeft,scrollTop:e.doc.scrollTop}),o=e.display.scroller;r.scrollTop=Math.max(0,Math.min(o.scrollHeight-o.clientHeight,r.scrollTop+n)),r.scrollLeft=Math.max(0,Math.min(o.scrollWidth-o.clientWidth,r.scrollLeft+t))}function lt(e,t,n,r){var o=e.doc;if(null==n&&(n="add"),"smart"==n)if(e.doc.mode.indent)var i=N(e,t);else n="prev";var a,s=e.options.tabSize,u=dn(o,t),l=Kn(u.text,null,s),c=u.text.match(/^\s*/)[0];if("smart"==n&&(a=e.doc.mode.indent(i,u.text.slice(c.length),u.text),a==Mo)){if(!r)return;n="prev"}"prev"==n?a=t>o.first?Kn(dn(o,t-1).text,null,s):0:"add"==n?a=l+e.options.indentUnit:"subtract"==n?a=l-e.options.indentUnit:"number"==typeof n&&(a=l+n),a=Math.max(0,a);var d="",g=0;if(e.options.indentWithTabs)for(var f=Math.floor(a/s);f;--f)g+=s,d+="	";a>g&&(d+=Vn(a-g)),d!=c&&Re(e.doc,d,He(t,0),He(t,c.length),"+input"),u.stateAfter=null}function ct(e,t,n){var r=t,o=t,i=e.doc;return"number"==typeof t?o=dn(i,Ze(i,t)):r=pn(t),null==r?null:n(o,r)?(ue(e,r,r+1),o):null}function dt(e,t,n,r,o){function i(){var t=s+n;return t<e.first||t>=e.first+e.size?d=!1:(s=t,c=dn(e,t))}function a(e){var t=(o?wr:Cr)(c,u,n,!0);if(null==t){if(e||!i())return d=!1;u=o?(0>n?pr:hr)(c):0>n?c.text.length:0}else u=t;return!0}var s=t.line,u=t.ch,l=n,c=dn(e,s),d=!0;if("char"==r)a();else if("column"==r)a(!0);else if("word"==r||"group"==r)for(var g=null,f="group"==r,h=!0;!(0>n)||a(!h);h=!1){var p=c.text.charAt(u)||"\n",m=tr(p)?"w":f?/\s/.test(p)?null:"p":null;if(g&&g!=m){0>n&&(n=1,a());break}if(m&&(g=m),n>0&&!a(!h))break}var v=nt(e,He(s,u),l,!0);return d||(v.hitSide=!0),v}function gt(e,t,n,r){var o,i=e.doc,a=t.left;if("page"==r){var s=Math.min(e.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight);o=t.top+n*(s-(0>n?1.5:.5)*te(e.display))}else"line"==r&&(o=n>0?t.bottom+3:t.top-3);for(;;){var u=Q(e,a,o);if(!u.outside)break;if(0>n?0>=o:o>=i.height){u.hitSide=!0;break}o+=5*n}return u}function ft(e,t){var n=t.ch,r=t.ch;if(e){(t.xRel<0||r==e.length)&&n?--n:++r;for(var o=e.charAt(n),i=tr(o)?tr:/\s/.test(o)?function(e){return/\s/.test(e)}:function(e){return!/\s/.test(e)&&!tr(e)};n>0&&i(e.charAt(n-1));)--n;for(;r<e.length&&i(e.charAt(r));)++r}return{from:He(t.line,n),to:He(t.line,r)}}function ht(e,t){Je(e.doc,He(t,0),je(e.doc,He(t+1,0)))}function pt(t,n,r,o){e.defaults[t]=n,r&&(no[t]=o?function(e,t,n){n!=oo&&r(e,t,n)}:r)}function mt(e,t){if(t===!0)return t;if(e.copyState)return e.copyState(t);var n={};for(var r in t){var o=t[r];o instanceof Array&&(o=o.concat([])),n[r]=o}return n}function vt(e,t,n){return e.startState?e.startState(t,n):!0}function bt(e){return"string"==typeof e?go[e]:e}function yt(e,t,n){function r(t){t=bt(t);var o=t[e];if(o===!1)return"stop";if(null!=o&&n(o))return!0;if(t.nofallthrough)return"stop";var i=t.fallthrough;if(null==i)return!1;if("[object Array]"!=Object.prototype.toString.call(i))return r(i);for(var a=0,s=i.length;s>a;++a){var u=r(i[a]);if(u)return u}return!1}for(var o=0;o<t.length;++o){var i=r(t[o]);if(i)return"stop"!=i}}function _t(e){var t=Ao[e.keyCode];return"Ctrl"==t||"Alt"==t||"Shift"==t||"Mod"==t}function wt(e,t){if(Ir&&34==e.keyCode&&e["char"])return!1;var n=Ao[e.keyCode];return null==n||e.altGraphKey?!1:(e.altKey&&(n="Alt-"+n),(Hr?e.metaKey:e.ctrlKey)&&(n="Ctrl-"+n),(Hr?e.ctrlKey:e.metaKey)&&(n="Cmd-"+n),!t&&e.shiftKey&&(n="Shift-"+n),n)}function Ct(e,t){this.pos=this.start=0,this.string=e,this.tabSize=t||8,this.lastColumnPos=this.lastColumnValue=0}function kt(e,t){this.lines=[],this.type=t,this.doc=e}function Mt(e,t,n,r,o){if(r&&r.shared)return St(e,t,n,r,o);if(e.cm&&!e.cm.curOp)return ie(e.cm,Mt)(e,t,n,r,o);var i=new kt(e,o);if("range"==o&&!Ke(t,n))return i;r&&Jn(r,i),i.replacedWith&&(i.collapsed=!0,i.replacedWith=rr("span",[i.replacedWith],"CodeMirror-widget"),r.handleMouseEvents||(i.replacedWith.ignoreEvents=!0)),i.collapsed&&(Vr=!0),i.addToHistory&&Cn(e,{from:t,to:n,origin:"markText"},{head:e.sel.head,anchor:e.sel.anchor},0/0);var a,s,u,l=t.line,c=0,d=e.cm;if(e.iter(l,n.line+1,function(r){d&&i.collapsed&&!d.options.lineWrapping&&Ft(e,r)==d.display.maxLine&&(u=!0);var o={from:null,to:null,marker:i};c+=r.text.length,l==t.line&&(o.from=t.ch,c-=t.ch),l==n.line&&(o.to=n.ch,c-=r.text.length-n.ch),i.collapsed&&(l==n.line&&(s=Nt(r,n.ch)),l==t.line?a=Nt(r,t.ch):hn(r,0)),zt(r,o),++l}),i.collapsed&&e.iter(t.line,n.line+1,function(t){Pt(e,t)&&hn(t,0)}),i.clearOnEnter&&On(i,"beforeCursorEnter",function(){i.clear()}),i.readOnly&&(Kr=!0,(e.history.done.length||e.history.undone.length)&&e.clearHistory()),i.collapsed){if(a!=s)throw new Error("Inserting collapsed marker overlapping an existing one");i.size=c,i.atomic=!0}return d&&(u&&(d.curOp.updateMaxLine=!0),(i.className||i.title||i.startStyle||i.endStyle||i.collapsed)&&ue(d,t.line,n.line+1),i.atomic&&tt(d)),i}function Lt(e,t){this.markers=e,this.primary=t;for(var n=0,r=this;n<e.length;++n)e[n].parent=this,On(e[n],"clear",function(){r.clear()})}function St(e,t,n,r,o){r=Jn(r),r.shared=!1;var i=[Mt(e,t,n,r,o)],a=i[0],s=r.replacedWith;return ln(e,function(e){s&&(r.replacedWith=s.cloneNode(!0)),i.push(Mt(e,je(e,t),je(e,n),r,o));for(var u=0;u<e.linked.length;++u)if(e.linked[u].isParent)return;a=Zn(i)}),new Lt(i,a)}function Tt(e,t){if(e)for(var n=0;n<e.length;++n){var r=e[n];if(r.marker==t)return r}}function xt(e,t){for(var n,r=0;r<e.length;++r)e[r]!=t&&(n||(n=[])).push(e[r]);return n}function zt(e,t){e.markedSpans=e.markedSpans?e.markedSpans.concat([t]):[t],t.marker.attachLine(e)}function It(e,t,n){if(e)for(var r,o=0;o<e.length;++o){var i=e[o],a=i.marker,s=null==i.from||(a.inclusiveLeft?i.from<=t:i.from<t);if(s||"bookmark"==a.type&&i.from==t&&(!n||!i.marker.insertLeft)){var u=null==i.to||(a.inclusiveRight?i.to>=t:i.to>t);(r||(r=[])).push({from:i.from,to:u?null:i.to,marker:a})}}return r}function Dt(e,t,n){if(e)for(var r,o=0;o<e.length;++o){var i=e[o],a=i.marker,s=null==i.to||(a.inclusiveRight?i.to>=t:i.to>t);if(s||"bookmark"==a.type&&i.from==t&&(!n||i.marker.insertLeft)){var u=null==i.from||(a.inclusiveLeft?i.from<=t:i.from<t);(r||(r=[])).push({from:u?null:i.from-t,to:null==i.to?null:i.to-t,marker:a})}}return r}function Et(e,t){var n=Xe(e,t.from.line)&&dn(e,t.from.line).markedSpans,r=Xe(e,t.to.line)&&dn(e,t.to.line).markedSpans;if(!n&&!r)return null;var o=t.from.ch,i=t.to.ch,a=Ye(t.from,t.to),s=It(n,o,a),u=Dt(r,i,a),l=1==t.text.length,c=Zn(t.text).length+(l?o:0);if(s)for(var d=0;d<s.length;++d){var g=s[d];if(null==g.to){var f=Tt(u,g.marker);f?l&&(g.to=null==f.to?null:f.to+c):g.to=o}}if(u)for(var d=0;d<u.length;++d){var g=u[d];if(null!=g.to&&(g.to+=c),null==g.from){var f=Tt(s,g.marker);f||(g.from=c,l&&(s||(s=[])).push(g))}else g.from+=c,l&&(s||(s=[])).push(g)}if(l&&s){for(var d=0;d<s.length;++d)null!=s[d].from&&s[d].from==s[d].to&&"bookmark"!=s[d].marker.type&&s.splice(d--,1);s.length||(s=null)}var h=[s];if(!l){var p,m=t.text.length-2;if(m>0&&s)for(var d=0;d<s.length;++d)null==s[d].to&&(p||(p=[])).push({from:null,to:null,marker:s[d].marker});for(var d=0;m>d;++d)h.push(p);h.push(u)}return h}function Gt(e,t){var n=Mn(e,t),r=Et(e,t);if(!n)return r;if(!r)return n;for(var o=0;o<n.length;++o){var i=n[o],a=r[o];if(i&&a)e:for(var s=0;s<a.length;++s){for(var u=a[s],l=0;l<i.length;++l)if(i[l].marker==u.marker)continue e;i.push(u)}else a&&(n[o]=a)}return n}function At(e,t,n){var r=null;if(e.iter(t.line,n.line+1,function(e){if(e.markedSpans)for(var t=0;t<e.markedSpans.length;++t){var n=e.markedSpans[t].marker;!n.readOnly||r&&-1!=qn(r,n)||(r||(r=[])).push(n)}}),!r)return null;for(var o=[{from:t,to:n}],i=0;i<r.length;++i)for(var a=r[i],s=a.find(),u=0;u<o.length;++u){var l=o[u];if(!Ke(l.to,s.from)&&!Ke(s.to,l.from)){var c=[u,1];(Ke(l.from,s.from)||!a.inclusiveLeft&&Ye(l.from,s.from))&&c.push({from:l.from,to:s.from}),(Ke(s.to,l.to)||!a.inclusiveRight&&Ye(l.to,s.to))&&c.push({from:s.to,to:l.to}),o.splice.apply(o,c),u+=c.length-1}}return o}function Nt(e,t){var n,r=Vr&&e.markedSpans;if(r)for(var o,i=0;i<r.length;++i)o=r[i],o.marker.collapsed&&(null==o.from||o.from<t)&&(null==o.to||o.to>t)&&(!n||n.width<o.marker.width)&&(n=o.marker);return n}function Bt(e){return Nt(e,-1)}function Ot(e){return Nt(e,e.text.length+1)}function Ft(e,t){for(var n;n=Bt(t);)t=dn(e,n.find().from.line);return t}function Pt(e,t){var n=Vr&&t.markedSpans;if(n)for(var r,o=0;o<n.length;++o)if(r=n[o],r.marker.collapsed){if(null==r.from)return!0;if(!r.marker.replacedWith&&0==r.from&&r.marker.inclusiveLeft&&Ut(e,t,r))return!0}}function Ut(e,t,n){if(null==n.to){var r=n.marker.find().to,o=dn(e,r.line);return Ut(e,o,Tt(o.markedSpans,n.marker))}if(n.marker.inclusiveRight&&n.to==t.text.length)return!0;for(var i,a=0;a<t.markedSpans.length;++a)if(i=t.markedSpans[a],i.marker.collapsed&&!i.marker.replacedWith&&i.from==n.to&&(i.marker.inclusiveLeft||n.marker.inclusiveRight)&&Ut(e,t,i))return!0}function $t(e){var t=e.markedSpans;if(t){for(var n=0;n<t.length;++n)t[n].marker.detachLine(e);e.markedSpans=null}}function Wt(e,t){if(t){for(var n=0;n<t.length;++n)t[n].marker.attachLine(e);e.markedSpans=t}}function Rt(e){return function(){var t=!this.cm.curOp;t&&re(this.cm);try{var n=e.apply(this,arguments)}finally{t&&oe(this.cm)}return n}}function Ht(e){return null!=e.height?e.height:(e.node.parentNode&&1==e.node.parentNode.nodeType||ir(e.cm.display.measure,rr("div",[e.node],null,"position: relative")),e.height=e.node.offsetHeight)}function Yt(e,t,n,r){var o=new fo(e,n,r);return o.noHScroll&&(e.display.alignWidgets=!0),ct(e,t,function(t){var n=t.widgets||(t.widgets=[]);if(null==o.insertAt?n.push(o):n.splice(Math.min(n.length-1,Math.max(0,o.insertAt)),0,o),o.line=t,!Pt(e.doc,t)||o.showIfHidden){var r=vn(e,t)<e.doc.scrollTop;hn(t,t.height+Ht(o)),r&&ut(e,0,o.height)}return!0}),o}function Kt(e,t,n,r){e.text=t,e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null),null!=e.order&&(e.order=null),$t(e),Wt(e,n);var o=r?r(e):1;o!=e.height&&hn(e,o)}function Vt(e){e.parent=null,$t(e)}function Zt(e,t,n,r,o){var i=n.flattenSpans;null==i&&(i=e.options.flattenSpans);var a,s=0,u=null,l=new Ct(t,e.options.tabSize);for(""==t&&n.blankLine&&n.blankLine(r);!l.eol();)l.pos>e.options.maxHighlightLength?(i=!1,l.pos=Math.min(t.length,l.start+5e4),a=null):a=n.token(l,r),i&&u==a||(s<l.start&&o(l.start,u),s=l.start,u=a),l.start=l.pos;s<l.pos&&o(l.pos,u)}function jt(e,t,n){var r=[e.state.modeGen];Zt(e,t.text,e.doc.mode,n,function(e,t){r.push(e,t)});for(var o=0;o<e.state.overlays.length;++o){var i=e.state.overlays[o],a=1,s=0;Zt(e,t.text,i.mode,!0,function(e,t){for(var n=a;e>s;){var o=r[a];o>e&&r.splice(a,1,e,r[a+1],o),a+=2,s=Math.min(e,o)}if(t)if(i.opaque)r.splice(n,a-n,e,t),a=n+2;else for(;a>n;n+=2){var u=r[n+1];r[n+1]=u?u+" "+t:t}})}return r}function qt(e,t){return t.styles&&t.styles[0]==e.state.modeGen||(t.styles=jt(e,t,t.stateAfter=N(e,pn(t)))),t.styles}function Xt(e,t,n){var r=e.doc.mode,o=new Ct(t.text,e.options.tabSize);for(""==t.text&&r.blankLine&&r.blankLine(n);!o.eol()&&o.pos<=e.options.maxHighlightLength;)r.token(o,n),o.start=o.pos}function Jt(e){return e?po[e]||(po[e]="cm-"+e.replace(/ +/g," cm-")):null}function Qt(e,t,n,r){for(var o,i=t,a=!0;o=Bt(i);)i=dn(e.doc,o.find().from.line);var s={pre:rr("pre"),col:0,pos:0,measure:null,measuredSomething:!1,cm:e,copyWidgets:r};i.textClass&&(s.pre.className=i.textClass);do{i.text&&(a=!1),s.measure=i==t&&n,s.pos=0,s.addToken=s.measure?tn:en,(Mr||Tr)&&e.getOption("lineWrapping")&&(s.addToken=nn(s.addToken));var u=on(i,s,qt(e,i));n&&i==t&&!s.measuredSomething&&(n[0]=s.pre.appendChild(cr(e.display.measure)),s.measuredSomething=!0),u&&(i=dn(e.doc,u.to.line))}while(u);!n||s.measuredSomething||n[0]||(n[0]=s.pre.appendChild(a?rr("span"," "):cr(e.display.measure))),s.pre.firstChild||Pt(e.doc,t)||s.pre.appendChild(document.createTextNode(" "));var l;if(n&&Mr&&(l=bn(i))){var c=l.length-1;l[c].from==l[c].to&&--c;var d=l[c],g=l[c-1];if(d.from+1==d.to&&g&&d.level<g.level){var f=n[s.pos-1];f&&f.parentNode.insertBefore(f.measureRight=cr(e.display.measure),f.nextSibling)}}return Pn(e,"renderLine",e,t,s.pre),s.pre}function en(e,t,n,r,o,i){if(t){if(mo.test(t))for(var a=document.createDocumentFragment(),s=0;;){mo.lastIndex=s;var u=mo.exec(t),l=u?u.index-s:t.length-s;if(l&&(a.appendChild(document.createTextNode(t.slice(s,s+l))),e.col+=l),!u)break;if(s+=l+1,"	"==u[0]){var c=e.cm.options.tabSize,d=c-e.col%c;a.appendChild(rr("span",Vn(d),"cm-tab")),e.col+=d}else{var g=rr("span","•","cm-invalidchar");g.title="\\u"+u[0].charCodeAt(0).toString(16),a.appendChild(g),e.col+=1}}else{e.col+=t.length;var a=document.createTextNode(t)}if(n||r||o||e.measure){var f=n||"";r&&(f+=r),o&&(f+=o);var g=rr("span",[a],f);return i&&(g.title=i),e.pre.appendChild(g)}e.pre.appendChild(a)}}function tn(e,t,n,r,o){for(var i=e.cm.options.lineWrapping,a=0;a<t.length;++a){var s=t.charAt(a),u=0==a;s>="�"&&"�">s&&a<t.length-1?(s=t.slice(a,a+2),++a):a&&i&&ur(t,a)&&e.pre.appendChild(rr("wbr"));var l=e.measure[e.pos],c=e.measure[e.pos]=en(e,s,n,u&&r,a==t.length-1&&o);l&&(c.leftSide=l.leftSide||l),Mr&&i&&" "==s&&a&&!/\s/.test(t.charAt(a-1))&&a<t.length-1&&!/\s/.test(t.charAt(a+1))&&(c.style.whiteSpace="normal"),e.pos+=s.length}t.length&&(e.measuredSomething=!0)}function nn(e){function t(e){for(var t=" ",n=0;n<e.length-2;++n)t+=n%2?" ":" ";return t+=" "}return function(n,r,o,i,a,s){return e(n,r.replace(/ {3,}/,t),o,i,a,s)}}function rn(e,t,n,r){var o=!r&&n.replacedWith;if(o&&(e.copyWidgets&&(o=o.cloneNode(!0)),e.pre.appendChild(o),e.measure)){if(t)e.measure[e.pos]=o;else{var i=e.measure[e.pos]=cr(e.cm.display.measure);"bookmark"!=n.type||n.insertLeft?e.pre.insertBefore(i,o):e.pre.appendChild(i)}e.measuredSomething=!0}e.pos+=t}function on(e,t,n){var r=e.markedSpans,o=e.text,i=0;if(r)for(var a,s,u,l,c,d,g=o.length,f=0,h=1,p="",m=0;;){if(m==f){s=u=l=c="",d=null,m=1/0;for(var v=null,b=0;b<r.length;++b){var y=r[b],_=y.marker;y.from<=f&&(null==y.to||y.to>f)?(null!=y.to&&m>y.to&&(m=y.to,u=""),_.className&&(s+=" "+_.className),_.startStyle&&y.from==f&&(l+=" "+_.startStyle),_.endStyle&&y.to==m&&(u+=" "+_.endStyle),_.title&&!c&&(c=_.title),_.collapsed&&(!d||d.marker.size<_.size)&&(d=y)):y.from>f&&m>y.from&&(m=y.from),"bookmark"==_.type&&y.from==f&&_.replacedWith&&(v=_)}if(d&&(d.from||0)==f&&(rn(t,(null==d.to?g:d.to)-f,d.marker,null==d.from),null==d.to))return d.marker.find();v&&!d&&rn(t,0,v)}if(f>=g)break;for(var w=Math.min(g,m);;){if(p){var C=f+p.length;if(!d){var k=C>w?p.slice(0,w-f):p;t.addToken(t,k,a?a+s:s,l,f+k.length==m?u:"",c)}if(C>=w){p=p.slice(w-f),f=w;break}f=C,l=""}p=o.slice(i,i=n[h++]),a=Jt(n[h++])}}else for(var h=1;h<n.length;h+=2)t.addToken(t,o.slice(i,i=n[h]),Jt(n[h+1]))}function an(e,t,n,r,o){function i(e){return n?n[e]:null}function a(e,n,r){Kt(e,n,r,o),Un(e,"change",e,t)}var s=t.from,u=t.to,l=t.text,c=dn(e,s.line),d=dn(e,u.line),g=Zn(l),f=i(l.length-1),h=u.line-s.line;if(0==s.ch&&0==u.ch&&""==g){for(var p=0,m=l.length-1,v=[];m>p;++p)v.push(new ho(l[p],i(p),o));a(d,d.text,f),h&&e.remove(s.line,h),v.length&&e.insert(s.line,v)}else if(c==d)if(1==l.length)a(c,c.text.slice(0,s.ch)+g+c.text.slice(u.ch),f);else{for(var v=[],p=1,m=l.length-1;m>p;++p)v.push(new ho(l[p],i(p),o));v.push(new ho(g+c.text.slice(u.ch),f,o)),a(c,c.text.slice(0,s.ch)+l[0],i(0)),e.insert(s.line+1,v)}else if(1==l.length)a(c,c.text.slice(0,s.ch)+l[0]+d.text.slice(u.ch),i(0)),e.remove(s.line+1,h);else{a(c,c.text.slice(0,s.ch)+l[0],i(0)),a(d,g+d.text.slice(u.ch),f);for(var p=1,m=l.length-1,v=[];m>p;++p)v.push(new ho(l[p],i(p),o));h>1&&e.remove(s.line+1,h-1),e.insert(s.line+1,v)}Un(e,"change",e,t),et(e,r.anchor,r.head,null,!0)}function sn(e){this.lines=e,this.parent=null;for(var t=0,n=e.length,r=0;n>t;++t)e[t].parent=this,r+=e[t].height;this.height=r}function un(e){this.children=e;for(var t=0,n=0,r=0,o=e.length;o>r;++r){var i=e[r];t+=i.chunkSize(),n+=i.height,i.parent=this}this.size=t,this.height=n,this.parent=null}function ln(e,t,n){function r(e,o,i){if(e.linked)for(var a=0;a<e.linked.length;++a){var s=e.linked[a];if(s.doc!=o){var u=i&&s.sharedHist;(!n||u)&&(t(s.doc,u),r(s.doc,e,u))}}}r(e,null,!0)}function cn(e,t){if(t.cm)throw new Error("This document is already in use.");e.doc=t,t.cm=e,i(e),n(e),e.options.lineWrapping||d(e),e.options.mode=t.modeOption,ue(e)}function dn(e,t){for(t-=e.first;!e.lines;)for(var n=0;;++n){var r=e.children[n],o=r.chunkSize();if(o>t){e=r;break}t-=o}return e.lines[t]}function gn(e,t,n){var r=[],o=t.line;return e.iter(t.line,n.line+1,function(e){var i=e.text;o==n.line&&(i=i.slice(0,n.ch)),o==t.line&&(i=i.slice(t.ch)),r.push(i),++o}),r}function fn(e,t,n){var r=[];return e.iter(t,n,function(e){r.push(e.text)}),r}function hn(e,t){for(var n=t-e.height,r=e;r;r=r.parent)r.height+=n}function pn(e){if(null==e.parent)return null;for(var t=e.parent,n=qn(t.lines,e),r=t.parent;r;t=r,r=r.parent)for(var o=0;r.children[o]!=t;++o)n+=r.children[o].chunkSize();return n+t.first}function mn(e,t){var n=e.first;e:do{for(var r=0,o=e.children.length;o>r;++r){var i=e.children[r],a=i.height;if(a>t){e=i;continue e}t-=a,n+=i.chunkSize()}return n}while(!e.lines);for(var r=0,o=e.lines.length;o>r;++r){var s=e.lines[r],u=s.height;if(u>t)break;t-=u}return n+r}function vn(e,t){t=Ft(e.doc,t);for(var n=0,r=t.parent,o=0;o<r.lines.length;++o){var i=r.lines[o];if(i==t)break;n+=i.height}for(var a=r.parent;a;r=a,a=r.parent)for(var o=0;o<a.children.length;++o){var s=a.children[o];if(s==r)break;n+=s.height}return n}function bn(e){var t=e.order;return null==t&&(t=e.order=Bo(e.text)),t}function yn(e){return{done:[],undone:[],undoDepth:1/0,lastTime:0,lastOp:null,lastOrigin:null,generation:e||1,maxGeneration:e||1}}function _n(e,t,n,r){var o=t["spans_"+e.id],i=0;e.iter(Math.max(e.first,n),Math.min(e.first+e.size,r),function(n){n.markedSpans&&((o||(o=t["spans_"+e.id]={}))[i]=n.markedSpans),++i})}function wn(e,t){var n={line:t.from.line,ch:t.from.ch},r={from:n,to:to(t),text:gn(e,t.from,t.to)};return _n(e,r,t.from.line,t.to.line+1),ln(e,function(e){_n(e,r,t.from.line,t.to.line+1)},!0),r}function Cn(e,t,n,r){var o=e.history;o.undone.length=0;var i=+new Date,a=Zn(o.done);if(a&&(o.lastOp==r||o.lastOrigin==t.origin&&t.origin&&("+"==t.origin.charAt(0)&&e.cm&&o.lastTime>i-e.cm.options.historyEventDelay||"*"==t.origin.charAt(0)))){var s=Zn(a.changes);Ye(t.from,t.to)&&Ye(t.from,s.to)?s.to=to(t):a.changes.push(wn(e,t)),a.anchorAfter=n.anchor,a.headAfter=n.head}else for(a={changes:[wn(e,t)],generation:o.generation,anchorBefore:e.sel.anchor,headBefore:e.sel.head,anchorAfter:n.anchor,headAfter:n.head},o.done.push(a),o.generation=++o.maxGeneration;o.done.length>o.undoDepth;)o.done.shift();o.lastTime=i,o.lastOp=r,o.lastOrigin=t.origin}function kn(e){if(!e)return null;for(var t,n=0;n<e.length;++n)e[n].marker.explicitlyCleared?t||(t=e.slice(0,n)):t&&t.push(e[n]);return t?t.length?t:null:e}function Mn(e,t){var n=t["spans_"+e.id];if(!n)return null;for(var r=0,o=[];r<t.text.length;++r)o.push(kn(n[r]));return o}function Ln(e,t){for(var n=0,r=[];n<e.length;++n){var o=e[n],i=o.changes,a=[];r.push({changes:a,anchorBefore:o.anchorBefore,headBefore:o.headBefore,anchorAfter:o.anchorAfter,headAfter:o.headAfter});for(var s=0;s<i.length;++s){var u,l=i[s];if(a.push({from:l.from,to:l.to,text:l.text}),t)for(var c in l)(u=c.match(/^spans_(\d+)$/))&&qn(t,Number(u[1]))>-1&&(Zn(a)[c]=l[c],delete l[c])}}return r}function Sn(e,t,n,r){n<e.line?e.line+=r:t<e.line&&(e.line=t,e.ch=0)}function Tn(e,t,n,r){for(var o=0;o<e.length;++o){for(var i=e[o],a=!0,s=0;s<i.changes.length;++s){var u=i.changes[s];if(i.copied||(u.from=Ve(u.from),u.to=Ve(u.to)),n<u.from.line)u.from.line+=r,u.to.line+=r;else if(t<=u.to.line){a=!1;break}}i.copied||(i.anchorBefore=Ve(i.anchorBefore),i.headBefore=Ve(i.headBefore),i.anchorAfter=Ve(i.anchorAfter),i.readAfter=Ve(i.headAfter),i.copied=!0),a?(Sn(i.anchorBefore),Sn(i.headBefore),Sn(i.anchorAfter),Sn(i.headAfter)):(e.splice(0,o+1),o=0)}}function xn(e,t){var n=t.from.line,r=t.to.line,o=t.text.length-(r-n)-1;Tn(e.done,n,r,o),Tn(e.undone,n,r,o)}function zn(){An(this)}function In(e){return e.stop||(e.stop=zn),e}function Dn(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function En(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function Gn(e){return null!=e.defaultPrevented?e.defaultPrevented:0==e.returnValue}function An(e){Dn(e),En(e)}function Nn(e){return e.target||e.srcElement}function Bn(e){var t=e.which;return null==t&&(1&e.button?t=1:2&e.button?t=3:4&e.button&&(t=2)),Fr&&e.ctrlKey&&1==t&&(t=3),t}function On(e,t,n){if(e.addEventListener)e.addEventListener(t,n,!1);else if(e.attachEvent)e.attachEvent("on"+t,n);else{var r=e._handlers||(e._handlers={}),o=r[t]||(r[t]=[]);o.push(n)}}function Fn(e,t,n){if(e.removeEventListener)e.removeEventListener(t,n,!1);else if(e.detachEvent)e.detachEvent("on"+t,n);else{var r=e._handlers&&e._handlers[t];if(!r)return;for(var o=0;o<r.length;++o)if(r[o]==n){r.splice(o,1);break}}}function Pn(e,t){var n=e._handlers&&e._handlers[t];if(n)for(var r=Array.prototype.slice.call(arguments,2),o=0;o<n.length;++o)n[o].apply(null,r)}function Un(e,t){function n(e){return function(){e.apply(null,o)}}var r=e._handlers&&e._handlers[t];if(r){var o=Array.prototype.slice.call(arguments,2);wo||(++Co,wo=[],setTimeout(Wn,0));for(var i=0;i<r.length;++i)wo.push(n(r[i]))}}function $n(e,t,n){return Pn(e,n||t.type,e,t),Gn(t)||t.codemirrorIgnore}function Wn(){--Co;var e=wo;wo=null;for(var t=0;t<e.length;++t)e[t]()}function Rn(e,t){var n=e._handlers&&e._handlers[t];return n&&n.length>0;

}function Hn(e){e.prototype.on=function(e,t){On(this,e,t)},e.prototype.off=function(e,t){Fn(this,e,t)}}function Yn(){this.id=null}function Kn(e,t,n,r,o){null==t&&(t=e.search(/[^\s\u00a0]/),-1==t&&(t=e.length));for(var i=r||0,a=o||0;t>i;++i)"	"==e.charAt(i)?a+=n-a%n:++a;return a}function Vn(e){for(;Lo.length<=e;)Lo.push(Zn(Lo)+" ");return Lo[e]}function Zn(e){return e[e.length-1]}function jn(e){if(Br)e.selectionStart=0,e.selectionEnd=e.value.length;else try{e.select()}catch(t){}}function qn(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,r=e.length;r>n;++n)if(e[n]==t)return n;return-1}function Xn(e,t){function n(){}n.prototype=e;var r=new n;return t&&Jn(t,r),r}function Jn(e,t){t||(t={});for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function Qn(e){for(var t=[],n=0;e>n;++n)t.push(void 0);return t}function er(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t)}}function tr(e){return/\w/.test(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||So.test(e))}function nr(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!1;return!0}function rr(e,t,n,r){var o=document.createElement(e);if(n&&(o.className=n),r&&(o.style.cssText=r),"string"==typeof t)ar(o,t);else if(t)for(var i=0;i<t.length;++i)o.appendChild(t[i]);return o}function or(e){for(var t=e.childNodes.length;t>0;--t)e.removeChild(e.firstChild);return e}function ir(e,t){return or(e).appendChild(t)}function ar(e,t){Sr?(e.innerHTML="",e.appendChild(document.createTextNode(t))):e.textContent=t}function sr(e){return e.getBoundingClientRect()}function ur(){return!1}function lr(e){if(null!=zo)return zo;var t=rr("div",null,null,"width: 50px; height: 50px; overflow-x: scroll");return ir(e,t),t.offsetWidth&&(zo=t.offsetHeight-t.clientHeight),zo||0}function cr(e){if(null==Io){var t=rr("span","​");ir(e,rr("span",[t,document.createTextNode("x")])),0!=e.firstChild.offsetHeight&&(Io=t.offsetWidth<=1&&t.offsetHeight>2&&!Lr)}return Io?rr("span","​"):rr("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px")}function dr(e,t,n,r){if(!e)return r(t,n,"ltr");for(var o=!1,i=0;i<e.length;++i){var a=e[i];(a.from<n&&a.to>t||t==n&&a.to==t)&&(r(Math.max(a.from,t),Math.min(a.to,n),1==a.level?"rtl":"ltr"),o=!0)}o||r(t,n,"ltr")}function gr(e){return e.level%2?e.to:e.from}function fr(e){return e.level%2?e.from:e.to}function hr(e){var t=bn(e);return t?gr(t[0]):0}function pr(e){var t=bn(e);return t?fr(Zn(t)):e.text.length}function mr(e,t){var n=dn(e.doc,t),r=Ft(e.doc,n);r!=n&&(t=pn(r));var o=bn(r),i=o?o[0].level%2?pr(r):hr(r):0;return He(t,i)}function vr(e,t){for(var n,r;n=Ot(r=dn(e.doc,t));)t=n.find().to.line;var o=bn(r),i=o?o[0].level%2?hr(r):pr(r):r.text.length;return He(t,i)}function br(e,t,n){var r=e[0].level;return t==r?!0:n==r?!1:n>t}function yr(e,t){for(var n,r=0;r<e.length;++r){var o=e[r];if(o.from<t&&o.to>t)return No=null,r;if(o.from==t||o.to==t){if(null!=n)return br(e,o.level,e[n].level)?(No=n,r):(No=r,n);n=r}}return No=null,n}function _r(e,t,n,r){if(!r)return t+n;do t+=n;while(t>0&&To.test(e.text.charAt(t)));return t}function wr(e,t,n,r){var o=bn(e);if(!o)return Cr(e,t,n,r);for(var i=yr(o,t),a=o[i],s=_r(e,t,a.level%2?-n:n,r);;){if(s>a.from&&s<a.to)return s;if(s==a.from||s==a.to)return yr(o,s)==i?s:(a=o[i+=n],n>0==a.level%2?a.to:a.from);if(a=o[i+=n],!a)return null;s=n>0==a.level%2?_r(e,a.to,-1,r):_r(e,a.from,1,r)}}function Cr(e,t,n,r){var o=t+n;if(r)for(;o>0&&To.test(e.text.charAt(o));)o+=n;return 0>o||o>e.text.length?null:o}var kr=/gecko\/\d/i.test(navigator.userAgent),Mr=/MSIE \d/.test(navigator.userAgent),Lr=Mr&&(null==document.documentMode||document.documentMode<8),Sr=Mr&&(null==document.documentMode||document.documentMode<9),Tr=/WebKit\//.test(navigator.userAgent),xr=Tr&&/Qt\/\d+\.\d+/.test(navigator.userAgent),zr=/Chrome\//.test(navigator.userAgent),Ir=/Opera\//.test(navigator.userAgent),Dr=/Apple Computer/.test(navigator.vendor),Er=/KHTML\//.test(navigator.userAgent),Gr=/Mac OS X 1\d\D([7-9]|\d\d)\D/.test(navigator.userAgent),Ar=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(navigator.userAgent),Nr=/PhantomJS/.test(navigator.userAgent),Br=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent),Or=Br||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent),Fr=Br||/Mac/.test(navigator.platform),Pr=/windows/i.test(navigator.platform),Ur=Ir&&navigator.userAgent.match(/Version\/(\d*\.\d*)/);Ur&&(Ur=Number(Ur[1])),Ur&&Ur>=15&&(Ir=!1,Tr=!0);var $r,Wr,Rr,Hr=Fr&&(xr||Ir&&(null==Ur||12.11>Ur)),Yr=kr||Mr&&!Sr,Kr=!1,Vr=!1,Zr=0,jr=0,qr=0,Xr=null;Mr?Xr=-.53:kr?Xr=15:zr?Xr=-.7:Dr&&(Xr=-1/3);var Jr,Qr,eo=null,to=e.changeEnd=function(e){return e.text?He(e.from.line+e.text.length-1,Zn(e.text).length+(1==e.text.length?e.from.ch:0)):e.to};e.Pos=He,e.prototype={constructor:e,focus:function(){window.focus(),fe(this),De(this),ce(this)},setOption:function(e,t){var n=this.options,r=n[e];(n[e]!=t||"mode"==e)&&(n[e]=t,no.hasOwnProperty(e)&&ie(this,no[e])(this,t,r))},getOption:function(e){return this.options[e]},getDoc:function(){return this.doc},addKeyMap:function(e,t){this.state.keyMaps[t?"push":"unshift"](e)},removeKeyMap:function(e){for(var t=this.state.keyMaps,n=0;n<t.length;++n)if(t[n]==e||"string"!=typeof t[n]&&t[n].name==e)return t.splice(n,1),!0},addOverlay:ie(null,function(t,n){var r=t.token?t:e.getMode(this.options,t);if(r.startState)throw new Error("Overlays may not be stateful.");this.state.overlays.push({mode:r,modeSpec:t,opaque:n&&n.opaque}),this.state.modeGen++,ue(this)}),removeOverlay:ie(null,function(e){for(var t=this.state.overlays,n=0;n<t.length;++n){var r=t[n].modeSpec;if(r==e||"string"==typeof e&&r.name==e)return t.splice(n,1),this.state.modeGen++,void ue(this)}}),indentLine:ie(null,function(e,t,n){"string"!=typeof t&&"number"!=typeof t&&(t=null==t?this.options.smartIndent?"smart":"prev":t?"add":"subtract"),Xe(this.doc,e)&&lt(this,e,t,n)}),indentSelection:ie(null,function(e){var t=this.doc.sel;if(Ye(t.from,t.to))return lt(this,t.from.line,e);for(var n=t.to.line-(t.to.ch?0:1),r=t.from.line;n>=r;++r)lt(this,r,e)}),getTokenAt:function(e,t){var n=this.doc;e=je(n,e);for(var r=N(this,e.line,t),o=this.doc.mode,i=dn(n,e.line),a=new Ct(i.text,this.options.tabSize);a.pos<e.ch&&!a.eol();){a.start=a.pos;var s=o.token(a,r)}return{start:a.start,end:a.pos,string:a.current(),className:s||null,type:s||null,state:r}},getTokenTypeAt:function(e){e=je(this.doc,e);var t=qt(this,dn(this.doc,e.line)),n=0,r=(t.length-1)/2,o=e.ch;if(0==o)return t[2];for(;;){var i=n+r>>1;if((i?t[2*i-1]:0)>=o)r=i;else{if(!(t[2*i+1]<o))return t[2*i+2];n=i+1}}},getModeAt:function(t){var n=this.doc.mode;return n.innerMode?e.innerMode(n,this.getTokenAt(t).state).mode:n},getHelper:function(e,t){if(lo.hasOwnProperty(t)){var n=lo[t],r=this.getModeAt(e);return r[t]&&n[r[t]]||r.helperType&&n[r.helperType]||n[r.name]}},getStateAfter:function(e,t){var n=this.doc;return e=Ze(n,null==e?n.first+n.size-1:e),N(this,e+1,t)},cursorCoords:function(e,t){var n,r=this.doc.sel;return n=null==e?r.head:"object"==typeof e?je(this.doc,e):e?r.from:r.to,X(this,n,t||"page")},charCoords:function(e,t){return q(this,je(this.doc,e),t||"page")},coordsChar:function(e,t){return e=j(this,e,t||"page"),Q(this,e.left,e.top)},lineAtHeight:function(e,t){return e=j(this,{top:e,left:0},t||"page").top,mn(this.doc,e+this.display.viewOffset)},heightAtLine:function(e,t){var n=!1,r=this.doc.first+this.doc.size-1;e<this.doc.first?e=this.doc.first:e>r&&(e=r,n=!0);var o=dn(this.doc,e);return Z(this,dn(this.doc,e),{top:0,left:0},t||"page").top+(n?o.height:0)},defaultTextHeight:function(){return te(this.display)},defaultCharWidth:function(){return ne(this.display)},setGutterMarker:ie(null,function(e,t,n){return ct(this,e,function(e){var r=e.gutterMarkers||(e.gutterMarkers={});return r[t]=n,!n&&nr(r)&&(e.gutterMarkers=null),!0})}),clearGutter:ie(null,function(e){var t=this,n=t.doc,r=n.first;n.iter(function(n){n.gutterMarkers&&n.gutterMarkers[e]&&(n.gutterMarkers[e]=null,ue(t,r,r+1),nr(n.gutterMarkers)&&(n.gutterMarkers=null)),++r})}),addLineClass:ie(null,function(e,t,n){return ct(this,e,function(e){var r="text"==t?"textClass":"background"==t?"bgClass":"wrapClass";if(e[r]){if(new RegExp("(?:^|\\s)"+n+"(?:$|\\s)").test(e[r]))return!1;e[r]+=" "+n}else e[r]=n;return!0})}),removeLineClass:ie(null,function(e,t,n){return ct(this,e,function(e){var r="text"==t?"textClass":"background"==t?"bgClass":"wrapClass",o=e[r];if(!o)return!1;if(null==n)e[r]=null;else{var i=o.match(new RegExp("(?:^|\\s+)"+n+"(?:$|\\s+)"));if(!i)return!1;var a=i.index+i[0].length;e[r]=o.slice(0,i.index)+(i.index&&a!=o.length?" ":"")+o.slice(a)||null}return!0})}),addLineWidget:ie(null,function(e,t,n){return Yt(this,e,t,n)}),removeLineWidget:function(e){e.clear()},lineInfo:function(e){if("number"==typeof e){if(!Xe(this.doc,e))return null;var t=e;if(e=dn(this.doc,e),!e)return null}else{var t=pn(e);if(null==t)return null}return{line:t,handle:e,text:e.text,gutterMarkers:e.gutterMarkers,textClass:e.textClass,bgClass:e.bgClass,wrapClass:e.wrapClass,widgets:e.widgets}},getViewport:function(){return{from:this.display.showingFrom,to:this.display.showingTo}},addWidget:function(e,t,n,r,o){var i=this.display;e=X(this,je(this.doc,e));var a=e.bottom,s=e.left;if(t.style.position="absolute",i.sizer.appendChild(t),"over"==r)a=e.top;else if("above"==r||"near"==r){var u=Math.max(i.wrapper.clientHeight,this.doc.height),l=Math.max(i.sizer.clientWidth,i.lineSpace.clientWidth);("above"==r||e.bottom+t.offsetHeight>u)&&e.top>t.offsetHeight?a=e.top-t.offsetHeight:e.bottom+t.offsetHeight<=u&&(a=e.bottom),s+t.offsetWidth>l&&(s=l-t.offsetWidth)}t.style.top=a+"px",t.style.left=t.style.right="","right"==o?(s=i.sizer.clientWidth-t.offsetWidth,t.style.right="0px"):("left"==o?s=0:"middle"==o&&(s=(i.sizer.clientWidth-t.offsetWidth)/2),t.style.left=s+"px"),n&&it(this,s,a,s+t.offsetWidth,a+t.offsetHeight)},triggerOnKeyDown:ie(null,ze),execCommand:function(e){return co[e](this)},findPosH:function(e,t,n,r){var o=1;0>t&&(o=-1,t=-t);for(var i=0,a=je(this.doc,e);t>i&&(a=dt(this.doc,a,o,n,r),!a.hitSide);++i);return a},moveH:ie(null,function(e,t){var n,r=this.doc.sel;n=r.shift||r.extend||Ye(r.from,r.to)?dt(this.doc,r.head,e,t,this.options.rtlMoveVisually):0>e?r.from:r.to,Je(this.doc,n,n,e)}),deleteH:ie(null,function(e,t){var n=this.doc.sel;Ye(n.from,n.to)?Re(this.doc,"",n.from,dt(this.doc,n.head,e,t,!1),"+delete"):Re(this.doc,"",n.from,n.to,"+delete"),this.curOp.userSelChange=!0}),findPosV:function(e,t,n,r){var o=1,i=r;0>t&&(o=-1,t=-t);for(var a=0,s=je(this.doc,e);t>a;++a){var u=X(this,s,"div");if(null==i?i=u.left:u.left=i,s=gt(this,u,o,n),s.hitSide)break}return s},moveV:ie(null,function(e,t){var n=this.doc.sel,r=X(this,n.head,"div");null!=n.goalColumn&&(r.left=n.goalColumn);var o=gt(this,r,e,t);"page"==t&&ut(this,0,q(this,o,"div").top-r.top),Je(this.doc,o,o,e),n.goalColumn=r.left}),toggleOverwrite:function(e){(null==e||e!=this.state.overwrite)&&((this.state.overwrite=!this.state.overwrite)?this.display.cursor.className+=" CodeMirror-overwrite":this.display.cursor.className=this.display.cursor.className.replace(" CodeMirror-overwrite",""))},hasFocus:function(){return this.state.focused},scrollTo:ie(null,function(e,t){st(this,e,t)}),getScrollInfo:function(){var e=this.display.scroller,t=ko;return{left:e.scrollLeft,top:e.scrollTop,height:e.scrollHeight-t,width:e.scrollWidth-t,clientHeight:e.clientHeight-t,clientWidth:e.clientWidth-t}},scrollIntoView:ie(null,function(e,t){"number"==typeof e&&(e=He(e,0)),t||(t=0);var n=e;e&&null==e.line||(this.curOp.scrollToPos=e?je(this.doc,e):this.doc.sel.head,this.curOp.scrollToPosMargin=t,n=X(this,this.curOp.scrollToPos));var r=at(this,n.left,n.top-t,n.right,n.bottom+t);st(this,r.scrollLeft,r.scrollTop)}),setSize:ie(null,function(e,t){function n(e){return"number"==typeof e||/^\d+$/.test(String(e))?e+"px":e}null!=e&&(this.display.wrapper.style.width=n(e)),null!=t&&(this.display.wrapper.style.height=n(t)),this.options.lineWrapping&&(this.display.measureLineCache.length=this.display.measureLineCachePos=0),this.curOp.forceUpdate=!0}),operation:function(e){return se(this,e)},refresh:ie(null,function(){Y(this),st(this,this.doc.scrollLeft,this.doc.scrollTop),ue(this)}),swapDoc:ie(null,function(e){var t=this.doc;return t.cm=null,cn(this,e),Y(this),ge(this,!0),st(this,e.scrollLeft,e.scrollTop),t}),getInputField:function(){return this.display.input},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},Hn(e);var no=e.optionHandlers={},ro=e.defaults={},oo=e.Init={toString:function(){return"CodeMirror.Init"}};pt("value","",function(e,t){e.setValue(t)},!0),pt("mode",null,function(e,t){e.doc.modeOption=t,n(e)},!0),pt("indentUnit",2,n,!0),pt("indentWithTabs",!1),pt("smartIndent",!0),pt("tabSize",4,function(e){n(e),Y(e),ue(e)},!0),pt("electricChars",!0),pt("rtlMoveVisually",!Pr),pt("theme","default",function(e){s(e),u(e)},!0),pt("keyMap","default",a),pt("extraKeys",null),pt("onKeyEvent",null),pt("onDragEvent",null),pt("lineWrapping",!1,r,!0),pt("gutters",[],function(e){g(e.options),u(e)},!0),pt("fixedGutter",!0,function(e,t){e.display.gutters.style.left=t?b(e.display)+"px":"0",e.refresh()},!0),pt("coverGutterNextToScrollbar",!1,f,!0),pt("lineNumbers",!1,function(e){g(e.options),u(e)},!0),pt("firstLineNumber",1,u,!0),pt("lineNumberFormatter",function(e){return e},u,!0),pt("showCursorWhenSelecting",!1,x,!0),pt("readOnly",!1,function(e,t){"nocursor"==t?(Ee(e),e.display.input.blur()):t||ge(e,!0)}),pt("dragDrop",!0),pt("cursorBlinkRate",530),pt("cursorScrollMargin",0),pt("cursorHeight",1),pt("workTime",100),pt("workDelay",100),pt("flattenSpans",!0),pt("pollInterval",100),pt("undoDepth",40,function(e,t){e.doc.history.undoDepth=t}),pt("historyEventDelay",500),pt("viewportMargin",10,function(e){e.refresh()},!0),pt("maxHighlightLength",1e4,function(e){n(e),e.refresh()},!0),pt("moveInputWithCursor",!0,function(e,t){t||(e.display.inputDiv.style.top=e.display.inputDiv.style.left=0)}),pt("tabindex",null,function(e,t){e.display.input.tabIndex=t||""}),pt("autofocus",null);var io=e.modes={},ao=e.mimeModes={};e.defineMode=function(t,n){if(e.defaults.mode||"null"==t||(e.defaults.mode=t),arguments.length>2){n.dependencies=[];for(var r=2;r<arguments.length;++r)n.dependencies.push(arguments[r])}io[t]=n},e.defineMIME=function(e,t){ao[e]=t},e.resolveMode=function(t){if("string"==typeof t&&ao.hasOwnProperty(t))t=ao[t];else if(t&&"string"==typeof t.name&&ao.hasOwnProperty(t.name)){var n=ao[t.name];t=Xn(n,t),t.name=n.name}else if("string"==typeof t&&/^[\w\-]+\/[\w\-]+\+xml$/.test(t))return e.resolveMode("application/xml");return"string"==typeof t?{name:t}:t||{name:"null"}},e.getMode=function(t,n){var n=e.resolveMode(n),r=io[n.name];if(!r)return e.getMode(t,"text/plain");var o=r(t,n);if(so.hasOwnProperty(n.name)){var i=so[n.name];for(var a in i)i.hasOwnProperty(a)&&(o.hasOwnProperty(a)&&(o["_"+a]=o[a]),o[a]=i[a])}return o.name=n.name,o},e.defineMode("null",function(){return{token:function(e){e.skipToEnd()}}}),e.defineMIME("text/plain","null");var so=e.modeExtensions={};e.extendMode=function(e,t){var n=so.hasOwnProperty(e)?so[e]:so[e]={};Jn(t,n)},e.defineExtension=function(t,n){e.prototype[t]=n},e.defineDocExtension=function(e,t){bo.prototype[e]=t},e.defineOption=pt;var uo=[];e.defineInitHook=function(e){uo.push(e)};var lo=e.helpers={};e.registerHelper=function(t,n,r){lo.hasOwnProperty(t)||(lo[t]=e[t]={}),lo[t][n]=r},e.isWordChar=tr,e.copyState=mt,e.startState=vt,e.innerMode=function(e,t){for(;e.innerMode;){var n=e.innerMode(t);if(!n||n.mode==e)break;t=n.state,e=n.mode}return n||{mode:e,state:t}};var co=e.commands={selectAll:function(e){e.setSelection(He(e.firstLine(),0),He(e.lastLine()))},killLine:function(e){var t=e.getCursor(!0),n=e.getCursor(!1),r=!Ye(t,n);r||e.getLine(t.line).length!=t.ch?e.replaceRange("",t,r?n:He(t.line),"+delete"):e.replaceRange("",t,He(t.line+1,0),"+delete")},deleteLine:function(e){var t=e.getCursor().line;e.replaceRange("",He(t,0),He(t),"+delete")},delLineLeft:function(e){var t=e.getCursor();e.replaceRange("",He(t.line,0),t,"+delete")},undo:function(e){e.undo()},redo:function(e){e.redo()},goDocStart:function(e){e.extendSelection(He(e.firstLine(),0))},goDocEnd:function(e){e.extendSelection(He(e.lastLine()))},goLineStart:function(e){e.extendSelection(mr(e,e.getCursor().line))},goLineStartSmart:function(e){var t=e.getCursor(),n=mr(e,t.line),r=e.getLineHandle(n.line),o=bn(r);if(o&&0!=o[0].level)e.extendSelection(n);else{var i=Math.max(0,r.text.search(/\S/)),a=t.line==n.line&&t.ch<=i&&t.ch;e.extendSelection(He(n.line,a?0:i))}},goLineEnd:function(e){e.extendSelection(vr(e,e.getCursor().line))},goLineRight:function(e){var t=e.charCoords(e.getCursor(),"div").top+5;e.extendSelection(e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:t},"div"))},goLineLeft:function(e){var t=e.charCoords(e.getCursor(),"div").top+5;e.extendSelection(e.coordsChar({left:0,top:t},"div"))},goLineUp:function(e){e.moveV(-1,"line")},goLineDown:function(e){e.moveV(1,"line")},goPageUp:function(e){e.moveV(-1,"page")},goPageDown:function(e){e.moveV(1,"page")},goCharLeft:function(e){e.moveH(-1,"char")},goCharRight:function(e){e.moveH(1,"char")},goColumnLeft:function(e){e.moveH(-1,"column")},goColumnRight:function(e){e.moveH(1,"column")},goWordLeft:function(e){e.moveH(-1,"word")},goGroupRight:function(e){e.moveH(1,"group")},goGroupLeft:function(e){e.moveH(-1,"group")},goWordRight:function(e){e.moveH(1,"word")},delCharBefore:function(e){e.deleteH(-1,"char")},delCharAfter:function(e){e.deleteH(1,"char")},delWordBefore:function(e){e.deleteH(-1,"word")},delWordAfter:function(e){e.deleteH(1,"word")},delGroupBefore:function(e){e.deleteH(-1,"group")},delGroupAfter:function(e){e.deleteH(1,"group")},indentAuto:function(e){e.indentSelection("smart")},indentMore:function(e){e.indentSelection("add")},indentLess:function(e){e.indentSelection("subtract")},insertTab:function(e){e.replaceSelection("	","end","+input")},defaultTab:function(e){e.somethingSelected()?e.indentSelection("add"):e.replaceSelection("	","end","+input")},transposeChars:function(e){var t=e.getCursor(),n=e.getLine(t.line);t.ch>0&&t.ch<n.length-1&&e.replaceRange(n.charAt(t.ch)+n.charAt(t.ch-1),He(t.line,t.ch-1),He(t.line,t.ch+1))},newlineAndIndent:function(e){ie(e,function(){e.replaceSelection("\n","end","+input"),e.indentLine(e.getCursor().line,null,!0)})()},toggleOverwrite:function(e){e.toggleOverwrite()}},go=e.keyMap={};go.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite"},go.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Alt-Up":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Down":"goDocEnd","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore",fallthrough:"basic"},go.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineStart","Cmd-Right":"goLineEnd","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delLineLeft",fallthrough:["basic","emacsy"]},go["default"]=Fr?go.macDefault:go.pcDefault,go.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars"},e.lookupKey=yt,e.isModifierKey=_t,e.keyName=wt,e.fromTextArea=function(t,n){function r(){t.value=l.getValue()}if(n||(n={}),n.value=t.value,!n.tabindex&&t.tabindex&&(n.tabindex=t.tabindex),!n.placeholder&&t.placeholder&&(n.placeholder=t.placeholder),null==n.autofocus){var o=document.body;try{o=document.activeElement}catch(i){}n.autofocus=o==t||null!=t.getAttribute("autofocus")&&o==document.body}if(t.form&&(On(t.form,"submit",r),!n.leaveSubmitMethodAlone)){var a=t.form,s=a.submit;try{var u=a.submit=function(){r(),a.submit=s,a.submit(),a.submit=u}}catch(i){}}t.style.display="none";var l=e(function(e){t.parentNode.insertBefore(e,t.nextSibling)},n);return l.save=r,l.getTextArea=function(){return t},l.toTextArea=function(){r(),t.parentNode.removeChild(l.getWrapperElement()),t.style.display="",t.form&&(Fn(t.form,"submit",r),"function"==typeof t.form.submit&&(t.form.submit=s))},l},Ct.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return 0==this.pos},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){return this.pos<this.string.length?this.string.charAt(this.pos++):void 0},eat:function(e){var t=this.string.charAt(this.pos);if("string"==typeof e)var n=t==e;else var n=t&&(e.test?e.test(t):e(t));return n?(++this.pos,t):void 0},eatWhile:function(e){for(var t=this.pos;this.eat(e););return this.pos>t},eatSpace:function(){for(var e=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e},skipToEnd:function(){this.pos=this.string.length},skipTo:function(e){var t=this.string.indexOf(e,this.pos);return t>-1?(this.pos=t,!0):void 0},backUp:function(e){this.pos-=e},column:function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=Kn(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue},indentation:function(){return Kn(this.string,null,this.tabSize)},match:function(e,t,n){if("string"!=typeof e){var r=this.string.slice(this.pos).match(e);return r&&r.index>0?null:(r&&t!==!1&&(this.pos+=r[0].length),r)}var o=function(e){return n?e.toLowerCase():e},i=this.string.substr(this.pos,e.length);return o(i)==o(e)?(t!==!1&&(this.pos+=e.length),!0):void 0},current:function(){return this.string.slice(this.start,this.pos)}},e.StringStream=Ct,e.TextMarker=kt,Hn(kt),kt.prototype.clear=function(){if(!this.explicitlyCleared){var e=this.doc.cm,t=e&&!e.curOp;if(t&&re(e),Rn(this,"clear")){var n=this.find();n&&Un(this,"clear",n.from,n.to)}for(var r=null,o=null,i=0;i<this.lines.length;++i){var a=this.lines[i],s=Tt(a.markedSpans,this);null!=s.to&&(o=pn(a)),a.markedSpans=xt(a.markedSpans,s),null!=s.from?r=pn(a):this.collapsed&&!Pt(this.doc,a)&&e&&hn(a,te(e.display))}if(e&&this.collapsed&&!e.options.lineWrapping)for(var i=0;i<this.lines.length;++i){var u=Ft(e.doc,this.lines[i]),l=c(e.doc,u);l>e.display.maxLineLength&&(e.display.maxLine=u,e.display.maxLineLength=l,e.display.maxLineChanged=!0)}null!=r&&e&&ue(e,r,o+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,e&&tt(e)),t&&oe(e)}},kt.prototype.find=function(){for(var e,t,n=0;n<this.lines.length;++n){var r=this.lines[n],o=Tt(r.markedSpans,this);if(null!=o.from||null!=o.to){var i=pn(r);null!=o.from&&(e=He(i,o.from)),null!=o.to&&(t=He(i,o.to))}}return"bookmark"==this.type?e:e&&{from:e,to:t}},kt.prototype.changed=function(){var e=this.find(),t=this.doc.cm;if(e&&t){var n=dn(this.doc,e.from.line);if($(t,n),e.from.line>=t.display.showingFrom&&e.from.line<t.display.showingTo){for(var r=t.display.lineDiv.firstChild;r;r=r.nextSibling)if(r.lineObj==n){r.offsetHeight!=n.height&&hn(n,r.offsetHeight);break}se(t,function(){t.curOp.selectionChanged=t.curOp.forceUpdate=t.curOp.updateMaxLine=!0})}}},kt.prototype.attachLine=function(e){if(!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;t.maybeHiddenMarkers&&-1!=qn(t.maybeHiddenMarkers,this)||(t.maybeUnhiddenMarkers||(t.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(e)},kt.prototype.detachLine=function(e){if(this.lines.splice(qn(this.lines,e),1),!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;(t.maybeHiddenMarkers||(t.maybeHiddenMarkers=[])).push(this)}},e.SharedTextMarker=Lt,Hn(Lt),Lt.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var e=0;e<this.markers.length;++e)this.markers[e].clear();Un(this,"clear")}},Lt.prototype.find=function(){return this.primary.find()};var fo=e.LineWidget=function(e,t,n){if(n)for(var r in n)n.hasOwnProperty(r)&&(this[r]=n[r]);this.cm=e,this.node=t};Hn(fo),fo.prototype.clear=Rt(function(){var e=this.line.widgets,t=pn(this.line);if(null!=t&&e){for(var n=0;n<e.length;++n)e[n]==this&&e.splice(n--,1);e.length||(this.line.widgets=null);var r=vn(this.cm,this.line)<this.cm.doc.scrollTop;hn(this.line,Math.max(0,this.line.height-Ht(this))),r&&ut(this.cm,0,-this.height),ue(this.cm,t,t+1)}}),fo.prototype.changed=Rt(function(){var e=this.height;this.height=null;var t=Ht(this)-e;if(t){hn(this.line,this.line.height+t);var n=pn(this.line);ue(this.cm,n,n+1)}});var ho=e.Line=function(e,t,n){this.text=e,Wt(this,t),this.height=n?n(this):1};Hn(ho);var po={},mo=/[\t\u0000-\u0019\u00ad\u200b\u2028\u2029\uFEFF]/g;sn.prototype={chunkSize:function(){return this.lines.length},removeInner:function(e,t){for(var n=e,r=e+t;r>n;++n){var o=this.lines[n];this.height-=o.height,Vt(o),Un(o,"delete")}this.lines.splice(e,t)},collapse:function(e){e.splice.apply(e,[e.length,0].concat(this.lines))},insertInner:function(e,t,n){this.height+=n,this.lines=this.lines.slice(0,e).concat(t).concat(this.lines.slice(e));for(var r=0,o=t.length;o>r;++r)t[r].parent=this},iterN:function(e,t,n){for(var r=e+t;r>e;++e)if(n(this.lines[e]))return!0}},un.prototype={chunkSize:function(){return this.size},removeInner:function(e,t){this.size-=t;for(var n=0;n<this.children.length;++n){var r=this.children[n],o=r.chunkSize();if(o>e){var i=Math.min(t,o-e),a=r.height;if(r.removeInner(e,i),this.height-=a-r.height,o==i&&(this.children.splice(n--,1),r.parent=null),0==(t-=i))break;e=0}else e-=o}if(this.size-t<25){var s=[];this.collapse(s),this.children=[new sn(s)],this.children[0].parent=this}},collapse:function(e){for(var t=0,n=this.children.length;n>t;++t)this.children[t].collapse(e)},insertInner:function(e,t,n){this.size+=t.length,this.height+=n;for(var r=0,o=this.children.length;o>r;++r){var i=this.children[r],a=i.chunkSize();if(a>=e){if(i.insertInner(e,t,n),i.lines&&i.lines.length>50){for(;i.lines.length>50;){var s=i.lines.splice(i.lines.length-25,25),u=new sn(s);i.height-=u.height,this.children.splice(r+1,0,u),u.parent=this}this.maybeSpill()}break}e-=a}},maybeSpill:function(){if(!(this.children.length<=10)){var e=this;do{var t=e.children.splice(e.children.length-5,5),n=new un(t);if(e.parent){e.size-=n.size,e.height-=n.height;var r=qn(e.parent.children,e);e.parent.children.splice(r+1,0,n)}else{var o=new un(e.children);o.parent=e,e.children=[o,n],e=o}n.parent=e.parent}while(e.children.length>10);e.parent.maybeSpill()}},iterN:function(e,t,n){for(var r=0,o=this.children.length;o>r;++r){var i=this.children[r],a=i.chunkSize();if(a>e){var s=Math.min(t,a-e);if(i.iterN(e,s,n))return!0;if(0==(t-=s))break;e=0}else e-=a}}};var vo=0,bo=e.Doc=function(e,t,n){if(!(this instanceof bo))return new bo(e,t,n);null==n&&(n=0),un.call(this,[new sn([new ho("",null)])]),this.first=n,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.history=yn(),this.cleanGeneration=1,this.frontier=n;var r=He(n,0);this.sel={from:r,to:r,head:r,anchor:r,shift:!1,extend:!1,goalColumn:null},this.id=++vo,this.modeOption=t,"string"==typeof e&&(e=Do(e)),an(this,{from:r,to:r,text:e},null,{head:r,anchor:r})};bo.prototype=Xn(un.prototype,{constructor:bo,iter:function(e,t,n){n?this.iterN(e-this.first,t-e,n):this.iterN(this.first,this.first+this.size,e)},insert:function(e,t){for(var n=0,r=0,o=t.length;o>r;++r)n+=t[r].height;this.insertInner(e-this.first,t,n)},remove:function(e,t){this.removeInner(e-this.first,t)},getValue:function(e){var t=fn(this,this.first,this.first+this.size);return e===!1?t:t.join(e||"\n")},setValue:function(e){var t=He(this.first,0),n=this.first+this.size-1;Oe(this,{from:t,to:He(n,dn(this,n).text.length),text:Do(e),origin:"setValue"},{head:t,anchor:t},!0)},replaceRange:function(e,t,n,r){t=je(this,t),n=n?je(this,n):t,Re(this,e,t,n,r)},getRange:function(e,t,n){var r=gn(this,je(this,e),je(this,t));return n===!1?r:r.join(n||"\n")},getLine:function(e){var t=this.getLineHandle(e);return t&&t.text},setLine:function(e,t){Xe(this,e)&&Re(this,t,He(e,0),je(this,He(e)))},removeLine:function(e){e?Re(this,"",je(this,He(e-1)),je(this,He(e))):Re(this,"",He(0,0),je(this,He(1,0)))},getLineHandle:function(e){return Xe(this,e)?dn(this,e):void 0},getLineNumber:function(e){return pn(e)},getLineHandleVisualStart:function(e){return"number"==typeof e&&(e=dn(this,e)),Ft(this,e)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(e){return je(this,e)},getCursor:function(e){var t,n=this.sel;return t=null==e||"head"==e?n.head:"anchor"==e?n.anchor:"end"==e||e===!1?n.to:n.from,Ve(t)},somethingSelected:function(){return!Ye(this.sel.head,this.sel.anchor)},setCursor:ae(function(e,t,n){var r=je(this,"number"==typeof e?He(e,t||0):e);n?Je(this,r):et(this,r,r)}),setSelection:ae(function(e,t){et(this,je(this,e),je(this,t||e))}),extendSelection:ae(function(e,t){Je(this,je(this,e),t&&je(this,t))}),getSelection:function(e){return this.getRange(this.sel.from,this.sel.to,e)},replaceSelection:function(e,t,n){Oe(this,{from:this.sel.from,to:this.sel.to,text:Do(e),origin:n},t||"around")},undo:ae(function(){Pe(this,"undo")}),redo:ae(function(){Pe(this,"redo")}),setExtending:function(e){this.sel.extend=e},historySize:function(){var e=this.history;return{undo:e.done.length,redo:e.undone.length}},clearHistory:function(){this.history=yn(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration()},changeGeneration:function(){return this.history.lastOp=this.history.lastOrigin=null,this.history.generation},isClean:function(e){return this.history.generation==(e||this.cleanGeneration)},getHistory:function(){return{done:Ln(this.history.done),undone:Ln(this.history.undone)}},setHistory:function(e){var t=this.history=yn(this.history.maxGeneration);t.done=e.done.slice(0),t.undone=e.undone.slice(0)},markText:function(e,t,n){return Mt(this,je(this,e),je(this,t),n,"range")},setBookmark:function(e,t){var n={replacedWith:t&&(null==t.nodeType?t.widget:t),insertLeft:t&&t.insertLeft};return e=je(this,e),Mt(this,e,e,n,"bookmark")},findMarksAt:function(e){e=je(this,e);var t=[],n=dn(this,e.line).markedSpans;if(n)for(var r=0;r<n.length;++r){var o=n[r];(null==o.from||o.from<=e.ch)&&(null==o.to||o.to>=e.ch)&&t.push(o.marker.parent||o.marker)}return t},getAllMarks:function(){var e=[];return this.iter(function(t){var n=t.markedSpans;if(n)for(var r=0;r<n.length;++r)null!=n[r].from&&e.push(n[r].marker)}),e},posFromIndex:function(e){var t,n=this.first;return this.iter(function(r){var o=r.text.length+1;return o>e?(t=e,!0):(e-=o,void++n)}),je(this,He(n,t))},indexFromPos:function(e){e=je(this,e);var t=e.ch;return e.line<this.first||e.ch<0?0:(this.iter(this.first,e.line,function(e){t+=e.text.length+1}),t)},copy:function(e){var t=new bo(fn(this,this.first,this.first+this.size),this.modeOption,this.first);return t.scrollTop=this.scrollTop,t.scrollLeft=this.scrollLeft,t.sel={from:this.sel.from,to:this.sel.to,head:this.sel.head,anchor:this.sel.anchor,shift:this.sel.shift,extend:!1,goalColumn:this.sel.goalColumn
},e&&(t.history.undoDepth=this.history.undoDepth,t.setHistory(this.getHistory())),t},linkedDoc:function(e){e||(e={});var t=this.first,n=this.first+this.size;null!=e.from&&e.from>t&&(t=e.from),null!=e.to&&e.to<n&&(n=e.to);var r=new bo(fn(this,t,n),e.mode||this.modeOption,t);return e.sharedHist&&(r.history=this.history),(this.linked||(this.linked=[])).push({doc:r,sharedHist:e.sharedHist}),r.linked=[{doc:this,isParent:!0,sharedHist:e.sharedHist}],r},unlinkDoc:function(t){if(t instanceof e&&(t=t.doc),this.linked)for(var n=0;n<this.linked.length;++n){var r=this.linked[n];if(r.doc==t){this.linked.splice(n,1),t.unlinkDoc(this);break}}if(t.history==this.history){var o=[t.id];ln(t,function(e){o.push(e.id)},!0),t.history=yn(),t.history.done=Ln(this.history.done,o),t.history.undone=Ln(this.history.undone,o)}},iterLinkedDocs:function(e){ln(this,e)},getMode:function(){return this.mode},getEditor:function(){return this.cm}}),bo.prototype.eachLine=bo.prototype.iter;var yo="iter insert remove copy getEditor".split(" ");for(var _o in bo.prototype)bo.prototype.hasOwnProperty(_o)&&qn(yo,_o)<0&&(e.prototype[_o]=function(e){return function(){return e.apply(this.doc,arguments)}}(bo.prototype[_o]));Hn(bo),e.e_stop=An,e.e_preventDefault=Dn,e.e_stopPropagation=En;var wo,Co=0;e.on=On,e.off=Fn,e.signal=Pn;var ko=30,Mo=e.Pass={toString:function(){return"CodeMirror.Pass"}};Yn.prototype={set:function(e,t){clearTimeout(this.id),this.id=setTimeout(t,e)}},e.countColumn=Kn;var Lo=[""],So=/[\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,To=/[\u0300-\u036F\u0483-\u0487\u0488-\u0489\u0591-\u05BD\u05BF\u05C1-\u05C2\u05C4-\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7-\u06E8\u06EA-\u06ED\uA66F\uA670-\uA672\uA674-\uA67D\uA69F\udc00-\udfff]/;e.replaceGetRect=function(e){sr=e};var xo=function(){if(Sr)return!1;var e=rr("div");return"draggable"in e||"dragDrop"in e}();kr?ur=function(e,t){return 36==e.charCodeAt(t-1)&&39==e.charCodeAt(t)}:Dr&&!/Version\/([6-9]|\d\d)\b/.test(navigator.userAgent)?ur=function(e,t){return/\-[^ \-?]|\?[^ !\'\"\),.\-\/:;\?\]\}]/.test(e.slice(t-1,t+1))}:Tr&&!/Chrome\/(?:29|[3-9]\d|\d\d\d)\./.test(navigator.userAgent)&&(ur=function(e,t){if(t>1&&45==e.charCodeAt(t-1)){if(/\w/.test(e.charAt(t-2))&&/[^\-?\.]/.test(e.charAt(t)))return!0;if(t>2&&/[\d\.,]/.test(e.charAt(t-2))&&/[\d\.,]/.test(e.charAt(t)))return!1}return/[~!#%&*)=+}\]|\"\.>,:;][({[<]|-[^\-?\.\u2010-\u201f\u2026]|\?[\w~`@#$%\^&*(_=+{[|><]|…[\w~`@#$%\^&*(_=+{[><]/.test(e.slice(t-1,t+1))});var zo,Io,Do=3!="\n\nb".split(/\n/).length?function(e){for(var t=0,n=[],r=e.length;r>=t;){var o=e.indexOf("\n",t);-1==o&&(o=e.length);var i=e.slice(t,"\r"==e.charAt(o-1)?o-1:o),a=i.indexOf("\r");-1!=a?(n.push(i.slice(0,a)),t+=a+1):(n.push(i),t=o+1)}return n}:function(e){return e.split(/\r\n?|\n/)};e.splitLines=Do;var Eo=window.getSelection?function(e){try{return e.selectionStart!=e.selectionEnd}catch(t){return!1}}:function(e){try{var t=e.ownerDocument.selection.createRange()}catch(n){}return t&&t.parentElement()==e?0!=t.compareEndPoints("StartToEnd",t):!1},Go=function(){var e=rr("div");return"oncopy"in e?!0:(e.setAttribute("oncopy","return;"),"function"==typeof e.oncopy)}(),Ao={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",91:"Mod",92:"Mod",93:"Mod",109:"-",107:"=",127:"Delete",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63276:"PageUp",63277:"PageDown",63275:"End",63273:"Home",63234:"Left",63232:"Up",63235:"Right",63233:"Down",63302:"Insert",63272:"Delete"};e.keyNames=Ao,function(){for(var e=0;10>e;e++)Ao[e+48]=String(e);for(var e=65;90>=e;e++)Ao[e]=String.fromCharCode(e);for(var e=1;12>=e;e++)Ao[e+111]=Ao[e+63235]="F"+e}();var No,Bo=function(){function e(e){return 255>=e?t.charAt(e):e>=1424&&1524>=e?"R":e>=1536&&1791>=e?n.charAt(e-1536):e>=1792&&2220>=e?"r":"L"}var t="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLL",n="rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmmrrrrrrrrrrrrrrrrrr",r=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,o=/[stwN]/,i=/[LRr]/,a=/[Lb1n]/,s=/[1n]/,u="L";return function(t){if(!r.test(t))return!1;for(var n,l=t.length,c=[],d=0;l>d;++d)c.push(n=e(t.charCodeAt(d)));for(var d=0,g=u;l>d;++d){var n=c[d];"m"==n?c[d]=g:g=n}for(var d=0,f=u;l>d;++d){var n=c[d];"1"==n&&"r"==f?c[d]="n":i.test(n)&&(f=n,"r"==n&&(c[d]="R"))}for(var d=1,g=c[0];l-1>d;++d){var n=c[d];"+"==n&&"1"==g&&"1"==c[d+1]?c[d]="1":","!=n||g!=c[d+1]||"1"!=g&&"n"!=g||(c[d]=g),g=n}for(var d=0;l>d;++d){var n=c[d];if(","==n)c[d]="N";else if("%"==n){for(var h=d+1;l>h&&"%"==c[h];++h);for(var p=d&&"!"==c[d-1]||l-1>h&&"1"==c[h]?"1":"N",m=d;h>m;++m)c[m]=p;d=h-1}}for(var d=0,f=u;l>d;++d){var n=c[d];"L"==f&&"1"==n?c[d]="L":i.test(n)&&(f=n)}for(var d=0;l>d;++d)if(o.test(c[d])){for(var h=d+1;l>h&&o.test(c[h]);++h);for(var v="L"==(d?c[d-1]:u),b="L"==(l-1>h?c[h]:u),p=v||b?"L":"R",m=d;h>m;++m)c[m]=p;d=h-1}for(var y,_=[],d=0;l>d;)if(a.test(c[d])){var w=d;for(++d;l>d&&a.test(c[d]);++d);_.push({from:w,to:d,level:0})}else{var C=d,k=_.length;for(++d;l>d&&"L"!=c[d];++d);for(var m=C;d>m;)if(s.test(c[m])){m>C&&_.splice(k,0,{from:C,to:m,level:1});var M=m;for(++m;d>m&&s.test(c[m]);++m);_.splice(k,0,{from:M,to:m,level:2}),C=m}else++m;d>C&&_.splice(k,0,{from:C,to:d,level:1})}return 1==_[0].level&&(y=t.match(/^\s+/))&&(_[0].from=y[0].length,_.unshift({from:0,to:y[0].length,level:0})),1==Zn(_).level&&(y=t.match(/\s+$/))&&(Zn(_).to-=y[0].length,_.push({from:l-y[0].length,to:l,level:0})),_[0].level!=Zn(_).level&&_.push({from:l,to:l,level:_[0].level}),_}}();return e.version="3.15.0",e}();!function(){"use strict";var e=/^(\s*)([*+-]|(\d+)\.)(\s*)/,t="*+-";C.commands.newlineAndIndentContinueMarkdownList=function(n){var r,o=n.getCursor(),i=n.getStateAfter(o.line).list;if(!i||!(r=n.getLine(o.line).match(e)))return void n.execCommand("newlineAndIndent");var a=r[1],s=r[4],u=t.indexOf(r[2])>=0?r[2]:parseInt(r[3],10)+1+".";n.replaceSelection("\n"+a+u+s,"end")}}(),C.defineMode("xml",function(e,t){function n(e,t){function n(n){return t.tokenize=n,n(e,t)}var o=e.next();if("<"==o){if(e.eat("!"))return e.eat("[")?e.match("CDATA[")?n(i("atom","]]>")):null:e.match("--")?n(i("comment","-->")):e.match("DOCTYPE",!0,!0)?(e.eatWhile(/[\w\._\-]/),n(a(1))):null;if(e.eat("?"))return e.eatWhile(/[\w\._\-]/),t.tokenize=i("meta","?>"),"meta";var s=e.eat("/");y="";for(var u;u=e.eat(/[^\s\u00a0=<>\"\'\/?]/);)y+=u;return y?(_=s?"closeTag":"openTag",t.tokenize=r,"tag"):"error"}if("&"==o){var l;return l=e.eat("#")?e.eat("x")?e.eatWhile(/[a-fA-F\d]/)&&e.eat(";"):e.eatWhile(/[\d]/)&&e.eat(";"):e.eatWhile(/[\w\.\-:]/)&&e.eat(";"),l?"atom":"error"}return e.eatWhile(/[^&<]/),null}function r(e,t){var r=e.next();return">"==r||"/"==r&&e.eat(">")?(t.tokenize=n,_=">"==r?"endTag":"selfcloseTag","tag"):"="==r?(_="equals",null):"<"==r?"error":/[\'\"]/.test(r)?(t.tokenize=o(r),t.stringStartCol=e.column(),t.tokenize(e,t)):(e.eatWhile(/[^\s\u00a0=<>\"\']/),"word")}function o(e){var t=function(t,n){for(;!t.eol();)if(t.next()==e){n.tokenize=r;break}return"string"};return t.isInAttribute=!0,t}function i(e,t){return function(r,o){for(;!r.eol();){if(r.match(t)){o.tokenize=n;break}r.next()}return e}}function a(e){return function(t,r){for(var o;null!=(o=t.next());){if("<"==o)return r.tokenize=a(e+1),r.tokenize(t,r);if(">"==o){if(1==e){r.tokenize=n;break}return r.tokenize=a(e-1),r.tokenize(t,r)}}return"meta"}}function s(){for(var e=arguments.length-1;e>=0;e--)w.cc.push(arguments[e])}function u(){return s.apply(null,arguments),!0}function l(e,t){var n=T.doNotIndent.hasOwnProperty(e)||w.context&&w.context.noIndent;w.context={prev:w.context,tagName:e,indent:w.indented,startOfLine:t,noIndent:n}}function c(){w.context&&(w.context=w.context.prev)}function d(e){if("openTag"==e)return w.tagName=y,w.tagStart=C.column(),u(p,g(w.startOfLine));if("closeTag"==e){var t=!1;return w.context?w.context.tagName!=y&&(T.implicitlyClosed.hasOwnProperty(w.context.tagName.toLowerCase())&&c(),t=!w.context||w.context.tagName!=y):t=!0,t&&(k="error"),u(f(t))}return u()}function g(e){return function(t){var n=w.tagName;return w.tagName=w.tagStart=null,"selfcloseTag"==t||"endTag"==t&&T.autoSelfClosers.hasOwnProperty(n.toLowerCase())?(h(n.toLowerCase()),u()):"endTag"==t?(h(n.toLowerCase()),l(n,e),u()):u()}}function f(e){return function(t){return e&&(k="error"),"endTag"==t?(c(),u()):(k="error",u(arguments.callee))}}function h(e){for(var t;;){if(!w.context)return;if(t=w.context.tagName.toLowerCase(),!T.contextGrabbers.hasOwnProperty(t)||!T.contextGrabbers[t].hasOwnProperty(e))return;c()}}function p(e){return"word"==e?(k="attribute",u(m,p)):"endTag"==e||"selfcloseTag"==e?s():(k="error",u(p))}function m(e){return"equals"==e?u(v,p):(T.allowMissing?"word"==e&&(k="attribute"):k="error","endTag"==e||"selfcloseTag"==e?s():u())}function v(e){return"string"==e?u(b):"word"==e&&T.allowUnquoted?(k="string",u()):(k="error","endTag"==e||"selfCloseTag"==e?s():u())}function b(e){return"string"==e?u(b):s()}var y,_,w,C,k,M=e.indentUnit,L=t.multilineTagIndentFactor||1,S=t.multilineTagIndentPastTag||!0,T=t.htmlMode?{autoSelfClosers:{area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},implicitlyClosed:{dd:!0,li:!0,optgroup:!0,option:!0,p:!0,rp:!0,rt:!0,tbody:!0,td:!0,tfoot:!0,th:!0,tr:!0},contextGrabbers:{dd:{dd:!0,dt:!0},dt:{dd:!0,dt:!0},li:{li:!0},option:{option:!0,optgroup:!0},optgroup:{optgroup:!0},p:{address:!0,article:!0,aside:!0,blockquote:!0,dir:!0,div:!0,dl:!0,fieldset:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,menu:!0,nav:!0,ol:!0,p:!0,pre:!0,section:!0,table:!0,ul:!0},rp:{rp:!0,rt:!0},rt:{rp:!0,rt:!0},tbody:{tbody:!0,tfoot:!0},td:{td:!0,th:!0},tfoot:{tbody:!0},th:{td:!0,th:!0},thead:{tbody:!0,tfoot:!0},tr:{tr:!0}},doNotIndent:{pre:!0},allowUnquoted:!0,allowMissing:!0}:{autoSelfClosers:{},implicitlyClosed:{},contextGrabbers:{},doNotIndent:{},allowUnquoted:!1,allowMissing:!1},x=t.alignCDATA;return{startState:function(){return{tokenize:n,cc:[],indented:0,startOfLine:!0,tagName:null,tagStart:null,context:null}},token:function(e,t){if(!t.tagName&&e.sol()&&(t.startOfLine=!0,t.indented=e.indentation()),e.eatSpace())return null;k=_=y=null;var n=t.tokenize(e,t);if(t.type=_,(n||_)&&"comment"!=n)for(w=t,C=e;;){var r=t.cc.pop()||d;if(r(_||n))break}return t.startOfLine=!1,k||n},indent:function(e,t,o){var i=e.context;if(e.tokenize.isInAttribute)return e.stringStartCol+1;if(e.tokenize!=r&&e.tokenize!=n||i&&i.noIndent)return o?o.match(/^(\s*)/)[0].length:0;if(e.tagName)return S?e.tagStart+e.tagName.length+2:e.tagStart+M*L;if(x&&/<!\[CDATA\[/.test(t))return 0;for(i&&/^<\//.test(t)&&(i=i.prev);i&&!i.startOfLine;)i=i.prev;return i?i.indent+M:0},electricChars:"/",blockCommentStart:"<!--",blockCommentEnd:"-->",configuration:t.htmlMode?"html":"xml",helperType:t.htmlMode?"html":"xml"}}),C.defineMIME("text/xml","xml"),C.defineMIME("application/xml","xml"),C.mimeModes.hasOwnProperty("text/html")||C.defineMIME("text/html",{name:"xml",htmlMode:!0}),C.defineMode("markdown",function(e,t){function n(e,t,n){return t.f=t.inline=n,n(e,t)}function r(e,t,n){return t.f=t.block=n,n(e,t)}function o(e){return e.linkTitle=!1,e.em=!1,e.strong=!1,e.quote=0,m||e.f!=a||(e.f=c,e.block=i),e.trailingSpace=0,e.trailingSpaceNewLine=!1,e.thisLineHasContent=!1,null}function i(e,o){var i=o.list!==!1;if(o.list!==!1&&o.indentationDiff>=0?(o.indentationDiff<4&&(o.indentation-=o.indentationDiff),o.list=null):o.list!==!1&&o.indentation>0?(o.list=null,o.listDepth=Math.floor(o.indentation/4)):o.list!==!1&&(o.list=!1,o.listDepth=0),o.indentationDiff>=4)return o.indentation-=4,e.skipToEnd(),k;if(e.eatSpace())return null;if("#"===e.peek()||o.prevLineHasContent&&e.match($))o.header=!0;else if(e.eat(">"))for(o.indentation++,o.quote=1,e.eatSpace();e.eat(">");)e.eatSpace(),o.quote++;else{if("["===e.peek())return n(e,o,g);if(e.match(O,!0))return z;if(o.prevLineHasContent&&!i||!e.match(F,!0)&&!e.match(P,!0)){if(t.fencedCodeBlocks&&e.match(/^```([\w+#]*)/,!0))return o.localMode=y(RegExp.$1),o.localMode&&(o.localState=o.localMode.startState()),r(e,o,s),k}else o.indentation+=4,o.list=!0,o.listDepth++,t.taskLists&&e.match(U,!1)&&(o.taskList=!0)}return n(e,o,o.inline)}function a(e,t){var n=v.token(e,t.htmlState);return m&&"tag"===n&&"openTag"!==t.htmlState.type&&!t.htmlState.context&&(t.f=c,t.block=i),t.md_inside&&-1!=e.current().indexOf(">")&&(t.f=c,t.block=i,t.htmlState.context=void 0),n}function s(e,t){return e.sol()&&e.match(/^```/,!0)?(t.localMode=t.localState=null,t.f=c,t.block=i,k):t.localMode?t.localMode.token(e,t.localState):(e.skipToEnd(),k)}function u(e){var t=[];if(e.taskOpen)return"meta";if(e.taskClosed)return"property";if(e.strong&&t.push(B),e.em&&t.push(N),e.linkText&&t.push(G),e.code&&t.push(k),e.header&&t.push(w),e.quote&&t.push(e.quote%2?M:L),e.list!==!1){var n=(e.listDepth-1)%3;t.push(n?1===n?T:x:S)}return e.trailingSpaceNewLine?t.push("trailing-space-new-line"):e.trailingSpace&&t.push("trailing-space-"+(e.trailingSpace%2?"a":"b")),t.length?t.join(" "):null}function l(e,t){return e.match(W,!0)?u(t):void 0}function c(e,o){var i=o.text(e,o);if("undefined"!=typeof i)return i;if(o.list)return o.list=null,u(o);if(o.taskList){var s="x"!==e.match(U,!0)[1];return s?o.taskOpen=!0:o.taskClosed=!0,o.taskList=!1,u(o)}o.taskOpen=!1,o.taskClosed=!1;var l=e.next();if("\\"===l)return e.next(),u(o);if(o.linkTitle){o.linkTitle=!1;var c=l;"("===l&&(c=")"),c=(c+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");var g="^\\s*(?:[^"+c+"\\\\]+|\\\\\\\\|\\\\.)"+c;if(e.match(new RegExp(g),!0))return A}if("`"===l){var f=u(o),h=e.pos;e.eatWhile("`");var m=1+e.pos-h;return o.code?m===_?(o.code=!1,f):u(o):(_=m,o.code=!0,u(o))}if(o.code)return u(o);if("!"===l&&e.match(/\[[^\]]*\] ?(?:\(|\[)/,!1))return e.match(/\[[^\]]*\]/),o.inline=o.f=d,I;if("["===l&&e.match(/.*\](\(| ?\[)/,!1))return o.linkText=!0,u(o);if("]"===l&&o.linkText){var v=u(o);return o.linkText=!1,o.inline=o.f=d,v}if("<"===l&&e.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,!1))return n(e,o,p(D,">"));if("<"===l&&e.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,!1))return n(e,o,p(E,">"));if("<"===l&&e.match(/^\w/,!1)){if(-1!=e.string.indexOf(">")){var b=e.string.substring(1,e.string.indexOf(">"));/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(b)&&(o.md_inside=!0)}return e.backUp(1),r(e,o,a)}if("<"===l&&e.match(/^\/\w*?>/))return o.md_inside=!1,"tag";var y=!1;if(!t.underscoresBreakWords&&"_"===l&&"_"!==e.peek()&&e.match(/(\w)/,!1)){var w=e.pos-2;if(w>=0){var C=e.string.charAt(w);"_"!==C&&C.match(/(\w)/,!1)&&(y=!0)}}var f=u(o);if("*"===l||"_"===l&&!y){if(o.strong===l&&e.eat(l))return o.strong=!1,f;if(!o.strong&&e.eat(l))return o.strong=l,u(o);if(o.em===l)return o.em=!1,f;if(!o.em)return o.em=l,u(o)}else if(" "===l&&(e.eat("*")||e.eat("_"))){if(" "===e.peek())return u(o);e.backUp(1)}return" "===l&&(e.match(/ +$/,!1)?o.trailingSpace++:o.trailingSpace&&(o.trailingSpaceNewLine=!0)),u(o)}function d(e,t){if(e.eatSpace())return null;var r=e.next();return"("===r||"["===r?n(e,t,p(A,"("===r?")":"]")):"error"}function g(e,t){return e.match(/^[^\]]*\]:/,!0)?(t.f=f,G):n(e,t,c)}function f(e,t){return e.eatSpace()?null:(e.match(/^[^\s]+/,!0),void 0===e.peek()?t.linkTitle=!0:e.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,!0),t.f=t.inline=c,A)}function h(e){return R[e]||(e=(e+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),R[e]=new RegExp("^(?:[^\\\\]|\\\\.)*?("+e+")")),R[e]}function p(e,t,n){return n=n||c,function(r,o){return r.match(h(t)),o.inline=o.f=n,e}}var m=C.modes.hasOwnProperty("xml"),v=C.getMode(e,m?{name:"xml",htmlMode:!0}:"text/plain"),b={html:"htmlmixed",js:"javascript",json:"application/json",c:"text/x-csrc","c++":"text/x-c++src",java:"text/x-java",csharp:"text/x-csharp","c#":"text/x-csharp",scala:"text/x-scala"},y=function(){var t,n,r={},o={},i=[];for(var a in C.modes)C.modes.propertyIsEnumerable(a)&&i.push(a);for(t=0;t<i.length;t++)r[i[t]]=i[t];var s=[];for(var a in C.mimeModes)C.mimeModes.propertyIsEnumerable(a)&&s.push({mime:a,mode:C.mimeModes[a]});for(t=0;t<s.length;t++)n=s[t].mime,o[n]=s[t].mime;for(var u in b)(b[u]in r||b[u]in o)&&(r[u]=b[u]);return function(t){return r[t]?C.getMode(e,r[t]):null}}();void 0===t.underscoresBreakWords&&(t.underscoresBreakWords=!0),void 0===t.fencedCodeBlocks&&(t.fencedCodeBlocks=!1),void 0===t.taskLists&&(t.taskLists=!1);var _=0,w="header",k="comment",M="atom",L="number",S="variable-2",T="variable-3",x="keyword",z="hr",I="tag",D="link",E="link",G="link",A="string",N="em",B="strong",O=/^([*\-=_])(?:\s*\1){2,}\s*$/,F=/^[*\-+]\s+/,P=/^[0-9]+\.\s+/,U=/^\[(x| )\](?=\s)/,$=/^(?:\={1,}|-{1,})$/,W=/^[^!\[\]*_\\<>` "'(]+/,R=[];return{startState:function(){return{f:i,prevLineHasContent:!1,thisLineHasContent:!1,block:i,htmlState:C.startState(v),indentation:0,inline:c,text:l,linkText:!1,linkTitle:!1,em:!1,strong:!1,header:!1,taskList:!1,list:!1,listDepth:0,quote:0,trailingSpace:0,trailingSpaceNewLine:!1}},copyState:function(e){return{f:e.f,prevLineHasContent:e.prevLineHasContent,thisLineHasContent:e.thisLineHasContent,block:e.block,htmlState:C.copyState(v,e.htmlState),indentation:e.indentation,localMode:e.localMode,localState:e.localMode?C.copyState(e.localMode,e.localState):null,inline:e.inline,text:e.text,linkTitle:e.linkTitle,em:e.em,strong:e.strong,header:e.header,taskList:e.taskList,list:e.list,listDepth:e.listDepth,quote:e.quote,trailingSpace:e.trailingSpace,trailingSpaceNewLine:e.trailingSpaceNewLine,md_inside:e.md_inside}},token:function(e,t){if(e.sol()){if(e.match(/^\s*$/,!0))return t.prevLineHasContent=!1,o(t);t.prevLineHasContent=t.thisLineHasContent,t.thisLineHasContent=!0,t.header=!1,t.taskList=!1,t.code=!1,t.trailingSpace=0,t.trailingSpaceNewLine=!1,t.f=t.block;var n=e.match(/^\s*/,!0)[0].replace(/\t/g,"    ").length,r=4*Math.floor((n-t.indentation)/4);r>4&&(r=4);var i=t.indentation+r;if(t.indentationDiff=i-t.indentation,t.indentation=i,n>0)return null}return t.f(e,t)},blankLine:o,getType:u}},"xml"),C.defineMIME("text/x-markdown","markdown");var k=/Mac/.test(navigator.platform),M={"Cmd-B":u,"Cmd-I":l,"Cmd-K":f,"Cmd-Alt-I":h,"Cmd-'":c,"Cmd-Alt-L":g,"Cmd-L":d},L=!1,S=[{name:"bold",action:u},{name:"italic",action:l},"|",{name:"quote",action:c},{name:"unordered-list",action:d},{name:"ordered-list",action:g},"|",{name:"link",action:f},{name:"image",action:h},"|",{name:"info",action:"http://lab.lepture.com/editor/markdown"},{name:"preview",action:v},{name:"fullscreen",action:s}];w.toolbar=S,w.markdown=function(e){if(window.marked){var t=new marked.Renderer;return marked.setOptions({renderer:t,gfm:!0,tables:!0,breaks:!0,pedantic:!1,sanitize:!1,smartLists:!0,smartypants:!1}),marked(e)}},w.prototype.render=function(e,t){if(e||(e=this.element||document.getElementsByTagName("textarea")[0]),!this._rendered||this._rendered!==e){this.element=e;var n=this.options,o=this,i={};for(var a in M)!function(e){i[r(e)]=function(t){M[e](o)}}(a);i.Enter="newlineAndIndentContinueMarkdownList",this.codemirror=C.fromTextArea(e,{mode:"markdown",theme:"paper",indentWithTabs:!0,lineNumbers:!1,extraKeys:i,lineWrapping:!0,viewportMargin:1/0}),n.toolbar!==!1&&this.createToolbar(null,t),n.status!==!1&&this.createStatusbar(),this._rendered=this.element}},w.prototype.createToolbar=function(e){var e=e||this.options.toolbar;if(e&&0!==e.length){var t=document.createElement("div");t.className="editor-toolbar";var n=this;n.toolbar={};for(var r=0;r<e.length;r++)!function(e){var r;e.text?(r=document.createElement("span"),r.className="tip",r.id=e.name,r.innerText=e.text):r=e.name?o(e.name,e):"|"===e?i():o(e),e.action&&("function"==typeof e.action?r.onclick=function(t){e.action(n)}:"string"==typeof e.action&&(r.href=e.action,r.target=e.target)),n.toolbar[e.name||e]=r,t.appendChild(r)}(e[r]);var s=this.codemirror;s.on("cursorActivity",function(){var e=a(s);for(var t in n.toolbar)!function(t){var r=n.toolbar[t];e[t]?r.className+=" active":r.className=r.className.replace(/\s*active\s*/g,"")}(t)});var u=(document.createElement("span"),s.getWrapperElement());return u.parentNode.insertBefore(t,u),t}},w.prototype.createStatusbar=function(e){if(e=e||this.options.status,e&&0!==e.length){var t=document.createElement("div");t.className="editor-statusbar";for(var n,r=this.codemirror,o=0;o<e.length;o++)!function(e){var o=document.createElement("span");o.className=e,"words"===e?(o.innerHTML="0",r.on("update",function(){o.innerHTML=_(r.getValue())})):"lines"===e?(o.innerHTML="0",r.on("update",function(){o.innerHTML=r.lineCount()})):"cursor"===e&&(o.innerHTML="0:0",r.on("cursorActivity",function(){n=r.getCursor(),o.innerHTML=n.line+":"+n.ch})),t.appendChild(o)}(e[o]);var i=this.codemirror.getWrapperElement();return i.parentNode.insertBefore(t,i.nextSibling),t}},w.toggleBold=u,w.toggleItalic=l,w.toggleBlockquote=c,w.toggleUnOrderedList=d,w.toggleOrderedList=g,w.drawLink=f,w.drawImage=h,w.undo=p,w.redo=m,w.togglePreview=v,w.toggleFullScreen=s,w.prototype.toggleBold=function(){u(this)},w.prototype.toggleItalic=function(){l(this)},w.prototype.toggleBlockquote=function(){c(this)},w.prototype.toggleUnOrderedList=function(){d(this)},w.prototype.toggleOrderedList=function(){g(this)},w.prototype.drawLink=function(){f(this)},w.prototype.drawImage=function(){h(this)},w.prototype.undo=function(){p(this)},w.prototype.redo=function(){m(this)},w.prototype.togglePreview=function(){v(this)},w.prototype.toggleFullScreen=function(){s(this)},t.exports=w},{}],8:[function(e,t,n){function r(e){return e}function o(e){return!1}function i(){}function a(){}var s={};i.prototype={chain:function(e,t){var n=this[e];if(!n)throw new Error("unknown hook "+e);this[e]=n===r?t:function(e){var r=Array.prototype.slice.call(arguments,0);return r[0]=n.apply(null,r),t.apply(null,r)}},set:function(e,t){if(!this[e])throw new Error("unknown hook "+e);this[e]=t},addNoop:function(e){this[e]=r},addFalse:function(e){this[e]=o}},s.HookCollection=i,a.prototype={set:function(e,t){this["s_"+e]=t},get:function(e){return this["s_"+e]}},s.Converter=function(e){function t(e){return e=e.replace(/^[ ]{0,3}\[([^\[\]]+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?(?=\s|$)[ \t]*\n?[ \t]*((\n*)["(](.+?)[")][ \t]*)?(?:\n+)/gm,function(e,t,n,r,o,i){return t=t.toLowerCase(),O.set(t,S(n)),o?r:(i&&F.set(t,i.replace(/"/g,"&quot;")),"")})}function n(e){return e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,s),e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,s),e=e.replace(/\n[ ]{0,3}((<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,s),e=e.replace(/\n\n[ ]{0,3}(<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>[ \t]*(?=\n{2,}))/g,s),e=e.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,s)}function o(e){return e=e.replace(/(^\n+|\n+$)/g,""),"\n\n~K"+(P.push(e)-1)+"K\n\n"}function s(e,t){return o(t)}function u(e,t){e=B.preBlockGamut(e,H),e=m(e);var r="<hr />\n";return e=e.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,r),e=e.replace(/^[ ]{0,2}([ ]?-[ ]?){3,}[ \t]*$/gm,r),e=e.replace(/^[ ]{0,2}([ ]?_[ ]?){3,}[ \t]*$/gm,r),e=v(e),e=y(e),e=M(e),e=B.postBlockGamut(e,H),e=n(e),e=L(e,t)}function l(e){return e=B.preSpanGamut(e),e=_(e),e=c(e),e=T(e),e=f(e),e=d(e),e=z(e),e=e.replace(/~P/g,"://"),e=S(e),e=R(e),e=e.replace(/  +\n/g," <br>\n"),e=B.postSpanGamut(e)}function c(e){var t=/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>)/gi;return e=e.replace(t,function(e){var t=e.replace(/(.)<\/?code>(?=.)/g,"$1`");return t=A(t,"!"==e.charAt(1)?"\\`*_/":"\\`*_")})}function d(e){return-1===e.indexOf("[")?e:(e=e.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,g),e=e.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?((?:\([^)]*\)|[^()\s])*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,g),e=e.replace(/(\[([^\[\]]+)\])()()()()()/g,g))}function g(e,t,n,r,o,i,a,s){void 0==s&&(s="");var u=t,l=n.replace(/:\/\//g,"~P"),c=r.toLowerCase(),d=o,g=s;if(""==d)if(""==c&&(c=l.toLowerCase().replace(/ ?\n/g," ")),d="#"+c,void 0!=O.get(c))d=O.get(c),void 0!=F.get(c)&&(g=F.get(c));else{if(!(u.search(/\(\s*\)$/m)>-1))return u;d=""}d=G(d);var f='<a href="'+d+'"';return""!=g&&(g=h(g),g=A(g,"*_"),f+=' title="'+g+'"'),f+=">"+l+"</a>"}function f(e){return-1===e.indexOf("![")?e:(e=e.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,p),e=e.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,p))}function h(e){return e.replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function p(e,t,n,r,o,i,a,s){var u=t,l=n,c=r.toLowerCase(),d=o,g=s;if(g||(g=""),""==d){if(""==c&&(c=l.toLowerCase().replace(/ ?\n/g," ")),d="#"+c,void 0==O.get(c))return u;d=O.get(c),void 0!=F.get(c)&&(g=F.get(c))}l=A(h(l),"*_[]()"),d=A(d,"*_");var f='<img src="'+d+'" alt="'+l+'"';return g=h(g),g=A(g,"*_"),f+=' title="'+g+'"',f+=" />"}function m(e){return e=e.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(e,t){return"<h1>"+l(t)+"</h1>\n\n"}),e=e.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(e,t){return"<h2>"+l(t)+"</h2>\n\n"}),e=e.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(e,t,n){var r=t.length;return"<h"+r+">"+l(n)+"</h"+r+">\n\n"})}function v(e,t){e+="~0";var n=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;return U?e=e.replace(n,function(e,n,r){var o=n,i=r.search(/[*+-]/g)>-1?"ul":"ol",a=b(o,i,t);return a=a.replace(/\s+$/,""),a="<"+i+">"+a+"</"+i+">\n"}):(n=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g,e=e.replace(n,function(e,t,n,r){var o=t,i=n,a=r.search(/[*+-]/g)>-1?"ul":"ol",s=b(i,a);return s=o+"<"+a+">\n"+s+"</"+a+">\n"})),e=e.replace(/~0/,"")}function b(e,t,n){U++,e=e.replace(/\n{2,}$/,"\n"),e+="~0";var r=Y[t],o=new RegExp("(^[ \\t]*)("+r+")[ \\t]+([^\\r]+?(\\n+))(?=(~0|\\1("+r+")[ \\t]+))","gm"),i=!1;return e=e.replace(o,function(e,t,r,o){var a=o,s=/\n\n$/.test(a),c=s||a.search(/\n{2,}/)>-1;return c||i?a=u(D(a),!0):(a=v(D(a),!0),a=a.replace(/\n$/,""),n||(a=l(a))),i=s,"<li>"+a+"</li>\n"}),e=e.replace(/~0/g,""),U--,e}function y(e){return e+="~0",e=e.replace(/(?:\n\n|^\n?)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(e,t,n){var r=t,o=n;return r=w(D(r)),r=E(r),r=r.replace(/^\n+/g,""),r=r.replace(/\n+$/g,""),r="<pre><code>"+r+"\n</code></pre>","\n\n"+r+"\n\n"+o}),e=e.replace(/~0/,"")}function _(e){return e=e.replace(/(^|[^\\`])(`+)(?!`)([^\r]*?[^`])\2(?!`)/gm,function(e,t,n,r,o){var i=r;return i=i.replace(/^([ \t]*)/g,""),i=i.replace(/[ \t]*$/g,""),i=w(i),i=i.replace(/:\/\//g,"~P"),t+"<code>"+i+"</code>"})}function w(e){return e=e.replace(/&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=A(e,"*_{}[]\\",!1)}function C(e){return-1===e.indexOf("*")&&-1===e.indexOf("_")?e:(e=$(e),e=e.replace(/(^|[\W_])(?:(?!\1)|(?=^))(\*|_)\2(?=\S)([^\r]*?\S)\2\2(?!\2)(?=[\W_]|$)/g,"$1<strong>$3</strong>"),e=e.replace(/(^|[\W_])(?:(?!\1)|(?=^))(\*|_)(?=\S)((?:(?!\2)[^\r])*?\S)\2(?!\2)(?=[\W_]|$)/g,"$1<em>$3</em>"),W(e))}function k(e){return-1===e.indexOf("*")&&-1===e.indexOf("_")?e:(e=$(e),e=e.replace(/(?=[^\r][*_]|[*_])(^|(?=\W__|(?!\*)[\W_]\*\*|\w\*\*\w)[^\r])(\*\*|__)(?!\2)(?=\S)((?:|[^\r]*?(?!\2)[^\r])(?=\S_|\w|\S\*\*(?:[\W_]|$)).)(?=__(?:\W|$)|\*\*(?:[^*]|$))\2/g,"$1<strong>$3</strong>"),e=e.replace(/(?=[^\r][*_]|[*_])(^|(?=\W_|(?!\*)(?:[\W_]\*|\D\*(?=\w)\D))[^\r])(\*|_)(?!\2\2\2)(?=\S)((?:(?!\2)[^\r])*?(?=[^\s_]_|(?=\w)\D\*\D|[^\s*]\*(?:[\W_]|$)).)(?=_(?:\W|$)|\*(?:[^*]|$))\2/g,"$1<em>$3</em>"),W(e))}function M(e){return e=e.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(e,t){var n=t;return n=n.replace(/^[ \t]*>[ \t]?/gm,"~0"),n=n.replace(/~0/g,""),n=n.replace(/^[ \t]+$/gm,""),n=u(n),n=n.replace(/(^|\n)/g,"$1  "),n=n.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(e,t){var n=t;return n=n.replace(/^  /gm,"~0"),n=n.replace(/~0/g,"")}),o("<blockquote>\n"+n+"\n</blockquote>")})}function L(e,t){e=e.replace(/^\n+/g,""),e=e.replace(/\n+$/g,"");for(var n=e.split(/\n{2,}/g),r=[],o=/~K(\d+)K/,i=n.length,a=0;i>a;a++){var s=n[a];o.test(s)?r.push(s):/\S/.test(s)&&(s=l(s),s=s.replace(/^([ \t]*)/g,"<p>"),s+="</p>",r.push(s))}if(!t){i=r.length;for(var a=0;i>a;a++)for(var u=!0;u;)u=!1,r[a]=r[a].replace(/~K(\d+)K/g,function(e,t){return u=!0,P[t]})}return r.join("\n\n")}function S(e){return e=e.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),e=e.replace(/<(?![a-z\/?!]|~D)/gi,"&lt;")}function T(e){return e=e.replace(/\\(\\)/g,N),e=e.replace(/\\([`*_{}\[\]()>#+-.!])/g,N)}function x(e,t,n,r){if(t)return e;if(")"!==r.charAt(r.length-1))return"<"+n+r+">";for(var o=r.match(/[()]/g),i=0,a=0;a<o.length;a++)"("===o[a]?0>=i?i=1:i++:i--;var s="";if(0>i){var u=new RegExp("\\){1,"+-i+"}$");r=r.replace(u,function(e){return s=e,""})}if(s){var l=r.charAt(r.length-1);j.test(l)||(s=l+s,r=r.substr(0,r.length-1))}return"<"+n+r+">"+s}function z(e){e=e.replace(Z,x);var t=function(e,t){var n=G(t);return'<a href="'+n+'">'+B.plainLinkText(t)+"</a>"};return e=e.replace(/<((https?|ftp):[^'">\s]+)>/gi,t)}function I(e){return e=e.replace(/~E(\d+)E/g,function(e,t){var n=parseInt(t);return String.fromCharCode(n)})}function D(e){return e=e.replace(/^(\t|[ ]{1,4})/gm,"~0"),e=e.replace(/~0/g,"")}function E(e){if(!/\t/.test(e))return e;var t,n=["    ","   ","  "," "],r=0;return e.replace(/[\n\t]/g,function(e,o){return"\n"===e?(r=o+1,e):(t=(o-r)%4,r=o+1,n[t])})}function G(e){return e=h(e),e=A(e,"*_:()[]")}function A(e,t,n){var r="(["+t.replace(/([\[\]\\])/g,"\\$1")+"])";n&&(r="\\\\"+r);var o=new RegExp(r,"g");return e=e.replace(o,N)}function N(e,t){var n=t.charCodeAt(0);return"~E"+n+"E"}var B=this.hooks=new i;B.addNoop("plainLinkText"),B.addNoop("preConversion"),B.addNoop("postNormalization"),B.addNoop("preBlockGamut"),B.addNoop("postBlockGamut"),B.addNoop("preSpanGamut"),B.addNoop("postSpanGamut"),B.addNoop("postConversion");var O,F,P,U;e=e||{};var $=r,W=r;e.nonAsciiLetters&&!function(){var e=/[Q\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376-\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0523\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0621-\u064a\u0660-\u0669\u066e-\u066f\u0671-\u06d3\u06d5\u06e5-\u06e6\u06ee-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07c0-\u07ea\u07f4-\u07f5\u07fa\u0904-\u0939\u093d\u0950\u0958-\u0961\u0966-\u096f\u0971-\u0972\u097b-\u097f\u0985-\u098c\u098f-\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc-\u09dd\u09df-\u09e1\u09e6-\u09f1\u0a05-\u0a0a\u0a0f-\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32-\u0a33\u0a35-\u0a36\u0a38-\u0a39\u0a59-\u0a5c\u0a5e\u0a66-\u0a6f\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2-\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0-\u0ae1\u0ae6-\u0aef\u0b05-\u0b0c\u0b0f-\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32-\u0b33\u0b35-\u0b39\u0b3d\u0b5c-\u0b5d\u0b5f-\u0b61\u0b66-\u0b6f\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99-\u0b9a\u0b9c\u0b9e-\u0b9f\u0ba3-\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0be6-\u0bef\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58-\u0c59\u0c60-\u0c61\u0c66-\u0c6f\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0-\u0ce1\u0ce6-\u0cef\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d28\u0d2a-\u0d39\u0d3d\u0d60-\u0d61\u0d66-\u0d6f\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32-\u0e33\u0e40-\u0e46\u0e50-\u0e59\u0e81-\u0e82\u0e84\u0e87-\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa-\u0eab\u0ead-\u0eb0\u0eb2-\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0ed0-\u0ed9\u0edc-\u0edd\u0f00\u0f20-\u0f29\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8b\u1000-\u102a\u103f-\u1049\u1050-\u1055\u105a-\u105d\u1061\u1065-\u1066\u106e-\u1070\u1075-\u1081\u108e\u1090-\u1099\u10a0-\u10c5\u10d0-\u10fa\u10fc\u1100-\u1159\u115f-\u11a2\u11a8-\u11f9\u1200-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u1676\u1681-\u169a\u16a0-\u16ea\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u17e0-\u17e9\u1810-\u1819\u1820-\u1877\u1880-\u18a8\u18aa\u1900-\u191c\u1946-\u196d\u1970-\u1974\u1980-\u19a9\u19c1-\u19c7\u19d0-\u19d9\u1a00-\u1a16\u1b05-\u1b33\u1b45-\u1b4b\u1b50-\u1b59\u1b83-\u1ba0\u1bae-\u1bb9\u1c00-\u1c23\u1c40-\u1c49\u1c4d-\u1c7d\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u203f-\u2040\u2054\u2071\u207f\u2090-\u2094\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2183-\u2184\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2c6f\u2c71-\u2c7d\u2c80-\u2ce4\u2d00-\u2d25\u2d30-\u2d65\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3006\u3031-\u3035\u303b-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31b7\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fc3\ua000-\ua48c\ua500-\ua60c\ua610-\ua62b\ua640-\ua65f\ua662-\ua66e\ua67f-\ua697\ua717-\ua71f\ua722-\ua788\ua78b-\ua78c\ua7fb-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8d0-\ua8d9\ua900-\ua925\ua930-\ua946\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa50-\uaa59\uac00-\ud7a3\uf900-\ufa2d\ufa30-\ufa6a\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe33-\ufe34\ufe4d-\ufe4f\ufe70-\ufe74\ufe76-\ufefc\uff10-\uff19\uff21-\uff3a\uff3f\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc]/g,t="Q".charCodeAt(0),n="A".charCodeAt(0),r="Z".charCodeAt(0),o="a".charCodeAt(0)-r-1;

$=function(i){return i.replace(e,function(e){for(var i,a=e.charCodeAt(0),s="";a>0;)i=a%51+n,i>=t&&i++,i>r&&(i+=o),s=String.fromCharCode(i)+s,a=a/51|0;return"Q"+s+"Q"})},W=function(e){return e.replace(/Q([A-PR-Za-z]{1,3})Q/g,function(e,i){for(var a,s=0,u=0;u<i.length;u++)a=i.charCodeAt(u),a>r&&(a-=o),a>t&&a--,a-=n,s=51*s+a;return String.fromCharCode(s)})}}();var R=e.asteriskIntraWordEmphasis?k:C;this.makeHtml=function(e){if(O)throw new Error("Recursive call to converter.makeHtml");return O=new a,F=new a,P=[],U=0,e=B.preConversion(e),e=e.replace(/~/g,"~T"),e=e.replace(/\$/g,"~D"),e=e.replace(/\r\n/g,"\n"),e=e.replace(/\r/g,"\n"),e="\n\n"+e+"\n\n",e=E(e),e=e.replace(/^[ \t]+$/gm,""),e=B.postNormalization(e),e=n(e),e=t(e),e=u(e),e=I(e),e=e.replace(/~D/g,"$$"),e=e.replace(/~T/g,"~"),e=B.postConversion(e),P=F=O=null,e};var H=function(e){return u(e)},Y={ol:"\\d+[.]",ul:"[*+-]"},K="[-A-Z0-9+&@#/%?=~_|[\\]()!:,.;]",V="[-A-Z0-9+&@#/%=~_|[\\])]",Z=new RegExp('(="|<)?\\b(https?|ftp)(://'+K+"*"+V+")(?=$|\\W)","gi"),j=new RegExp(V,"i")},t.exports=s},{}],9:[function(e,t,n){function r(e){return e.replace(/^\s+|\s+$/g,"")}function o(e){return e.replace(/\s+$/g,"")}function i(e){return e.replace(new RegExp("^(\\t|[ ]{1,4})","gm"),"")}function a(e,t){return-1!=e.indexOf(t)}function s(e,t){return e.replace(/<[^>]*>?/gi,function(e){return e.match(t)?e:""})}function u(e,t){for(var n={},r=0;r<e.length;r++)n[e[r]]=e[r];for(r=0;r<t.length;r++)n[t[r]]=t[r];var o=[];for(var i in n)n.hasOwnProperty(i)&&o.push(n[i]);return o}function l(e){return""!=e.charAt(0)&&(e=""+e),""!=e.charAt(e.length-1)&&(e+=""),e}function c(e){return""==e.charAt(0)&&(e=e.substr(1)),""==e.charAt(e.length-1)&&(e=e.substr(0,e.length-1)),e}function d(e,t){return s(g(e,t),y)}function g(e,t){var n=t.blockGamutHookCallback(e);return n=p(n),n=n.replace(/~D/g,"$$").replace(/~T/g,"~"),n=t.previousPostConversion(n)}function f(e){return e.replace(/\\\|/g,"~I").replace(/\\:/g,"~i")}function h(e){return e.replace(/~I/g,"|").replace(/~i/g,":")}function p(e){return e=e.replace(/~E(\d+)E/g,function(e,t){var n=parseInt(t);return String.fromCharCode(n)})}function m(e){return e.toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}function v(e,t){var n=t;return n=n.replace(/&\#8220;/g,'"'),n=n.replace(/&\#8221;/g,'"'),n=n.replace(/&\#8216;/g,"'"),n=n.replace(/&\#8217;/g,"'"),n=n.replace(/&\#8212;/g,"---"),n=n.replace(/&\#8211;/g,"--"),n=n.replace(/&\#8230;/g,"...")}var b={},y=new RegExp(["^(<\\/?(a|abbr|acronym|applet|area|b|basefont|","bdo|big|button|cite|code|del|dfn|em|figcaption|","font|i|iframe|img|input|ins|kbd|label|map|","mark|meter|object|param|progress|q|ruby|rp|rt|s|","samp|script|select|small|span|strike|strong|","sub|sup|textarea|time|tt|u|var|wbr)[^>]*>|","<(br)\\s?\\/?>)$"].join(""),"i");Array.indexOf||(Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return t;return-1}),b.Extra=function(){this.converter=null,this.hashBlocks=[],this.footnotes={},this.usedFootnotes=[],this.attributeBlocks=!1,this.googleCodePrettify=!1,this.highlightJs=!1,this.tableClass="",this.tabWidth=4},b.Extra.init=function(e,t){var n=new b.Extra,r=[],o=[],i=[],s=["unHashExtraBlocks"];return t=t||{},t.extensions=t.extensions||["all"],a(t.extensions,"all")&&(t.extensions=["tables","fenced_code_gfm","def_list","attr_list","footnotes","smartypants","strikethrough","newlines"]),o.push("wrapHeaders"),a(t.extensions,"attr_list")&&(r.push("hashFcbAttributeBlocks"),o.push("hashHeaderAttributeBlocks"),s.push("applyAttributeBlocks"),n.attributeBlocks=!0),a(t.extensions,"fenced_code_gfm")&&(o.push("fencedCodeBlocks"),r.push("fencedCodeBlocks")),a(t.extensions,"tables")&&o.push("tables"),a(t.extensions,"def_list")&&o.push("definitionLists"),a(t.extensions,"footnotes")&&(r.push("stripFootnoteDefinitions"),o.push("doFootnotes"),s.push("printFootnotes")),a(t.extensions,"smartypants")&&s.push("runSmartyPants"),a(t.extensions,"strikethrough")&&i.push("strikethrough"),a(t.extensions,"newlines")&&i.push("newlines"),e.hooks.chain("postNormalization",function(e){return n.doTransform(r,e)+"\n"}),e.hooks.chain("preBlockGamut",function(e,t){return n.blockGamutHookCallback=t,e=f(e),e=n.doTransform(o,e)+"\n",e=h(e)}),e.hooks.chain("postSpanGamut",function(e){return n.doTransform(i,e)}),n.previousPostConversion=e.hooks.postConversion,e.hooks.chain("postConversion",function(e){return e=n.doTransform(s,e),n.hashBlocks=[],n.footnotes={},n.usedFootnotes=[],e}),"highlighter"in t&&(n.googleCodePrettify="prettify"===t.highlighter,n.highlightJs="highlight"===t.highlighter),"table_class"in t&&(n.tableClass=t.table_class),n.converter=e,n},b.Extra.prototype.doTransform=function(e,t){for(var n=0;n<e.length;n++)t=this[e[n]](t);return t},b.Extra.prototype.hashExtraBlock=function(e){return"\n<p>~X"+(this.hashBlocks.push(e)-1)+"X</p>\n"},b.Extra.prototype.hashExtraInline=function(e){return"~X"+(this.hashBlocks.push(e)-1)+"X"},b.Extra.prototype.unHashExtraBlocks=function(e){function t(){var r=!1;e=e.replace(/(?:<p>)?~X(\d+)X(?:<\/p>)?/g,function(e,t){r=!0;var o=parseInt(t,10);return n.hashBlocks[o]}),r===!0&&t()}var n=this;return t(),e},b.Extra.prototype.wrapHeaders=function(e){function t(e){return"\n"+e+"\n"}return e=e.replace(/^.+[ \t]*\n=+[ \t]*\n+/gm,t),e=e.replace(/^.+[ \t]*\n-+[ \t]*\n+/gm,t),e=e.replace(/^\#{1,6}[ \t]*.+?[ \t]*\#*\n+/gm,t)};var _="\\{[ \\t]*((?:[#.][-_:a-zA-Z0-9]+[ \\t]*)+)\\}",w=new RegExp("^(#{1,6}.*#{0,6})[ \\t]+"+_+"[ \\t]*(?:\\n|0x03)","gm"),C=new RegExp("^(.*)[ \\t]+"+_+"[ \\t]*\\n(?=[\\-|=]+\\s*(?:\\n|0x03))","gm"),k=new RegExp("^(```[ \\t]*[^{\\s]*)[ \\t]+"+_+"[ \\t]*\\n(?=([\\s\\S]*?)\\n```[ \\t]*(\\n|0x03))","gm");b.Extra.prototype.hashHeaderAttributeBlocks=function(e){function t(e,t,r){return"<p>~XX"+(n.hashBlocks.push(r)-1)+"XX</p>\n"+t+"\n"}var n=this;return e=e.replace(w,t),e=e.replace(C,t)},b.Extra.prototype.hashFcbAttributeBlocks=function(e){function t(e,t,r){return"<p>~XX"+(n.hashBlocks.push(r)-1)+"XX</p>\n"+t+"\n"}var n=this;return e.replace(k,t)},b.Extra.prototype.applyAttributeBlocks=function(e){var t=this,n=new RegExp('<p>~XX(\\d+)XX</p>[\\s]*(?:<(h[1-6]|pre)(?: +class="(\\S+)")?(>[\\s\\S]*?</\\2>))',"gm");return e=e.replace(n,function(e,n,r,o,i){if(!r)return"";for(var a=parseInt(n,10),s=t.hashBlocks[a],l=s.match(/#[^\s#.]+/g)||[],c=l[0]?' id="'+l[0].substr(1,l[0].length-1)+'"':"",d=s.match(/\.[^\s#.]+/g)||[],g=0;g<d.length;g++)d[g]=d[g].substr(1,d[g].length-1);var f="";return o&&(d=u(d,[o])),d.length>0&&(f=' class="'+d.join(" ")+'"'),"<"+r+c+f+i})},b.Extra.prototype.tables=function(e){function t(e,t,o,i,a,s){t=t.replace(/^ *[|]/m,""),o=o.replace(/^ *[|]/m,""),i=i.replace(/^ *[|]/gm,""),t=t.replace(/[|] *$/m,""),o=o.replace(/[|] *$/m,""),i=i.replace(/[|] *$/gm,"");for(var u=o.split(/ *[|] */),l=[],c=0;c<u.length;c++){var g=u[c];l[c]=g.match(/^ *-+: *$/m)?' align="right"':g.match(/^ *:-+: *$/m)?' align="center"':g.match(/^ *:-+ *$/m)?' align="left"':""}var f=t.split(/ *[|] */),h=f.length,p=n.tableClass?' class="'+n.tableClass+'"':"",m=["<table",p,">\n","<thead>\n","<tr>\n"].join("");for(c=0;h>c;c++){var v=d(r(f[c]),n);m+=["  <th",l[c],">",v,"</th>\n"].join("")}m+="</tr>\n</thead>\n";var b=i.split("\n");for(c=0;c<b.length;c++)if(!b[c].match(/^\s*$/)){for(var y=b[c].split(/ *[|] */),_=h-y.length,w=0;_>w;w++)y.push("");for(m+="<tr>\n",w=0;h>w;w++){var C=d(r(y[w]),n);m+=["  <td",l[w],">",C,"</td>\n"].join("")}m+="</tr>\n"}return m+="</table>\n",n.hashExtraBlock(m)}var n=this,o=new RegExp(["^","[ ]{0,3}","[|]","(.+)\\n","[ ]{0,3}","[|]([ ]*[-:]+[-| :]*)\\n","(","(?:[ ]*[|].*\\n?)*",")","(?:\\n|$)"].join(""),"gm"),i=new RegExp(["^","[ ]{0,3}","(\\S.*[|].*)\\n","[ ]{0,3}","([-:]+[ ]*[|][-| :]*)\\n","(","(?:.*[|].*\\n?)*",")","(?:\\n|$)"].join(""),"gm");return e=e.replace(o,t),e=e.replace(i,t)},b.Extra.prototype.stripFootnoteDefinitions=function(e){var t=this;return e=e.replace(/\n[ ]{0,3}\[\^(.+?)\]\:[ \t]*\n?([\s\S]*?)\n{1,2}((?=\n[ ]{0,3}\S)|$)/g,function(e,n,r){return n=m(n),r+="\n",r=r.replace(/^[ ]{0,3}/g,""),t.footnotes[n]=r,"\n"})},b.Extra.prototype.doFootnotes=function(e){var t=this;if(t.isConvertingFootnote===!0)return e;var n=0;return e=e.replace(/\[\^(.+?)\]/g,function(e,r){var o=m(r),i=t.footnotes[o];if(void 0===i)return e;n++,t.usedFootnotes.push(o);var a='<a href="#fn:'+o+'" id="fnref:'+o+'" title="See footnote" class="footnote">'+n+"</a>";return t.hashExtraInline(a)})},b.Extra.prototype.printFootnotes=function(e){var t=this;if(0===t.usedFootnotes.length)return e;e+='\n\n<div class="footnotes">\n<hr>\n<ol>\n\n';for(var n=0;n<t.usedFootnotes.length;n++){var r=t.usedFootnotes[n],o=t.footnotes[r];t.isConvertingFootnote=!0;var i=d(o,t);delete t.isConvertingFootnote,e+='<li id="fn:'+r+'">'+i+' <a href="#fnref:'+r+'" title="Return to article" class="reversefootnote">&#8617;</a></li>\n\n'}return e+="</ol>\n</div>"},b.Extra.prototype.fencedCodeBlocks=function(e){function t(e){return e=e.replace(/&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/~D/g,"$$"),e=e.replace(/~T/g,"~")}var n=this;return e=e.replace(/(?:^|\n)```[ \t]*(\S*)[ \t]*\n([\s\S]*?)\n```[ \t]*(?=\n)/g,function(e,r,o){var i=r,a=o,s=n.googleCodePrettify?' class="prettyprint linenums"':"",u="";i&&(u=n.googleCodePrettify||n.highlightJs?' class="language-'+i+'"':' class="'+i+'"');var l=["<pre",s,"><code",u,">",t(a),"</code></pre>"].join("");return n.hashExtraBlock(l)})},b.Extra.prototype.educatePants=function(e){var t=this,n="",r=0;e.replace(/(?:<!--[\s\S]*?-->)|(<)([a-zA-Z1-6]+)([^\n]*?>)([\s\S]*?)(<\/\2>)/g,function(o,i,a,s,u,l,c){var d=e.substring(r,c);return n+=t.applyPants(d),t.smartyPantsLastChar=n.substring(n.length-1),r=c+o.length,i?(/code|kbd|pre|script|noscript|iframe|math|ins|del|pre/i.test(a)?t.smartyPantsLastChar=u.substring(u.length-1):u=t.educatePants(u),void(n+=i+a+s+u+l)):void(n+=o)});var o=e.substring(r);return n+=t.applyPants(o),t.smartyPantsLastChar=n.substring(n.length-1),n},b.Extra.prototype.applyPants=function(e){return e=e.replace(/---/g,"&#8212;").replace(/--/g,"&#8211;"),e=e.replace(/\.\.\./g,"&#8230;").replace(/\.\s\.\s\./g,"&#8230;"),e=e.replace(/``/g,"&#8220;").replace(/''/g,"&#8221;"),/^'$/.test(e)?/\S/.test(this.smartyPantsLastChar)?"&#8217;":"&#8216;":/^"$/.test(e)?/\S/.test(this.smartyPantsLastChar)?"&#8221;":"&#8220;":(e=e.replace(/^'(?=[!"#\$\%'()*+,\-.\/:;<=>?\@\[\\]\^_`{|}~]\B)/,"&#8217;"),e=e.replace(/^"(?=[!"#\$\%'()*+,\-.\/:;<=>?\@\[\\]\^_`{|}~]\B)/,"&#8221;"),e=e.replace(/"'(?=\w)/g,"&#8220;&#8216;"),e=e.replace(/'"(?=\w)/g,"&#8216;&#8220;"),e=e.replace(/'(?=\d{2}s)/g,"&#8217;"),e=e.replace(/(\s|&nbsp;|--|&[mn]dash;|&\#8211;|&\#8212;|&\#x201[34];)'(?=\w)/g,"$1&#8216;"),e=e.replace(/([^\s\[\{\(\-])'/g,"$1&#8217;"),e=e.replace(/'(?=\s|s\b)/g,"&#8217;"),e=e.replace(/'/g,"&#8216;"),e=e.replace(/(\s|&nbsp;|--|&[mn]dash;|&\#8211;|&\#8212;|&\#x201[34];)"(?=\w)/g,"$1&#8220;"),e=e.replace(/([^\s\[\{\(\-])"/g,"$1&#8221;"),e=e.replace(/"(?=\s)/g,"&#8221;"),e=e.replace(/"/gi,"&#8220;"))},b.Extra.prototype.runSmartyPants=function(e){return this.smartyPantsLastChar="",e=this.educatePants(e),e=e.replace(/(<([a-zA-Z1-6]+)\b([^\n>]*?)(\/)?>)/g,v)},b.Extra.prototype.definitionLists=function(e){var t=new RegExp(["(\\x02\\n?|\\n\\n)","(?:","(","(","[ ]{0,3}","((?:[ \\t]*\\S.*\\n)+)","\\n?","[ ]{0,3}:[ ]+",")","([\\s\\S]+?)","(","(?=\\0x03)","|","(?=","\\n{2,}","(?=\\S)","(?!","[ ]{0,3}","(?:\\S.*\\n)+?","\\n?","[ ]{0,3}:[ ]+",")","(?!","[ ]{0,3}:[ ]+",")",")",")",")",")"].join(""),"gm"),n=this;return e=l(e),e=e.replace(t,function(e,t,o){var i=r(n.processDefListItems(o));return i="<dl>\n"+i+"\n</dl>",t+n.hashExtraBlock(i)+"\n\n"}),c(e)},b.Extra.prototype.processDefListItems=function(e){var t=this,n=new RegExp(["(\\x02\\n?|\\n\\n+)","(","[ ]{0,3}","(?![:][ ]|[ ])","(?:\\S.*\\n)+?",")","(?=\\n?[ ]{0,3}:[ ])"].join(""),"gm"),a=new RegExp(["\\n(\\n+)?","(","[ ]{0,3}","[:][ ]+",")","([\\s\\S]+?)","(?=\\n*","(?:","\\n[ ]{0,3}[:][ ]|","<dt>|\\x03",")",")"].join(""),"gm");return e=l(e),e=e.replace(/\n{2,}(?=\\x03)/,"\n"),e=e.replace(n,function(e,n,o){for(var i=r(o).split("\n"),a="",s=0;s<i.length;s++){var u=i[s];u=d(r(u),t),a+="\n<dt>"+u+"</dt>"}return a+"\n"}),e=e.replace(a,function(e,n,r,a){return n||a.match(/\n{2,}/)?(a=Array(r.length+1).join(" ")+a,a=i(a)+"\n\n",a="\n"+g(a,t)+"\n"):(a=o(a),a=d(i(a),t)),"\n<dd>"+a+"</dd>\n"}),c(e)},b.Extra.prototype.strikethrough=function(e){return e.replace(/([\W_]|^)~T~T(?=\S)([^\r]*?\S[\*_]*)~T~T([\W_]|$)/g,"$1<del>$2</del>$3")},b.Extra.prototype.newlines=function(e){return e.replace(/(<(?:br|\/li)>)?\n/g,function(e,t){return t?e:" <br>\n"})},t.exports=b.Extra},{}],10:[function(e,t,n){var r={weixin:{appid:_WIZ_CONFIG.weixin.appid,qrcode:{url:"https://open.weixin.qq.com/connect/qrconnect?appid=$1&redirect_uri=&2&response_type=code&scope=snsapi_login&state=$3#wechat_redirect"},bind:{url:_WIZ_CONFIG.url.as+"/wx/bind",action:"post"},autoLogin:{url:_WIZ_CONFIG.url.weixin+"/biz/refresh_token",action:"get"},smsCaptcha:{url:_WIZ_CONFIG.url.as+"/users/sms_captcha",action:"get"},mobileLogin:{url:_WIZ_CONFIG.url.weixin+"/biz/mobile_login",action:"post"},getUsage:{url:_WIZ_CONFIG.url.weixin+"/biz/usage",action:"get"},addUsage:{url:_WIZ_CONFIG.url.weixin+"/biz/usage",action:"post"},searchDocumentList:{url:_WIZ_CONFIG.url.weixin+"/biz/search",action:"get"}},user:{autoLogin:{url:_WIZ_CONFIG.url.ks+"/login",action:"post"},keepAlive:{url:_WIZ_CONFIG.url.as+"/users/ping",action:"post"},login:{url:"/api/login",action:"post"},logout:{url:"/api/logout",action:"post"},register:{url:_WIZ_CONFIG.url.as+"/users/signup",action:"post"},resetPassword:{url:_WIZ_CONFIG.url.as+"/users/reset_pwd",action:"post"},checkUserId:{url:_WIZ_CONFIG.url.as+"/users/is_pwd_set",action:"get"},userInfo:{url:_WIZ_CONFIG.url.as+"/users/get_info",action:"get"},changeUserId:{url:_WIZ_CONFIG.url.as+"/users/change_account",action:"post"},createBindOauth:{url:_WIZ_CONFIG.url.as+"/users/bind_wiz_account",action:"post"},updateUserInfo:{url:_WIZ_CONFIG.url.as+"/users/update_info",action:"post"},changePassword:{url:_WIZ_CONFIG.url.as+"/users/change_pwd",action:"post"},resendVerifyEmail:{url:_WIZ_CONFIG.url.as+"/users/resend_verify_email",action:"get"},verifyEmail:{url:_WIZ_CONFIG.url.as+"/users/verify_email",action:"get"},getInviteUserList:{url:_WIZ_CONFIG.url.as+"/users/get_invites",action:"get"},pay:{url:_WIZ_CONFIG.url.as+"/pay2/person",action:"post"},payByPoint:{url:_WIZ_CONFIG.url.as+"/pay/points",action:"get"},payByCard:{url:_WIZ_CONFIG.url.as+"/pay/card",action:"get"},validatePayCard:{url:_WIZ_CONFIG.url.as+"/pay/card/info",action:"get"},getPersonalPayLog:{url:_WIZ_CONFIG.url.as+"/pay/person/log?count=10",action:"get"},resetPasswordApply:{url:_WIZ_CONFIG.url.as+"/users/apply_reset_pwd",action:"get"}},biz:{bizInfo:{url:_WIZ_CONFIG.url.as+"/biz/info",action:"get"},extendTrial:{url:_WIZ_CONFIG.url.as+"/biz/extend_trial",action:"post"},createBiz:{url:_WIZ_CONFIG.url.as+"/biz/create",action:"post"},updateBiz:{url:_WIZ_CONFIG.url.as+"/biz/update",action:"post"},getBizList:{url:_WIZ_CONFIG.url.as+"/biz/user_bizs",action:"get"},addBizMember:{url:_WIZ_CONFIG.url.as+"/biz/add_users",action:"post"},updateBizMember:{url:_WIZ_CONFIG.url.as+"/biz/update_user",action:"post"},deleteBizMember:{url:_WIZ_CONFIG.url.as+"/biz/delete_users",action:"get"},getBizMemberList:{url:_WIZ_CONFIG.url.as+"/biz/get_users",action:"get"},getBizMemberListForAt:{url:_WIZ_CONFIG.url.ks+"/biz/user/list",action:"get"},finishBizGuide:{url:_WIZ_CONFIG.url.as+"/biz/init_biz",action:"get"},getPayPromote:{url:_WIZ_CONFIG.url.as+"/pay2/promo_code/get_info",action:"get"},getPromoOrdersLog:{url:_WIZ_CONFIG.url.as+"/pay2/promo_code/orders",action:"get"},getPayCoupon:{url:_WIZ_CONFIG.url.as+"/pay2/coupon/get_info",action:"get"},pay:{url:_WIZ_CONFIG.url.as+"/pay2/biz",action:"post"},getPayOrderInfo:{url:_WIZ_CONFIG.url.as+"/pay2/order",action:"get"},getBizPayLog:{url:_WIZ_CONFIG.url.as+"/pay/biz/log",action:"get"}},group:{createBizGroup:{url:_WIZ_CONFIG.url.as+"/groups/create",action:"post"},createPersonalGroup:{url:_WIZ_CONFIG.url.ks+"/user/createPersonalGroup",action:"post"},updateGroup:{url:_WIZ_CONFIG.url.as+"/groups/update",action:"post"},deleteGroup:{url:_WIZ_CONFIG.url.as+"/groups/delete",action:"get"},getBizGroupList:{url:_WIZ_CONFIG.url.as+"/groups",action:"get"},getAllGroupList:{url:_WIZ_CONFIG.url.as+"/groups",action:"get"},createDefaultDocument:{url:_WIZ_CONFIG.url.ks+"/document/createDefault",action:"get"},createGroupCategory:{url:_WIZ_CONFIG.url.ks+"/tag/items",action:"post"},getGroupMemberList:{url:_WIZ_CONFIG.url.as+"/groups/get_users",action:"get"},addGroupMember:{url:_WIZ_CONFIG.url.as+"/groups/add_users",action:"post"},deleteGroupMember:{url:_WIZ_CONFIG.url.as+"/groups/delete_users",action:"post"},groupStorage:{url:_WIZ_CONFIG.url.ks+"/kb/info",action:"get"},quitGroup:{url:_WIZ_CONFIG.url.as+"/groups/quit",action:"get"}},oauth:{bind:{sina:_WIZ_CONFIG.url.as+"/openid2/bind?st=sina",taobao:_WIZ_CONFIG.url.as+"/openid2/bind?st=taobao",qq:_WIZ_CONFIG.url.as+"/openid2/bind?st=qq",kuaipan:_WIZ_CONFIG.url.as+"/openid2/bind?st=kuaipan",renren:_WIZ_CONFIG.url.as+"/openid2/bind?st=renren"},unbind:{sina:{url:_WIZ_CONFIG.url.as+"/openid2/unbind?st=sina",action:"get"},taobao:{url:_WIZ_CONFIG.url.as+"/openid2/unbind?st=taobao",action:"get"},qq:{url:_WIZ_CONFIG.url.as+"/openid2/unbind?st=qq",action:"get"},weixin:{url:_WIZ_CONFIG.url.as+"/openid2/unbind?st=weixin",action:"get"},kuaipan:{url:_WIZ_CONFIG.url.as+"/openid2/unbind?st=kuaipan",action:"get"},renren:{url:_WIZ_CONFIG.url.as+"/openid2/unbind?st=renren",action:"get"}},login:{url:_WIZ_CONFIG.url.as+"/openid2/auth_code",action:"post"},signup:{url:_WIZ_CONFIG.url.as+"/openid2/oauth_signup",action:"post"}},doc:{getMessage:{url:"/wizmessage/messages",action:"get"},setMessageStatus:{url:"/wizmessage/messages/status",action:"post"},deleteMessage:{url:"/wizmessage/messages",action:"delete"},getAllCategory:{url:_WIZ_CONFIG.url.ks+"/category/all",action:"get"},addCategory:{url:_WIZ_CONFIG.url.ks+"/category/item",action:"post"},deleteCategory:{url:_WIZ_CONFIG.url.ks+"/category/item",action:"delete"},renameCategory:{url:_WIZ_CONFIG.url.ks+"/category/item",action:"put"},getAllTag:{url:_WIZ_CONFIG.url.ks+"/tag/all",action:"get"},addTag:{url:_WIZ_CONFIG.url.ks+"/tag/item",action:"post"},deleteTag:{url:_WIZ_CONFIG.url.ks+"/tag/item",action:"delete"},renameTag:{url:_WIZ_CONFIG.url.ks+"/tag/item",action:"put"},getDocumentList:{url:_WIZ_CONFIG.url.ks+"/document/list",action:"get"},getDocumentSummary:{url:"/wizsearch/abstract",action:"get"},getDocumentInfo:{url:_WIZ_CONFIG.url.ks+"/document/info",action:"get"},getDocumentData:{url:_WIZ_CONFIG.url.ks+"/document/body",action:"get"},createTmpDocument:{url:_WIZ_CONFIG.url.ks+"/document/data",action:"post"},updateDocument:{url:_WIZ_CONFIG.url.ks+"/document/data",action:"put"},deleteDocument:{url:_WIZ_CONFIG.url.ks+"/document/data",action:"delete"},getEditCounter:{url:_WIZ_CONFIG.url.ks+"/counter/get",action:"get"},addEditCounter:{url:_WIZ_CONFIG.url.ks+"/counter/add",action:"get"},deleteEditCounter:{url:_WIZ_CONFIG.url.ks+"/counter/delete",action:"get"},getHistory:{url:_WIZ_CONFIG.url.ks+"/document/history",action:"get"},getDeletedList:{url:_WIZ_CONFIG.url.ks+"/document/deleted_list",action:"get"},restoreHistory:{url:_WIZ_CONFIG.url.ks+"/document/restore",action:"get"},recycle:{url:_WIZ_CONFIG.url.ks+"/document/recycle",action:"get"},getAttachmentList:{url:_WIZ_CONFIG.url.ks+"/attachment/list",action:"get"},deleteAttachment:{url:_WIZ_CONFIG.url.ks+"/attachment/data",action:"delete"},attachmentUpload:{url:_WIZ_CONFIG.url.ks+"/attachment/data"},getCommentList:{url:_WIZ_CONFIG.url.ks+"/comment/list",action:"get"},getCommentCount:{url:_WIZ_CONFIG.url.ks+"/comment/count",action:"get"},createComment:{url:_WIZ_CONFIG.url.ks+"/comment/create",action:"post"},deleteComment:{url:_WIZ_CONFIG.url.ks+"/comment/delete",action:"post"}},share:{cancel:{url:"/share/api/shares/$1",action:"delete"},create:{url:"/share/api/shares",action:"post"},update:{url:"/share/api/shares/$1",action:"put"},getMyShare:{url:"/share/api/shares",action:"get"}},weibo:{bind:{url:_WIZ_CONFIG.url.as+"/weibo_fans/bind",action:"post"}}};t.exports=r},{}],11:[function(e,t,n){var r={"wizBox-20150504":{startDate:new Date(2015,4,4),endDate:new Date(2015,5,5),url:"/pages/poster/wizBox-20150504/index.html"}};t.exports=r},{}],12:[function(e,t,n){var r=wizUI.util.getLocale(),o=(new Date).valueOf(),i={libs:{githubCss:"/libs/component/pagedown/github2.f957e500.css",prettifyJs:"/libs/component/pagedown/prettify.83028912.js",mathJax:location.protocol+"//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"},common:{bizLogin:"/pages/login.html",login:_WIZ_CONFIG.url.login,captchaImg:_WIZ_CONFIG.url.as+"/captcha/",resetPasswordApply:"/pages/manage/person/reset_pwd_apply.html",noteFullScreen:"/pages/wiz-flat-doc.html",noteFullScreenForMobile:"/pages-mobile/wiz-flat-doc.html",appDownload:_WIZ_CONFIG.url.website+"/download.html",invitedURL:"https://note.wiz.cn/i/",shareURL:"http://fromwiz.com/share/s/",zeroclipboardSwf:"/libs/component/zeroclipboard/zeroclipboard.92440710.swf"},user:{iconBase:_WIZ_CONFIG.url.as+"/users/avatar/",note:_WIZ_CONFIG.url.wizNote,noteGroupList:_WIZ_CONFIG.url.wizNote+"?gidx=1",account_setting:"/pages/manage/person/account.html?p=setting",inviteFriend:"/pages/manage/person/account.html?p=invite",vipPrice:"/pages/manage/person/account.html?p=vip",userPay:"/pages/manage/biz/userPay.html",payData:"/libs/wizData/"+r+"/userpay.json?"+o,oauth:"/pages/manage/person/oauth.html",oauthAPI:_WIZ_CONFIG.url.as+"/openid2/bind",bdshareUrl:_WIZ_CONFIG.url.website},personal:{groupCreate:"/pages/manage/biz/personalGroupCreate.html",groupManage:"/pages/manage/biz/personalGroupManage.html",helpDoc:_WIZ_CONFIG.url.website+"/manual/web"},biz:{guideData:"/libs/wizData/"+r+"/bizTypeData.json?"+o,authIntroData:"/libs/wizData/"+r+"/authIntro.json?"+o,guide:"/pages/manage/biz/bizGuide.html",helpDoc:_WIZ_CONFIG.url.website+"/manual/web/teamwork-web.html",manage:"/pages/manage/biz/bizManage.html",groupCreate:"/pages/manage/biz/bizGroupCreate.html",groupManage:"/pages/manage/biz/bizGroupManage.html",payData:"/libs/wizData/"+r+"/bizpay.json?"+o,pay:"/pages/manage/biz/bizPay.html",extendTrial:"/pages/manage/biz/extendTrial.html",oemManage:"/manage_console"},doc:{history:"/pages/manage/doc/history.html"},note_mobile:{main:"/pages-mobile/wiz-flat.html",docInfo:"/pages-mobile/wiz-flat-doc.html"},wx:{main:"/pages-mobile/weixin/index.html",docInfo:"/pages-mobile/weixin/doc.html"},pay:{aliPay:"https://mapi.alipay.com/gateway.do",payPal:"https://www.sandbox.paypal.com/cgi-bin/webscr?cmd=_express-checkout&useraction=commit",paySuccess:"/pages/manage/biz/paySuccess.html"},biz_mobile:{guide:"/pages-mobile/manage/biz/bizGuide.html",manage:"/pages-mobile/manage/biz/bizManage.html",groupCreate:"/pages-mobile/manage/biz/bizGroupCreate.html",groupManage:"/pages-mobile/manage/biz/bizGroupManage.html"},blogInfo:{userVip:"http://blog.wiz.cn/wiz-vip.html",userPoint:"http://blog.wiz.cn/user_points.html",userLevel:"http://blog.wiz.cn/user_level.html",bizUpgradeInfo:"http://blog.wiz.cn/wiznote-biz-pricing.html",mywizEmailInfo:"http://blog.wiz.cn/wiz-mywiz.html",weiboBindUser:"http://blog.wiz.cn/ios-weibo-collection.html",weixinBindUser:"http://blog.wiz.cn/ios-wechat-collection.html",wizBizTerm:"http://blog.wiz.cn/wiz-service.html",wizBizPromo:"http://blog.wiz.cn/pay-promo.html",payProblem:"http://blog.wiz.cn/pay-more.html",payProblemVIP:"http://blog.wiz.cn/pay-more-vip.html",support:"http://www.wiz.cn/support.html",wizTeamRoleAuth:"http://blog.wiz.cn/team-role-auth.html",fuckIE:"http://blog.wiz.cn/ieupdate.html",tel:"tel:4008258085",commentMarkdown:"http://blog.wiz.cn/wiz-comment-markdown.html",usePromoCode:"http://blog.wiz.cn/pay-promo.html"},download:{Windows:"http://misc.wiz.cn/download?product=wiznote&client=windows-x86",Mac:"https://itunes.apple.com/cn/app/wiznote/id863771545?l=zh&ls=1&mt=12",Linux:"http://blog.wiz.cn/downloads-mac-linux.html","default":"https://note.wiz.cn/login"},other:{wizWeibo:"http://weibo.com/wiz2011"}};t.exports=i},{}],13:[function(e,t,n){var r=e("./api"),o=e("./url"),i=e("./poster"),a=_WIZ_CONFIG.oem.getData("CustomInfo"),s={companyInfo:{hotline:a?a.customer_hotline:"400-825-8085"},event:{},style:{wizWebFlat:"wizWebFlat",wizWebFlatMobile:"wizWebFlatMobile",wizWebFlatDoc:"wizWebFlatDoc",wizWeixin:"wizWeixin",clientComment:"clientComment",resetPassword:"wizResetPassword",myShare:"wizMyShare",myShareSetting:"wizMyShareSetting",account:"account",docHistory:"docHistory",docRecycle:"docRecycle",oauth:"oauth",bindWeibo:"bindWeibo",bizLogin:"bizLogin",bizGuide:"bizGuide",bizManage:"bizManage",bizPay:"bizPay",groupCreate:"groupCreate",personalGroupCreate:"personalGroupCreate",personalGroupManage:"personalGroupManage",bizGroupCreate:"bizGroupCreate",bizGroupManage:"bizGroupManage"},clientType:"webFrame",note:{initDoc:{body:'<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8">$1</head><body>$2</body></html>',cssId:"wiz_custom_css",cssForEdit:"html, body {height: 100%;margin: 0;-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;}html {padding: 0;} body{padding: 8px;}",css:'body{font-family: "Microsoft YaHei UI","Microsoft YaHei",SimSun,"Segoe UI",Tahoma,Helvetica,Sans-Serif,"Microsoft YaHei", Georgia,Helvetica,Arial,sans-serif,宋体, PMingLiU,serif;font-size: 10.5pt;line-height: 1.5;}html, body {}h1, h2, h3, h4, h5, h6 {font-weight:bold;}h1 {font-size:1.5em;}h2 {font-size:1.4em;}h3 {font-size:1.3em;}h4 {font-size:1.2em;}h5 {font-size:1.1em;}h6 {font-size:1.0em;}img {border:0;max-width: 100%;}blockquote {margin-top:0px;margin-bottom:0px;}table {border-collapse:collapse;border:1px solid #bbbbbb;}td {border-collapse:collapse;border:1px solid #bbbbbb;}'},autoSave:3e3,maxFileSize:_WIZ_CONFIG.oem.getData("Web_MaxFileSize")||5,pay:{wizRemittanceAccount:"0200003809068098972",vipPoints:1e3},kb:{personal:"personal",myGroup:"myGroup",bizGroup:"bizGroup",msg:"message"},msgType:{all:"-",at:0,commented:10,modified:1,unRead:"-r"},menuType:{messageCenter:"messageCenter",lastModify:"lastModify",search:"search",category:"category",tag:"tag",myShare:"myShare"},menuCmd:{create:"create",noTag:"noTag"},docListTypeParams:{keyword:"kw",category:"ca",tag:"tg",noTag:"ntg",msg:"msg",myShare:"myShare"},docListType:{Msg:"msg",msg:"msg",Search:"keyword",kw:"keyword",Category:"category",ca:"category",Tag:"tag",tg:"tag",NoTag:"noTag",ntg:"noTag",myShare:"myShare"},emptyType:{msgUnReadIsEmpty:"msgUnReadIsEmpty",msgIsEmpty:"msgIsEmpty",docLastIsEmpty:"docLastIsEmpty",docSearchIsEmpty:"docSearchIsEmpty",docCategoryIsEmpty:"docCategoryIsEmpty",docTagIsEmpty:"docTagIsEmpty",docNotFound:"docNotFound"},share:{limitValue:{days:7,times:300},limitRange:{days:{max:1e3,min:1},times:{min:1,max:1e3}},weibo:{appkey:3957573307,ralateUid:1920682763,title:"Hi，我分享了一篇文章 “$1”，来看看吧！"}}},authority:{biz:{nameList:["owner","admin","user"],codeList:[0,10,1e3],0:"owner",10:"admin",100:"hr",1000:"user",10000:"guest",owner:0,admin:10,hr:100,user:1e3,guest:1e4,defaultCode:1e3},group:{nameList:["admin","super","editor","author","reader"],codeList:[0,10,50,100,1e3],0:"admin",10:"super",50:"editor",100:"author",1000:"reader",admin:0,"super":10,editor:50,author:100,reader:1e3,defaultCode:50}},memberMaxCount:{biz:{0:10,1:10,2:1/0,3:1/0}},groupMaxCount:{biz:{maxLevel:_WIZ_CONFIG.oem.getData("MaxBizLevel")||3,0:_WIZ_CONFIG.oem.getData("MaxGroupCount_Biz0")||2,1:_WIZ_CONFIG.oem.getData("MaxGroupCount_Biz1")||5,2:_WIZ_CONFIG.oem.getData("MaxGroupCount_Biz2")||10,3:_WIZ_CONFIG.oem.getData("MaxGroupCount_Biz3")||1/0},personal:{free:_WIZ_CONFIG.oem.getData("MaxGroupCount_PersonFree")||2,vip:_WIZ_CONFIG.oem.getData("MaxGroupCount_PersonVip")||5}},comment:{maxLetterCount:1500},pageFrame:{account:{setting:"setting",vip:"vip",invite:"invite",sns:"sns"},accountVip:{points:"points",vipCard:"vipCard"},recycle:{doc:"doc",attachment:"attachment"},oauth:{success:"wiznote_oauth_success",fail:"fail",nobind:"nobind",bind:"bind",create:"create",login:"login"},biz:{groupList:"grouplist",memberList:"memberlist",bizInfo:"bizinfo",payment:"payment"}},modelStamp:{MessageList:"MessageList",DocMessageList:"docMessageList",LeftCategoryTree:"leftCategoryTree",LeftTagPTree:"leftTagPTree",LeftTagGTree:"leftTagGTree",DocSummaryList:"docSummaryList",DocInfo:"docInfo",DocTagName:"docTagName",DocComment:"docComment",DocAttachment:"docAttachment",DocEditTagTree:"editTagTree",DocEditCategoryTree:"editCategoryTree",DocEditAllTags:"editAllTags",DocEditTagName:"editTagName",BizUserListForAt:"BizUserListForAt"},sysMsg:{Type:{Error:"error",Warning:"warning",Success:"success"}},confirm:{Space:5,Type:{UpLeft:"up-left",DownLeft:"down-left",LeftUp:"left-up",RightUp:"right-up",UpRight:"up-right",DownRight:"down-right",LeftDown:"left-down",RightDown:"right-down"}},pointType:{create_biz:"createBiz",login_web:"loginFirst",login_pc:"loginFirst",sync_daily:"syncDaily",pay_first:"payFirst",invite_verify_email:"invitedUserVerifyEmail",invite_signup:"inviteUser",manual:"manual"},globalTimer:300,dataOperateType:{GetBizMessage:"d_getBizMessage",SetBizMessageStatus:"d_setBizMessageStatus",DeleteBizMessage:"d_deleteBizMessage",MarkAllReadStatus:"d_markAllReadStatus",GetCategory:"d_getCategory",AddCategory:"d_addCategory",RenameCategory:"d_renameCategory",DeleteCategory:"d_deleteCategory",GetTags:"d_getTags",AddTag:"d_addTag",RenameTag:"d_renameTag",DeleteTag:"d_deleteTag",GetDocumentList:"d_getDocumentList",GetDocumentSummary:"d_getDocumentSummary",GetDocument:"d_getDocument",CreateDocument:"d_createDocument",SaveDocument:"d_saveDocument",DeleteDocument:"d_deleteDocument",CreateDefaultDocument:"d_createDefaultDocument",CreateGroupCategory:"d_createGroupCategory",GetEditCount:"d_getEditCount",AddEditCount:"d_addEditCount",DeleteEditCount:"d_deleteEditCount",GetAttachment:"d_getAttachment",DeleteAttachment:"d_deleteAttachment",GetCommentList:"wiz_getCommentList",AddComment:"wiz_addComment",DeleteComment:"wiz_deleteComment",GetDocumentHistory:"d_getDocumentHistory",RestoreDocumentHistory:"d_restoreDocumentHistory",GetDocumentBody:"d_getDocumentBody",GetDocumentDeleted:"d_getDocumentDeleted",GetAttachmentDeleted:"d_getAttachmentDeleted",RecycleDeleted:"d_recycleDeleted",CancelShareDocument:"d_cancelShareDocument",CreateShareDocument:"d_createShareDocument",UpdateShareDocument:"d_updateShareDocument",GetMyShareDocuments:"d_getMyShareDocuments",GetMyShareByDocGuid:"d_getMyShareByDocGuid",CreateBizInfo:"d_createBizInfo",UpdateBizInfo:"d_updateBizInfo",OnUpdateBizInfo:"on_d_updateBizInfo",AddBizMember:"d_addBizMember",OnAddBizMember:"on_d_addBizMember",DeleteBizMember:"d_deleteBizMember",UpdateBizMember:"d_updateBizMember",OnUpdateBizMember:"on_d_updateBizMember",GetBizMemberList:"d_getBizMemberList",GetBizPromoteInfo:"d_getBizPromoteInfo",GetPromoOrdersLog:"d_getPromoOrdersLog",GetBizCouponInfo:"d_getBizCouponInfo",GetBizMemberListForAt:"d_getBizMemberListForAt",BizPay:"d_bizPay",GetBizPayLog:"d_getBizPayLog",GetBizGroupList:"d_getBizGroupList",CreateBizGroup:"d_createBizGroup",CreatePersonalGroup:"d_createPersonalGroup",OnCreateBizGroup:"on_d_createBizGroup",OnCreateBizGroupToGroupManage:"on_d_createBizGroupToGroupManage",OnCreateBizGroupToBizManage:"on_d_crateBizGroupToGroupManage",DeleteGroup:"d_deleteBizGroup",OnDeleteGroup:"on_d_deleteBizGroup",UpdateGroup:"d_updateGroup",OnUpdateGroup:"on_d_updateGroup",AddGroupMember:"d_addGroupMember",DeleteGroupMember:"d_deleteGroupMember",OnUpdateGroupMember:"on_d_updateGroupMember",UpdateGroupMemberRole:"d_updateGroupMemberRole",OnUpdateGroupMemberRole:"on_d_updateGroupMemberRole",GetGroupMemberList:"d_getGroupMemberList",GetGroupMemberListWithAll:"d_getGroupMemberListWithAll",GetGroupStorage:"d_getGroupStorage",QuitGroup:"d_quitGroup",OnQuitGroup:"on_d_quitGroup",ResetPasswordApply:"d_resetPasswordApply",ResetPassword:"d_resetPassword",ResendVerifyEmail:"d_resendVerifyEmail",
PersonalPayByPoint:"d_payByPoint",PersonalPayByCard:"d_payByCard",ValidatePersonalPayCard:"d_validatePayCard",GetPersonalPayLog:"d_getPersonPayLog",GetInviteUserList:"d_getInviteUserList",UpdateUserInfo:"d_updateUserInfo",ChangeUserId:"d_changeUserId",ChangePassword:"d_changePassword",CreateBindOauth:"d_createBindOauth",BindSNS:"d_bindSNS",UnBindSNS:"d_unbindSNS",UserPay:"d_userPay",OauthLogin:"d_oauthLogin",OauthBind:"d_oauthBind",OauthCreate:"d_oauthCreate",OauthAutoCreate:"d_oauthAutoCreate",WeiboFansBind:"d_weiboFansBind"},frameEventType:{EventManager:"wiz_eventManager",ForceClientRefresh:"forceClientRefresh",HideMainLoading:"wiz_hideMainLoadingMask",ShowWizFrame:"wiz_showWizFrame",ShowWizModal:"wiz_showWizModal",HideWizModal:"wiz_hideWizModal",ShowWizConfirm:"wiz_showWizConfirm",HideWizConfirm:"wiz_hideWizConfirm",ShowSidebar:"wiz_showSidebar",HideSidebar:"wiz_hideSidebar",ShowFullGroup:"wiz_showFullGroup",HideFullGroup:"wiz_hideFullGroup",MenuExpand:"wiz_menuExpand",MenuCollapse:"wiz_menuCollapse",SwitchKb:"wiz_switchKb",SwitchMsgCenter:"wiz_switchMsgCenter",ResetMenuTree:"wiz_resetMenuTree",AddCategoryAndTagMenuTree:"wiz_addCategoryAndTagMenuTree",RenameCategoryAndTagMenuTree:"wiz_renameCategoryAndTagMenuTree",RemoveCategoryAndTagMenuTree:"wiz_removeCategoryAndTagMenuTree",CreateTagFromDocView:"wiz_createTagFromDocView",ShowMsgDocList:"wiz_showMsgDocList",ShowDocument:"wiz_showDocument",EditDocument:"wiz_editDocument",RemoveDocument:"wiz_removeDocument",UpdateDocument:"wiz_updateDocument",SaveDocument:"wiz_saveDocument",AutoSaveDocument:"wiz_autoSaveDocument",ShowEmptyInfo:"wiz_showEmptyInfo",ShowMsgList:"wiz_showMsgList",UpdateMsgList:"wiz_updateMsgList",ShowGroupIndex:"wiz_showGroupIndex",HideGroupList:"wiz_hideGroupList",ShowDocList:"wiz_showDocList",ShowSearch:"wiz_showSearch",ShowMyShare:"wiz_showMyShare",FrameResizeTrigger:"wiz_frameResizeTrigger",FrameResize:"frameResize",UpdateShareDocument:"wiz_updateShareDocument",ShowAccountSetting:"wiz_showAccountSetting",ShowAccountVip:"wiz_showAccountVip",ShowAccountInvite:"wiz_showAccountInvite",ShowAccountSns:"wiz_showAccountSns",ShowCreateBindModal:"wiz_showCreateBindModal",ShowRecycleDoc:"wiz_showRecycleDoc",ShowRecycleAttachment:"wiz_showRecycleAttachment",ShowOauthSuccess:"wiz_showOauthSuccess",ShowOauthFail:"wiz_showOauthFail",ShowOauthNoBind:"wiz_showOauthNoBind",ShowOauthBind:"wiz_showOauthBind",ShowOauthCreate:"wiz_showOauthCreate",GuideStep:"wiz_guideStep",ShowStepLoading:"wiz_guideShowStepLoading",HideStepLoading:"wiz_guideHideStepLoading",ShowOnlyAuthTip:"wiz_onlyAuthTip",SwitchBiz:"wiz_switchBiz",ShowGroupList:"wiz_showGroupList",ShowBizMemberList:"wiz_showBizMemberList",ShowBizInfo:"wiz_showBizInfo",ShowPayment:"wiz_showPayment",ShowCreateGroup:"wiz_showCreateGroup",HideCreateGroup:"wiz_hideCreateGroup",ShowGroupMemberList:"wiz_showGroupMemberList",HideGroupMemberList:"wiz_hideGroupMemberList",ShowAddGroupMember:"wiz_showAddGroupMember",HideAddGroupMember:"wiz_hideAddGroupMember",ShowMemberCharacter:"wiz_showMemberCharacter",HideMemberCharacter:"wiz_hideMemberCharacter",ShowBizMemberAssign:"wiz_showBizMemberAssign",HideBizMemberAssign:"wiz_hideBizMemberAssign",ShowAuthList:"wiz_showAuthList",HideAuthList:"wiz_hideAuthList",AddGroup:"wiz_addGroup",AddBizMember:"wiz_addBizMember"}},u={CLIENT_TYPE:"web2.0",API_VERSION:4,KEEP_ALIVE_TIME_MS:27e4,AUTO_LOGIN_RETRY:3,GET_USER_INFO_RETRY:3},l={loadingWait:300,documentListAuto:18e4,messageListAuto:3e4,commentListAuto:3e4,editCountAuto:6e4,localStorageTimeout:144e5,clientCommentTimeout:6048e5,notifyWait:1e4},c={bound:13897608e5},d={click:"touchend"},g={click:"click"};s.pcEvent=g,s.mobileEvent=d,s.event=g,t.exports={api:r,remote:u,baseModel:l,url:o,poster:i,web:s,emailVerify:c}},{"./api":10,"./poster":11,"./url":12}],14:[function(e,t,n){var r=e("../mvc/controller/webFlatController");r.init()},{"../mvc/controller/webFlatController":16}],15:[function(e,t,n){function r(){return"undefined"==typeof wiz_browser_check}var o=e("locale"),i=e("../util/Class"),a=e("../util/GlobalUtil"),s=e("../../config/wizConf"),u=e("../database/wizCenter"),l=e("../viewer-common/urlOperator");window.Wiz=window.Wiz||{};var c=wizUI.util.getCookieOptions(),d=i.extend({init:function(){l.init(),wizUI.isPcClient&&$(document.body).removeClass("flat-scrollbar"),this.bindClientOpenURL($(document),null)},libs:{locale:o,util:a,wizConf:s,wizCenter:u},views:{groupList:null,user:null},models:{base:null,user:null,groupList:null,userList:null},wizInit:function(){if(r()){var t=_WIZ_CONFIG.oem.getData("LogoConfig")?_WIZ_CONFIG.oem.getData("LogoConfig"):null;t&&t.enable?$("img.logo-oem-common").attr({src:t.common}).removeClass("hide"):($(".logo.wiz-white").removeClass("hide"),$(".logo.wiz-grey").removeClass("hide")),a.renderLanguage(o),u.token=wizUI.util.cookie("token"),this.models.base=e("../model/BaseModel"),this.models.base.setController(this),this.globalTimer=e("../util/globalTimer"),this.globalEvent=e("../util/globalEvent"),this.sysMsg=new wizUI.SysMsg({ctn:$("#sys-msg-ctn"),itemTemplate:$("#sys-msg-item-tmpl").html(),max:3}),window.sysMsg=this.sysMsg}},initBackgroundData:function(){this.initPage()},initPage:function(){wizUI.Modal.init(),this.views.confirm=new wizUI.Confirm({okBtn:o.common.label.confirm,cancelBtn:o.common.label.cancel}),this.views.header=e("../viewer-common/header"),this.views.header.init(this),this.views.loading=e("../viewer-common/loading"),this.views.loading.init(this),$(document).trigger(s.web.frameEventType.EventManager,[s.web.frameEventType.HideMainLoading])},clearTokenCookie:function(){wizUI.util.cookie("token",null),wizUI.util.cookie("token",null,c)},clearCertNoCookie:function(){wizUI.util.cookie("CertNo",null),wizUI.util.cookie("CertNo",null,c)},clearCookie:function(){this.clearTokenCookie(),this.clearCertNoCookie()},logoff:function(){var e=this;this.models.user.logout({},function(){var t=s.url.common.login+"?p=login";e.clearCookie(),e.getWinRoot().location.href=t})},reLogin:function(e){e=e||{},u.checkToken()&&this.clearCookie();var t=e.userId?"&user_id="+encodeURIComponent(e.userId):"",n=this.getWinRoot();n.location.href=s.url.common.login+"?p=login&redirectUrl="+encodeURIComponent(n.location.href)+t},getWinRoot:function(){var e=window;try{for(;e.parent!==e;)e=e.parent}catch(t){}return e},showSetting:function(e,t){e&&(t=t||{},window.open(this.libs.util.addParamsToUrl(e,t)))},initBizExpired:function(e){function t(e){return Math.ceil((e-new Date)/864e5)}var n;n=t(e.due_date),e.expired=0>=n,e.expiredDay=n,document._initBizExpired||($(document).on("click",".wizExtendTrial",function(e){var t=$(e.target);location.href=t.attr("data-url")}),document._initBizExpired=!0)},alertBizExpired:function(e,t){function n(e){var t=e.biz_name;return t.length<20?t:t.substr(0,5)+"..."+t.substr(t.length-5)}function r(e,r){var i=0>=r,s=e.biz_level,u={msg:"",auto:1e4};return u.msg=0!==s||i?0===s&&i?o.bizInfo.expired.bizFree+a.getExtendTrialHtml(e,o):i?o.bizInfo.expired.bizVip:o.bizInfo.expired.bizVipSoon:o.bizInfo.expired.bizFreeSoon+a.getExtendTrialHtml(e,o),t&&(u.msg="["+n(e)+"] "+u.msg),-3>r&&(u.showRnd=[100,20]),u}var i=e?e.expiredDay:1/0,s=7;s>=i&&this.showWarningMessage(r(e,i))},checkBizExpired:function(e){if(e&&e.expired){var t=0===e.biz_level?a.getExtendTrialHtml(e,o):"";return this.showWarningMessage({msg:o.bizInfo.expired.warning+t,auto:1e4}),!1}return!0},getBizGuid:function(){var e=u.bizInfo?u.bizInfo.biz_guid:null;return e=e||wizUI.util.getUrlParam("biz")||""},goGuide:function(e){var t={biz:e?"":this.getBizGuid()};wizUI.isAppStore&&(t.appstore=1),window.location=wizUI.util.setUrlParams(s.url.biz.guide,t)},goVip:function(){var e={biz:this.getBizGuid(),p:"payment"};wizUI.isAppStore&&(e.appstore=1),window.location=wizUI.util.setUrlParams(s.url.biz.manage,e)},goManage:function(){var e={};wizUI.isWizClient||wizUI.isWizWebClient?(e.biz=this.getBizGuid(),wizUI.isAppStore&&(e.appstore=1),window.location=wizUI.util.setUrlParams(s.url.biz.manage,e)):(e.mod="bizmanager",u.groupList&&u.groupList.length&&u.groupList[0]&&(e.kb=u.groupList[0].kbGuid),window.location=wizUI.util.setUrlParams(s.url.user.note,e))},confirmMessage:function(e,t){var n=e.type||s.web.sysMsg.Type.Warning;e.header=o.common.label[n],this.views.confirm.show(e,t)},showErrorMessage:function(e){e.type=s.web.sysMsg.Type.Error,e.showDrop=!0,this.sysMsg.addMsg(e)},showWarningMessage:function(e){e.type=s.web.sysMsg.Type.Warning,e.showDrop=!0,this.sysMsg.addMsg(e)},showSuccessMessage:function(e){e.type=s.web.sysMsg.Type.Success,e.showDrop=!0,this.sysMsg.addMsg(e)},wizStyle:function(){},initBlogLink:function(){var e,t,n,r=$(".blogInfoLink");for(e=0,t=r.length;t>e;e++)n=r.get(e),n.href=s.url.blogInfo[n.getAttribute("data-blog")]},bindClientOpenURL:function(e,t){function n(e){var t=$(e.currentTarget),n=t.attr("href")||"";/^wiz:/.test(n)&&(wizUI.util.openWizLink(a.parseWizLink(n,!1)),wizUI.util.stopBubble(e),wizUI.util.stopDefault(e))}function r(e){var n=$(e.currentTarget),r=n.attr("href")||"";if(r&&r.indexOf("javascript:")<0&&0!==r.indexOf("#")){if(location.origin||(location.origin=location.protocol+"//"+location.host),0===r.indexOf("/")?r=location.origin+r:r.indexOf("wiz")<0&&r.indexOf("http")<0&&r.indexOf("https")<0&&r.indexOf("mailto:")<0&&(r=location.origin+location.pathname+"/"+r),/^(http|https|wiz|wiznote):/.test(r)&&"_blank"!==n.attr("target")&&"_blank"!==t)return;/^(wiz|wiznote):/.test(r)?wizUI.util.openWizLink(wizUI.isWizClient?r:a.parseWizLink(r,!1)):window.open(r),wizUI.util.stopBubble(e),wizUI.util.stopDefault(e)}}wizUI.isWizClient||wizUI.isWizWebClient?e.find("body").on("click","a",r):e.find("body").on("click","a",n),this.unbindClientOpenURL=function(e){e.find("body").off("click","a",r)}}});t.exports=d},{"../../config/wizConf":13,"../database/wizCenter":18,"../model/BaseModel":21,"../util/Class":34,"../util/GlobalUtil":35,"../util/globalEvent":37,"../util/globalTimer":38,"../viewer-common/header":43,"../viewer-common/loading":44,"../viewer-common/urlOperator":46,locale:"locale"}],16:[function(e,t,n){var r,o=e("locale"),i=e("./baseController"),a=e("../../config/wizConf"),s=e("../database/wizCenter"),u=e("../viewer-common/urlOperator"),l=e("../database/remote"),c=e("../util/eventproxy"),d=i.extend({wizStyle:function(){return this.libs.wizConf.web.style.wizWebFlat},wizInit:function(){this._super.apply(this,arguments),l.init(this),window.Wiz.token=s.token;var e=this;r=c.create("initUser","initBiz",function(t,n){e.initGroupList(t,n)}),this.initUser(),this.initBiz()},initUser:function(){var t=this;this.models.user=e("../model/UserInfo"),this.models.user.getBase({},"wizInitUser",function(e){if(!e)return void t.tokenInvalid();var n=wizUI.util.getUrlParam("user_id");return n&&e.user_id.toLowerCase()!=n.toLowerCase()?void t.reLogin({userId:n}):(wizUI.util.cookie("isinvited",null,wizUI.util.getCookieOptions()),t.models.user.keepAlive(),void r.emit("initUser",e))})},initBiz:function(){var t=this;this.models.bizInfo=e("../model/BizInfo"),this.models.bizInfo.getBizList(function(e){if(!e||0===e.length)return void r.emit("initBiz",null);var n,o,i;for(s.isBizUser=e.length>0,n=0,o=e.length;o>n;n++)i=e[n],i.user_group==a.web.authority.biz.owner?(s.biz.owner=i,t.initBizExpired(i)):i.user_group==a.web.authority.biz.admin?(s.biz.manageList.push(i),t.initBizExpired(i)):s.biz.memberList.push(i);r.emit("initBiz",null)})},initGroupList:function(t,n){var r=this;this.models.groupInfo=e("../model/GroupInfo"),this.models.groupInfo.getAllGroupList(function(e){return e?void r.initBackgroundData(t):void setTimeout(function(){r.reLogin()},2e3)})},initBackgroundData:function(t){s.init({user:t,personalKb:{kbGuid:t.kb_guid,kbName:o.docMenu.label.myNotes,kbType:a.web.note.kb.personal}}),this.models.authority=e("../model/Authority"),this.models.msg=e("../model/Message"),this.models.category=e("../model/Category"),this.models.tag=e("../model/Tag"),this.models.docList=e("../model/DocumentList"),this.models.doc=e("../model/Document"),this.models.attachment=e("../model/Attachment"),this.models.comment=e("../model/Comment"),this.models.docSummary=e("../model/DocumentSummary"),this.models.bizMemberListForAt=e("../model/BizMemberListForAt"),this._super.apply(this,arguments)},initPage:function(){this.views.menuTreeTools=e("../viewer/note/menuTreeTools"),this.views.menuTreeTools.setController(this),this.views.pageFrame=e("../viewer/note/pageFrame"),this.views.pageFrame.init(this),this.views.wizFrame=e("../viewer-common/wizFrame"),this.views.wizFrame.init(this),this.views.noteHeader=e("../viewer/note/header"),this.views.noteHeader.init(this),this.views.groupIndex=e("../viewer/note/groupIndex"),this.views.groupIndex.init(this),this.views.sidebar=e("../viewer/note/sidebar"),this.views.sidebar.init(this),this.views.menuTree=e("../viewer/note/menuTree"),this.views.menuTree.init(this),this.views.docList=e("../viewer/note/docList"),this.views.docList.init(this),this.views.myShareList=e("../viewer/note/myShareList"),this.views.myShareList.init(this),this.views.docView=e("../viewer/note/docView"),this.views.docView.init(this),this.views.docEditor=e("../viewer/note/docEditor"),this.views.docEditor.init(this),this.views.poster=e("../viewer-common/poster"),this.views.poster.init(this),this.beforeWinCloseHandler();var t=this;this.libs.urlOperator=u,this.libs.urlOperator.setAnalyticsFrame(function(){t.analyticsFrame()}).trigger(),this._super.apply(this,arguments),setTimeout(function(){t.alertBizExpired.apply(t,[s.biz.owner,!0]);var e,n,r;for(e=0,n=s.biz.manageList.length;n>e;e++)r=s.biz.manageList[e],t.alertBizExpired.apply(t,[r,!0])},3e3)},analyticsFrame:function(){this.onCheckDocChangedHandler(function(e){if(e){var t,n,r,o,i,s,l=$("body"),c=location.hash||location.search;c=c.replace(/\?|#/,"&"),t=wizUI.util.getUrlParam("gidx",c),l.trigger(a.web.frameEventType.EventManager,[t?a.web.frameEventType.ShowFullGroup:a.web.frameEventType.HideFullGroup]),n=wizUI.util.getUrlParam("kb",c),i=wizUI.util.getUrlParam("dc",c),s=wizUI.util.getUrlParam("mod",c),s&&(u.push({mod:null}),"bizmanager"===s&&l.trigger(a.web.frameEventType.EventManager,[a.web.frameEventType.ShowWizFrame,{url:a.url.biz.manage}])),o={},r=wizUI.util.getUrlParam("cmd",c),r&&(r=r.split(","),o={action_cmd:r[0],action_value:r[1],doc_guid:i,fromUrl:!0}),l.trigger(a.web.frameEventType.EventManager,[a.web.frameEventType.SwitchKb,n,o])}})},onCheckDocChangedHandler:function(e){s.noteCur.editFlag&&s.checkCurDocChanged(this.views.docView.getEditingDocument())&&this.views.docView.saveDocument(),e(!0)},beforeWinCloseHandler:function(){var e=this;window.onbeforeunload=function(t){s.noteCur.editFlag&&s.checkCurDocChanged(e.views.docView.getEditingDocument())&&(t=t||window.event,t.returnValue=o.docDocument.label.unSaveConfirmForAlert)}},tokenInvalid:function(){var e=3e3;wizUI.util.cookie("token")&&(e=30,this.showErrorMessage({msg:o.common.err.tokenInvalid,auto:-1}));var t=this;setTimeout(function(){t.reLogin.apply(t)},e)}}),g=new d;t.exports={init:function(){g.wizInit()}}},{"../../config/wizConf":13,"../database/remote":17,"../database/wizCenter":18,"../model/Attachment":19,"../model/Authority":20,"../model/BizInfo":22,"../model/BizMemberListForAt":23,"../model/Category":25,"../model/Comment":26,"../model/Document":27,"../model/DocumentList":28,"../model/DocumentSummary":29,"../model/GroupInfo":30,"../model/Message":31,"../model/Tag":32,"../model/UserInfo":33,"../util/eventproxy":36,"../viewer-common/poster":45,"../viewer-common/urlOperator":46,"../viewer-common/wizFrame":47,"../viewer/note/docEditor":48,"../viewer/note/docList":50,"../viewer/note/docView":51,"../viewer/note/groupIndex":54,"../viewer/note/header":55,"../viewer/note/menuTree":57,"../viewer/note/menuTreeTools":58,"../viewer/note/myShareList":59,"../viewer/note/pageFrame":60,"../viewer/note/sidebar":61,"./baseController":15,locale:"locale"}],17:[function(e,t,n){function r(e,t,n,i,a){if(t){if(!e||!e.url||!e.action)return void(console&&console.error("remote.sendRequest apiObj: "+e.url+"-"+e.action+" Error"));i||(i=function(){g&&g.showErrorMessage({msg:s.noteCur.editFlag?l.common.err.serverEditing:l.common.err.server,auto:-1})});var d=function(o){c=!1,"string"==typeof o?o="success"==o?{code:200}:null:wizUI.util.isArray(o)||o&&!o.code&&(o.code=o.return_code||o.err_code||o.error_code),g&&g.wizStyle()!==u.web.style.bizLogin&&g.wizStyle()!==u.web.style.bindWeibo&&e!==u.api.user.autoLogin&&o&&301==o.code?m.autoLogin(function(){t.token=s.token,r.apply(p,[e,t,n,i,a])}):n(o)},f=function(e,t,n){c=!1,"abort"!==t&&(o(e,t,n),i(e,t,n))},h=e.url,v=[];if("delete"==e.action.toLowerCase()){for(var b in t)t.hasOwnProperty(b)&&v.push(b+"="+encodeURIComponent(t[b]));v.length>0&&(h+=(h.indexOf("?")>-1?"&":"?")+v.join("&"),t={})}setTimeout(function(){$.ajax({url:h,data:t,dataType:"json",type:e.action,success:d,error:f,cache:!1})},0)}}function o(e,t,n){var r="";r=n&&"string"==typeof n?n:e&&"string"==typeof e?e:"unknown ajax error"}function i(){var e=!1;if(arguments.length>0&&"boolean"==typeof arguments[0]&&(e=arguments[0]),!e&&g&&g.wizStyle()!==u.web.style.clientComment&&!s.checkToken())return v(),null;var t,n,r,o={client_type:u.remote.CLIENT_TYPE,api_version:u.remote.API_VERSION,token:s.token},i=[o];for(t=0,n=arguments.length;n>t;t++)r=arguments[t],r&&"object"==typeof r&&i.push(r);return a.apply(p,i)}function a(){if(arguments.length<1)return{};if(arguments.length<2)return arguments[0];var e,t,n,r,o=arguments[0];for(e=1,t=arguments.length;t>e;e++){r=arguments[e];for(n in r)r.hasOwnProperty(n)&&!o[n]&&void 0!==r[n]&&(o[n]=r[n])}return o}var s=e("./wizCenter"),u=e("../../config/wizConf"),l=e("locale"),c=!1,d=null,g=null,f=!1,h=[],p=this,m={init:function(e){g=e},setAutoLogin:function(e){return e?(this.loginType=e,this):this},user:{checkUserId:function(e,t,n){var o=i(!0,{user_id:e});r(u.api.user.checkUserId,o,t,n)},login:function(e,t,n){var o=i(!0,e);r(u.api.user.login,o,t,n)},logout:function(e,t,n){var o=i(!0,e);r(u.api.user.logout,o,t,n)},register:function(e,t,n){var o=i(!0,e);r(u.api.user.register,o,t,n)},refreshToken:function(e,t){var n=i(),o=function(t){200!=t.code||e&&e(t.code)},a=function(){t&&t()};r(u.api.user.keepAlive,n,o,a)},keepAlive:function(){null===d&&(d=setInterval(function(){m.user.refreshToken()},u.remote.KEEP_ALIVE_TIME_MS))},getUserInfo:function(e,t,n){var o=i(e);r(u.api.user.userInfo,o,t,n)},changeUserId:function(e,t,n){var o=i(e);r(u.api.user.changeUserId,o,t,n)},updateUserInfo:function(e,t,n){var o=i(e);r(u.api.user.updateUserInfo,o,t,n)},changePassword:function(e,t,n){var o=i(e);r(u.api.user.changePassword,o,t,n)},resendVerifyEmail:function(e,t){r(u.api.user.resendVerifyEmail,i(),e,t)},resetPasswordApply:function(e,t,n){var o=i(!0,e);r(u.api.user.resetPasswordApply,o,t,n)},resetPassword:function(e,t,n){var o=i(!0,e);r(u.api.user.resetPassword,o,t,n)},getInviteUserList:function(e,t){r(u.api.user.getInviteUserList,i(),e,t)},payByPoint:function(e,t,n){var o=i(e);r(u.api.user.payByPoint,o,t,n)},payByCard:function(e,t,n){var o=i(e);r(u.api.user.payByCard,o,t,n)},validatePayCard:function(e,t,n){var o=i(e);r(u.api.user.validatePayCard,o,t,n)},userPay:function(e,t,n){var o=i(e);r(u.api.user.pay,o,t,n)},getPersonalPayLog:function(e,t,n){var o=i(e);r(u.api.user.getPersonalPayLog,o,t,n)},createBindOauth:function(e,t,n){var o=i(!0,e);r(u.api.user.createBindOauth,o,t,n)},oauthLogin:function(e,t,n){var o=i(!1,e);r(u.api.oauth.login,o,t,n)},oauthSignup:function(e,t,n){var o=i(!0,e);r(u.api.oauth.signup,o,t,n)},bindSNSAccount:function(e,t){var n=i(!0,e);if(!n)return void v();var r="http://"+location.host+u.api.oauth.bind[e.SNSName]+"&"+$.param(n);window.open(r),t()},unbindSNSAccount:function(e,t,n){var o=i(!0,e);r(u.api.oauth.unbind[e.SNSName],o,t,n)}},weixin:{sendSmsCaptcha:function(e,t,n){var o=i(!0,{mobile:e});r(u.api.weixin.smsCaptcha,o,t,n)},mobileLogin:function(e,t,n){var o=i(!0,{mobile:e.mobile,captcha:e.captcha,wxId:e.wxId});r(u.api.weixin.mobileLogin,o,t,n)},getWeiXinUsage:function(e,t,n){var o=i({biz_guid:e});r(u.api.weixin.getUsage,o,t,n)},increaseWeiXinUsage:function(e,t,n){var o=u.api.weixin.addUsage;o.url=o.url+"?biz_guid="+e,r(o,null,t,n)}},doc:{getAllCategory:function(e,t,n){var o=i({kb_guid:e});r(u.api.doc.getAllCategory,o,t,n)},addCategory:function(e,t,n,o){var a=i({kb_guid:e,new_name:t});r(u.api.doc.addCategory,a,n,o)},deleteCategory:function(e,t,n,o){var a=i({kb_guid:e,old_category_path:t});r(u.api.doc.deleteCategory,a,n,o)},renameCategory:function(e,t,n,o,a){var s=i({kb_guid:e,old_category_path:t,new_title:n});r(u.api.doc.renameCategory,s,o,a)},getAllTag:function(e,t,n){var o=i({kb_guid:e});r(u.api.doc.getAllTag,o,t,n)},addTag:function(e,t,n,o,a){var s=i({kb_guid:e,new_name:t,parent_tag_guid:n||""});r(u.api.doc.addTag,s,o,a)},deleteTag:function(e,t,n,o){var a=i({kb_guid:e,tag_guid:t});r(u.api.doc.deleteTag,a,n,o)},renameTag:function(e,t,n,o,a){var s=i({kb_guid:e,tag_guid:t,new_name:n});r(u.api.doc.renameTag,s,o,a)},getMessageList:function(e,t,n){var o=i(e);r(u.api.doc.getMessage,o,t,n)},setMessageStatus:function(e,t,n){var o=i({ids:e});r(u.api.doc.setMessageStatus,o,t,n)},deleteMessage:function(e,t,n){var o=i({ids:e});r(u.api.doc.deleteMessage,o,t,n)},searchDocumentList:function(e,t,n,o){var a=i({keyword:e,count:t});r(u.api.weixin.searchDocumentList,a,n,o)},getDocumentList:function(e,t,n,o){var a=i(t,{kb_guid:e});r(u.api.doc.getDocumentList,a,n,o)},getDocumentInfo:function(e,t,n,o){var a=i({kb_guid:e,document_guid:t});r(u.api.doc.getDocumentInfo,a,n,o)},getDocumentBody:function(e,t,n){var o=i(e);r(u.api.doc.getDocumentData,o,t,n)},getDocumentSummary:function(e,t,n,o){var a=i({kb_guid:e,document_guids:t,type:3});r(u.api.doc.getDocumentSummary,a,n,o)},createTempDocument:function(e,t,n){var o=i(e,{temp:!0,kb_guid:e.kb_guid});r(u.api.doc.createTmpDocument,o,t,n,null,!0)},updateDocument:function(e,t,n,o){var a=i(t,{kb_guid:e});c!==!0&&(c=!0,r(u.api.doc.updateDocument,a,n,o,null,!0))},deleteDocument:function(e,t,n,o){var a=i({kb_guid:e,document_guid:t});r(u.api.doc.deleteDocument,a,n,o)},getEditCounter:function(e,t,n){var o=i(e);r(u.api.doc.getEditCounter,o,t,n)},addEditCounter:function(e,t,n){var o=i(e);r(u.api.doc.addEditCounter,o,t,n)},deleteEditCounter:function(e,t,n){var o=i(e);r(u.api.doc.deleteEditCounter,o,t,n)},getHistory:function(e,t,n){var o=i(e);r(u.api.doc.getHistory,o,t,n)},getDeletedList:function(e,t,n){var o=i(e);r(u.api.doc.getDeletedList,o,t,n)},restoreHistory:function(e,t,n){var o=i(e);r(u.api.doc.restoreHistory,o,t,n)},recycle:function(e,t,n){var o=i(e);r(u.api.doc.recycle,o,t,n)},getAttachmentList:function(e,t,n,o){var a=i({kb_guid:e,document_guid:t});r(u.api.doc.getAttachmentList,a,n,o)},deleteAttachment:function(e,t,n,o,a){var s=i({kb_guid:e,document_guid:t,attachment_guid:n});r(u.api.doc.deleteAttachment,s,o,a)},addComment:function(e,t,n,o,a,s,l){var c={kb_guid:e,document_guid:t,comment_body:n,user_name:""};o&&a&&(c.parent_sn=o,c.parent_user_guid=a);var d=i(c);r(u.api.doc.createComment,d,s,l)},deleteComment:function(e,t,n,o){var a=i({kb_guid:e,comment_sn:t});r(u.api.doc.deleteComment,a,n,o)},getCommentList:function(e,t,n,o){var a=i({kb_guid:e,document_guid:t});r(u.api.doc.getCommentList,a,n,o)}},biz:{getBizInfo:function(e,t){var n=i();r(u.api.biz.bizInfo,n,e,t)},getBizList:function(e,t){var n=i();r(u.api.biz.getBizList,n,e,t)},createBiz:function(e,t,n){var o=i(e);r(u.api.biz.createBiz,o,t,n)},updateBiz:function(e,t,n){var o=i(e);r(u.api.biz.updateBiz,o,t,n)},finishBizGuide:function(e,t,n){var o=i(e);r(u.api.biz.finishBizGuide,o,t,n)},extendTrial:function(e,t,n){var o=i(e);r(u.api.biz.extendTrial,o,t,n)},getBizPromoteInfo:function(e,t,n){var o=i(e);r(u.api.biz.getPayPromote,o,t,n)},getPromoOrdersLog:function(e,t,n){var o=i(e);r(u.api.biz.getPromoOrdersLog,o,t,n)},getBizCouponInfo:function(e,t,n){var o=i(e);r(u.api.biz.getPayCoupon,o,t,n)},bizPay:function(e,t,n){var o=i(e);r(u.api.biz.pay,o,t,n)},getBizPayLog:function(e,t,n){var o=i(e);r(u.api.biz.getBizPayLog,o,t,n)},getBizMemberList:function(e,t,n){var o=i(e);r(u.api.biz.getBizMemberList,o,t,n)},getBizUserListForAt:function(e,t,n){var o=i(e);r(u.api.biz.getBizMemberListForAt,o,t,n)},addBizMember:function(e,t,n){var o=i(e);r(u.api.biz.addBizMember,o,t,n)},updateBizMember:function(e,t,n){var o=i(e);r(u.api.biz.updateBizMember,o,t,n)},deleteBizMember:function(e,t,n){var o=i(e);r(u.api.biz.deleteBizMember,o,t,n)}},group:{getAllGroupList:function(e,t){var n=i();r(u.api.group.getAllGroupList,n,e,t)},getBizGroupList:function(e,t,n){var o=i(e);r(u.api.group.getBizGroupList,o,t,n)},createBizGroup:function(e,t,n){var o=i(e);r(u.api.group.createBizGroup,o,t,n)},createPersonalGroup:function(e,t,n){var o=i(e);r(u.api.group.createPersonalGroup,o,t,n)},updateGroup:function(e,t,n){var o=i(e);r(u.api.group.updateGroup,o,t,n)},deleteGroup:function(e,t,n){var o=i(e);r(u.api.group.deleteGroup,o,t,n)},getGroupStorage:function(e,t,n){var o=i(e);r(u.api.group.groupStorage,o,t,n)},getGroupMemberList:function(e,t,n){var o=i(e);r(u.api.group.getGroupMemberList,o,t,n)},addGroupMember:function(e,t,n){var o=i(e);r(u.api.group.addGroupMember,o,t,n)},deleteGroupMember:function(e,t,n){var o=i(e);r(u.api.group.deleteGroupMember,o,t,n)},quitGroup:function(e,t,n){var o=i(e);r(u.api.group.quitGroup,o,t,n)},createDefaultDocument:function(e,t,n){var o=i(e);r(u.api.group.createDefaultDocument,o,t,n)},createGroupCategory:function(e,t,n){var o=i(e);r(u.api.group.createGroupCategory,o,t,n)}},share:{cancel:function(e,t,n){var o=e.shareId;delete e.shareId;var a=i(e);r({url:u.api.share.cancel.url.replace("$1",o),action:u.api.share.cancel.action},a,t,n)},create:function(e,t,n){var o=i(e);r(u.api.share.create,o,t,n)},update:function(e,t,n){var o=e.shareId;delete e.shareId;var a=i(e);r({url:u.api.share.update.url.replace("$1",o),action:u.api.share.update.action},a,t,n)},getMyShare:function(e,t,n){var o=i(e);r(u.api.share.getMyShare,o,t,n)}},weibo:{bind:function(e,t,n){r(u.api.weibo.bind,e,t,n)}},getTokenFromClient:function(e){if(!wizUI.util.getToken)return!1;var t="getToken"+(new Date).valueOf();return window[t]=function(n){n&&e({code:200,token:n}),delete window[t]},wizUI.util.getToken(t),!0},autoLogin:function(e){function t(e){if(f=!1,e&&200==e.code)for(s.setToken(e.token);h.length>0;)h.shift().call(p);else v()}function n(){f=!1,h=[],v()}var o,i={},a=this.loginType==u.web.style.wizWeixin;if(h.push(e),!f&&(f=!0,!m.getTokenFromClient(t))){if(!a){if(o=wizUI.util.cookie("CertNo"),!o)return void v();i.cookie_str=o}r(a?u.api.weixin.autoLogin:u.api.user.autoLogin,i,t,n)}}},v=function(){g&&g.tokenInvalid&&g.tokenInvalid.apply(g)};t.exports=m},{"../../config/wizConf":13,"./wizCenter":18,locale:"locale"}],18:[function(e,t,n){var r=e("../../config/wizConf"),o=e("../util/GlobalUtil"),i={token:"",userId:null,userInfo:null,isBizUser:!1,personalKb:null,shareBlackList:!1,biz:{owner:null,manageList:[],memberList:[]},bizInfo:null,groupList:[],bizMemberList:[],aliasRepeatMap:{all:1},userIdRepeatMap:{},noteFrameStatus:{sidebar:!1,fullGroup:!1,menuExpand:!1},noteCur:{kb:null,menuParams:null,docListKey:null,cmd:null,docGuid:null,docInfo:null,prevDocInfo:null,editFlag:!1,shareInfo:null},init:function(e){this.userInfo=e.user,this.personalKb=e.personalKb},setToken:function(e){i.token=e,wizUI.util.cookie("token",e,wizUI.util.getCookieOptions())},checkToken:function(){return wizUI.util.cookie("token")&&wizUI.util.cookie("token")==i.token},getUserIcon:function(e){return e=e||this.userInfo.user_guid||this.userInfo.user_id,e&&this.userInfo&&this.userInfo.icon&&e===this.userInfo.user_guid?this.userInfo.icon:r.url.user.iconBase+e+"?default=true"},checkRepeatAlias:function(e){return this.aliasRepeatMap[e]&&(this.aliasRepeatMap[e]++,e+="_0"+this.aliasRepeatMap[e]),this.appendRepeatAlias(e),e},appendRepeatAlias:function(e){this.aliasRepeatMap[e]=1},removeRepeatAlias:function(e){delete this.aliasRepeatMap[e]},setCurDocListKey:function(e){var t=e===this.noteCur.docListKey;return this.noteCur.docListKey=e,t},setCurDocInfo:function(e){window.Wiz.curDoc=e,window.Wiz.kbGuid=e?e.kb_guid:"",this.noteCur.prevDocInfo=this.noteCur.docInfo,this.noteCur.docInfo=e,this.setLastDocSave(e)},setCurShareInfo:function(e){this.noteCur.shareInfo=e},setLastDocSave:function(e){return e?(this.noteCur.docGuid=e.document_guid,void(this.noteCur.lastSaved={document_guid:e.document_guid,document_title:e.document_title,document_body:e.document_body,document_tag_guids:e.document_tag_guids,document_category:e.document_category})):(this.noteCur.lastSaved={},void(this.noteCur.editFlag=!1))},checkCurDocChanged:function(e){var t=this.noteCur.lastSaved,n=t.document_tag_guids.replace(/\*/gi,";").split(";"),r=e.document_tag_guids.split(";"),i=o.arrayCompare(n,r),a=t.document_body.replace(String.fromCharCode(65279),""),s=e.document_body.replace(String.fromCharCode(65279),"");return e.document_guid!=t.document_guid||e.document_title!=t.document_title||a!=s||i.del.length>0||i.add.length>0||e.document_category!=t.document_category}};t.exports=i},{"../../config/wizConf":13,"../util/GlobalUtil":35}],19:[function(e,t,n){var r=e("./CacheModel"),o=e("./BaseModel"),i=e("../database/remote"),a=e("locale"),s=r.extend({getAttachmentList:function(e){return null}}),u=new s,l=o.extend({_getKey:function(e){return e.kb_guid+"_"+e.document_guid},_isCacheLoading:function(e){return u.isLoading(this._getKey(e))},_getCacheData:function(e){return u.getAttachmentList(this._getKey(e))},_getCacheDataByRemote:function(e,t){var n=this._getKey(e),r=e.kb_guid,o=e.document_guid;u.setLoading(n,!0),i.doc.getAttachmentList(r,o,function(e){if(u.setLoading(n,!1),!e||!e.code||"200"!=e.code)return void t(null,{msg:a.docDocument.err.attachment_getList});var r=e.list;t(r)})},_clearCache:function(e){u.clearCache(this._getKey(e))},deleteAttachment:function(e,t){var n=this,r=e.kb_guid,o=e.document_guid,s=e.attachment_guid;i.doc.deleteAttachment(r,o,s,function(e){return e&&e.code&&"200"==e.code?void t.apply(n,[!0]):void n._controller.showErrorMessage({msg:a.docDocument.err.attachment_delete})})}}),c=new l;t.exports=c},{"../database/remote":17,"./BaseModel":21,"./CacheModel":24,locale:"locale"}],20:[function(e,t,n){function r(e){return i.personalKb&&i.personalKb.kbGuid==e}var o=e("../../config/wizConf"),i=e("../database/wizCenter"),a=e("./BaseModel"),s=a.extend({modifyCategory:function(e){if(!e)return!1;if(r(e))return!0;var t=this._controller.models.groupInfo.getGroup(e);return t&&t.userGroup<=o.web.authority.group["super"]?!0:!1},createDoc:function(e){var t={can:!1};if(!e)return t;if(r(e))return t.can=!0,t;var n=this._controller.models.groupInfo.getGroup(e);return n&&n.userGroup<=o.web.authority.group.author?(t.can=!0,t):(t.role=n.userGroup,t.minRole=o.web.authority.group.author,t)},editDoc:function(e,t){var n={can:!1};if(!e)return n;if(r(e))return n.can=!0,n;var a=this._controller.models.groupInfo.getGroup(e);return a&&a.userGroup<=o.web.authority.group.editor?(n.can=!0,n):a&&a.userGroup==o.web.authority.group.author&&t.toLowerCase()==i.userInfo.user_id.toLowerCase()?(n.can=!0,n):(n.role=a.userGroup,n.minRole=o.web.authority.group.author,n)},deleteDoc:function(e,t){return this.editDoc(e,t)}}),u=new s;t.exports=u},{"../../config/wizConf":13,"../database/wizCenter":18,"./BaseModel":21}],21:[function(e,t,n){function r(e,t,n,r){if(!t)return function(t,o){o&&e._controller.showErrorMessage(o),n.apply(e,[t,r])};var o=(new Date).valueOf();return u[t]=o,function(i,a){u[t]===o&&(delete u[t],a&&e._controller.showErrorMessage(a),n.apply(e,[i,r]))}}var o,i=e("../util/Class"),a=e("../../config/wizConf"),s=a.baseModel.loadingWait,u={},l=i.extend({init:function(){this._controller=o,this.doc=$("body"),this.frameEventType=a.web.frameEventType,this.dataOperateType=a.web.dataOperateType},setAttr:function(e,t){this[e]=t},getAttr:function(e){return this[e]},getBase:function(e,t,n){var o=r(this,t,n),i=this;if(this._isCacheLoading(e))return void setTimeout(function(){i.getBase.apply(i,[e,t,n])},s);var a=this._getCacheData(e);a?o(a):this._getCacheDataByRemote.apply(this,[e,o])},refresh:function(e,t,n){this._isCacheLoading(e)||this._clearCache(e),
this.getBase.apply(this,arguments)},_getCallback:function(e,t,n){return r(this,e,t,n)},_getKey:function(e){},_isCacheLoading:function(e){},_getCacheData:function(e){},_getCacheDataByRemote:function(e,t){},_clearCache:function(e){}});l.setController=function(e){o=e},t.exports=l},{"../../config/wizConf":13,"../util/Class":34}],22:[function(e,t,n){var r=e("./CacheModel"),o=e("./BaseModel"),i=e("../database/remote"),a=e("../database/wizCenter"),s=e("../../config/wizConf"),u=e("../util/GlobalUtil"),l=e("locale"),c=r.extend({getBizInfo:function(){return this.map.bizInfo},setBizInfo:function(e){this.map.bizInfo=e},getBizList:function(){return this.map.bizList},setBizList:function(e){this.map.bizList=e},createBizMemberList:function(){this.map.bizMemberList||(this.map.bizMemberList={}),this.map.bizMemberList[a.bizInfo.biz_guid]||(this.map.bizMemberList[a.bizInfo.biz_guid]=[])},getBizMemberList:function(){return this.map.bizMemberList?this.map.bizMemberList[a.bizInfo.biz_guid]:null},getBizMember:function(e,t){if(!this.map.bizMemberList)return null;var n,r,o=this.map.bizMemberList[a.bizInfo.biz_guid];for(n=o.length-1;n>=0;n--)if(r=o[n],r[e]===t)return r;return null},getBizMembers:function(e,t){if(!this.map.bizMemberList)return[];var n,r,o=this.map.bizMemberList[a.bizInfo.biz_guid],i=[];for(n=o.length-1;n>=0;n--)r=o[n],r[e]===t&&i.push(r);return i},setBizMemberList:function(e){this.createBizMemberList();var t,n;for(t=e.length-1;t>=0;t--)n=e[t],n.user_id=n.user_id.toLowerCase(),n.avatar=a.getUserIcon(n.user_guid||n.user_id);this.map.bizMemberList[a.bizInfo.biz_guid]=e,this.sortBizMemberList()},sortBizMemberList:function(){var e=this.getBizMemberList();e.sort(function(e,t){return e.user_group===s.web.authority.biz.owner?-1:t.user_group===s.web.authority.biz.owner?1:e.user_group===s.web.authority.biz.admin&&t.user_group>s.web.authority.biz.admin?-1:t.user_group===s.web.authority.biz.admin&&e.user_group>s.web.authority.biz.admin?1:e.alias.localeCompare(t.alias)})},addBizMember:function(e){if(!e)return null;this.createBizMemberList();var t,n,r,o=[];for(t=e.length-1;t>=0;t--)r=e[t],200!=r.status_code&&e.splice(t,1);var i=this.getBizMemberList(),s={};if(i)for(t=0,n=i.length;n>t;t++)s[i[t].user_id]=!0;for(t=0,n=e.length;n>t;t++)r=e[t],s[r.user_id]||(r.avatar=a.getUserIcon(r.user_guid||r.user_id),this.map.bizMemberList[a.bizInfo.biz_guid].push(r),o.push(r));return this.sortBizMemberList(),o},updateBizMember:function(e){var t,n,r=this.getBizMemberList();for(t=r.length-1;t>=0;t--)if(n=r[t],n.user_guid==e.user_guid)return"undefined"!=typeof e.user_group&&(n.user_group=e.user_group),n.alias=e.alias,n.avatar=a.getUserIcon(n.user_guid||n.user_id),f._controller.models.groupInfo.updateMemberAlias(n.user_id,n.alias),void this.sortBizMemberList()},deleteBizMember:function(e){if(e){var t,n,r,o={};for(t=e.length-1;t>=0;t--)n=e[t],200==n.status_code&&(o[n.user_guid]=!0,r=this.getBizMember("user_guid",n.user_guid),r&&f._controller.models.groupInfo.deleteGroupMemberFromBiz(r.user_id));for(e=this.getBizMemberList(),t=e.length-1;t>=0;t--)n=e[t],o[n.user_guid]&&e.splice(t,1)}}}),d=new c,g=o.extend({_getKey:function(){return a.token},_isCacheLoading:function(){return d.isLoading(this._getKey())},_getCacheData:function(){return d.getBizInfo()},_getCacheDataByRemote:function(e,t){var n=this._getKey();d.setLoading(n,!0),i.biz.getBizInfo(function(e){return d.setLoading(n,!1),e?(200==e.code&&d.setBizInfo(e),void t(e)):void t(null)})},_clearCache:function(){d.clearCache(this._getKey())},extendTrial:function(e,t){var n="";e.extend_note=JSON.stringify(e.extend_note),i.biz.extendTrial(e,function(e){e&&200==e.code?(f._controller.showSuccessMessage({msg:l.bizExtendTrial.suc,auto:-1}),t(e)):(n=e&&321==e.code?l.bizExtendTrial.err[321]:e&&3213==e.code?l.bizExtendTrial.err[3213]:l.bizExtendTrial.err.fail,f._controller.showErrorMessage({msg:n}),t())})},createBiz:function(e,t){i.biz.createBiz(e,function(e){e&&200==e.code?t(e):(t(),f._controller.showErrorMessage({msg:l.bizGuide.err.createBiz}))})},updateBiz:function(e,t){i.biz.updateBiz(e,function(e){e&&200==e.code?(t&&t(e),f.doc.trigger(f.frameEventType.EventManager,[f.dataOperateType.OnUpdateBizInfo,e]),f._controller.showSuccessMessage({msg:l.bizInfo.suc.save})):(t&&t(),f._controller.showErrorMessage({msg:l.bizInfo.err.save}))})},getBizList:function(e){var t=d.getBizList();return t?void e(t):void i.biz.getBizList(function(t){t&&200==t.code?(d.setBizList(t.result),e(d.getBizList())):e()})},getBizByGuid:function(e){var t=d.getBizList();if(!t||0===t.length)return null;var n,r,o;for(n=0,r=t.length;r>n;n++)if(o=t[n],o.biz_guid==e)return o;return null},checkNewBizMemberList:function(e){for(var t,n,r={},o=e.length,i=[],a=[],s=[],l=[],c=0;o>c;c++)if(t=e[c].toLowerCase(),u.userIdNeedVerify(t))s.push(t);else if(u.verifyEmail(t)||u.verifyMobile(t)){if(u.verifyMyWizEmail(t)){l.push(t);continue}n=f.getBizMember("email",t)||f.getBizMember("mobile",t),n?a.push(t):r[t]||(s.push(t),r[t]=1)}else{if(""===$.trim(t))continue;i.push(t)}return{good:s,bad:i,exist:a,mywiz:l}},addBizMember:function(e,t,n){if(!f._controller.checkBizExpired(a.bizInfo))return void(t&&t(!1));var r,o,c=e.users;for(r=c.length-1;r>=0;r--)o=c[r],o.user_id=o.user_id.toLowerCase();e.users=JSON.stringify(e.users),i.biz.addBizMember(e,function(e){if(e&&200==e.code){var r,o,i,g=e.result,h={};for(r=c.length-1;r>=0;r--)o=c[r],h[o.user_id]=o;for(r=g.length-1;r>=0;r--)o=g[r],200!=o.status_code?g.splice(r,1):(i=h[o.user_id],o.alias=i.alias,o.user_group=i.user_group,u.verifyEmail(o.user_id)?o.email=o.user_id:o.mobile=o.user_id);g=d.addBizMember(g),t&&t(g),n||f._controller.showSuccessMessage({msg:l.bizMember.suc.addMember.replace("$1",g.length)}),f.doc.trigger(f.frameEventType.EventManager,[f.dataOperateType.OnAddBizMember,g])}else e&&327==e.code&&f._controller.showErrorMessage({msg:l.bizMember.err.memberFull.replace("$1",s.web.memberMaxCount.biz[a.bizInfo.biz_level])}),t&&t()})},updateBizMember:function(e,t){if(!f._controller.checkBizExpired(a.bizInfo))return void(t&&t(!1));var n=e.biz_user;e.biz_user=JSON.stringify(e.biz_user),i.biz.updateBizMember(e,function(e){e&&200==e.code?(d.updateBizMember(n),t&&t(e),f._controller.showSuccessMessage({msg:l.bizMember.suc.updateMember})):(t&&t(),f._controller.showErrorMessage({msg:l.bizMember.err.updateMember}))})},deleteBizMember:function(e,t){return f._controller.checkBizExpired(a.bizInfo)?(e.users=JSON.stringify(e.users),void i.biz.deleteBizMember(e,function(e){e&&200==e.code?(d.deleteBizMember(e.result),t(e),f._controller.showSuccessMessage({msg:l.bizMember.suc.deleteMember}),f.doc.trigger(f.frameEventType.EventManager,[f.dataOperateType.OnUpdateGroupMember,""])):(t(),f._controller.showErrorMessage({msg:l.bizMember.err.deleteMember}))})):void t(!1)},getBizMemberList:function(e,t){var n=d.getBizMemberList();return n?void t(n):void i.biz.getBizMemberList(e,function(e){e&&200==e.code?(n=e.users||[],d.setBizMemberList(n),t(d.getBizMemberList())):t([])})},getBizOwner:function(){return d.getBizMember("user_group",s.web.authority.biz.owner)},getBizManagers:function(){return d.getBizMembers("user_group",s.web.authority.biz.admin)},getBizMember:function(e,t){return d.getBizMember(e,t)},isOwner:function(e){var t=this.getBizOwner();return t&&t.user_id===e},isManager:function(e){var t,n,r,o=this.getBizManagers();for(t=0,n=o.length;n>t;t++)if(r=o[t],r.user_id===e)return!0;return!1},isDefaultGroupManager:function(e){return this.isOwner(e)||this.isManager(e)},finishBizGuide:function(e,t){i.biz.finishBizGuide(e,function(e){e&&200==e.code?t(e):t()})},getBizPromoteInfo:function(e,t){i.biz.getBizPromoteInfo(e,function(e){e&&200==e.code?t(e):e?t({code:e.code}):t()})},getPromoOrdersLog:function(e,t){i.biz.getPromoOrdersLog(e,function(e){t(e)})},getBizCouponInfo:function(e,t){var n=e.biz_guid;i.biz.getBizCouponInfo(e,function(e){var r=new Date;if(e&&200==e.code){if(+r>e.dtDue)return void t({code:3464});if(e.batch_used)return void t({code:3467});var o=e.result.status,i=e.result.ownerGuid;0===o?f._controller.showSuccessMessage({msg:l.bizPay.label.addCouponSuccess}):1==o?e.code=3463:2===o?i===n?f._controller.showSuccessMessage({msg:l.bizPay.label.addCouponSuccess}):e.code=3465:e=null,t(e)}else e?t(e):(t(),f._controller.showErrorMessage({msg:l.bizPay.label.addCouponFail}))})},getBizPayLog:function(e,t){i.biz.getBizPayLog(e,function(e){200===e.code&&t(e.result)})},getBizPayLink:function(){return wizUI.util.setUrlParams(s.url.biz.pay,{level:a.bizInfo.biz_level+1,biz:a.bizInfo.biz_guid,token:a.token})},bizPay:function(e,t){i.biz.bizPay(e,function(e){t(e)})}}),f=new g;t.exports=f},{"../../config/wizConf":13,"../database/remote":17,"../database/wizCenter":18,"../util/GlobalUtil":35,"./BaseModel":21,"./CacheModel":24,locale:"locale"}],23:[function(e,t,n){var r=e("./CacheModel"),o=e("./BaseModel"),i=e("../database/remote"),a="BizUserList",s=r.extend({init:function(){this.idMap={},this._super.apply(this,arguments);var e,t,n=this.loadLocalStorage(a);if(n){this.map=n;for(e in n)n.hasOwnProperty(e)&&(t=n[e],this.createIdMap(e,t))}},createIdMap:function(e,t){var n,r={};for(n=t.length-1;n>=0;n--)r[t[n].user_id]=t[n],r[t[n].user_guid]=t[n];this.idMap[e]=r},clearStorage:function(e){var t=this.loadLocalStorage(a);t&&(delete t[e],this.saveLocalStorage(a,t))},clearCache:function(e){delete this.map[e],this.clearStorage(e)},getUserList:function(e){return this.map[e]},getUserIdMap:function(e){return this.idMap[e]},setUserList:function(e,t){this.map[e]=t,this.createIdMap(e,t);var n=this;setTimeout(function(){n.saveLocalStorage(a,n.map)},10)},getUserByUserId:function(e,t){if(!e||!t)return null;var n=this.getUserIdMap(e);if(!n)return null;var r=n[t];return r?r:null},getUserByUserGuid:function(e,t){if(!e||!t)return null;var n=this.getUserIdMap(e);if(!n)return null;var r=n[t];return r?r:null}}),u=new s,l=o.extend({_getKey:function(e){return e.kb_guid?e.kb_guid:e.biz_guid?e.biz_guid:""},_isCacheLoading:function(e){return u.isLoading(this._getKey(e))},_getCacheData:function(e){return u.getUserList(this._getKey(e))},_getCacheDataByRemote:function(e,t){var n=this._getKey(e);if(!e.force){var r=this._controller.models.groupInfo.getGroup(e.kb_guid);if(!r||"string"!=typeof r.bizGuid)return void t(null)}u.setLoading(n,!0),i.biz.getBizUserListForAt({biz_guid:e.biz_guid,kb_guid:e.kb_guid},function(e){if(u.setLoading(n,!1),!e||!e.code||"200"!=e.code)return 321==e.code&&u.setUserList(n,[]),void t(null);var r=e.list;u.setUserList(n,r),t(r)})},_clearCache:function(e){u.clearCache(this._getKey(e))},getUserByUserId:function(e,t){var n=this._getKey(e);return u.getUserByUserId(n,t)},getUserByUserGuid:function(e,t){var n=this._getKey(e);return u.getUserByUserGuid(n,t)},clearCache:function(e){u.clearCache(e)},clearStorage:function(e){u.clearStorage(e)}}),c=new l;t.exports=c},{"../database/remote":17,"./BaseModel":21,"./CacheModel":24}],24:[function(e,t,n){var r=e("../util/Class"),o=e("../util/GlobalUtil"),i=e("../../config/wizConf"),a=r.extend({init:function(e){this.map={},this.list={},this.loadingMap={},this.localStorageTimeout=e&&e.localStorageTimeout?e.localStorageTimeout:i.baseModel.localStorageTimeout},isLoading:function(e){return this.loadingMap[e]},setLoading:function(e,t){t?this.loadingMap[e]=!0:delete this.loadingMap[e]},saveLocalStorage:function(e,t){window.localStorage&&window.localStorage.setItem(e,o.encode(JSON.stringify({time:(new Date).valueOf(),data:t})))},deleteLocalStorage:function(e){window.localStorage&&window.localStorage.removeItem(e)},loadLocalStorage:function(e){var t,n,r,i;return window.localStorage&&(t=window.localStorage[e])?(n=JSON.parse(0===t.indexOf("{")?t:o.decode(t)),r=n.time,i=(new Date).valueOf(),i-r<this.localStorageTimeout?n.data:(window.localStorage.removeItem(e),null)):null},clearCache:function(e){delete this.list[e],delete this.map[e]}});t.exports=a},{"../../config/wizConf":13,"../util/Class":34,"../util/GlobalUtil":35}],25:[function(e,t,n){function r(e){if(!e)return e;var t,n,r,o=e.split("/");for(t=0,n=o.length;n>t&&2>t;t++)r=o[t],r&&c[r]&&(o[t]=c[r]);return o.join("/")}var o=e("../../config/wizConf"),i=e("./CacheModel"),a=e("./BaseModel"),s=e("../database/remote"),u=e("./Authority"),l=e("locale"),c=l.docCategory._default,d={createCategoryNodes:{name:l.docMenu.label.createCategory,cmd:o.web.note.menuCmd.create,type:o.web.note.menuType.category,iconSkin:o.web.note.menuCmd.create}},g=i.extend({getCategory:function(e,t){var n=this.map[e],r=null;return n&&(r=n[t]),r},setCategory:function(e,t){if(t){this.list[e]=t,this.map[e]={};for(var n=0,r=t.length;r>n;n++)this.addCategoryMap.apply(this,[e,t[n]])}},addCategoryMap:function(e,t){var n=this.map[e];n[t.location]=t},addCategory:function(e,t){this.map[e][t.location]=t;var n=this.list[e];n.splice(n.length-1,0,t)},deleteCategory:function(e,t){delete this.map[e][t];for(var n,r=this.list[e],o=0,i=r.length;i>o;o++)if(n=r[o],n.location==t){r.splice(o,1);break}},renameCategory:function(e,t,n){var o=t.category_name,i=t.location,a=i.substr(0,i.length-(o.length+1))+n+"/",s=this.map[e][t.location];return t.id=a,t.location=a,t.displayLocation=r(a),t.category_name=n,t.name=n,t.oldLocation=i,s.location=a,s.displayLocation=a,s.category_name=n,s.name=n,delete this.map[e][i],this.map[e][a]=s,s},sortList:function(e){return e.sort(function(e,t){return e.position?e.position-t.position:e.category_name.localeCompare(t.category_name)}),e},initForTree:function(e,t){for(var n,o=t.length-1;o>=0;o--)n=t[o],n.location&&0===n.location.indexOf("/Deleted Items/")?t.splice(o,1):(n.name||(n.name=n.category_name),n.name=r(n.name),n.displayLocation=r(n.location),n.id=n.location?n.location:"_"+(new Date).valueOf(),n.pId=n.parentLocation?n.parentLocation:"",n.type="category",n.kb_guid=e)}}),f=new g,h=a.extend({_getKey:function(e){return e.kb_guid},_isCacheLoading:function(e){return f.isLoading(this._getKey(e))},_getCacheData:function(e){return f.list[this._getKey(e)]},_getCacheDataByRemote:function(e,t){var n=this._getKey(e);f.setLoading(n,!0),s.doc.getAllCategory(n,function(e){if(f.setLoading(n,!1),!e||!e.code||"200"!=e.code)return void t(f.list[n],{msg:l.docCategory.err.category_getList});var r=f.sortList(e.list);u.modifyCategory(n)&&r.push(d.createCategoryNodes),f.initForTree(n,r),f.setCategory(n,r),t(f.list[n])})},_clearCache:function(e){f.clearCache(this._getKey(e))},getCategoryName:function(e,t){var n="",r=f.getCategory.apply(f,arguments);return r&&r.category_name&&(n=r.category_name),n},addCategory:function(e,t){var n=this,i=this._getKey(e),a=e.name,u=e.category_node.getParentNode(),c=u&&u.location?u.location:"/",d=c+a+"/";s.doc.addCategory(i,d,function(s){var u;s&&s.code&&"200"==s.code?(u={category_name:a,location:d,parentLocation:c,displayLocation:r(d),type:o.web.note.menuType.category,isParent:!1},f.initForTree(i,[u]),f.addCategory.apply(f,[e.kb_guid,u])):n._controller.showErrorMessage({msg:l.docCategory.err.category_create}),t.apply(n,[i,u])})},deleteCategory:function(e,t){var n=this,r=this._getKey(e),o=e.category_node,i=o.location,a=!0;s.doc.deleteCategory(r,i,function(e){e&&e.code&&"200"==e.code?f.deleteCategory.apply(f,[r,i]):(n._controller.showErrorMessage({msg:l.docCategory.err.category_delete}),a=!1),t.apply(n,[r,a])})},renameCategory:function(e,t){var n=this,r=this._getKey(e),o=e.name,i=e.category_node,a=i.location;s.doc.renameCategory(r,a,o,function(e){var a;e&&e.code&&"200"==e.code?a=f.renameCategory.apply(f,[r,i,o]):n._controller.showErrorMessage({msg:l.docCategory.err.category_rename}),t.apply(n,[r,a])})},formatLocation:r}),p=new h;t.exports=p},{"../../config/wizConf":13,"../database/remote":17,"./Authority":20,"./BaseModel":21,"./CacheModel":24,locale:"locale"}],26:[function(e,t,n){var r=e("./CacheModel"),o=e("./BaseModel"),i=e("../database/remote"),a=e("../database/wizCenter"),s=e("locale"),u=e("../../config/wizConf"),l=e("./BizMemberListForAt"),c="CommentTmp",d=r.extend({getCommentList:function(e){return this.list[e]||(this.list[e]=[]),this.list[e]},setCommentList:function(e,t){t&&(this.list[e]=this.initCommentList(t))},addComment:function(e,t){if(t){var n=this.getCommentList(e);n&&(this.initComment(t),n.push(t))}},deleteComment:function(e,t){if(t){var n,r=this.getCommentList(e);if(r)for(n=r.length-1;n>=0;n--)if(r[n].comment_sn==t)return void r.splice(n,1)}},initCommentList:function(e){for(var t,n,r=e.length-1,o=!1;r>=0;r--)t=e[r],n=this.initComment(t),n.hasNewId&&(o=!0);return o&&l.clearCache(e[0].kb_guid),e},initComment:function(e){e.id="_comment_"+e.comment_sn,e.user_icon=a.getUserIcon(e.user_guid),e.isOwner=e.user_guid===a.userInfo.user_guid;var t=l.getUserByUserGuid({kb_guid:e.kb_guid},e.user_guid);return t&&(e.user_name=t.alias),{hasNewId:!t}},sortList:function(e){return e.sort(function(e,t){return t.dt_created-e.dt_created}),e}}),g=new d({localStorageTimeout:u.baseModel.clientCommentTimeout}),f=o.extend({_getKey:function(e){return e.document_guid},_isCacheLoading:function(e){return g.isLoading(this._getKey(e))},_getCacheData:function(e){return g.getCommentList(this._getKey(e))},_getCacheDataByRemote:function(e,t){function n(e){if(g.setLoading(r,!1),!e||!e.code||"200"!=e.code)return void t(null,{msg:e?s.docComment.err.getList:s.common.err.server});var n=e.list;g.setCommentList(r,n),t(g.getCommentList(r))}var r=this._getKey(e);g.setLoading(r,!0),i.doc.getCommentList(e.kb_guid,e.document_guid,n)},_clearCache:function(e){g.clearCache(this._getKey(e))},_autoLoadClear:function(){this._autoTimer&&clearTimeout(this._autoTimer)},_autoLoadStart:function(e,t,n){var r=this;this._autoTimer=setTimeout(function(){var o=r._getCallback.apply(r,[t,n]);r._getCacheDataByRemote.apply(r,[e,o]),r._autoLoadStart(e,t,n)},u.baseModel.commentListAuto)},getBase:function(e,t,n){if(this._autoLoadClear(),this._super.apply(this,arguments),!this._isCacheLoading(e)){var r=this._getCallback.apply(this,[t,n,!0]);this._getCacheDataByRemote.apply(this,[e,r])}e.startAuto&&this._autoLoadStart(e,t,n)},addComment:function(e,t){var n=this;i.doc.addComment(e.kb_guid,e.document_guid,e.comment_body,e.parent_sn,e.parent_user_guid,function(r){var o;if(!r||!r.code||"200"!=r.code)return o=r?"333"==r.code||"3330"==r.code?s.docComment.err.noNote:s.docComment.err.add:s.common.err.server,n._controller.showErrorMessage({msg:o,auto:5e3}),void t();var i=a.userInfo;e.dt_created=(new Date).valueOf(),e.comment_sn=r.id,e.user_guid=i.user_guid,e.user_name=i.displayname,e.user_icon=i.icon,g.addComment(n._getKey(e),e),t(g.getCommentList(n._getKey(e)))})},deleteComment:function(e,t){var n=this;i.doc.deleteComment(e.kb_guid,e.comment_sn,function(r){return r&&r.code&&"200"==r.code?(g.deleteComment(n._getKey(e),e.comment_sn),void t(g.getCommentList(n._getKey(e)))):(r||n._controller.showErrorMessage({msg:s.common.err.server,auto:5e3}),void t())})},setTempComment:function(e,t){var n,r,o,i,s=a.userInfo.user_guid,l=e+"_"+s,d=g.loadLocalStorage(c)||[];for(i=(new Date).valueOf(),n=d.length-1;n>=0;n--)r=d[n],o=r.time,(i-o>=u.baseModel.clientCommentTimeout||r[l])&&d.splice(n,1);var f;t&&(f={time:(new Date).valueOf()},f[l]=t,d.push(f)),d.length>5&&d.shift(),0===d.length?g.deleteLocalStorage(c):g.saveLocalStorage(c,d)},getTempComment:function(e){var t,n,r,o,i=a.userInfo.user_guid,s=e+"_"+i,l=g.loadLocalStorage(c)||[];for(o=(new Date).valueOf(),t=l.length-1;t>=0;t--)if(n=l[t],r=n.time,o-r<u.baseModel.clientCommentTimeout&&n[s])return n[s];return""}});t.exports=new f},{"../../config/wizConf":13,"../database/remote":17,"../database/wizCenter":18,"./BaseModel":21,"./BizMemberListForAt":23,"./CacheModel":24,locale:"locale"}],27:[function(e,t,n){var r=e("../util/GlobalUtil"),o=e("./CacheModel"),i=e("./BaseModel"),a=e("../../config/wizConf"),s=e("../database/wizCenter"),u=e("../database/remote"),l=e("../../common/moment/moment"),c=e("locale"),d=o.extend({getDocument:function(e){return null},setDocument:function(e){}}),g=new d,f=i.extend({_getKey:function(e){return e.doc_guid},_isCacheLoading:function(e){return g.isLoading(this._getKey(e))},_getCacheData:function(e){return g.getDocument(this._getKey(e))},_getCacheDataByRemote:function(e,t){var n=this._getKey(e),r=e.kb_guid,o=e.doc_guid;g.setLoading(n,!0),u.doc.getDocumentInfo(r,o,function(e){g.setLoading(n,!1),t(e),e&&"200"==e.code&&g.setDocument(e.document_info)})},_clearCache:function(e){g.clearCache(this._getKey(e))},createDocument:function(e,t){var n=this,o={title:"",kb_guid:e.kb_guid,document_body:a.web.note.initDoc.body.replace("$1",'<style id="'+a.web.note.initDoc.cssId+'">'+a.web.note.initDoc.css+"</style>").replace("$2",""),document_guid:r.genGuid(),document_owner:e.document_owner,document_category:e.document_category,document_tag_guids:e.document_tag_guids,document_url:e.document_url,userIcon:e.userIcon,dt_created:e.dt_created,dt_modified:e.dt_modified};u.doc.createTempDocument(o,function(e){return e&&e.code&&"200"==e.code?void t.apply(n,[o]):(n._controller.showErrorMessage({msg:c.docDocument.err.document_create}),void t.apply(n))})},saveDocument:function(e,t){var n=this,r=e.doc_info;r.version&&"temp"!=r.version||(r.dt_created=l().format(),r.dt_modified=r.dt_created,r.dt_data_modified=r.dt_created),u.doc.updateDocument(r.kb_guid,r,function(e){var o="",i="";e&&e.code&&"200"==e.code?i=e.document_guid:(o=e&&"3032"==e.code?c.docDocument.err.document_save_3032:c.docDocument.err.document_save,h._controller.showErrorMessage({msg:o})),t.apply(n,[r.kb_guid,{document_guid:i,message:o}])})},deleteDocument:function(e,t){var n=this,r=e.doc_info;u.doc.deleteDocument(r.kb_guid,r.document_guid,function(e){var o=r;e&&e.code&&"200"==e.code||(n._controller.showErrorMessage({msg:c.docDocument.err.document_delete}),o=null),t.apply(n,[r.kb_guid,o])})},getEditCounter:function(e,t){u.doc.getEditCounter(e,function(e){t(e)})},addEditCounter:function(e,t){u.doc.addEditCounter(e,function(e){t(e)})},deleteEditCounter:function(e,t){u.doc.deleteEditCounter(e,function(e){t(e)})},getHistory:function(e,t){u.doc.getHistory(e,function(n){return n&&200==n.code?void t(n):(n&&404==n.code&&h._controller.showErrorMessage({msg:c.docHistory.err[e.obj_type].restore_404,auto:-1}),void t())})},getDocDeleted:function(e,t){e.obj_type="document",u.doc.getDeletedList(e,function(e){if(e&&200==e.code){var n,r,o;for(n=0,r=e.result.length;r>n;n++)o=e.result[n],o.deleted_content=$.parseJSON(o.deleted_content);t(e)}else t()})},getAttachmentDeleted:function(e,t){e.obj_type="attachment",u.doc.getDeletedList(e,function(e){if(e&&200==e.code){var n,r,o;for(n=0,r=e.result.length;r>n;n++)o=e.result[n],o.deleted_content=$.parseJSON(o.deleted_content);t(e)}else t()})},restoreHistory:function(e,t){u.doc.restoreHistory(e,function(n){var r="";return n&&200==n.code?(t(n),void h._controller.showSuccessMessage({msg:c.docHistory.suc})):(r=n&&323==n.code?e.kb_guid==s.userInfo.kb_guid||"person"==n.kb_type?c.docHistory.err.restore_323_personal:"biz"==n.kb_type?c.docHistory.err.restore_323_biz:c.docHistory.err.restore_323_group:n&&303==n.code?c.docHistory.err.restore_303:c.docHistory.err.restore,void h._controller.showErrorMessage({msg:r}))})},getDocumentBody:function(e,t){u.doc.getDocumentBody(e,function(e){t(e)})},recycleDeleted:function(e,t){var n=e.type;delete e.type,u.doc.recycle(e,function(e){var r,o,i,a,s={};if(e&&200==e.code){for(t(e),r=e.result,o=0,i=r.length;i>o;o++)a=r[o],s[a.return_code]=s[a.return_code]?s[a.return_code]+1:1;s[200]&&(h._controller.showSuccessMessage({msg:c.docRecycle.suc[n].replace("$1",s[200])}),i-=s[200],delete s[200]),s[324]&&(h._controller.showSuccessMessage({msg:c.docRecycle.err[n].recycle_324.replace("$1",s[324])}),i-=s[324],delete s[324]),i>0&&h._controller.showErrorMessage({msg:c.docRecycle.err[n].recycle})}else h._controller.showErrorMessage(e&&303==e.code?{msg:c.docHistory.err[n].restore_303}:{msg:c.docRecycle.err[n].recycle})})},cancelShare:function(e,t){u.share.cancel(e,function(e){t(e)})},createShare:function(e,t){u.share.create(e,function(e){t(e)})},updateShare:function(e,t){u.share.update(e,function(e){t(e)})},getMyShare:function(e,t){u.share.getMyShare(e,function(e){t(e)})},getMyShareByDocGuid:function(e,t){u.share.getMyShare(e,function(e){t(e)})}}),h=new f;t.exports=h},{"../../common/moment/moment":4,"../../config/wizConf":13,"../database/remote":17,"../database/wizCenter":18,"../util/GlobalUtil":35,"./BaseModel":21,"./CacheModel":24,locale:"locale"}],28:[function(e,t,n){var r=e("./CacheModel"),o=e("./BaseModel"),i=e("../database/remote"),a=e("../database/wizCenter"),s=e("locale"),u=e("../../config/wizConf"),l=r.extend({getDocumentList:function(e){return this.map[e]},setDocumentList:function(e,t){if(this.filter(t),e){var n=/_version$/;if(!n.test(e))return void(this.map[e]=t);if(!t||0===t.length)return void(this.map[e]||(this.map[e]=[]));var r,o,i,a,s={};if(this.map[e]){for(r=this.map[e],o=0,i=t.length;i>o;o++)a=t[o],s[a.document_guid]=1;for(o=r.length-1;o>=0;o--)a=r[o],s[a.document_guid]&&r.splice(o,1);this.map[e]=r.concat(t)}else this.map[e]=t;var u=this.map[e];u.length>0&&this.sortDocumentList(u)}},sortDocumentList:function(e){e.sort(function(e,t){return t.version-e.version})},_clearDocumentListByKey:function(e,t,n){var r,o,i,a;for(r in this.map)if(this.map.hasOwnProperty(r)){if(o=this.map[r],!o||0!==r.indexOf(e))continue;for(i=o.length-1;i>=0;i--)a=o[i],a[t]===n&&o.splice(i,1)}},clearDocumentListByCategory:function(e,t){delete this.map[e+"_category_"+t],this._clearDocumentListByKey(e,"document_category",t)},clearDocumentListByDocument:function(e){this._clearDocumentListByKey(e.kb_guid,"document_guid",e.document_guid)},saveDocumentListByDocument:function(e){if(e){e=this.filter([e])[0];var t,n=e.kb_guid,r=e.document_category,o=e.document_tag_guids;this._clearDocumentListByKey(e.kb_guid,"document_guid",e.document_guid),t=this.map[n+"_keyword"],t&&t.push(e),t=this.map[n+"_noTag"],!o&&t&&t.push(e),t=this.map[n+"_category_"+r],t&&t.push(e);var i,a,s,u=o?o.split(";"):[];for(i=0,a=u.length;a>i;i++)s=u[i],t=this.map[n+"_tag_"+s],t&&t.push(e)}},filter:function(e){if(!e||0===e.length)return e;for(var t,n,r=e.length-1;r>=0;r--)t=e[r],n=t.version,t.version=t.version?parseInt(t.version,10):"",isNaN(t.version)&&(t.version=n),t.document_category&&0===t.document_category.indexOf("/Deleted Items/")&&e.splice(r,1),t.document_owner&&(t.userIcon=a.getUserIcon(t.document_owner));return e}}),c=new l,d=o.extend({_getKey:function(e){return"keyword"==e.action_cmd&&e.action_value||"search"==e.action_cmd?null:"version"==e.action_cmd?e.kb_guid+"_version":"keyword"==e.action_cmd?e.kb_guid+"_keyword":"noTag"==e.action_cmd?e.kb_guid+"_noTag":e.kb_guid+"_"+e.action_cmd+"_"+e.action_value},_isCacheLoading:function(e){return c.isLoading(this._getKey(e))},_getCacheData:function(e){return c.getDocumentList(this._getKey(e))},_getCacheDataByRemote:function(e,t){function n(n){if(c.setLoading(r,!1),!n||!n.code||"200"!=n.code)return void t(null,{msg:s.docDocument.err.document_getList});var o,i,a,u=n.list||n.result,l=[];if("search"==e.action_cmd&&u&&u.length>0){for(o=0,i=u.length;i>o;o++)a=u[o].source,l.push({dt_modified:a.dt_modified,kb_guid:a.kb_guid,document_category:a.obj_category,document_guid:a.obj_guid,document_owner:a.obj_owner,document_summary:a.obj_summary,document_title:a.obj_title});u=l}c.setDocumentList(r,u),t(r?c.getDocumentList(r):u)}"keyword"!=e.action_cmd||e.action_value?e.count=e.count||200:(e.action_cmd="version",e.order="desc",e.count=100);var r=this._getKey(e),o=e.kb_guid;c.setLoading(r,!0),"search"==e.action_cmd?i.doc.searchDocumentList(e.action_value,e.count,n):i.doc.getDocumentList(o,e,n)},_clearCache:function(e){c.clearCache(this._getKey(e))},_autoLoadClear:function(){this._autoTimer&&clearTimeout(this._autoTimer)},_autoLoadStart:function(e,t,n){var r=this;this._autoTimer=setTimeout(function(){var o=r._getCallback.apply(r,[t,n,!0]);r._getCacheDataByRemote.apply(r,[e,o]),r._autoLoadStart(e,t,n)},u.baseModel.documentListAuto)},getBase:function(e,t,n){if(this._autoLoadClear(),this._super.apply(this,arguments),this._getKey(e)){if(!this._isCacheLoading(e)){var r=this._getCallback.apply(this,[t,n,!0]);this._getCacheDataByRemote.apply(this,[e,r])}e.auto&&this._autoLoadStart(e,t,n)}},clearDocumentListByCategory:function(e,t){c.clearDocumentListByCategory(e,t)},clearDocumentListByDocument:function(e){c.clearDocumentListByDocument(e)},saveDocumentListByDocument:function(e){c.saveDocumentListByDocument(e)}}),g=new d;t.exports=g},{"../../config/wizConf":13,"../database/remote":17,"../database/wizCenter":18,"./BaseModel":21,"./CacheModel":24,locale:"locale"}],29:[function(e,t,n){var r=e("./CacheModel"),o=e("./BaseModel"),i=e("../database/remote"),a=r.extend({getDocumentSummary:function(e){var t,n,r,o,i=e.split(","),a=[];for(r=0,o=i.length;o>r;r++)t=i[r],n=this.map[t],n&&a.push(n);return a.length>0?a:null},getSummaryCacheList:function(e){var t,n,r,o,i=e.split(","),a={summary:[],noCache:[]};for(r=0,o=i.length;o>r;r++)t=i[r],n=this.map[t],n?a.summary.push(n):a.noCache.push(t);return a},setDocumentSummary:function(e){var t,n;for(t in e)e.hasOwnProperty(t)&&(n=e[t],n.docGuid=t,this.map[t]=n)}}),s=new a,u=o.extend({_getKey:function(e){return e.doc_guids},_isCacheLoading:function(e){return s.isLoading(this._getKey(e))},_getCacheData:function(e){return s.getDocumentSummary(this._getKey(e))},_getCacheDataByRemote:function(e,t){var n=this._getKey(e),r=e.kb_guid,o=e.doc_guids;s.setLoading(n,!0),i.doc.getDocumentSummary(r,o,function(e){if(s.setLoading(n,!1),e&&e.code&&"200"==e.code){var r=e.result;s.setDocumentSummary(r),t(n?s.getDocumentSummary(n):r)}})},_clearCache:function(e){s.clearCache(this._getKey(e))},getBase:function(e,t,n){var r=this._getKey(e),o=s.getSummaryCacheList(r);o.noCache.length>0&&(e.doc_guids=o.noCache.join(","),this._super.apply(this,[e,t,n])),o.summary.length>0&&n.apply(this,[o.summary])}}),l=new u;t.exports=l},{"../database/remote":17,"./BaseModel":21,"./CacheModel":24}],30:[function(e,t,n){var r=e("./CacheModel"),o=e("./BaseModel"),i=e("../database/remote"),a=e("../database/wizCenter"),s=e("../../config/wizConf"),u=e("../util/GlobalUtil"),l=e("locale"),c=r.extend({getBizGroupList:function(){return this.map.groupList?this.map.groupList[a.bizInfo.biz_guid]:null},getAllGroupList:function(){return this.map.groupList?this.map.groupList.all:null},getOwnerGroupList:function(){return this.map.groupList?this.map.groupList.owner:null},getAllGroupStructure:function(){return this.map.groupList?{personalGroup:this.map.groupList.personalGroup||[],bizList:this.map.bizList||[]}:null},getGroupList:function(){return a.bizInfo?this.getBizGroupList():this.getAllGroupList()},getGroupByKbGuid:function(e){var t,n,r=this.getGroupList();if(!r)return null;for(t=r.length-1;t>=0;t--)if(n=r[t],n.kbGuid==e)return n;return null},createGroupList:function(){this.map.groupList||(this.map.groupList={}),this.map.groupList[a.bizInfo.biz_guid]||(this.map.groupList[a.bizInfo.biz_guid]=[])},setGroupList:function(e){if(e){e=this.groupListFilter(e);for(var t=0,n=e.length;n>t;t++)e[t].kbIcon||(e[t].kbIcon="default");this.createGroupList(),this.map.groupList[a.bizInfo.biz_guid]=e,this.sortGroupList()}},groupListFilter:function(e){if(!e)return null;var t,n,r,o=[];for(t=0,n=e.length;n>t;t++)r=e[t],r.bizGuid==a.bizInfo.biz_guid&&(r.kbNote=r.kbNote?r.kbNote:"",o.push(r));return o},sortGroupList:function(){this.map.groupList[a.bizInfo.biz_guid].sort(function(e,t){return e.kbName.localeCompare(t.kbName)})},setAllGroupList:function(e){if(e){this.map.groupList||(this.map.groupList={}),this.map.groupList.all=e,this.map.groupList.owner=[],this.map.groupList.personalGroup=[],this.map.bizList=[];var t,n,r,o=[],i={};for(t=0,n=e.length;n>t;t++)r=e[t],r.kbIcon||(r.kbIcon="default"),r.kbOwner&&this.map.groupList.owner.push(r),r.bizGuid?(i[r.bizGuid]||(i[r.bizGuid]=[],this.map.bizList.push({biz_guid:r.bizGuid,biz_name:r.bizName,groups:i[r.bizGuid]})),i[r.bizGuid].push(r)):_WIZ_CONFIG.oem.getData("HidePersonalGroup")||this.map.groupList.personalGroup.push(r),a.bizInfo&&a.bizInfo.biz_guid==r.bizGuid&&o.push(r);o.length>0&&this.setGroupList(o)}},addGroup:function(e){this.createGroupList();var t=this.getGroupList();t.push(e),this.sortGroupList();

},deleteGroup:function(e){var t,n,r=this.getGroupList();if(r)for(t=r.length-1;t>=0;t--)if(n=r[t],n.kbGuid==e)return void r.splice(t,1)},updateGroup:function(e){var t,n,r=this.getGroupList();if(r){for(t=r.length-1;t>=0;t--)if(n=r[t],n.kbGuid==e.kb_guid)return n.kbName=e.kb_name,void("string"==typeof e.kb_note&&(n.kbNote=e.kb_note));this.sortGroupList()}},createGroupMembers:function(e){var t=this.getGroupByKbGuid(e);t&&(t.members||(t.members=[]))},getGroupMemberList:function(e){var t=this.getGroupByKbGuid(e);return t&&t.members?t.members:null},memberListFilter:function(e,t){var n,r,o;for(n=e.length-1;n>=0;n--)r=e[n],r.user_id=r.user_id.toLowerCase(),u.verifyEmail(r.user_id)?r.email=r.user_id:r.mobile=r.user_id,o=t?f._controller.models.bizInfo.getBizMember("user_id",r.user_id):null,r.alias=t?o?o.alias:"":r.user_name||u.getAlias(r.user_id),r.avatar=a.getUserIcon(r.user_guid||r.user_id),r.is_owner?(r.user_role=0,r.role_state=1,r.real_user=!0):r.real_user="undefined"!=typeof r.role_state},setGroupMemberList:function(e,t){var n=this.getGroupByKbGuid(e);if(n){delete n.members,this.createGroupMembers(e),n.exMembers={};var r,o,i;for(r=0,o=t.length;o>r;r++)i=t[r],n.members.push(i);this.sortGroupMemberList(e)}},sortGroupMemberList:function(e){var t=this.getGroupByKbGuid(e);t&&t.members&&(this.memberListFilter(t.members,!!t.bizGuid),t.members.sort(function(e,t){return e.is_owner?-1:t.is_owner?1:e.user_role!=t.user_role?e.user_role-t.user_role:!e.role_state||2!=e.role_state||t.role_state&&2==t.role_state?!t.role_state||2!=t.role_state||e.role_state&&2==e.role_state?e.alias&&t.alias?e.alias.localeCompare(t.alias):e.alias?-1:t.alias?1:e.user_id.localeCompare(t.user_id):-1:1}))},getGroupMemberByUserId:function(e,t){var n=this.getGroupMemberList(e);if(!n)return null;var r,o;for(r=n.length-1;r>=0;r--)if(o=n[r],o.user_id==t)return o;return null},searchGroupMember:function(e,t){function n(e,t){if(!t||!e)return!1;t=t.split(/[,; ，；]/);var n,r,o;for(n=0,r=t.length;r>n;n++)if(o=$.trim(t[n]),o.length>0&&(e.user_id.indexOf(o)>-1||e[i]&&e[i].indexOf(o)>-1))return!0;return!1}var r=this.getGroupByKbGuid(e),o=r&&r.bizGuid,i=o?"alias":"user_name",a=this.getGroupMemberList(e);if(!a)return null;var s,u,l=[];for(s=a.length-1;s>=0;s--)u=a[s],n(u,t)&&l.push(u);return l},addGroupMember:function(e,t){this.createGroupMembers(e);var n,r,o,i=this.getGroupMemberList(e),a=0;for(n=t.length-1;n>=0;n--)r=t[n],r&&200==r.return_code&&(o=this.getGroupMemberByUserId(e,r.user_id),o?o.user_role=r.user_group:(o={user_id:r.user_id,user_role:r.user_group,todo_state:0},i.push(o)),a++);return this.sortGroupMemberList(e),a},updateMemberAlias:function(e,t){var n,r,o,i,a,s=this.getBizGroupList();for(n=s.length-1;n>=0;n--){for(o=s[n],a=!1,r=o.members.length-1;r>=0;r--)if(i=o.members[r],i.user_id==e){i.alias=t,a=!0;break}a&&this.sortGroupMemberList(o.kbGuid)}},getGroupIcon:function(e){var t=this.getGroupByKbGuid(e);return t?t.kbIcon:null},setGroupIcon:function(e,t){var n=this.getGroupByKbGuid(e);n&&(n.kbIcon=t)},deleteGroupMember:function(e,t){var n,r,o=this.getGroupMemberList(e),i={};if(o){for(n=t.length-1;n>=0;n--)r=t[n],r&&(r.user_id&&(i[r.user_id]=!0),r.user_guid&&(i[r.user_guid]=!0));for(n=o.length-1;n>=0;n--)r=o[n],(r.user_id&&i[r.user_id]||r.user_guid&&i[r.user_guid])&&o.splice(n,1)}},deleteGroupMemberFromBiz:function(e){var t,n,r=this.getBizGroupList();if(r)for(t=r.length-1;t>=0;t--)n=r[t],this.deleteGroupMember(n.kbGuid,[{user_id:e}])},getGroupStorage:function(e){return this.map.groupStorage?this.map.groupStorage[e]:null},setGroupStorage:function(e,t){e&&t&&(this.map.groupStorage||(this.map.groupStorage={}),this.map.groupStorage[e]=t)}}),d=new c,g=o.extend({createBizGroup:function(e,t){function n(e,n){f.getGroupMemberList({kb_guid:e.kb_guid},function(){var r=d.getGroupByKbGuid(e.kb_guid);t(r),f.doc.trigger(f.frameEventType.EventManager,[f.dataOperateType.OnCreateBizGroup,r,n])})}return f._controller.checkBizExpired(a.bizInfo)?void i.group.createBizGroup({kb_name:e.kb_name,kb_note:e.kb_note,biz_guid:e.biz_guid},function(r){if(r&&200==r.code){var o=a.userInfo.user_guid==a.bizInfo.owner_guid;d.addGroup({bizGuid:e.biz_guid,kbGuid:r.kb_guid,kbId:r.kb_id,kbName:e.kb_name,kbNote:e.kb_note,kbIcon:e.kb_icon,kbOwner:o,dtCreated:(new Date).valueOf(),roleNote:"",roleState:1,userGroup:o?s.web.authority.group.admin:"-1"}),f.getGroupMemberList({kb_guid:r.kb_guid},function(){if(e.join_group){var t={user_id:a.userInfo.user_id,user_group:0};f.addGroupMember({kb_guid:r.kb_guid,users:[t]},function(){n(r,null)})}else n(r,e.biz_guid)})}else{if(r&&327==r.code){var i;i=_WIZ_CONFIG.oem.enable||a.bizInfo.biz_level>=s.web.groupMaxCount.biz.maxLevel?l.common.label.call400.replace("$1",s.web.companyInfo.hotline):'<a href="'+f._controller.models.bizInfo.getBizPayLink()+'" target="_blank">'+l.common.label.upgradeLink+"</a>",f._controller.showErrorMessage({msg:l.groupManage.err.groupAmountFull.replace("$1",s.web.groupMaxCount.biz[a.bizInfo.biz_level])+i})}else if(r&&36005==r.code){var u='<a href="'+s.url.user.account_setting+'&mod=createBind" title="'+l.groupManage.err.createGroupOnlyOauth+'" target="_blank">'+l.groupManage.err.createGroupOnlyOauth+"</a>",c=l.groupManage.err.createGroupOnlyOauthBefore+u+l.groupManage.err.createGroupOnlyOauthAfter;f._controller.showErrorMessage({msg:c,auto:-1})}else f._controller.showErrorMessage({msg:l.groupManage.err.createGroup});t()}}):void t()},createPersonalGroup:function(e,t){i.group.createPersonalGroup(e,function(e){if(e&&200==e.code)return void t(e.group);if(e&&36005==e.code){var n='<a href="'+s.url.user.account_setting+'&mod=createBind" title="'+l.groupManage.err.createGroupOnlyOauth+'" target="_blank">'+l.groupManage.err.createGroupOnlyOauth+"</a>",r=l.groupManage.err.createGroupOnlyOauthBefore+n+l.groupManage.err.createGroupOnlyOauthAfter;f._controller.showErrorMessage({msg:r,auto:-1})}else f._controller.showErrorMessage({msg:l.groupManage.err.createGroup,auto:-1});t()})},updateGroup:function(e,t){i.group.updateGroup(e,function(n){n&&200==n.code?(d.updateGroup(e),t(!0),f._controller.showSuccessMessage({msg:l.groupManage.suc.updateInfo}),f.doc.trigger(f.frameEventType.EventManager,[f.dataOperateType.OnUpdateGroup])):(t(!1),f._controller.showErrorMessage({msg:l.groupManage.err.updateInfo}))})},deleteGroup:function(e,t){i.group.deleteGroup(e,function(n){n&&200==n.code?(d.deleteGroup(e.kb_guid),t(!0),f._controller.showSuccessMessage({msg:l.groupManage.suc.deleteGroup}),f.doc.trigger(f.frameEventType.EventManager,[f.dataOperateType.OnDeleteGroup])):(t(),f._controller.showErrorMessage("366"==n.code?{msg:l.common.err.checkCode}:{msg:l.groupManage.err.deleteGroup}))})},createDefaultDocument:function(e,t){e.lang=wizUI.util.getLocale(),i.group.createDefaultDocument(e,function(e){e&&e.code?t(e):t()})},createGroupCategory:function(e,t){i.group.createGroupCategory(e,function(e){e&&e.code?t(e):t()})},getBizGroupList:function(e){var t=d.getBizGroupList();return t?void e(t):void i.group.getBizGroupList({biz_guid:a.bizInfo.biz_guid},function(n){n&&200==n.code?(t=n.group_list||[],d.setGroupList(t),e(d.getBizGroupList())):e()})},getAllGroupList:function(e){var t=d.getAllGroupList();return t?void e(t):void i.group.getAllGroupList(function(n){n&&200==n.code?(t=n.group_list||[],d.setAllGroupList(t),e(d.getAllGroupList())):e()})},getAllGroupStructure:function(){var e=d.getAllGroupStructure()||{personalGroup:[],bizList:[]};return e.personalKb=a.personalKb,e},getOwnerGroupList:function(e){function t(){e(d.getOwnerGroupList())}this.getAllGroupList(t)},getGroup:function(e){return d.getGroupByKbGuid(e)},getGroupMemberList:function(e,t){var n=e.kb_guid,r=d.getGroupMemberList(n);return r?void t(r):void i.group.getGroupMemberList(e,function(e){e&&200==e.code?(r=e.user_list||[],d.setGroupMemberList(n,r),t(d.getGroupMemberList(n))):t()})},checkNewGroupMemberList:function(e,t,n){function r(e){for(o=0;c>o;o++)if(a=t[o].toLowerCase(),u.userIdNeedVerify(a))f.push(a);else if(u.verifyEmail(a)){if(u.verifyMyWizEmail(a)){h.push(a);continue}for(s=!1,i=0;i<e.length;i++)if(e[i].user_id===a){s=!0;break}s?g.push(a):l[a]||(f.push(a),l[a]=1)}else{if(""===$.trim(a))continue;d.push(a)}n({good:f,bad:d,exist:g,mywiz:h})}var o,i,a,s,l={},c=t.length,d=[],g=[],f=[],h=[];e?this.getGroupMemberList({kb_guid:e},r):r([])},setGroupIcon:function(e,t){var n=e.kb_guid,r=e.kb_icon;if(n&&r){var o=this.getGroup(n);e.kb_name=o.kbName,e.kb_note=o.kbNote,i.group.updateGroup(e,function(e){e&&200==e.code?(d.setGroupIcon(n,r),t(r),f._controller.showSuccessMessage({msg:l.groupManage.suc.updateGroupIcon})):(f._controller.showErrorMessage({msg:l.groupManage.err.updateGroupIcon}),t())})}},getGroupMemberListWithAll:function(e,t){var n=2,r=[],o=[],i=[],a=function(){if(n--,!(n>0)){if(o.length==r.length)return void t(r,i);var e,a,s,u={};for(e=0,a=r.length;a>e;e++)s=r[e],u[s.user_id]=!0;for(e=0,a=o.length;a>e;e++)s=o[e],u[s.user_id]||i.push(s);t(r,i)}};this.getGroupMemberList(e,function(e){e&&(r=e),a()}),this._controller.models.bizInfo.getBizMemberList(e,function(e){e&&(o=e),a()})},getGroupMember:function(e,t){return d.getGroupMemberByUserId(e,t)},searchGroupMember:function(e,t){return d.searchGroupMember(e,t)},updateGroupMemberRole:function(e,t){f.addGroupMember(e,function(n){if(n){t&&t(!0),f._controller.showSuccessMessage({msg:l.groupMember.suc.updateMember});var r,o,i=[];for(r=0,o=e.users.length;o>r;r++)i.push(e.users[r].user_id);f.doc.trigger(f.frameEventType.EventManager,[f.dataOperateType.OnUpdateGroupMemberRole,e.kb_guid,i,["user_role"]])}else n!==!1&&(t&&t(),f._controller.showErrorMessage({msg:l.groupMember.err.updateMember}))},!0)},addGroupMember:function(e,t,n){if(!f._controller.checkBizExpired(a.bizInfo))return void(t&&t(!1));var r=e.kb_guid,o=e.users;e.users=JSON.stringify(e.users),i.group.addGroupMember(e,function(e){if(e&&200==e.code){var i,a,s,u=e.result,c={};for(i=0,a=u.length;a>i;i++)s=u[i],c[s.user_id]=s.return_code;for(i=0,a=o.length;a>i;i++)s=o[i],c[s.user_id]&&(s.return_code=c[s.user_id]);var g=d.addGroupMember(r,o);t&&t(g>0?e:null),n||f._controller.showSuccessMessage({msg:l.groupMember.suc.addMember}),f.doc.trigger(f.frameEventType.EventManager,[f.dataOperateType.OnUpdateGroupMember,r])}else t&&t(),n||f._controller.showErrorMessage({msg:l.bizGuide.err.assignMember})})},updateMemberAlias:function(e,t){d.updateMemberAlias(e,t)},deleteGroupMember:function(e,t,n){if(!f._controller.checkBizExpired(a.bizInfo))return void t(!1);var r,o,s,u=e.kb_guid,c=e.users;for(r=0,o=c.length;o>r;r++)s=c[r],"guid"==s.type?s.user_id="":s.user_guid="";e.users=JSON.stringify(e.users),i.group.deleteGroupMember(e,function(e){e&&200==e.code?(d.deleteGroupMember(u,c),t(!0),n||f._controller.showSuccessMessage({msg:l.groupMember.suc.removeMember}),f.doc.trigger(f.frameEventType.EventManager,[f.dataOperateType.OnUpdateGroupMember,u])):(t(),n||f._controller.showErrorMessage({msg:l.groupMember.err.removeMember}))})},deleteGroupMemberFromBiz:function(e){d.deleteGroupMemberFromBiz(e)},getMemberRoleInGroups:function(e){var t,n,r,o,i,a=d.getBizGroupList(),s=[];if(!a)return[];for(t=0,n=a.length;n>t;t++)r=a[t],o=d.getGroupMemberByUserId(r.kbGuid,e),i={kbGuid:r.kbGuid,kbName:r.kbName},o?(i.user_role=o.user_role,i.real_user=o.real_user):(i.user_role=-1,i.real_user=!1),s.push(i);return s.sort(function(e,t){return e.user_role==t.user_role||-1!=e.user_role&&-1!=t.user_role?e.kbName.localeCompare(t.kbName):e.user_role-t.user_role}),s},getGroupStorage:function(e,t){if(e){var n=d.getGroupStorage(e);return n?void t(n):void i.group.getGroupStorage({kb_guid:e},function(r){if(r&&200==r.code){n=r.kb_info||{};var o,i,s,u,c,g=d.getGroupByKbGuid(e),h=g&&f._controller.models.bizInfo?f._controller.models.bizInfo.getBizByGuid(g.bizGuid):null,p=!!g&&!!g.bizGuid,m=!!h&&h.biz_level>1,v={};p?(1==a.bizInfo.biz_level&&(n.notes_count_limit=5e3),i=parseInt(n.notes_count),s=parseInt(n.notes_count_limit),u=n.notes_count+"",c=n.notes_count_limit+""):(i=parseInt(n.storage_usage),s=parseInt(n.storage_limit),u=n.storage_usage_string,/^[0-9]*$/.test(u)&&(u=Math.round(i/1024*10)/10+"K"),c=n.storage_limit_string),v.vip=m,v.status="normal",m?v.storageStr=u:s>i?(0===i?o=0:(o=+(100*i/s).toFixed(2),o=o>2?o:2),v.percentage=o,v.storageStr=u+"/"+c,v.status=80>o?"normal":"warn"):(v.status="overflow",v.percentage=100,v.storageStr=u+"/"+c),p&&(v.storageStr=v.storageStr+l.common.unit.notes),n.calculate=v,d.setGroupStorage(e,n),t(d.getGroupStorage(e))}else f._controller.showErrorMessage({msg:l.groupManage.err.getStorage}),t()})}},quitGroup:function(e,t){i.group.quitGroup({kb_guid:e},function(e){e&&200==e.code?(t(!0),f.doc.trigger(f.frameEventType.EventManager,[f.dataOperateType.OnQuitGroup])):t(!1)})}}),f=new g;t.exports=f},{"../../config/wizConf":13,"../database/remote":17,"../database/wizCenter":18,"../util/GlobalUtil":35,"./BaseModel":21,"./CacheModel":24,locale:"locale"}],31:[function(e,t,n){var r=e("./CacheModel"),o=e("./BaseModel"),i=e("../database/remote"),a=e("../database/wizCenter"),s=e("locale"),u=e("../../config/wizConf"),l={},c=!1,d=r.extend({maxVersion:0,lastMaxVersion:0,addMsgCount:0,getMessageList:function(e){return this.getAllMessageList(e)},filter:function(e,t){function n(e,t){var n,r,o;if(isNaN(e)||isNaN(t[0]))return!0;for(n=0,r=t.length;r>n;n++)if(o=t[n],!isNaN(e)&&e==o)return!0;return!1}if(!t)return t;var r=(e.message_type+"").split("/"),o=e.read_status;if(isNaN(r[0])&&isNaN(o))return t;var i,a,s,u=[];for(i=0,a=t.length;a>i;i++)s=t[i],n(s.message_type,r)&&(isNaN(o)||!isNaN(o)&&s.read_status===o)&&u.push(s);return u},setMessageList:function(e){var t=e.length-1,n=!1;for(this.map.list||(this.map.list=[],n=!0),this.addMsgCount=0,this.lastMaxVersion=this.maxVersion;t>=0;t--)this.setMessage(e[t]);n&&(this.addMsgCount=0),c=!0},setMessage:function(e){if(e){if(this.setMaxVersion(e.version),e.delete_status)return void this.deleteMessage(e.id);if(l[e.id]&&e.read_status)return void(l[e.id].read_status=e.read_status);l[e.id]=e,this.initMessage(e);var t=this.map.list||[],n=t.length>0?t[0].version:0;e.version>=this.lastMaxVersion&&this.addMsgCount++,e.version>=n?t.splice(0,0,e):t.push(e),this.map.list=t}},setMaxVersion:function(e){this.maxVersion=this.maxVersion<e?e+1:this.maxVersion},initMessage:function(e){switch(e.sender_guid&&(e.userIcon=a.getUserIcon(e.sender_guid)),e.message_type){case 0:e.message_body=s.docMsg.template.at.replace("$1",e.title);break;case 1:e.message_body=s.docMsg.template.modified.replace("$1",e.title);break;case 10:e.message_body=s.docMsg.template.commented.replace("$1",e.title);break;case 20:e.message_body=s.docMsg.template.cmtAt.replace("$1",e.title);break;case 30:e.message_body=s.docMsg.template.reply.replace("$1",e.title)}},getAllMessageList:function(e){var t;return t=this.filter(e,this.map.list),t?this.sortList(t):null},sortList:function(e){return e.sort(function(e,t){return t.dt_created-e.dt_created}),e},setMessageStatus:function(e,t){var n=l[e];if(n){var r;for(r in t)t.hasOwnProperty(r)&&(n[r]=t[r])}},deleteMessage:function(e){if(delete l[e],this.map.list){var t,n,r;for(t=0,n=this.map.list.length;n>t;t++)if(r=this.map.list[t],r.id==e)return void this.map.list.splice(t,1)}}}),g=new d,f=o.extend({_getKey:function(e){return e.kb_guid},_isCacheLoading:function(e){return g.isLoading(this._getKey(e))},_getCacheData:function(e){return g.getMessageList(e)},_getCacheDataByRemote:function(e,t){function n(n){if(g.setLoading(r,!1),!n||!n.code||"200"!=n.code)return void t(null,{msg:s.docMsg.err.message_getList});var o=n.result;g.setMessageList(o),t(g.getMessageList(e))}var r=this._getKey(e);g.setLoading(r,!0);var o={};g.maxVersion?o.version=g.maxVersion:o.delete_status=0,i.doc.getMessageList(o,n)},_clearCache:function(e){g.clearCache(this._getKey(e))},_autoLoadClear:function(){this._autoTimer&&clearTimeout(this._autoTimer)},_autoLoadStart:function(e,t,n){var r=this;this._autoTimer=setTimeout(function(){var o=r._getCallback.apply(r,[t,n,!0]);r._getCacheDataByRemote.apply(r,[e,o]),r._autoLoadStart(e,t,n)},u.baseModel.messageListAuto)},getBase:function(e,t,n){if(this._autoLoadClear(),this._super.apply(this,arguments),!this._isCacheLoading(e)){var r=this._getCallback.apply(this,[t,n,!0]);this._getCacheDataByRemote.apply(this,[e,r])}e.auto&&this._autoLoadStart(e,t,n)},markAllReadStatus:function(e){var t,n,r=this._getCacheData({message_type:"-",read_status:0}),o=[];if(0!==r.length){for(t=0,n=r.length;n>t;t++)o.push(r[t].id);this.setMessageStatus(o.join(","),{read_status:1},e)}},setMessageStatus:function(e,t,n){g.addMsgCount=0,i.doc.setMessageStatus(e,function(r){var o,i,a;if(200==r.code){for(o="string"==typeof e&&e.indexOf(",")>-1?e.split(","):[e],i=0,a=o.length;a>i;i++)g.setMessageStatus(o[i],t);n()}})},deleteMessage:function(e,t){g.addMsgCount=0,i.doc.deleteMessage(e,function(n){var r,o,i;if(200==n.code)for(r="string"==typeof e&&e.indexOf(",")>-1?e.split(","):[e],o=0,i=r.length;i>o;o++)g.deleteMessage(r[o]);t()})},getAddMsgCount:function(){return g.addMsgCount},getAllMsgCount:function(){return g.map.list?g.map.list.length:0}});t.exports=new f},{"../../config/wizConf":13,"../database/remote":17,"../database/wizCenter":18,"./BaseModel":21,"./CacheModel":24,locale:"locale"}],32:[function(e,t,n){var r=e("../../config/wizConf"),o=e("./CacheModel"),i=e("./BaseModel"),a=e("../database/remote"),s=e("./Authority"),u=e("locale"),l={unCategorizedNode:{tag_name:u.docMenu.label.unClassified,type:r.web.note.menuType.tag,childType:r.web.note.menuType.tag,cmd:r.web.note.menuCmd.noTag,isParent:!1},createTagNodes:{name:u.docMenu.label.createTag,cmd:r.web.note.menuCmd.create,type:r.web.note.menuType.tag,iconSkin:r.web.note.menuCmd.create},createTagNodesForGroup:{name:u.docMenu.label.createCategory,cmd:r.web.note.menuCmd.create,type:r.web.note.menuType.tag,iconSkin:r.web.note.menuCmd.create}},c=o.extend({getFullTagName:function(e,t){var n="",r=[],o=this.getTag.apply(this,arguments);if(!o)return n;var i=this.getTag.apply(this,[e,o.tag_group_guid]);for(r.push(o.tag_name);i;)r.push(i.tag_name),i=this.getTag.apply(this,[e,i.tag_group_guid]);return r.reverse(),n=r.join("/")},getTag:function(e,t){var n=this.map[e],r=null;return n&&(r=n[t]),r},setTag:function(e,t){if(t){this.list[e]=t,this.map[e]={};for(var n=0,r=t.length;r>n;n++)this.addTagMap.apply(this,[e,t[n]])}},addTagMap:function(e,t){var n=this.map[e];t.tag_guid&&(n[t.tag_guid]=t)},addTag:function(e,t){this.map[e][t.tag_guid]=t;var n=this.list[e];n.splice(n.length-1,0,t)},deleteTag:function(e,t){delete this.map[e][t];for(var n,r=this.list[e],o=0,i=r.length;i>o;o++)if(n=r[o],n.tag_guid==t){r.splice(o,1);break}},renameTag:function(e,t,n){var r=this.map[e][t.tag_guid];return t.tag_name=n,r.name=r.tag_name=n,r},sortList:function(e){return e.sort(function(e,t){return e.position?e.position-t.position:e.tag_name.localeCompare(t.tag_name)}),e},initForTree:function(e,t){$.each(t,function(t,n){n.name||(n.name=n.tag_name),n.id=n.tag_guid?n.tag_guid:"_"+(new Date).valueOf(),n.pId=n.tag_group_guid?n.tag_group_guid:"",n.type="tag",n.kb_guid=e})}}),d=new c,g=i.extend({_getKey:function(e){return e.kb_guid},_isCacheLoading:function(e){return d.isLoading(this._getKey(e))},_getCacheData:function(e){return d.list[this._getKey(e)]},_getCacheDataByRemote:function(e,t){var n=this._getKey(e),r=!!this._controller.models.groupInfo.getGroup(n);d.setLoading(n,!0),a.doc.getAllTag(n,function(e){if(d.setLoading(n,!1),!e||!e.code||"200"!=e.code)return void t(d.list[n],{msg:r?u.docCategory.err.category_getList:u.docCategory.err.tag_getList});var o=d.sortList(e.list);r&&o.splice(0,0,l.unCategorizedNode),s.modifyCategory(n)&&o.push(r?l.createTagNodesForGroup:l.createTagNodes),d.initForTree(n,o),d.setTag(n,o),t(d.list[n])})},_clearCache:function(e){d.clearCache(this._getKey(e))},getTagName:function(e,t){var n="",r=d.getTag.apply(d,arguments);return r&&r.tag_name&&(n=r.tag_name),n},getTagNameForGroup:function(e,t){var n=d.getFullTagName.apply(d,[e,t]);return n=n?n:u.docMenu.label.unClassified,n="/"+n+"/"},addTag:function(e,t){var n=this,r=this._getKey(e),o=!!this._controller.models.groupInfo.getGroup(r),i=e.name,s=e.parent,l=s&&s.tag_guid?s.tag_guid:"";a.doc.addTag(r,i,l,function(e){var a;e&&e.code&&"200"==e.code?(a={dt_info_modified:"",tag_group_guid:l,tag_guid:e.tag_guid,tag_description:"",tag_name:i,version:"0"},d.initForTree(r,[a]),d.addTag.apply(d,[r,a])):n._controller.showErrorMessage({msg:o?u.docCategory.err.category_create:u.docCategory.err.tag_create}),t.apply(n,[r,a])})},deleteTag:function(e,t){var n=this,r=this._getKey(e),o=!!this._controller.models.groupInfo.getGroup(r),i=e.tag_node.tag_guid,s=!0;a.doc.deleteTag(r,i,function(e){e&&e.code&&"200"==e.code?d.deleteTag.apply(d,[r,i]):(n._controller.showErrorMessage({msg:o?u.docCategory.err.category_delete:u.docCategory.err.tag_delete}),s=!1),t.apply(n,[r,s])})},renameTag:function(e,t){var n=this,r=this._getKey(e),o=!!this._controller.models.groupInfo.getGroup(r),i=e.name,s=e.tag_node;a.doc.renameTag(r,s.tag_guid,i,function(e){var a;e&&e.code&&"200"==e.code?a=d.renameTag.apply(d,[r,s,i]):n._controller.showErrorMessage({msg:o?u.docCategory.err.category_rename:u.docCategory.err.tag_rename}),t.apply(n,[r,a])})}}),f=new g;t.exports=f},{"../../config/wizConf":13,"../database/remote":17,"./Authority":20,"./BaseModel":21,"./CacheModel":24,locale:"locale"}],33:[function(e,t,n){var r=e("./CacheModel"),o=e("./BaseModel"),i=e("../database/remote"),a=e("../database/wizCenter"),s=e("../../config/wizConf"),u=e("locale"),l=r.extend({init:function(){this._super.apply(this,arguments)},getUserInfo:function(){return this.map.user},setUserInfo:function(e){function t(e){var t;for(t in s.web.pointType)if(s.web.pointType.hasOwnProperty(t)&&0===e.indexOf(t))return s.web.pointType[t];return null}e.email_verified="true"===e.email_verified,e.onlyOauth=e.email&&0===e.email.indexOf("#"),e.icon=a.getUserIcon(e.user_guid||e.user_id)+"&_"+(new Date).valueOf(),this.map.user=e;var n,r,o,i;if(e.point_logs)for(n=0,r=e.point_logs.length;r>n;n++)o=e.point_logs[n],i=t(o.logCode),i&&(o.logMsg=u.accountSetting.pointType[i].replace("$1",o.logLong))},getUserBizInfo:function(){return this.map.biz},setUserBizInfo:function(e){this.map.biz=e}}),c=new l,d=s.remote.GET_USER_INFO_RETRY,g=o.extend({_getKey:function(e){return e.token},_isCacheLoading:function(e){return c.isLoading(this._getKey(e))},_getCacheData:function(){return c.getUserInfo()},_getCacheDataByRemote:function(e,t){var n=this._getKey(e);d--,c.setLoading(n,!0),i.user.getUserInfo(e,function(r){return c.setLoading(n,!1),r&&r.code&&"200"==r.code?r?(c.setUserInfo(r),void t(r)):void t(null):void(d>0&&r&&301!=r.code?f._getCacheDataByRemote(e,t):t(null))})},_clearCache:function(e){c.clearCache(this._getKey(e))},keepAlive:function(){i.user.keepAlive()},login:function(e,t){i.user.login(e,function(e){e&&e.code?t(e):t()})},logout:function(e,t){i.user.logout(e,function(){t()})},loginByCertNo:function(e){i.autoLogin(e)},register:function(e,t){var n=wizUI.util.getUrlParam("product_type");n&&(e.product_type=n);var r=wizUI.util.cookie("signup_source");r&&(e.signup_source=r),i.user.register(e,function(e){e&&e.code?t(e):t()})},checkUserId:function(e,t){i.user.checkUserId(e,t)},changeUserId:function(e,t){i.user.changeUserId(e,function(e){if(e&&200==e.code)return f._controller.showSuccessMessage({msg:u.accountSetting.suc.changeUserId}),void t(e);var n=u.accountSetting.err.changeUserId;e&&(31002==e.code?n=u.accountSetting.err.changeUserIdPwd:31e3==e.code&&(n=u.common.err[e.code])),f._controller.showErrorMessage({msg:n}),t()})},createBindOauth:function(e,t){i.user.createBindOauth(e,function(e){var n=u.accountSetting.suc.createBind;e&&200==e.code?(t(e),f._controller.showSuccessMessage({msg:n})):(t(),n=u.accountSetting.err.createBind,e&&31e3==e.code&&(n=u.accountSetting.err.hasBind),f._controller.showErrorMessage({msg:n}))})},updateUserInfo:function(e,t){i.user.updateUserInfo(e,function(n){var r=/[@#]/,o=u.accountSetting.suc.changeUserInfo;return n&&200==n.code?("mobile"==e.key&&r.test(a.userInfo.user_id)&&(o=u.accountSetting.suc.changeUserId),f._controller.showSuccessMessage({msg:o}),void t(n)):(o=u.accountSetting.err.changeUserInfo,f._controller.showErrorMessage({msg:o}),void t())})},changePassword:function(e,t){i.user.changePassword(e,function(e){e&&200==e.code?(f._controller.showSuccessMessage({msg:wizUI.isWizClient?u.accountSetting.suc.changePassword_client:u.accountSetting.suc.changePassword_web,auto:-1}),t(e)):(f._controller.showErrorMessage({msg:u.accountSetting.err.changePassword,auto:5e3}),t())})},resendVerifyEmail:function(e){i.user.resendVerifyEmail(function(t){t&&200==t.code?(f._controller.showSuccessMessage({msg:u.accountSetting.emailVerify.success}),e(t)):(f._controller.showErrorMessage({msg:u.accountSetting.emailVerify.fail}),e())})},getInviteUserList:function(e){i.user.getInviteUserList(function(t){t&&200==t.code?e(t):e()})},userPay:function(e,t){i.user.userPay(e,function(e){e&&200==e.code?t(e):e?(f._controller.showErrorMessage({msg:u.common.err[e.code]}),t()):t()})},payByPoint:function(e,t){i.user.payByPoint(e,function(e){e&&200==e.code?(t(e),f._controller.showSuccessMessage({msg:u.personalVipTable.pointExchange.success})):(t(),f._controller.showErrorMessage({msg:u.personalVipTable.pointExchange.fail}))})},payByCard:function(e,t){i.user.payByCard(e,function(e){e&&200==e.code?(t(e),f._controller.showSuccessMessage({msg:u.personalVipTable.card.success})):(t(),f._controller.showErrorMessage({msg:u.personalVipTable.card.fail}))})},validatePayCard:function(e,t){i.user.validatePayCard(e,function(e){e&&200==e.code?(t(e),f._controller.showSuccessMessage({msg:u.personalVipTable.card.verifySuc})):(t(),f._controller.showErrorMessage({msg:u.personalVipTable.card.fail}))})},getPersonalPayLog:function(e){i.user.getPersonalPayLog({charge_state:200},function(t){t&&200==t.code?e(t):e()})},bindSNS:function(e,t){i.user.bindSNSAccount(e,t)},unbindSNS:function(e,t){i.user.unbindSNSAccount(e,function(e){e&&200==e.code?t(e):t()})},oauthLogin:function(e,t){i.user.oauthLogin(e,function(e){t(e)})},oauthBind:function(e,t){e.type=1,i.user.oauthSignup(e,function(e){t(e)})},oauthCreate:function(e,t){e.type=2,i.user.oauthSignup(e,function(e){t(e)})},oauthAutoCreate:function(e,t){e.type=3,i.user.oauthSignup(e,function(e){t(e)})},resetPasswordApply:function(e,t){var n=!!e.noSucMsg;delete e.noSucMsg,i.user.resetPasswordApply(e,function(r){if(r&&"200"==r.code)return t(r),void(n||f._controller.showSuccessMessage({msg:u.resetPwd.suc.apply.replace("$1",e.email),auto:-1}));var o=u.resetPwd.err.apply;r&&"366"==r.code?o=u.common.err.checkCode:r&&"31004"==r.code&&(o=u.common.err[r.code]),f._controller.showErrorMessage({msg:o}),t()})},resetPassword:function(e,t){var n="";i.user.resetPassword(e,function(e){if(e){if("200"==e.code)return f._controller.showSuccessMessage({msg:u.resetPwd.suc.common.replace("$1",'<a href="'+s.url.common.login+'">'+u.common.label.login+"</a>")}),void t(e);n="31004"==e.code?u.common.err[e.code]:u.resetPwd.err.linkFailure,f._controller.showErrorMessage({msg:n}),t(e)}else f.controller.showErrorMessage({msg:u.common.err.server}),t()})},sendSmsCaptcha:function(e,t){i.weixin.sendSmsCaptcha(e,function(e){t(e)})},mobileLogin:function(e,t){i.weixin.mobileLogin(e,function(e){t(e)})},bindWeiboFans:function(e,t){e.state=wizUI.util.getUrlParam("state")||"",i.weibo.bind(e,function(e){t(e)})}}),f=new g;t.exports=f},{"../../config/wizConf":13,"../database/remote":17,"../database/wizCenter":18,"./BaseModel":21,"./CacheModel":24,locale:"locale"}],34:[function(e,t,n){function r(e){function t(){!o&&this.init&&this.init.apply(this,arguments)}var n=this.prototype;o=!0;var a=new this;o=!1;for(var s in e)a[s]="function"==typeof e[s]&&"function"==typeof n[s]&&i.test(e[s])?function(e,t){return function(){var r=this._super;this._super=n[e];var o=t.apply(this,arguments);return this._super=r,o}}(s,e[s]):e[s];return t.prototype=a,t.prototype.constructor=t,t.extend=r,t}var o=!1,i=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,a=function(){};a.extend=r,t.exports=a},{}],35:[function(e,t,n){var r=e("../../config/wizConf"),o={aliasReplaceReg:/[^\.a-zA-Z0-9\u4e00-\u9fa5_]/g,aliasTestReg:/^[\.a-zA-Z0-9\u4e00-\u9fa5_]+$/,userIdSpliter:/[\s,;，；　]/,replaceScriptTagReg:/<[\/]?script[^<>]*[\/]?>/gi,couponSN:/^[a-zA-Z0-9\-]{6,64}$/,promoteSN:/PR[a-zA-Z0-9]{8}/,verifyEmpty:function(e){return!!e},userIdNeedVerify:function(e){return _WIZ_CONFIG.oem.getData("NotVerifyUserIdForAddMember")?!!e:!1},verifyEmail:function(e){var t=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/;return t.test(e)},verifyMobile:function(e){var t=/^1[\d]{10}$/;return t.test(e)},verifyMyWizEmail:function(e){var t=/^\w+([-+.]\w+)*@mywiz\.cn$/;return t.test(e)},verifyWizEmail:function(e){var t=6,n=18,r=e.length;return""===e?!1:t>r?!1:/^\w[\w\-\.]*\w$/.test(e)?r>n?!1:!0:!1},verifyDiscoutSN:function(e){return o.isCouponSN(e)||o.isPromoteSN(e)},verifyMarkdown:function(e){return e?-1!=e.indexOf(".md ")?!0:-1!=e.indexOf(".md@")?!0:!!e.match(/\.md$/i):!1},getAlias:function(e){if(o.verifyEmail(e))return e.replace(/(.+)@.+/,"$1").replace(o.aliasReplaceReg,"");if(o.verifyMobile(e)){var t=new RegExp("(\\d{3})(\\d*)(\\d{4})");return e.replace(t,"$1....$3")}return e},checkValidBizName:function(e){var t=$.trim(e);return t.length>=2},checkValidBizTel:function(e){return e.length>5},checkValidAlias:function(e){e=$.trim(e);var t=o.aliasTestReg;return t.test(e)?"all"!==e:!1},checkValidPasswd:function(e,t,n){var r=t||6,i=n||100,a=$.trim(e);if(""===a)return!1;var s=o.isGoodPassword(a,r,i);if(s===!1)return!1;var u,l=!0;for(u=0;u<a.length;u++)a.charCodeAt(u)>255&&(l=!1);return!l||a.length<r?!1:a.length<=i},isValidGroupName:function(e){var t=$.trim(e);return t.length<2||t.length>30?!1:/^[\-\. a-zA-Z0-9_\u4e00-\u9fa5]+$/.test(t)?!o.isConSpeCharacters(t):!1},isValidGroupNote:function(e){return!0},isContainHtmlTag:function(e){var t=e.match(/[<>]/gi);return!t},isCouponSN:function(e){return o.couponSN.test(e)},isPromoteSN:function(e){return o.promoteSN.test(e)},getHost:function(e){var t=location.host;return/\.[0-9]$/.test(t),/\.[0-9]$/.test(t)===!1&&(t=e+".wiz.cn"),t},isGoodPassword:function(e,t,n){var r=t||6,o=n||16;return""===e||e.length<r||e.length>o?!1:!0},changeClass:function(e,t){$("#"+e).removeClass().addClass(t)},isWinPlatform:function(){var e=window.navigator.platform,t=0===e.toLowerCase().indexOf("mac"),n=0===e.toLowerCase().indexOf("linux");return!(t||n)},isIe:function(){return!!document.all},isConSpeCharacters:function(e){if(!e)return!1;var t=/[\\\/\*\?&:<>"']/gi;return!!e.match(t)},genGuid:function(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},lastIndexOfArray:function(e,t){if(Array.prototype.lastIndexOf)return Array.prototype.lastIndexOf.call(e,t);var n=e.length,r=n-1;for(0>r&&(r=Math.max(0,n+r));r>=0;r--)if(r in e&&e[r]===t)return r;return-1},getUtcTime:function(){var e=new Date,t=e.getTime(),n=6e4*e.getTimezoneOffset();return new Date(t+n)},getCurTime:function(){var e=new Date,t=e.getHours(),n=e.getMinutes(),r="";return r=10>n?t+":0"+n:t+":"+n},getFrameDocument:function(e){return e.contentDocument?e.contentDocument:e.contentWindow.document},addParamsToUrl:function(e,t){function n(e){var t="";for(var n in e)!e.hasOwnProperty(n)||"string"!=typeof e[n]&&"number"!=typeof e[n]||(t=t+"&"+n+"="+encodeURIComponent(e[n]));return t=t.substr(1)}if("string"==typeof e){var r=n(t),o="&";-1===e.indexOf("?")&&(o="?"),e=e+o+r}return e},getPageScroll:function(){var e={};return"undefined"!=typeof window.pageYOffset?(e.left=window.pageXOffset,e.top=window.pageYOffset):"undefined"!=typeof document.compatMode&&"BackCompat"!=document.compatMode?(e.left=document.documentElement.scrollLeft,e.top=document.documentElement.scrollTop):"undefined"!=typeof document.body&&(e.left=document.body.scrollLeft,e.top=document.body.scrollTop),e},getMousePoint:function(e){var t={},n=o.getPageScroll();return t.x=n.left+e.clientX,t.y=n.top+e.clientY,t},formatISODateString:function(e){return e?e.replace("T"," ").replace(/:\d+.\d+Z/,""):""},modifyTreeNodeDom:function(e,t){
var n=parseInt($("#"+e).attr("indentLevel"),10),o=t.level,i=t.tId;n=isNaN(n)?1:n;var a=$("#"+i+"_switch"),s=$("#"+i+"_check"),u=$("#"+i+"_ico");if(u.before(a),s.get(0)&&a.after(s),o>=n){var l,c;for(l=0,c=o-n;c>=l;l++)a.before('<span class="tmpIndent"></span>')}var d=$.fn.zTree.getZTreeObj(e).setting.treeObj;r.web.note.menuCmd&&t.cmd===r.web.note.menuCmd.create&&($("#"+t.tId+"_a",d).addClass("create-link"),$("#"+t.tId+"_ico",d).addClass("icon-b"))},sortObjArr:function(e,t,n,r){"asc"===r?e.sort(function(e,r){switch(n){case"number":return e[t]-r[t];case"date":return Number(e[t]>r[t])-.5;case"string":return e[t]&&e[t].localeCompare(r[t])}return 0}):"desc"===r&&e.sort(function(e,r){switch(n){case"number":return r[t]-e[t];case"date":return Number(r[t]>e[t])-.5;case"string":return r[t]&&r[t].localeCompare(e[t])}return 0})},arrayCompare:function(e,t,n,r){function o(e,t){return"string"==typeof e?e:e[t]}function i(e,t,n){if(!n||0===n.length)return!0;for(var r=n.length,o=0;r>o;o++)if(e[n[o]]!==t[n[o]])return!1;return!0}if(!e||!t)return null;var a,s,u,l,c,d=e.length,g=t.length,f=[],h=[],p=[],m=[],v={},b={};for(a=0;g>a;a++)s=o(t[a],n),v[s]=a;for(a=0;d>a;a++)s=o(e[a],n),l=v[s],u="undefined"==typeof l?null:t[l],b[s]=a,"undefined"==typeof u||null===u?m.push(a):i(u,e[a],r)?h.push(a):p.push(a);for(a=0;g>a;a++)s=o(t[a],n),c=b[s],"undefined"==typeof c&&f.push(a);return{add:f,del:m,keep:h,update:p}},getDomPosition:function(e){if(!e)return null;var t=e.offset(),n=parseInt(e.css("height"),10),r=parseInt(e.css("width"),10);return{top:t.top,left:t.left,height:n,width:r}},setLayout:function(e,t,n,i,a){var s,u,l,c,d=o.getDomPosition(e),g=o.getDomPosition(t),f=o.getPageScroll(),h=$(window).width(),p=$(window).height(),m="50%",v="30%",b=0,y=-d.width/2;i?(s=0,u=h,l=0,c=p):(s=0+f.left,u=h+f.left,l=0+f.top,c=p+f.top),g&&n&&(b=0,y=0,n==r.web.confirm.Type.UpLeft||n==r.web.confirm.Type.UpRight?v=g.top-d.height-(a?0:r.web.confirm.Space):n==r.web.confirm.Type.DownLeft||n==r.web.confirm.Type.DownRight?v=g.top+g.height+(a?0:r.web.confirm.Space):n==r.web.confirm.Type.LeftUp||n==r.web.confirm.Type.LeftDown?m=g.left-d.width-(a?0:r.web.confirm.Space):(n==r.web.confirm.Type.RightUp||n==r.web.confirm.Type.RightDown)&&(m=g.left+g.width+(a?0:r.web.confirm.Space)),n==r.web.confirm.Type.UpLeft||n==r.web.confirm.Type.DownLeft?(m=g.left,i&&(m-=f.left),m+d.width>u&&(m=u-d.width)):n==r.web.confirm.Type.UpRight||n==r.web.confirm.Type.DownRight?(m=g.left+g.width-d.width,i&&(m-=f.left),s>m&&(m=s)):n==r.web.confirm.Type.LeftUp||n==r.web.confirm.Type.RightUp?(v=g.top,i&&(v-=f.top),v+d.height>c&&(v=c-d.height)):(n==r.web.confirm.Type.LeftDown||n==r.web.confirm.Type.RightDown)&&(v=g.top+g.height-d.height,i&&(v-=f.top),l>v&&(v=l))),e.css({left:m,top:v,"margin-top":b+"px","margin-left":y+"px"})},renderLanguage:function(e){function t(e,t){if(!t||0===t[0].length||!e[t[0]])return null;for(var n=e;t.length>0&&(n=n[t.shift()],"undefined"!=typeof n);)if("string"==typeof n)return n;return null}var n,r,o,i,a=$("[data-lang]"),s=a.length;for(i=0;s>i;i++)n=a.eq(i),r=n.attr("data-lang").split("."),o=t(e,r),o&&n.html(o);for(a=$("[data-title-lang]"),s=a.length,i=0;s>i;i++)n=a.eq(i),r=n.attr("data-title-lang").split("."),o=t(e,r),o&&n.attr("title",o);var u=$("[data-placeholder]"),l=u.length;for(i=0;l>i;i++)n=u.eq(i),r=n.attr("data-placeholder").split("."),o=t(e,r),o&&n.attr("placeholder",o);var c=$("[data-alt-lang]");for(i=0;i<c.length;i++)n=c.eq(i),r=n.attr("data-alt-lang").split("."),o=t(e,r),o&&n.attr("alt",o)},setSelection:function(e,t,n){function r(e,t,n){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,n);else if(e.createTextRange){var r=e.createTextRange();r.collapse(!0),r.moveEnd("character",n),r.moveStart("character",t),r.select()}}r(e,t,n)},getDeleteMembersName:function(e,t,n){var r,o=n?t.bizMember.label.confirmDeleteMember:t.groupMember.label.confirmDeleteMember,i=n?t.bizMember.label.confirmDeleteMembers:t.groupMember.label.confirmDeleteMembers;return 1==e.length?r=o.replace("$1",e[0]):(r=i.replace("$1",e.length),e.length>5?(e=e.splice(0,5),r=r.replace("$2",e.join(", ")+"...")):r=r.replace("$2",e.join(", "))),r},encode:function(e){var t,n=[];for(t=0;t<e.length;t++)n.push((2*e.charCodeAt(t)+23).toString(8));return n.join("%")},decode:function(e){var t,n=[],r=e.split("%");for(t=0;t<r.length;t++)n.push(String.fromCharCode((parseInt(r[t],8)-23)/2));return n.join("")},getExtendTrialHtml:function(e,t){return'<a href="javascript:void(0);" class="wizExtendTrial" data-url="'+r.url.biz.extendTrial+"?biz="+e.biz_guid+'">'+t.bizInfo.label.extension+"</a>"},htmlUnEncode:function(e){return String(e).replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&&#39;/g,"'")},parseHTMLStr:function(e){var t={head:"",body:""},n=/<head[^>]*>([\s\S]*)<\/head>([^<]*)<body[^>]*>([\s\S]*)<\/body>/m;if(n.test(e)){var r=e.match(n);t.head=r[1],t.body=r[3]}else t.body=e;return t},parseWizLink:function(e,t){var n=e.replace(/^[^\?]*/i,""),o=wizUI.util.getUrlParam("kbguid",n),i=wizUI.util.getUrlParam("guid",n);o||(o=wizUI.util.getUrlParam("private_kbguid",n));var a=/wiz:(\/\/)?open_document/i,s=/wiz:(\/\/)?open_attachment/i;return a.test(e)?(t?r.url.common.noteFullScreenForMobile:r.url.common.noteFullScreen)+"?kb="+o+"&dc="+i:(s.test(e),"")},setIframeContent:function(e,t){var n=this.getFrameDocument(t),r=e.indexOf("<");if(0!==r&&(e=e.slice(r)),"string"==typeof e){n.open("text/html","replace");var o=e.match(/<html[^<>]*>([\s\S]*)<\/html>/im);n.write(o&&o.length?o[0]:e),n.close()}},getCaptchaCodeId:function(){return(+new Date).toString().slice(-8)+Math.random().toString(36).substr(2,6)},xssFilter:function(){if("undefined"==typeof window.filterXSS)return null;var e=new window.filterXSS.FilterXSS({safeAttrValue:function(e,t,n){return"a"===e&&"href"===t&&"wiz://"===n.substr(0,6)?window.filterXSS.escapeAttrValue(n):window.filterXSS.safeAttrValue(e,t,n)}});return function(t){return e.process(t)}}()};t.exports=o},{"../../config/wizConf":13}],36:[function(e,t,n){(function(e){var n=function(){},r=Array.prototype.slice,o=Array.prototype.concat,i="__all__",a=function(){return this instanceof a?(this._callbacks={},void(this._fired={})):new a};a.prototype.addListener=function(e,t){return n("Add listener for %s",e),this._callbacks[e]=this._callbacks[e]||[],this._callbacks[e].push(t),this},a.prototype.bind=a.prototype.addListener,a.prototype.on=a.prototype.addListener,a.prototype.subscribe=a.prototype.addListener,a.prototype.headbind=function(e,t){return n("Add listener for %s",e),this._callbacks[e]=this._callbacks[e]||[],this._callbacks[e].unshift(t),this},a.prototype.removeListener=function(e,t){var r=this._callbacks;if(e)if(t){var o=r[e];if(o)for(var i=o.length,a=0;i>a;a++)t===o[a]&&(n("Remove a listener of %s",e),o[a]=null)}else n("Remove all listeners of %s",e),r[e]=[];else n("Remove all listeners"),this._callbacks={};return this},a.prototype.unbind=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){return this.unbind(e)},a.prototype.bindForAll=function(e){this.bind(i,e)},a.prototype.unbindForAll=function(e){this.unbind(i,e)},a.prototype.trigger=function(e,t){var o,a,s,u,l,c,d=2,g=this._callbacks;for(n("Emit event %s with data %j",e,t);d--;)if(a=d?e:i,o=g[a])for(l=0,c=o.length;c>l;l++)(s=o[l])?(u=d?r.call(arguments,1):arguments,s.apply(this,u)):(o.splice(l,1),l--,c--);return this},a.prototype.emit=a.prototype.trigger,a.prototype.fire=a.prototype.trigger,a.prototype.once=function(e,t){var n=this,r=function(){t.apply(n,arguments),n.unbind(e,r)};return this.bind(e,r),this};var s="undefined"!=typeof e&&e.nextTick||function(e){setTimeout(e,0)};a.prototype.emitLater=function(){var e=this,t=arguments;s(function(){e.trigger.apply(e,t)})},a.prototype.immediate=function(e,t,n){return this.bind(e,t),this.trigger(e,n),this},a.prototype.asap=a.prototype.immediate;var u=function(e,t,o,i){var a=this,s=arguments.length,u=0,l={};if(3>s)return this;var c=r.call(arguments,0,-2),d=arguments[s-2],g=arguments[s-1];if("function"!=typeof d)return this;n("Assign listener for events %j, once is %s",c,!!g);for(var f=function(e){var t=g?"once":"bind";a[t](e,function(t){a._fired[e]=a._fired[e]||{},a._fired[e].data=t,l[e]||(l[e]=!0,u++)})},h=c.length,p=0;h>p;p++)f(c[p]);var m=function(e){if(!(h>u)&&l[e]){for(var t=[],r=0;h>r;r++)t.push(a._fired[c[r]].data);g&&a.unbindForAll(m),n("Events %j all emited with data %j",c,t),d.apply(null,t)}};a.bindForAll(m)};a.prototype.all=function(e,t,n){var r=o.apply([],arguments);return r.push(!0),u.apply(this,r),this},a.prototype.assign=a.prototype.all,a.prototype.fail=function(e){var t=this;return t.once("error",function(n){t.unbind(),e.apply(null,arguments)}),this},a.prototype.tail=function(){var e=o.apply([],arguments);return e.push(!1),u.apply(this,e),this},a.prototype.assignAll=a.prototype.tail,a.prototype.assignAlways=a.prototype.tail,a.prototype.after=function(e,t,r){if(0===t)return r.call(null,[]),this;var o=this,i=[];this._after=this._after||{};var a=e+"_group";this._after[a]={index:0,results:[]},n("After emit %s times, event %s's listenner will execute",t,e);var s=function(u,l){u===e&&(t--,i.push(l),1>t&&(n("Event %s was emit %s, and execute the listenner",e,t),o.unbindForAll(s),r.apply(null,[i]))),u===a&&(t--,o._after[a].results[l.index]=l.result,1>t&&(n("Event %s was emit %s, and execute the listenner",e,t),o.unbindForAll(s),r.call(null,o._after[a].results)))};return o.bindForAll(s),this},a.prototype.group=function(e,t){var n=this,o=e+"_group",i=n._after[o].index;return n._after[o].index++,function(e,a){return e?n.emit.apply(n,["error"].concat(r.call(arguments))):void n.emit(o,{index:i,result:t?t.apply(null,r.call(arguments,1)):a})}},a.prototype.any=function(){var e=this,t=arguments[arguments.length-1],o=r.call(arguments,0,-1),i=o.join("_");n("Add listenner for Any of events %j emit",o),e.once(i,t);for(var a=function(t){e.bind(t,function(r){n("One of events %j emited, execute the listenner"),e.trigger(i,{data:r,eventName:t})})},s=0;s<o.length;s++)a(o[s])},a.prototype.not=function(e,t){var r=this;n("Add listenner for not event %s",e),r.bindForAll(function(r,o){r!==e&&(n("listenner execute of event %s emit, but not event %s.",r,e),t(o))})},a.prototype.done=function(e,t){var n=this;return function(o,i){if(o)return n.emit.apply(n,["error"].concat(r.call(arguments)));var a=r.call(arguments,1);return"string"==typeof e?t?n.emit(e,t.apply(null,a)):n.emit.apply(n,[e].concat(a)):arguments.length<=2?e(i):void e.apply(null,a)}},a.prototype.doneLater=function(e,t){var n=this.done(e,t);return function(e,t){var r=arguments;s(function(){n.apply(null,r)})}},a.create=function(){var e=new a,t=o.apply([],arguments);if(t.length){var n=t[t.length-1],r=t[t.length-2];"function"==typeof n&&"function"==typeof r&&(t.pop(),e.fail(n)),e.assign.apply(e,t)}return e},a.EventProxy=a,t.exports=a}).call(this,e("_process"))},{_process:1}],37:[function(e,t,n){function r(e,t){return e?(l[e]||(l[e]={}),l[e][t]||(l[e][t]={list:[],func:null}),l[e][t].list):null}function o(e,t){for(var n=0,r=e.length;r>n;n++)if(e[n]===t)return n;return-1}function i(e,t){e&&!l[e][t].func&&(l[e][t].func=function(){for(var n=l[e][t].list,r=0,o=n.length;o>r;r++)n[r].apply(this,arguments)},$(e).bind(t,l[e][t].func))}function a(e,t){e&&l[e][t].func&&($(e).unbind(t,l[e][t].func),delete l[e][t])}function s(e,t,n){if(wizUI.util.isFunction(n)){e.jquery&&(e=e.get(0));var a=r(e,t);o(a,n)>=0||(a.push(n),i(e,t))}}function u(e,t,n){if(wizUI.util.isFunction(n)){e.jquery&&(e=e.get(0));var i=r(e,t),s=o(i,n);s>=0&&i.splice(s,1),0===i.length&&a(e,t)}}var l={},c={bind:function(e,t,n){var r,o;if(wizUI.util.isArray(n))for(r=0,o=n.length;o>r;r++)s(e,t,n[r]);else s(e,t,n)},unbind:function(e,t,n){var r,o;if(wizUI.util.isArray(n))for(r=0,o=n.length;o>r;r++)u(e,t,n[r]);else u(e,t,n)}};t.exports=c},{}],38:[function(e,t,n){function r(){for(var e=0,t=a.length;t>e;e++)a[e].apply(u);s=t>0?setTimeout(function(){r()},i.web.globalTimer):null}function o(e){for(var t=0,n=a.length;n>t;t++)if(a[t]===e)return!0;return!1}var i=e("../../config/wizConf"),a=[],s=null,u=this,l={add:function(e){wizUI.util.isFunction(e)&&!o(e)&&a.push(e),!s&&a.length>0&&r()},remove:function(e){for(var t=a.length-1;t>=0;t--)if(a[t]==e){a.splice(t,1);break}}};t.exports=l},{"../../config/wizConf":13}],39:[function(e,t,n){function r(e){c=e,l=$("body")}function o(e){c=c.concat(e)}function i(e,t){return e.attr("id")===t||e.parents("#"+t).length>0?$("#"+t):null}function a(e){var t,n,r,o,a,s,u=!0,l=!0,d=$(e.target);for(t=c.length-1;t>=0;t--)if(s=i(d,c[t])){d=s,l=!1;break}return l?u=!1:(n=parseInt(d.css("height"),10),r=d.scrollTop(),o=d.get(0).scrollHeight,a=e.originalEvent.wheelDelta||-e.originalEvent.detail,0>a&&n+r>=o?u=!1:a>0&&0===r&&(u=!1)),u?!0:(wizUI.util.stopBubble(e),wizUI.util.stopDefault(e),"undefined"!=typeof window.event&&(window.event.returnValue=!1),!1)}function s(){u(),l.bind("mousewheel",a),l.bind("DOMMouseScroll",a)}function u(){l.unbind("mousewheel",a),l.unbind("DOMMouseScroll",a)}var l,c=[],d={init:r,addIds:o,on:s,off:u};t.exports=d},{}],40:[function(e,t,n){var r=e("../../config/wizConf"),o=function(){};o.prototype.isSupport=function(){return!!window.Notification},o.prototype.getPermission=function(e){window.Notification.requestPermission(function(t){Notification.permission!==t&&(Notification.permission=t),e&&e(this.checkPermission())})},o.prototype.checkPermission=function(){return!(!window.Notification||"granted"!==Notification.permission)};var i;o.prototype.show=function(e,t,n,o){a.checkPermission()&&(i=new Notification(t,{tag:"wizMessageNotification",body:n,icon:e}),i.onshow=function(){setTimeout(function(){i&&i.close()},r.baseModel.notifyWait)},i.onclick=function(){o&&o.onClick&&o.onClick(),i.close(),window.focus()})};var a=new o;a.isSupport()?a.getPermission():a={show:function(){}},t.exports=a},{"../../config/wizConf":13}],41:[function(e,t,n){function r(e,t,n,r){var o=t.get(0),i=o===window?document.body.scrollHeight:o.scrollHeight,a=o===window?document.body.scrollTop:o.scrollTop,s=document.documentElement.scrollTop+a;return r?r>i-s-n:i-s-n===0}function o(e,t,n){clearTimeout(e.timer),n=n?n:50,e.timer=setTimeout(function(){e.scrollHandler.apply(e,t)},n)}var i=function(e){return this.timer=void 0,this.dataSet=[],this.lastScroll=0,this.scrollCallBacks=[],this};i.prototype.init=function(e){this.config=e.config,this.vmname=e.vmname,this.dataProp=e.dataProp;var t=this;this.config.visionNode.scroll(function(e){o.apply(t,[t,[e]])}),$(window).resize(function(e){o.apply(t,[t,arguments])})},i.prototype.changeDataSet=function(e,t,n){this.dataSet=[],this.dataSet=e;var r=e.slice(0,this.config.initAmount);n(r,t)},i.prototype.scrollHandler=function(e){var t=this.dataSet,n=avalon.vmodels[this.vmname][this.dataProp],o=this.config.visionNode.scrollTop();if(o>this.lastScroll&&r(e,this.config.visionNode,this.config.visionNode.height(),250)){var i=n.length;if(i<t.length){var a=t.slice(i,i+this.config.additionAmount);this.config.additionAddFunc(a,n);for(var s=this.scrollCallBacks.length,u=s-1;u>=0;){var l=this.scrollCallBacks[u](a);l&&this.scrollCallBacks.pop(),u--}}}return this.lastScroll=o,!1},t.exports=i},{}],42:[function(e,t,n){function r(e,t){var n=t.document_body,r=t.document_url,o=n.toLowerCase(),i=n.substring(o.indexOf("<head"),o.indexOf("</head>")+7);if(r){var a=document.createElement("base");a.href=r,e.doc.head.appendChild(a)}var s=e.doc.createElement("div");s.innerHTML=i;var u,l,c,d,g,f,h=s.childNodes,p=e.doc.createDocumentFragment();for(u=0,l=h.length;l>u;u++)c=h[u],d=c.tagName,d&&("link"==d.toLowerCase()&&c.getAttribute("href")?(g=e.doc.createElement("link"),g.rel=c.getAttribute("rel"),g.href=c.getAttribute("href"),g.media=c.getAttribute("media"),g.type=c.getAttribute("type"),p.appendChild(g)):"style"==d.toLowerCase()&&(f=e.doc.createElement("style"),f.id=c.getAttribute("id"),f.className=c.getAttribute("class"),f.innerHTML=c.innerHTML,p.appendChild(f)));e.doc.head.appendChild(p)}function o(e){var t=e.document_body,n=t.toLowerCase(),r="<body",o=n.indexOf(r);if(0>o||n.indexOf("</body>")<0)return{attrs:{},content:t};var i={start:o+r.length,end:n.length,str:n},u=a(i),l=n.lastIndexOf("</body>");l=l>0?l:n.length;var c=t.substring(u+1,l),d=t.substring(o+r.length,u),g=s(d);return{attrs:g,content:c}}function i(e,t){var n=o(t),r=n.content;e.container.html(r)}function a(e){for(var t=e.start,n=e.end,r=e.str,o=0,i=0;n>t;t++){var a=r.charAt(t);switch(a){case"'":o++;break;case'"':i++;break;case">":if(o%2===0&&i%2===0)return t}}return!1}function s(e){var t={};return e.replace(/([^\s]+)=(['"])([^\2]*?)\2/g,function(){return t[arguments[1]]=arguments[3],""}),t}var u,l,c=e("../util/GlobalUtil"),d=e("../../config/wizConf"),g=e("../../component/pagedown/Markdown.Converter"),f=e("../../component/pagedown/Markdown.Extra"),h=d.web.note.initDoc.css,p={filter:function(e){var t=e.replace(/<script[^<>]*\/>/gi,"").replace(/<script[^<>]*>(((?!<\/script>).)|(\r?\n))*<\/script>/gi,"");return t},clear:function(e){e.doc.write("<html><head></head><body></body></html>")},setDoc:function(e,t){if(u=c.verifyMarkdown(t.document_title),t.document_body){if(p.Document=e.doc,t=wizUI.util.clone(t),t.document_body=p.filter(t.document_body),e.container)r(e,t),i(e,t);else{e.doc.open("text/html","replace");var n=t.document_body.match(/<html[^<>]*>([\s\S]*)<\/html>/im);e.doc.write(n&&n.length?n[0]:t.document_body)}p.callback.markdown=function(){try{var t=e.doc.getElementById(d.web.note.initDoc.cssId);t||(t=e.doc.createElement("style"),t.setAttribute("id",d.web.note.initDoc.cssId),t.appendChild(e.doc.createTextNode(h)),e.doc.getElementsByTagName("head")[0].appendChild(t))}catch(n){}e.doc.close(),window.parent.wizResizeCallback&&window.parent.wizResizeCallback()},p.callback.prettify=p.callback.mathJax=function(){window.parent.wizResizeCallback&&window.parent.wizResizeCallback()},u?(p.Document=e.doc,p.markdownConvert(e),l&&p.mathjaxRender()):p.cb(p.callback.markdown)}},Utils:wizUI.util,Document:null,MarkDownCssFiles:[d.url.libs.githubCss],MarkdownJsFiles:[d.url.libs.prettifyJs],MathJaxJsFiles:[d.url.libs.mathJax],callback:{markdown:null,prettify:null,mathJax:null},cb:function(e,t){e&&e.apply(this,t?t:[])},getBodyTxt:function(e){var t=e.innerText;return t||(t=p.Utils.getInnerText(e)),t.replace(/\u00a0/g," ")},markdownConvert:function(e){function t(e){return e=e.replace(/@@(\d+)@@/g,function(e,t){return u[t]}),u=null,e}function n(e,t){for(var n=s.slice(e,t+1).join("").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");t>e;)s[t]="",t--;s[e]="@@"+u.length+"@@",u.push(n),o=i=a=null}function r(e){o=i=a=null,u=[],s=e.replace(/\r\n?/g,"\n").split(d);for(var t=1,r=s.length;r>t;t+=2){var l=s[t];"@"===l.charAt(0)?(s[t]="@@"+u.length+"@@",u.push(l)):o?l===i?c?a=t:n(o,t):l.match(/\n.*\n/)?(a&&(t=a,n(o,t)),o=i=a=null,c=0):"{"===l?c++:"}"===l&&c&&c--:"$$"===l?(o=t,i=l,c=0):"begin"===l.substr(1,5)&&(o=t,i="\\end"+l.substr(6),c=0)}return a&&n(o,a),s.join("")}var o,i,a,s,u,c,d=/(\$\$?|\\(?:begin|end)\{[a-z]*\*?\}|\\[\\{}$]|[{}]|(?:\n\s*)+|@@\d+@@)/i,h=$(p.Document),m=e.container?e.container:h.find("body");m.addClass("markdown-body");var v=new g.Converter;f.init(v,{extensions:"all",highlighter:"prettify"});var b,y,_;try{for(p.Utils.markdownPreProcess(m[0]),b=p.getBodyTxt(m[0]),y=0,_=p.MarkDownCssFiles.length;_>y;y++)p.Utils.loadSingleCss(p.Document,p.MarkDownCssFiles[y]);p.Utils.loadJs(p.Document,p.MarkdownJsFiles,function(){p.Utils.appendJs(p.Document,"prettyPrint();","text/javascript"),p.cb(p.callback.prettify)});var w=b.replace(/\n/g,"\\n").replace(/\r\n?/g,"\n").replace(/```(.*\n)+?```/gm,"");l=/(\$\$?)[^$\n]+\1/.test(w),l&&(b=r(b)),b=v.makeHtml(b),l&&(b=t(b)),m[0].innerHTML=b,p.cb(p.callback.markdown)}catch(C){p.cb(p.callback.markdown),console.log(C)}},mathjaxRender:function(){var e='MathJax.Hub.Config({skipStartupTypeset: true,"HTML-CSS": {preferredFont: "TeX",availableFonts: ["STIX","TeX"],linebreaks: {automatic: true},EqnChunk: 10,imageFont: null},tex2jax: {inlineMath: [["$","$"],["\\\\\\\\(","\\\\\\\\)"]],displayMath: [["$$","$$"],["\\\\[","\\\\]"]],processEscapes: true },TeX: {equationNumbers: {autoNumber: "AMS"},noUndefined: {attributes: {mathcolor: "red",mathbackground: "#FFEEEE",mathsize: "90%"}},Safe: {allow: {URLs: "safe",classes: "safe",cssIDs: "safe",styles: "safe",fontsize: "all"}}},messageStyle: "none"});';p.Utils.appendJs(p.Document,"MathJax = null","text/javascript"),p.Utils.appendJs(p.Document,e,"text/x-mathjax-config"),p.Utils.loadJs(p.Document,p.MathJaxJsFiles,function(){var e='MathJax.Hub.Queue(["Typeset", MathJax.Hub, document.body]);';p.Utils.appendJs(p.Document,e,"text/javascript"),p.cb(p.callback.mathJax)})}};t.exports=p},{"../../component/pagedown/Markdown.Converter":8,"../../component/pagedown/Markdown.Extra":9,"../../config/wizConf":13,"../util/GlobalUtil":35}],43:[function(e,t,n){function r(e){o=$("body"),i=$("#"+u.headerTitle),s=e,l.localize(),l.setTitle(),c.bind()}var o,i,a=e("../database/wizCenter"),s=null,u={headerTitle:"header-title"},l={localize:function(){},setTitle:function(e){i&&a.bizInfo&&(e=e||a.bizInfo.biz_name,i.text(e),i.attr("title",e))}},c={bind:function(){}};t.exports={init:r,setTitle:l.setTitle}},{"../database/wizCenter":18}],44:[function(e,t,n){function r(e){o=$("body"),i=$("#"+s.mainLoadingContent),a=e,l.localize(),c.bind()}var o,i,a=null,s={mainLoadingContent:"loading-content"},u={loadingContent:"loading-content",loading:"page-loading",active:"active"},l={localize:function(){},show:function(e,t){$("#"+e+" ."+u.loadingContent).addClass(u.active),t.addClass(u.loading)},hide:function(e,t){t.removeClass(u.loading),$("#"+e+" ."+u.loadingContent).removeClass(u.active)}},c={bind:function(){}};t.exports={init:r,show:l.show,hide:l.hide}},{}],45:[function(e,t,n){function r(e){a=$("#"+c.main),s=$("#"+c.template),l=e,h.init(),i&&g.show(),f.bind()}var o,i,a,s,u=e("../../config/wizConf"),l=null,c={main:"wiz-poster",template:"poster-template"},d={active:"active"},g={localize:function(){},show:function(){$.ajax({url:i.url,dataType:"text",success:function(e){s.html(e),a.addClass(d.active)},error:function(){}})},hide:function(){a.removeClass(d.active)}},f={bind:function(){}},h={init:function(){o=h.getPosterKey();var e,t,n=new Date;for(e in u.poster)if(u.poster.hasOwnProperty(e)&&(t=u.poster[e],n>=t.startDate&&n<=t.endDate&&e!==o))return i=t,void h.setPosterKey(e)},getPosterKey:function(){return wizUI.util.cookie("wizPoster")},setPosterKey:function(e){wizUI.util.cookie("wizPoster",e,wizUI.util.getCookieOptions(365))}};t.exports={init:r,show:g.show,hide:g.hide}},{"../../config/wizConf":13}],46:[function(e,t,n){function r(){return this}var o=e("../database/wizCenter");r.prototype.init=function(){this.bindEvent();var e=wizUI.util.getCookieOptions(),t=wizUI.util.getUrlParam("token");t&&wizUI.util.cookie("token",t,e),wizUI.support.history?this.push({token:""},!1):t&&location.replace(window.location.href.replace(/([\?|&])token=[^&]*[&]?/gi,"$1").replace(/[&|\?]$/,""))},r.prototype.bindEvent=function(){var e=this;$(window).bind(wizUI.support.history?"popstate":"hashchange",function(){e.frameTrigger()})},r.prototype.trigger=function(){return $(window).trigger(wizUI.support.history?"popstate":"hashchange"),this},r.prototype.frameTrigger=function(){o.userInfo&&i()};var i=function(){};r.prototype.setAnalyticsFrame=function(e){return wizUI.util.isFunction(e)&&(i=e),this},r.prototype.push=function(e,t){var n,r,o,i,a,s,u=location.hash||location.search;u=u.replace(/\?|#/,"&");var l=u;i=[];for(n in e)if(e.hasOwnProperty(n)){if(a=new RegExp("&("+n+"=([^&]*))"),s=u.match(a),r=e[n],o=n+"="+encodeURIComponent(r),!r&&!s)continue;if(s&&s[1]===o)continue;u=u.replace(a,""),e[n]&&i.push(o)}return 0===i.length&&l==u?this:(u=i.join("&")+u,0===u.indexOf("&")&&(u=u.substr(1)),wizUI.support.history?history.pushState(null,"","?"+u):location.href="#"+u,t&&this.trigger(),this)},t.exports=new r},{"../database/wizCenter":18}],47:[function(e,t,n){function r(e){i=$("body"),a=$("#"+c.frameTitle),s=$("#"+c.frame),l=e,g.localize(),f.bind()}var o,i,a,s,u=e("../database/wizCenter"),l=null,c={frameTitle:"frame-title",frame:"frame-item"},d={on:"wiz-frame"},g={localize:function(){},showFrame:function(e,t){return u.checkToken()?(o=t,a.text(" "),s.get(0).contentWindow.document.write(""),s.get(0).src=e.url,i.addClass(d.on),void(e["class"]&&i.addClass(e["class"]))):void l.tokenInvalid()},setFrameTitle:function(){a.text(s.get(0).src?s.get(0).contentWindow.document.title:" ")}},f={bind:function(){s.bind("load",function(){g.setFrameTitle(),"function"==typeof o&&o()})}};t.exports={init:r,show:g.showFrame}},{"../database/wizCenter":18}],48:[function(e,t,n){function r(e){o=$("body"),s=$("#"+h.readMain),c=$("#"+h.editorTitle),i=e,v.localize(),v.initEditor(),b.bind()}var o,i,a,s,u,l,c,d=e("../../util/GlobalUtil"),g=e("../../../config/wizConf"),f=e("../../database/wizCenter"),h={readMain:"read",editorFrame:"ueditor_0",editorCt:"wiz-edit-area",editorTitle:"edit-title"},p={S:83,Enter:13},m=g.web.frameEventType,v={localize:function(){},initEditor:function(){a=new UE.ui.Editor,a.render(h.editorCt),a.addListener("ready",function(){b.bindEditorKeyboard(),v.fixUeditorFrame();var e=d.getFrameDocument($("iframe",l).get(0));e.onclick=function(){o.trigger("click")}}),a.addListener("contentChange",function(){o.trigger(m.EventManager,[m.AutoSaveDocument])})},fixUeditorFrame:function(){u=$("#edui1_toolbarbox");var e=u.height();l=$("#edui1_iframeholder"),l.parent().css({width:"100%",height:"100%"}),l.parent().parent().css({width:"100%",height:"100%"}),l.css({position:"absolute",top:e+"px",left:"0",right:"0",bottom:"0px"})},resizeEditorIframe:function(){var e=u.height();e!==u.lastHeight&&(u.lastHeight=e,l.css({top:e+"px"}))},clearEditor:function(){a.reset()},editDocument:function(e){var t=e.docInfo;if(v.clearEditor(),"string"==typeof t.title||"string"==typeof t.document_body){var n=d.parseHTMLStr(t.document_body),r=a.iframe.contentWindow.document,o=$(r.getElementsByTagName("head")[0]);o.html("<style>"+g.web.note.initDoc.cssForEdit+"</style>"+n.head);var i=r.getElementById(g.web.note.initDoc.cssId);i||o.append('<style id="'+g.web.note.initDoc.cssId+'">'+g.web.note.initDoc.css+"</style>"),r.getElementsByTagName("body")[0].innerHTML=n.body,f.noteCur.lastSaved.document_body=y.getDocBody(t.document_body)}}},b={bind:function(){o.bind("keydown",b.saveKeyHandler),c.bind("keydown",b.inputEnter)},bindEditorKeyboard:function(){var e=document.getElementById(h.editorFrame),t=d.getFrameDocument(e);t.onkeydown=b.saveKeyHandler},inputEnter:function(e){var t,n;(e.charCode||e.keyCode)===p.Enter&&(wizUI.util.stopDefault(e),this.blur(),t=document.getElementById(h.editorFrame),n=d.getFrameDocument(t),n.body.focus())},saveKeyHandler:function(e){var t=document.getElementById(h.editorFrame);e=e||t.contentWindow.event,(e.charCode||e.keyCode)===p.S&&(e.ctrlKey||e.metaKey)&&(wizUI.util.stopDefault(e),b.saveDocument())},saveDocument:function(){o.trigger(m.EventManager,[m.SaveDocument])}},y={getDocBody:function(e){var t=/([\s\S]*<body[^>]*>)([\s\S]*)(<\/body>[\s\S]*)/m,n=a.getAllHtml();return t.test(e)||(e=g.web.note.initDoc.body.replace("$1","").replace("$2",e)),e.replace(t,function(e,r,o,i){return r+n.match(t)[2]+i})}};t.exports={init:r,editDocument:v.editDocument,getDocBody:y.getDocBody,resizeEditorIframe:v.resizeEditorIframe}},{"../../../config/wizConf":13,"../../database/wizCenter":18,"../../util/GlobalUtil":35}],49:[function(e,t,n){function r(){o(),setTimeout(o,500),a.globalTimer.remove(o);var e=l.getFrameDocument(s);e.onclick=function(){i.trigger("click")};var t,n,r,u=e.getElementsByTagName("a");if(u&&u.length>0)for(t=0,n=u.length;n>t;t++)r=u[t],r.target="_blank";$(e.body,e.ownerDocument).delegate("a","click",function(e){var t=$(e.currentTarget),n=t.attr("href")||"";n&&0===n.indexOf("wiz:")&&(wizUI.util.openWizLink(l.parseWizLink(n)),wizUI.util.stopBubble(e),wizUI.util.stopDefault(e))})}function o(){if(s){var e,t=u.parent();e=s.style,e.height=e.width="";var n=l.getFrameDocument(s),r=n.documentElement,i=Math.max(r.scrollHeight,n.body.scrollHeight),a=Math.max(r.scrollWidth,n.body.scrollWidth);if(d.isImportExcel){var c=$("frame",n).get(0),g=$("frame",n).get(1);if(!(c&&c.contentDocument&&c.contentDocument.body&&g.contentDocument.body))return void setTimeout(o,300);i=$(c.contentDocument).height()+$(g.contentDocument).height()}n&&i&&a&&(u.height(i+20+"px"),a>t.width()&&(u.width(t.width()-20+"px"),a=Math.max(r.scrollWidth,n.body.scrollWidth),a>t.width()&&u.width(a+"px")),u.parent().height(u.height()+21+"px"))}}var i,a,s,u,l=e("../../util/GlobalUtil"),c=e("../../viewer-common/documentRender");window.wizResizeCallback=o;var d={isImportExcel:!1,init:function(e,t){i=$("body"),a=e,s=document.getElementById(t),u=$(s),s.attachEvent?s.attachEvent("onload",function(){r()}):s.onload=function(){r()}},setUrl:function(e){s.src=e},getHTML:function(){var e=l.getFrameDocument(s);return e.documentElement.outerHTML},setHTML:function(e){d.isImportExcel=!!e.document_body&&!!wizUI.note.isImportExcel(e.document_body),a.globalTimer.add(o);var t=l.getFrameDocument(s);c.setDoc({doc:t,container:null},e)},clear:function(){d.isImportExcel=!1;var e=l.getFrameDocument(s);c.clear({doc:e,container:null})},resize:function(){o()}};t.exports=d},{"../../util/GlobalUtil":35,"../../viewer-common/documentRender":42}],50:[function(e,t,n){function r(e,t,n){var r;if(r="doc"===e?w.find("ul li"):C.find("ul li"),0===r.length)return void g.trigger(I.EventManager,[I.ShowDocument,{kb_guid:a.noteCur.kb?a.noteCur.kb.kbGuid:""}]);var o,i,s="data-docguid";"msg"===e?(o=G,i=C):(o=E,i=C);var u=B.getValidNoteById(s,t,r);u&&setTimeout(function(){n?(u.trigger("click"),B.scrollIntoView(u,b)):u.attr(s)==t?(b.find("li.active").eq(0).removeClass("active"),u.addClass("active"),B.scrollIntoView(u,b),"msg"===e&&A.markMsgReadById(u.attr("data-msgid"))):o.scrollCallBacks.push(function(){for(var n=i.find("ul li"),r=n.slice(n.length-o.config.additionAmount,n.length),a=r.length,u=0;a>u;u++)if(r[u].getAttribute(s)==t)return n.removeClass("active"),n.eq(n.length-(a-u)).addClass("active"),"msg"===e&&A.markMsgReadById(r[u].getAttribute("data-msgid")),!0;return!1})},100)}function o(e){g=$("body"),h=$("#"+T.noteList),p=$("#"+T.notePath),m=$("#"+T.sortRule),v=$("#"+T.sortBtn),y=$("#"+T.noteListTools),_=$("#"+T.msgListTools),b=$("#"+T.noteListContent),w=$("#"+T.docList),C=$("#"+T.msgList),k=$("#"+T.markAllBtn),f=e,B.localize(),O.bind(),S=Math.ceil(b.height()/60)+6,E.init({vmname:"doclist",dataProp:"docs",config:{initAmount:S,additionAmount:8,visionNode:b,contentDom:null,additionAddFunc:M.additionalAdd}}),G.init({vmname:"msglist",dataProp:"msgs",config:{initAmount:S,additionAmount:8,visionNode:b,contentDom:null,additionAddFunc:L.additionalAdd}})}var i=e("../../../config/wizConf"),a=e("../../database/wizCenter"),s=e("locale"),u=e("../../util/GlobalUtil"),l=e("../../viewer-common/loading"),c=e("../../util/pintrest"),d=e("../../../common/avalon-extend/calendarTime");d.init();var g,f,h,p,m,v,b,y,_,w,C,k,M,L,S,T={noteList:"note-list",notePath:"path",sortBtn:"note-sort",sortRule:"sort-rule",noteListTools:"notelist-tool",msgListTools:"msglist-tool",noteListContent:"note-list-content",docList:"doclist-ctn",msgList:"msglist-ctn",markAllBtn:"markAll-btn",loadingLayer:"notelst-loading"},x={hide:"hide",sort:"sort",active:"active",doclist:"doclist",personal:"personal",group:"group",unread:"unread",msglist:"msglist"},z={msg:"message",personal:"personal",group:"group",myShare:"myShare",docList:{last:"last",search:"search",category:"category",tag:"tag"}},I=i.web.frameEventType,D=i.web.dataOperateType,E=new c,G=new c,A={showDocs:function(e,t,n){function r(){if(!n){var e="";if(0===M.docs.length)switch(M.menuType){case z.docList.last:e=i.web.note.emptyType.docLastIsEmpty;break;case z.docList.search:e=i.web.note.emptyType.docSearchIsEmpty;break;case z.docList.category:e=i.web.note.emptyType.docCategoryIsEmpty;break;case z.docList.tag:e=i.web.note.emptyType.docTagIsEmpty}e&&g.trigger(I.EventManager,[I.ShowEmptyInfo,e])}}if(t===M.showDocKey||n)return A.incUpdate(E.dataSet,M.docs,M.showingtype),
void r();t&&(M.showDocKey=t),M.docs.clear();var o=[];z.personal===M.showingtype?(A.addAbstractProp2Val(e,function(e){o.push(e.document_guid)}),M.docs=e,A.getAbstractAndRender(o,M.docs)):M.docs=e,r()},additionalAddDocs:function(e){if(z.personal===M.showingtype){var t=[];A.addAbstractProp2Val(e,function(e){t.push(e.document_guid)}),A.additionalAdd(e,M.docs),A.getAbstractAndRender(t,M.docs)}else A.additionalAdd(e,M.docs)},showMsgs:function(e,t,n){if(t===L.showMsgKey?A.incUpdate(G.dataSet,L.msgs,L.showingtype):t&&(L.showMsgKey=t,L.msgs.clear(),L.msgs=e),g.trigger(I.EventManager,[I.UpdateMsgList]),!n){var r="";0===L.allMsgsCount||!L.onlyUnRead&&0===L.msgs.length?r=i.web.note.emptyType.msgIsEmpty:L.onlyUnRead&&0===L.msgs.length&&(r=i.web.note.emptyType.msgUnReadIsEmpty),r&&g.trigger(I.EventManager,[I.ShowEmptyInfo,r])}return!1},getMsgById:function(e){var t,n,r;for(t=0,n=L.msgs.length;n>t;t++)if(r=L.msgs[t],r.id==e)return r;return null},markMsgReadById:function(e){var t=A.getMsgById(e);t&&0===t.read_status&&g.trigger(I.EventManager,[D.SetBizMessageStatus,e,{read_status:1},function(){t.read_status=1,g.trigger(I.EventManager,[I.UpdateMsgList])}])},markAllMsgRead:function(){var e,t,n;for(e=0,t=L.msgs.length;t>e;e++)n=L.msgs[e],n.read_status=1;for(e=0,t=G.dataSet.length;t>e;e++)n=G.dataSet[e],n.read_status=1},additionalAddMsg:function(e){A.additionalAdd(e,L.msgs)},incUpdate:function(e,t,n){var r,o,i,a=["document_guid","document_title","dt_created"];n!==z.personal&&a.push("userIcon");var s=t.length;s=s>=S?s:S,z.msg!==n&&A.sortDataArr(e);var l=n==z.msg?"id":"document_guid",c=n==z.msg?["version","read_status"]:["version"],d=u.arrayCompare(t,e.slice(0,s),l,c);for(r=d.update.length-1;r>=0;r--)i=d.update[r],t[r].version=e[i].version,n==z.msg?t[r].read_status=e[i].read_status:(t[r].document_title=e[i].document_title,t[r].dt_data_modified=e[i].dt_data_modified);for(r=d.del.length-1;r>=0;r--)t.splice(d.del[r],1);for(r=0,o=d.add.length;o>r;r++)i=d.add[r],t.splice(i,0,e[i])},updateNoteInfo:function(e){for(var t=M.docs,n=t.length,r=0;n>r;r++)if(t[r].document_guid==e.document_guid){var o=t.splice(r,1)[0],i={};for(var s in o)0!==s.indexOf("$")&&o.hasOwnProperty(s)&&(i[s]=o[s]);i.document_title=e.document_title,i.document_attachment_count=e.document_attachment_count,t.unshift(i);break}a.noteCur.docInfo&&a.noteCur.docInfo.document_guid===e.document_guid&&w.find("ul li").eq(0).addClass("active")},read:function(e){var t=$(e.target).closest("li"),n=t.attr("data-msgid"),r=t.attr("data-kbguid"),o=t.attr("data-docguid");!a.noteCur.docInfo||o!=a.noteCur.docInfo.document_guid||n&&n!=a.noteCur.msgid||t.hasClass("active")||t.addClass("active").siblings().removeClass("active");var u=t.hasClass("encrypt");if(u){var l='<a href="'+i.url.common.appDownload+'" target="_blank">'+s.docDocument.label.downClient+"</a>";g.trigger(I.EventManager,[I.ShowEmptyInfo,i.web.note.emptyType.docNotFound,s.docDocument.err.document_encrypted+l])}else g.trigger(I.EventManager,[I.ShowEmptyInfo]);f.onCheckDocChangedHandler(function(e){if(e){t.addClass("active").siblings().removeClass("active"),a.noteCur.msgid=n,A.markMsgReadById(n);var i={kb_guid:r,doc_guid:u?"":o};g.trigger(I.EventManager,[I.ShowDocument,i])}})},additionalAdd:function(e,t){for(var n=e.length,r=0;n>r;r++)t.push(e[r]);return!1},sortDataArr:function(e){var t=y.attr("data-sortprop"),n=y.attr("data-sorttype"),r=y.attr("data-sortorder");u.sortObjArr(e,t,n,r)},storeSortDataAndChangeSortStyle:function(e,t,n){y.attr("data-sortprop",e),y.attr("data-sorttype",t),y.attr("data-sortorder",n)},addAbstractProp2Val:function(e,t){for(var n,r=e.length,o=0;r>o;o++)n=e[o],n.abstract_text="",n.abstract_image="",t(n)},getAbstractAndRender:function(e,t){var n={kb_guid:a.personalKb.kbGuid,doc_guids:e.join(",")};F.getDocumentSummary(n,function(e,n){var r=e.length;if(t)for(var o=t.length,i=0;r>i;i++)for(var a=0;o>a;a++)t[a].document_guid===e[i].docGuid&&A.addAbstract(t[a],e[i])})},addAbstract:function(e,t){e.abstract_text=t.abstract_text&&t.abstract_text.length>60?t.abstract_text.substring(0,60)+"... ...":"",e.abstract_image=t.abstract_image},delSpecificDoc:function(e,t){if(B.loading)return void setTimeout(function(){A.delSpecificDoc(e,t)},300);for(var n=e.document_guid,r=t.docs.length,o=0;r>o;o++)if(t.docs[o].document_guid==n){t.docs.splice(o,1);break}var i=w.find("ul li"),a=B.getValidNoteByIndex(o,i);a&&(a.trigger("click"),B.scrollIntoView(a,b))}};avalon.ready(function(){M=avalon.define("doclist",function(e){e.docs=[],e.menuType=z.docList.last,e.loading=!1,e.showingtype=z.personal,e.showDocKey="",e.showDocs=A.showDocs,e.additionalAdd=A.additionalAddDocs,e.read=A.read}),L=avalon.define("msglist",function(e){e.msgs=[],e.allMsgsCount=0,e.showMsgKey="",e.onlyUnRead=!1,e.showingtype=z.msg,e.showMsgs=A.showMsgs,e.additionalAdd=A.additionalAddMsg,e.read=A.read}),avalon.scan($("#doclist-ctn").get(0),"doclist"),avalon.scan($("#msglist-ctn").get(0),"msglist")});var N={showDocs:function(e,t,n,r){N.viewCtrl(r),z.msg!==r?(A.sortDataArr(e),E.changeDataSet(wizUI.util.clone(e),t,function(e,t){M.showDocs(e,t,n,r)})):G.changeDataSet(wizUI.util.clone(e),t,function(e,t){L.showMsgs(e,t,n)})},sort:function(e){var t=$(e.target).closest("li");if(t.length>0){var n,r=t.attr("data-sortprop");switch(r){case"document_title":n="string";break;case"dt_data_modified":n="date";break;case"dt_created":n="date"}var o="desc";t.hasClass("active")?t.hasClass("desc")?(o="asc",t.removeClass("desc").addClass("asc")):t.removeClass("asc").addClass("desc"):(o=t.attr("class"),t.siblings("li.active").removeClass("active"),t.addClass("active")),A.storeSortDataAndChangeSortStyle(r,n,o),u.sortObjArr(E.dataSet,r,n,o);var i=E.dataSet.slice(0,M.docs.length);M.showDocs(i)}},viewCtrl:function(e){return z.msg!==e?(h.attr("class",x.doclist),z.personal===e?h.addClass(x.personal):z.group===e&&h.addClass(x.group)):h.attr("class",x.msglist),M.showingtype=e,!1}},B={localize:function(){},showSort:function(){y.addClass(x.sort)},hideSort:function(){y.removeClass(x.sort)},isLoading:!1,showLoading:function(e){B.loading=!0;var t=a.setCurDocListKey(e);return t||l.show(T.loadingLayer,b),t},hideLoading:function(){B.loading=!1,l.hide(T.loadingLayer,b)},setPath:function(e){p.text(e),p.attr("title",e)},showDocList:function(e,t,n,r){n||t==M.showDocKey||B.scrollTop(),N.showDocs(e,t,n,r)},clearDocList:function(){a.setCurDocListKey(""),M.showDocKey=""},scrollTop:function(){b.scrollTop(0)},getValidNoteById:function(e,t,n){var r;if(t){var o=n.length;for(r=0;o>r&&n.get(r).getAttribute(e)!=t;r++);}else r=0;return B.getValidNote(r,n)},getValidNoteByIndex:function(e,t){return B.getValidNote(e,t)},getValidNote:function(e,t){var n=t.length;if(n>0){if(n>e){for(var r=e;n>r;r++)if(B.isValidNote(t.eq(r)))return t.eq(r);return t.eq(e)}return t.eq(0)}return!1},isValidNote:function(e){return!e.hasClass("encrypt")},scrollIntoView:function(e,t){}},O={bind:function(){this.bindSortBtn(),m.delegate("li","click",N.sort),k.bind("click",F.markAllReadStatus)},bindSortBtn:function(){v.bind("click",function(){y.hasClass(x.sort)?B.hideSort():B.showSort()}),f.globalEvent.bind(g,"click",O.hideSortLayerHandler)},hideSortLayerHandler:function(e){var t=$(e.target);t.attr("id")===T.sortBtn||t.parents("#"+T.sortBtn).length>0||t.attr("id")===T.sortRule||t.parents("#"+T.sortRule).length>0||B.hideSort()}},F={showMsgDocList:function(e){var t;e.action_cmd==i.web.note.docListType.Msg?(t={message_type:e.action_value,doc_guid:e.doc_guid},e.action_value===i.web.note.msgType.unRead?(t.message_type=i.web.note.msgType.unRead,t.read_status=0,_.addClass(x.unread)):_.removeClass(x.unread),F.getMessageList(t)):F.getDocumentList(e)},getMenuType:function(e){var t=!!f.models.groupInfo.getGroup(e.kb_guid);return e.action_cmd==i.web.note.docListType.Search&&e.action_value.length>0?z.docList.search:e.action_cmd==i.web.note.docListType.Category||e.action_cmd==i.web.note.docListType.Tag&&t?z.docList.category:e.action_cmd==i.web.note.docListType.Tag?z.docList.tag:z.docList.last},getAllMessageCount:function(){return f.models.msg.getAllMsgCount()},getMessageList:function(e){var t=i.web.note.docListType.Search+"_"+e.message_type,n=B.showLoading(t),o=function(o,s){if(B.hideLoading(),L.onlyUnRead=t==i.web.note.docListType.Search+"_"+i.web.note.msgType.unRead,o&&t==a.noteCur.docListKey&&(L.allMsgsCount=F.getAllMessageCount(),B.showDocList(o,t,n,z.msg)),e.doc_guid||n||s){if(e.doc_guid&&!s){var u={prop:"data-msgid",val:a.noteCur.msgid};r("msg",e.doc_guid||a.noteCur.docGuid,!1,u)}}else r("msg",null,!0)};e.auto=!0,g.trigger(I.EventManager,[D.GetBizMessage,e,i.web.modelStamp.DocMessageList,o])},getDocumentList:function(e){var t=e.action_cmd==i.web.note.docListType.Search&&e.action_value.length>0?"search_"+e.kb_guid:"doc_"+e.kb_guid+"_"+e.action_cmd+"_"+e.action_value,n=B.showLoading(t),o=!1;M.loading=!0,F.addAliasForList(e.kb_guid,function(){o=!0}),M.menuType=F.getMenuType(e);var s=function(i,u){var l=this;if(!o)return void setTimeout(function(){s.apply(l,[i,u])},100);M.loading=!1,B.hideLoading();var c,d,g,h=!1;if(i&&t==a.noteCur.docListKey){for(c=i.length-1;c>=0;c--)d=i[c],g=f.models.bizMemberListForAt.getUserByUserId({kb_guid:e.kb_guid},d.document_owner),d.owner_alias=g?g.alias:"",g||(h=!0);h&&f.models.bizMemberListForAt.clearStorage(e.kb_guid);var p=!!f.models.groupInfo.getGroup(e.kb_guid);B.showDocList(i,t,n,p?z.group:z.personal)}e.doc_guid||n||u?e.doc_guid&&!u&&r("doc",e.doc_guid,!1):r("doc",null,!0)};e.auto=!0,g.trigger(I.EventManager,[D.GetDocumentList,e,i.web.modelStamp.DocMessageList,s])},getDocumentSummary:function(e,t){g.trigger(I.EventManager,[D.GetDocumentSummary,e,"",t])},addAliasForList:function(e,t){var n=f.models.groupInfo.getGroup(e),r={kb_guid:e,biz_guid:n?n.bizGuid:""};g.trigger(I.EventManager,[D.GetBizMemberListForAt,r,"",function(e){t(e)}])},markAllReadStatus:function(){g.trigger(I.EventManager,[D.MarkAllReadStatus,function(){g.trigger(I.EventManager,[I.UpdateMsgList]),A.markAllMsgRead()}])}};t.exports={init:o,showMsgDocList:F.showMsgDocList,clearMsgDocList:B.clearDocList,setPath:B.setPath,removeDocument:function(e){A.delSpecificDoc(e,M)},updateSpecficNote:function(e){A.updateNoteInfo(e)},getListContent:function(){return b}}},{"../../../common/avalon-extend/calendarTime":2,"../../../config/wizConf":13,"../../database/wizCenter":18,"../../util/GlobalUtil":35,"../../util/pintrest":41,"../../viewer-common/loading":44,locale:"locale"}],51:[function(e,t,n){function r(e){w=$("body"),k=$("#"+Be.noteList),M=$("#"+Be.readMain),L=$("#"+Be.readContent),x=$("#"+Be.editBtn),S=$("#"+Be.createBtn),T=$("#"+Be.deleteBtn),z=$("#"+Be.backtoreadBtn),I=$("#"+Be.savingBar),D=$("#"+Be.savedTxt),E=$("#"+Be.docTools),G=$("#"+Be.docDetailBtn),A=$("#"+Be.shareBtn),N=$("#"+Be.historyBtn),B=$("#"+Be.commentIconBtn),O=$("#"+Be.categoryContent),F=$("#"+Be.categoryBtn),P=$("#"+Be.categoryLayer),U=$("#"+Be.categoryTree),W=$("#"+Be.addTagBtn),R=$("#"+Be.addTagLayer),H=$("#"+Be.addAttachmentBtn),Y=$("#"+Be.titleInput),K=$("#"+Be.txtForCaret),V=$("#"+Be.atList),Z=$("#"+Be.atScrollLayer),j=$("#"+Be.userListContent),q=$("#"+Be.atTips),X=$("#"+Be.commentTxtForCaret),J=$("#"+Be.commentAtList),Q=$("#"+Be.commentAtScrollLayer),ee=$("#"+Be.commentUserListContent),te=$("#"+Be.commentAtTips),Ie=$("#"+Be.tagUl),ne=$("#"+Be.attachUl),De=$("."+Oe.more,Ie),re=$(".attachlist ."+Oe.more),ue=$("#"+Be.cmtCtn),oe=$("#"+Be.commentBtn),ie=$("#"+Be.commentBtnTxt),ae=$("#"+Be.commentText),se=$("#"+Be.commentTxtCountInfo),le=$("#"+Be.cmtOl),fe=$("#"+Be.noteContentLayer),ge=$("#"+Be.noteContentCtn),ce=$("#"+Be.noteTitleLayer),de=$("#"+Be.noteAddonLayer),_e=$("#"+Be.customNotFoundMsg),he=$("#"+Be.uploadLayer),pe=$("#"+Be.uploadAttachContent),me=$("#"+Be.uploadDocguidInput),ve=$("#"+Be.uploadTokenInput),be=$("#"+Be.uploadKbguidInput),ye=$("#"+Be.uploadClientTypeInput),Ce=$("#"+Be.fileInput),ke=$("#"+Be.submitBtn),Me=$("#"+Be.uploadForm),Le=$("#"+Be.fileBtn),Se=$("#"+Be.fileNameTxt),Te=$("#"+Be.progressBar),xe=$("#"+Be.progressValue),ze=window.frames.att_upload_iframe,Ee=$("#"+Be.newTagInput),Ge=$("#"+Be.docList),C=e,_WIZ_CONFIG.oem.getData("HideMyShare")?A.remove():b.init(C),y.init(C,{callback:{onAdd:qe.onAddEditCount,onGet:qe.onGetEditCount}}),o.init(C,Be.docFrame),Ze.localize(),Ze.init(),je.bind()}var o=e("./docFrame"),i=e("../../util/GlobalUtil"),a=e("../../../config/wizConf"),s=e("../../database/wizCenter"),u=e("locale"),l=e("../../model/Authority"),c=e("../../viewer-common/loading"),d=e("./menuTreeTools"),g=e("./menuTree"),f=e("./docEditor"),h=e("./menuSetting"),p=e("../../../common/kramed/kramed.js"),m=e("../../../common/prettify/prettify"),v=e("../../../component/markdown-editor/editor"),b=e("./docViewShare"),y=e("./docViewEditCount"),_=e("../../../common/avalon-extend/calendarTime");_.init();var w,C,k,M,L,S,T,x,z,I,D,E,G,A,N,B,O,F,P,U,W,R,H,Y,K,V,Z,j,q,X,J,Q,ee,te,ne,re,oe,ie,ae,se,ue,le,ce,de,ge,fe,he,pe,me,ve,be,ye,_e,we,Ce,ke,Me,Le,Se,Te,xe,ze,Ie,De,Ee,Ge,Ae,Ne,Be={docFrame:"wiz_doc_iframe",noteList:"note-list .content",readMain:"read",readContent:"read .content",createBtn:"create-btn",deleteBtn:"delete-btn",editBtn:"edit-btn",backtoreadBtn:"backtoread-btn",savingBar:"savingBar",savedTxt:"savedTxt",docTools:"docTools",docDetailBtn:"docinfo-btn",docDetailCtn:"docinfo-ctn",shareBtn:"share-btn",historyBtn:"history-btn",commentIconBtn:"comment-icon",categoryContent:"category-ctn",categoryBtn:"note-cate",categoryLayer:"cate-select",categoryTree:"category-tree",addTagBtn:"addTagBtn",addTagLayer:"edittag-ctn",addAttachmentBtn:"addAttachBtn",titleInput:"edit-title",txtForCaret:"txtForCaret",atList:"atList",atScrollLayer:"atScrollLayer",userListContent:"userListContent",atTips:"atList .tips",commentTxtForCaret:"commentTxtForCaret",commentAtList:"commentAtList",commentAtScrollLayer:"commentAtScrollLayer",commentUserListContent:"commentUserListContent",commentAtTips:"commentAtList .tips",tagUl:"tag-ul",attachUl:"attach-ul",cmtCtn:"read #comment-ctn",cmtOl:"comment_list",commentBtn:"read #comment_btn",commentBtnTxt:"publish_comment",commentText:"read #comment_text",commentTxtCountInfo:"commentTxtCountInfo",noteTitleLayer:"read .notetitle-ctn",noteAddonLayer:"read .noteaddon-ctn",noteContentLayer:"read .notecontent-layer",noteContentCtn:"read .notecontent-ctn",uploadLayer:"upload-attach",uploadAttachContent:"attach-content",uploadDocguidInput:"docguid-input",uploadTokenInput:"token-input",uploadKbguidInput:"kbguid-input",uploadClientTypeInput:"client_type-input",uploadForm:"upload-form",fileInput:"uploader-input",submitBtn:"submit-upload",fileBtn:"ghost-file-btn",fileNameTxt:"upload-filename",progress:"uploadprogress .done",progressBar:"upload-progress .bar",progressValue:"upload-progress .text",newTagInput:"newtag-input",docList:"doclist-ctn",loadingLayer:"note-loading",customNotFoundMsg:"customNotFoundMsg"},Oe={shareInfo:"shareInfo",docInfo:"docInfo",groupDoc:"groupnote",more:"more",edit:"edit",setting:"setting",active:"active",hide:"hide",readonly:"readonly",uploading:"uploading",dropable:"dropable",cancelBtn:"modal-close-btn",updateBtn:"update",noProgress:"no-prg",markdownContent:"markdown-body",disabled:"disabled",modalEntry:"modal-entry"},Fe=a.web.frameEventType,Pe=a.web.dataOperateType,Ue=!1;window.marked=p;var $e,We,Re,He,Ye=a.web.note.maxFileSize,Ke=u.docDocument.label.selectFileAlert.replace("$1",Ye),Ve=u.docDocument.err.attachment_upload_413.replace("$1",Ye);avalon.filters.markdown=function(e){var t=new p.Renderer;return t.code=function(e,t){var n='<pre class="prettyprint linenums language-'+t+'">';return n+="<code>"+m.prettyPrintOne(e.replace(/</g,"&lt;").replace(/>/g,"&gt;"),t,!0)+"</code>",n+="</pre>"},p.setOptions({renderer:t,gfm:!0,tables:!0,breaks:!0,pedantic:!1,sanitize:!1,smartLists:!0,smartypants:!1}),i.xssFilter(p(wizUI.util.htmlDecode(e)))},avalon.ready(function(){var e=$("#read");$e=avalon.define("doc",function(e){e.doc_info={},e.dd_path="",e.dd_source="",e.dd_author="",e.dd_alias="",e.dd_dt_create="",e.dd_dt_modified="",e.title="",e.docGuid="",e.kbGuid="",e.editFlag=!1,e.newFlag=!1,e.can_edit={can:!1},e.can_delete={can:!1},e.deleted=!1,e.hasShare=!1,e.editByOther=!1,e.editByOtherInfo="",e.emptyType="",e.init=function(t){e.reset(),e.doc_info=t,e.dd_path="",e.dd_source=t.document_url,e.dd_author=t.document_owner;var n=C.models.bizMemberListForAt.getUserByUserId({kb_guid:t.kb_guid},t.document_owner);e.dd_alias=n?n.alias:"",e.dd_dt_create=t.dt_created,e.dd_dt_modified=t.dt_modified,e.can_edit=qe.docCanEditor(t),e.can_delete=l.deleteDoc(t.kb_guid,t.document_owner),e.deleted=!1,t.isNewNote&&(e.newFlag=!0),e.title=t.document_title,e.docGuid=t.document_guid,e.kbGuid=t.kb_guid,Re.tags.clear(),qe.getDocTags(t),qe.getDocPath(t)},e.more=function(e){var t=$(e.target),n=t.siblings("ul");n.hasClass(Oe.more)?(n.removeClass(Oe.more),t.text(u.common.label.more)):(n.addClass(Oe.more),t.text(u.common.label.less)),w.trigger(Fe.EventManager,[Fe.FrameResizeTrigger])},e.isEmpty=function(){return!e.doc_info||!e.doc_info.document_guid},e.reset=function(){e.editFlag=!1,s.noteCur.editFlag=e.editFlag,e.newFlag=!1,Re.editTagFlag=!1,Re.moreTagFlag=!1,Re.tagUlShow=!1,He.moreAttachFlag=!1,He.attaches.clear()},e.startEdit=function(){e.editFlag=!0,s.noteCur.editFlag=e.editFlag,Y.val(e.title),w.trigger(Fe.EventManager,[Fe.FrameResizeTrigger]),qe.addEditCount($e.doc_info.kb_guid,$e.doc_info.document_guid)},e.endEdit=function(){e.newFlag=!1,e.editFlag=!1,s.noteCur.editFlag=e.editFlag,Re.editTagFlag=!1,w.trigger(Fe.EventManager,[Fe.FrameResizeTrigger]),o.resize(),qe.checkEditCount($e.doc_info.kb_guid,$e.doc_info.document_guid,null)},e.scrollToCmt=function(){ge.get(0).scrollTop=ue.get(0).offsetTop},e.restoreHistory=function(){var t=a.url.doc.history+"?obj_type=document&kb_guid="+e.doc_info.kb_guid+"&obj_guid="+e.doc_info.document_guid;w.trigger(Fe.EventManager,[Fe.ShowWizFrame,{url:t,"class":"history-frame"}])},e.fullScreen=function(){wizUI.util.openWizLink(a.url.common.noteFullScreen+"?kb="+e.doc_info.kb_guid+"&dc="+e.doc_info.document_guid)},e.isURL=function(e){var t=/^http[s]?:\/\//g;return!!t.test(e)},e.modifyMenu=function(e){Ze.switchKbFormDoc(),Ze.hideDocDetail()},e.$skipArray=["doc_info"]}),Re=avalon.define("tag",function(t){t.tags=[],t.tagArr=[],t.kbtags=[],t.moreTagFlag=!1,t.editTagFlag=!1,t.tagUlShow=!1,t.initTag=function(n){var r,o,a;if(n.sort(function(e,t){return e.tag_name.localeCompare(t.tag_name)}),t.tags&&n){var s=i.arrayCompare(t.tags,n,"tag_guid");for(r=s.del.length-1;r>=0;r--)t.tags.splice(s.del[r],1);for(r=0,o=s.add.length;o>r;r++)a=s.add[r],t.tags.splice(a,0,n[a])}else t.tags?t.tags.clear():t.tags=n?n:[];Ie.removeClass(Oe.more),De.text(u.common.label.more),setTimeout(function(){$(".taglist li.raw",e).removeClass("raw")},20),setTimeout(function(){Ze.checkTagListMore()},220),t.tags.length>1&&(t.tagUlShow=!0),t.tagArr.clear();var l=n?n.length:0;for(r=0;l>r;r++)t.tagArr.push(n[r].tag_guid)},t.initKbTags=function(e){var t=e.length;Re.kbtags.clear();for(var n=0;t>n;n++)Re.kbtags.push({tag_guid:e[n].tag_guid,tag_name:e[n].tag_name})},t.editTag=function(){$e.editFlag&&(t.editTagFlag=!t.editTagFlag,t.editTagFlag?C.globalEvent.bind(w,Fe.FrameResize,Ze.setTagLayerMaxH):C.globalEvent.unbind(w,Fe.FrameResize,Ze.setTagLayerMaxH),Ze.setTagLayerMaxH())},t.stopAddTag=function(){t.editTagFlag=!1,C.globalEvent.unbind(w,Fe.FrameResize,Ze.setTagLayerMaxH)},t.addTag=function(n){var r,o=$(n.target).closest("li"),i=o.attr("data-tagguid"),a=o.text();if(o.hasClass("in"))r=t.tagArr.indexOf(i),t.tagArr.splice(r,1),t.tags.splice(r,1);else{var s={tag_guid:i,tag_name:a};t.tags.push(s),setTimeout(function(){$(".taglist li.raw",e).removeClass("raw")},20),t.tagArr.push(i)}Ze.checkTagListMore()},t.enterCreateTag=function(e){e&&13==e.keyCode&&je.createTag()},t.createTag=function(){je.createTag.apply(this,arguments)},t.deleteTagHandler=function(e){for(var n=t.tags.length,r=0;n>r;r++)if(t.tags[r].tag_guid==e){t.tags.splice(r,1);break}var o=t.kbtags.length;for(r=0;o>r;r++)if(t.kbtags[r].tag_guid==e){t.kbtags.splice(r,1);break}}}),He=avalon.define("attach",function(e){e.attaches=[],e.moreAttachFlag=!1,e.addAttach=function(){return $e.can_edit.can||"undefined"==typeof $e.can_edit.role?(he.addClass(Oe.active),void i.setLayout(pe,H,a.web.confirm.Type.DownLeft)):void C.showErrorMessage({msg:u.groupRoleText["title_"+$e.can_edit.role]+u.docDocument.err.authority_edit})},e.initAttach=function(t){e.attaches=t,ne.removeClass(Oe.more),re.text(u.common.label.more),Ze.checkAttachListMore()},e.addToProp=function(t){e.attaches.push({attachment_name:t.name,attachment_guid:t.attachment_guid,download_url:t.url}),e.altDocAttachInfo(1),w.trigger(Fe.EventManager,[Fe.UpdateDocument,{docInfo:$e.doc_info}]),Ze.checkAttachListMore()},e.deleteAttach=function(t){var n=$(t.target),r=n.closest("li").attr("data-attachguid"),o={content:u.docDocument.label.deleteAttachmentConfirm.replace("{$1}",$(t.target).closest("li").attr("data-attachname")),target:n,layout:a.web.confirm.Type.DownRight};C.confirmMessage(o,function(t){if(t){var n={kb_guid:M.attr("data-kbguid"),document_guid:M.attr("data-docguid"),attachment_guid:r};w.trigger(Fe.EventManager,[Pe.DeleteAttachment,n,function(t){if(t)for(var n=e.attaches.length,o=0;n>o;o++)if(e.attaches[o].attachment_guid==r){e.attaches.splice(o,1),e.altDocAttachInfo(-1),w.trigger(Fe.EventManager,[Fe.UpdateDocument,{docInfo:$e.doc_info}]),Ze.checkAttachListMore();break}}])}})},e.altDocAttachInfo=function(e){$e.doc_info.document_attachment_count=Number($e.doc_info.document_attachment_count)+e},e.$skipArray=["addToProp"]}),We=avalon.define("comment",function(e){e.cmtList=[],e.cmtCount=0,e.user=s.userInfo.user_guid,e.userIcon=s.getUserIcon(),e.textShadowTxt="",e.useMarkdown=window.localStorage.useMarkdown?JSON.parse(window.localStorage.useMarkdown):!1,e.newCmt=function(t){return t&&(e.cmtList.unshift(t),e.cmtCount++),!1},e.addCmt=function(){qe.addComment()},e.cancelCmt=function(){Ze.cancelComment()},e.removeOne=function(t){for(var n=e.cmtList.length,r=0;n>r;r++)if(e.cmtList[r]&&e.cmtList[r].id===t){e.remove(r),e.cmtCount--;break}return!1},e.remove=function(t){return e.cmtList.splice(t,1),$(window).trigger("resize"),!1},e.getCmt=function(t){var n,r,o=e.cmtList.length;for(n=0;o>n;n++)if(r=e.cmtList[n],r.comment_sn==t)return r;return null},e.checkUseMarkdown=function(){var e=$(".editor-toolbar");this.checked?(We.useMarkdown=!0,e.show(500),window.localStorage.setItem("useMarkdown",!0)):(Ze.quitMarkdownPreview(),We.useMarkdown=!1,e.hide(500),window.localStorage.setItem("useMarkdown",!1))},e.dateTitle=function(e){return avalon.filters.date(e,"yyyy-MM-dd HH:mm:ss")}}),avalon.scan(e.get(0),"doc"),avalon.scan($(".taglist",e).get(0),"tag"),avalon.scan($(".attachlist",e).get(0),"attach"),avalon.scan($(".content",e).get(0),"comment")});var Ze={localize:function(){Se.text(Ke)},init:function(){wizUI.Modal.init(),Ze.initCodeMirror(),Ze.initUpload(),_WIZ_CONFIG.oem.getData("HideHistory")&&N.hide(),Ze.checkCommentTxtCount()},initCodeMirror:function(){var e={};e.status=!1,e.toolbar=[{name:"bold",action:v.toggleBold,title:u.common.editor.bold},{name:"italic",action:v.toggleItalic,title:u.common.editor.italic},"|",{name:"quote",action:v.toggleBlockquote,title:u.common.editor.quote},{name:"unordered-list",action:v.toggleUnOrderedList,title:u.common.editor.ul},{name:"ordered-list",action:v.toggleOrderedList,title:u.common.editor.ol},"|",{name:"link",action:v.drawLink,title:u.common.editor.link},"|",{name:"help",action:a.url.blogInfo.commentMarkdown,title:u.common.editor.info,target:"#markdown-editor-help"},{name:"preview",action:v.togglePreview,title:u.common.editor.preview}],Ae=new v(e),Ae.render(ae[0]);var t=$(document.createElement("i"));t.addClass("icon icon-quz-circle"),$(".icon-help",ue).append(t),Ne=Ae.codemirror,We.useMarkdown&&$(".editor-toolbar").css("display","block")},initAutoComplete:function(e){e&&e.sort(function(e,t){return e.alias&&e.alias.localeCompare(t.alias)}),Y.wizTextAutoCompleteForAt({textCopyObj:K,listLayer:V,scrollLayer:Z,userListContent:j,relativeLayer:L,defaultCount:10,userList:e,allName:u.docAutoComplete.allName,multiLine:!1,updateBtn:$("."+Oe.updateBtn,V),callback:{makeListHtml:function(e){var t,n,r,o=[];for(t=0,n=e.length;n>t;t++)r=e[t],o.push("<li data-index='",t,"' class='userItem ",0===t?"on":"","'><a href='#' tabindex='1'>",r.aliasHtml," (",r.user_id,")</a></li>");return o.join("")},updateUserList:function(){var e=s.noteCur.kb.kbGuid;C.models.bizMemberListForAt.clearCache(e),qe.getBizUserList({kb_guid:e},function(e){Y.updateUserList(e),ae.updateUserList(e)})}}}),ae.wizTextAutoCompleteForAt({codeMirror:Ae,textCopyObj:X,listLayer:J,scrollLayer:Q,userListContent:ee,relativeLayer:L,defaultCount:10,userList:e,allName:u.docAutoComplete.allName,multiLine:!0,updateBtn:$("."+Oe.updateBtn,J),callback:{makeListHtml:function(e){var t,n,r,o=[];for(t=0,n=e.length;n>t;t++)r=e[t],o.push("<li data-index='",t,"' class='userItem ",0===t?"on":"","'><a href='#' tabindex='1'>",r.aliasHtml," (",r.user_id,")</a></li>");return o.join("")},updateUserList:function(){var e=s.noteCur.kb.kbGuid;C.models.bizMemberListForAt.clearCache(e),qe.getBizUserList({kb_guid:e},function(e){ae.updateUserList(e),Y.updateUserList(e)})}}})},initUpload:function(){wizUI.support.FormData&&Me.addClass(Oe.dropable),Me.attr("action",a.api.doc.attachmentUpload.url),Me.get(0).reset(),Me.removeClass(Oe.uploading),window.toStaticHTML&&Me.addClass("fuck-ie8-form")},initUploadForm:function(e,t,n){me.val(e),ve.val(t),be.val(n),ye.val(a.remote.CLIENT_TYPE)},showLoading:function(){c.show(Be.loadingLayer,L)},hideLoading:function(){c.hide(Be.loadingLayer,L)},clearDocument:function(e){s.setCurDocInfo(null),$e.doc_info={},$e.docGuid="",$e.title="",$e.endEdit(),Ze.setDocBody()},showEmptyInfo:function(e,t){e?($e.emptyType=e,Ze.hideLoading(),s.noteCur.docGuid=null):$e.emptyType="",e==a.web.note.emptyType.docNotFound&&(t=t||"",_e.html(t))},cancelShare:function(){$e.hasShare=!1},isShare:function(){$e.hasShare=!0},editContentFocus:function(){Ze.hideCategoryLayer();var e=$e.title.length;i.setSelection(Y.get(0),e,e)},editNewDoc:function(e){Ge.find(" li.note-list-item.active").removeClass("active"),e.document_title=u.docDocument.label.createDefaultTitle,s.setCurDocInfo(e),qe.getShareInfo({kb_guid:e.kb_guid,document_guid:e.document_guid});var t={docInfo:e};e.isNewNote=!0,e.version="temp",$e.init(e),w.trigger(Fe.EventManager,[Fe.EditDocument,t]),$e.startEdit(),je.saveDocHandler(),We.cmtList.clear()},showDocument:function(e){return w.trigger(Fe.EventManager,[Fe.FrameResizeTrigger]),Ne.setValue(""),C.models.groupInfo.getGroup(e.kb_guid)?M.addClass(Oe.groupDoc):M.removeClass(Oe.groupDoc),e?(s.setCurDocInfo(e),$e.init(wizUI.util.clone(e)),void Ze.setDocBody(e)):void Ze.clearDocument()},setDocBody:function(e){ge.get(0).scrollTop=0,e?o.setHTML(e):o.clear()},showAttachments:function(e){He.initAttach(wizUI.util.clone(e))},cancelComment:function(){Ne.setValue(""),Ne.focus()},checkTagListMore:function(){Re.moreTagFlag=Ie.get(0).scrollHeight>40},checkAttachListMore:function(){He.moreAttachFlag=ne.get(0).scrollHeight>40},checkAddonListMore:function(){Ze.checkTagListMore(),Ze.checkAttachListMore()},checkCommentTxtCount:function(){var e=Ne.getValue(),t=e.length,n=a.web.comment.maxLetterCount-t;0>n?se.removeClass(Oe.hide).text(u.docComment.label.commentTextCountOver.replace("$1",-n)):se.addClass(Oe.hide),C.models.comment.setTempComment(M.attr("data-docguid"),e)},showComment:function(e){e||(e=[]),e.sort(function(e,t){return t.dt_created-e.dt_created}),We.cmtList=wizUI.util.clone(e),We.cmtCount=We.cmtList.length;var t=C.models.comment.getTempComment(M.attr("data-docguid"));Ne.setValue(t),Ze.checkCommentTxtCount()},showDocDetail:function(){E.addClass(Oe.docInfo)},hideDocDetail:function(){E.removeClass(Oe.docInfo)},showCategoryTree:function(e,t){Je.initCategoryTree(e,t),O.addClass(Oe.edit)},setTagLayerMaxH:function(){var e=i.getDomPosition(L),t=i.getDomPosition(R);R.css("max-height",e.height-t.top+e.top-10+"px")},setCategoryLayerMaxH:function(){var e=i.getDomPosition(L),t=i.getDomPosition(P);P.css("max-height",e.height-t.top+e.top-10+"px")},showCategoryLayer:function(){return O.hasClass(Oe.edit)?void Ze.hideCategoryLayer():(Ze.setCategoryLayerMaxH(),C.globalEvent.bind(w,Fe.FrameResize,Ze.setCategoryLayerMaxH),void qe.getCategory())},hideCategoryLayer:function(){C.globalEvent.unbind(w,Fe.FrameResize,Ze.setCategoryLayerMaxH),O.hasClass(Oe.edit)&&(O.removeClass(Oe.edit),h.appendFragment())},resizeNoteContent:function(){$e.editFlag?f.resizeEditorIframe():o.resize();var e=parseInt(L.css("height"),10),t=parseInt(ce.css("height"),10),n=parseInt(de.css("height"),10);fe.css("height",e-t-n+"px")},isFormUploading:function(){return Me.hasClass(Oe.uploading)},updateUploadFormStatue:function(e){e?Me.addClass(Oe.uploading):Me.removeClass(Oe.uploading)},setNoProgress:function(e){e?Me.addClass(Oe.noProgress):Me.removeClass(Oe.noProgress)},updateDropAreaStatue:function(e){e?Me.addClass("dragenter"):Me.removeClass("dragenter")},updateUploadProgress:function(e){Te.css("width",e+"%"),xe.text(e+"%")},quitMarkdownPreview:function(){var e=$(".editor-preview");e.hasClass("editor-preview-active")&&v.togglePreview(Ae)},switchKbFormDoc:function(){var e=s.noteCur.docInfo,t=C.models.groupInfo.getGroup(e.kb_guid),n=t&&t.bizGuid,r={action_cmd:n?a.web.note.docListTypeParams.tag:a.web.note.docListTypeParams.category,action_value:n?e.document_tag_guids:e.document_category,doc_guid:e.document_guid,fromUrl:!0,changeUrl:!0};w.trigger(a.web.frameEventType.EventManager,[a.web.frameEventType.SwitchKb,e.kb_guid,r])}},je={bind:function(){S.bind("click",je.createDocHandler),x.bind("click",je.editDocHandler),z.bind("click",je.backReadHandler),F.bind("click",je.changeCategoryHandler),je.bindDocToolsBtn(),je.bindComment(),je.bindUploadAct(),w.on("click","."+Oe.markdownContent+" a",function(e){"A"!=e.target.tagName||e.target.hasAttribute("target")||e.target.setAttribute("target","_blank")}),U.delegate("span."+Oe.setting,"click",function(e){return U.trigger("click",[e.target]),h.showMenuSetting($(e.target),P)}),C.globalEvent.bind(w,Fe.FrameResize,[Ze.resizeNoteContent,Ze.checkAddonListMore]),C.globalEvent.bind(window,"resize",[Ze.resizeNoteContent]),C.globalEvent.bind(w,"click",[je.hideDocDetailHandler,je.hideCategoryLayerHandler,je.hideTagLayerHandler])},bindDocToolsBtn:function(){A.bind("click",je.shareInfoHandler),G.bind("click",je.docDetailHandler),T.bind("click",je.deleteDocHandler)},bindComment:function(){Ne.on("keypress",function(e,t){10!=t.keyCode&&13!=t.keyCode||!t.ctrlKey&&!t.metaKey||qe.addComment()}),ue.delegate("a","click",function(e){var t=$(e.currentTarget),n=t.attr("href")||"";n&&0===n.indexOf("wiz:")&&(wizUI.util.openWizLink(i.parseWizLink(n)),wizUI.util.stopBubble(e),wizUI.util.stopDefault(e))}),Ne.on("update",Ze.checkCommentTxtCount),le.delegate(".comment-delete","click",function(){var e=this;qe.deleteComment(e)}).delegate(".comment-reply","click",function(){var e=this.getAttribute("data-user-guid"),t=this.getAttribute("data-comment-sn");oe.parentUserGuid=e,oe.parentSn=t;var n=We.getCmt(t),r=wizUI.util.htmlDecode(n.comment_body).replace(/\n/g,"\n> ");Ne.setValue(n?"\n> //@"+n.user_name+u.common.colon+"\n> "+r:""),Ze.checkCommentTxtCount(),Ne.setCursor(0,0),Ne.focus()})},bindUploadAct:function(){var e={init:function(){e.bindFormUploader(),wizUI.support.FormData&&e.bindDnDUploader()},bindFormUploader:function(){function t(){var e=Ce.get(0);if(n(e)){if(e.files&&!qe.checkFileSize(e.files[0]))return C.showWarningMessage({msg:Ve}),!1;Ze.initUploadForm($e.docGuid,s.token,$e.kbGuid),Ze.isFormUploading()?C.showSuccessMessage({msg:u.docDocument.label.attachmentUploading}):(ze.document&&(ze.document.body.innerHTML=""),Me.submit(),Ze.setNoProgress(!0),Ze.updateUploadFormStatue(!0),r())}else C.showErrorMessage({msg:u.docDocument.label.noAttachmentUpload});return!1}function n(e){return!!e.value}function r(){var t=setInterval(function(){var n,r=ze.document?ze.document.body.innerHTML:"";if(r){try{n=JSON.parse(r)}catch(o){return C.showErrorMessage({
msg:u.docDocument.err.attachment_upload}),clearInterval(t),Ce.val(""),Ze.updateUploadFormStatue(!1),Se.text(Ke),!1}return n&&"200"==n.code?(n.name=Se.text(),e.sucHandler(n),C.showSuccessMessage({msg:u.docDocument.label.attachmentUploaded})):e.errHandler(n),clearInterval(t),Ze.setNoProgress(!1),Ze.updateUploadFormStatue(!1),Ce.val(""),Se.text(Ke),!1}return!0},250)}ke.click(t),Le.click(function(){Ce.trigger("click")}),Ce.bind("change",function(){var e;e=this.value?this.value.substr(this.value.lastIndexOf("\\")+1,this.value.length):Ke,Se.text(e)}),he.on("click","."+Oe.cancelBtn,Ze.initUpload)},bindDnDUploader:function(){function t(e){var t=e.dataTransfer.types.some(function(e){return"Files"===e});t&&Ze.updateDropAreaStatue(!0)}function n(e){return e.preventDefault(),l(e.dataTransfer.types)&&Ze.updateDropAreaStatue(!0),!1}function r(){return Ze.updateDropAreaStatue(!1),!1}function o(){return Ze.updateDropAreaStatue(!1),!1}function i(e){e.preventDefault(),Ze.updateDropAreaStatue(!1);var t=l(e.dataTransfer.types);if(t===!1);else{var n=e.dataTransfer.files[t];if(!qe.checkFileSize(n))return C.showWarningMessage({msg:Ve}),!1;c(n),Ze.updateUploadFormStatue(!0)}return!1}function l(e){for(var t=e.length,n=0;t>n;n++)if("Files"==e[n])return n;return!1}function c(e){return Ze.updateUploadProgress(0),d(e),!1}function d(t){Ze.initUploadForm($e.docGuid,s.token,$e.kbGuid);var n=new FormData;n.append("attachment_file",t),n.append("document_guid",me.val()),n.append("token",ve.val()),n.append("kb_guid",be.val()),n.append("client_type",a.remote.CLIENT_TYPE);var r=new XMLHttpRequest,o=a.api.doc.attachmentUpload.url;r.open("post",o,!0),r.upload.onprogress=function(e){if(e.lengthComputable){var t=e.loaded/e.total*100|0;Ze.updateUploadProgress(t)}},r.onreadystatechange=function(){if(4===r.readyState)if(Ze.updateUploadFormStatue(!1),200===r.status){var n=JSON.parse(r.responseText);"200"==n.code?(n.name=t.name,e.sucHandler(n),C.showSuccessMessage({msg:u.docDocument.label.attachmentUploaded})):e.errHandler(n)}else{var o;413==r.status?o=Ve:(o=u.docDocument.err["attachment_upload_"+r.status],o=o?o:u.docDocument.err.attachment_upload),C.showErrorMessage({msg:o})}},r.send(n)}var g=Me.get(0);g.ondragenter=t,g.ondragover=n,g.ondragleave=r,g.ondragend=o,g.ondrop=i},sucHandler:function(e){He.addToProp(e)},errHandler:function(e){var t;413==e.code?t=Ve:(t=u.docDocument.err["attachment_upload_"+e.code],t=t?t:u.docDocument.err.attachment_upload),C.showErrorMessage({msg:t})}};e.init()},changeCategoryHandler:function(){Ze.showCategoryLayer()},editDocHandler:function(){return $e.isEmpty()?void 0:$e.can_edit.can||"undefined"==typeof $e.can_edit.msg?$e.can_edit.can||"undefined"==typeof $e.can_edit.role?void qe.checkEditCount($e.doc_info.kb_guid,$e.doc_info.document_guid,function(){var e=y.getEditAlert();if(e)return void C.showErrorMessage({msg:y.getEditAlert()});var t={docInfo:$e.doc_info};w.trigger(Fe.EventManager,[Fe.EditDocument,t]),$e.startEdit()}):void C.showErrorMessage({msg:u.groupRoleText["title_"+$e.can_edit.role]+u.docDocument.err.authority_edit}):void C.showErrorMessage({msg:$e.can_edit.msg})},backReadHandler:function(){C.onCheckDocChangedHandler(function(e){e&&(qe.getDocTags($e.doc_info),$e.endEdit())})},shareInfoHandler:function(e){var t=s.noteCur.shareInfo;s.noteCur.docInfo&&s.noteCur.shareInfo&&(t&&t.url||b.getDefaultShareInfo())},docDetailHandler:function(e){if(!$e.isEmpty()){var t=$(e.target);t.attr("id")===Be.docDetailCtn||t.parents("#"+Be.docDetailCtn).length>0||(E.hasClass(Oe.docInfo)?Ze.hideDocDetail():Ze.showDocDetail())}},deleteDocHandler:function(){if(!$e.isEmpty()){if(!$e.can_delete.can&&"undefined"!=typeof $e.can_delete.role)return void C.showErrorMessage({msg:u.groupRoleText["title_"+$e.can_edit.role]+u.docDocument.err.authority_delete});var e=s.noteCur.docInfo,t={content:u.docDocument.label.deleteConfirm.replace("{$1}",e.document_title)};C.confirmMessage(t,function(t){t&&w.trigger(Fe.EventManager,[Pe.DeleteDocument,{doc_info:e},function(t,n){je.deleteDocDone(t,n,e)}])})}},deleteDocDone:function(e,t,n){if(t){if($e.endEdit(),$e.deleted=!0,C.wizStyle()===a.web.style.wizWebFlatDoc)return void window.close();C.models.docList.clearDocumentListByDocument(n),w.trigger(Fe.EventManager,[Fe.RemoveDocument,{docInfo:n}]),$(window).trigger("resize")}},createDocHandler:function(){C.onCheckDocChangedHandler(function(e){if(e){var t=s.noteCur.kb.kbGuid,n=l.createDoc(t);if(!n.can&&"undefined"!=typeof n.role)return void C.showErrorMessage({msg:u.groupRoleText["title_"+n.role]+u.docDocument.err.authority_create});var r=(new Date).valueOf(),o=g.getCurLocation(),i=g.getCurTagGuid();w.trigger(Fe.EventManager,[Pe.CreateDocument,{kb_guid:t,document_owner:s.userInfo.email,document_category:o,document_tag_guids:i,document_url:"",userIcon:s.getUserIcon(),dt_created:r,dt_modified:r},Ze.editNewDoc])}})},saveDocHandler:function(){if(!$e.isEmpty()&&$e.editFlag){$e.title=Y.prop("value");var e=s.noteCur.docInfo,t=function(){var t=a.web.note.docListType.Category,n={kb_guid:e.kb_guid,doc_guid:e.document_guid};C.models.groupInfo.getGroup(e.kb_guid)?(n.tag_guid=e.document_tag_guids,t=a.web.note.docListType.Tag):n.location=e.document_category,$e.newFlag&&($e.newFlag=!1,e.isNewNote=!1,qe.searchComment({kb_guid:e.kb_guid,document_guid:e.document_guid}),w.trigger(Fe.EventManager,[Fe.ResetMenuTree,t,n]),w.trigger(Fe.EventManager,[Fe.FrameResizeTrigger]),w.trigger(Fe.EventManager,[Fe.ShowDocument,{kb_guid:e.kb_guid,doc_guid:e.document_guid}]));var r=s.noteCur.docListKey;if(0===r.indexOf("doc_")){n={};var o=r.split("_");o.splice(0,1),n.kb_guid=o.splice(0,1)[0],n.action_cmd=o.splice(0,1)[0],n.action_value=o.join("_"),n.doc_guid=e.document_guid,w.trigger(Fe.EventManager,[Fe.ShowMsgDocList,n])}};qe.saveDocument(t);var n,r,o=Re.tags.slice(0,Re.tags.length),i=[];for(n=0,r=o.length;r>n;n++)i.push(o[n].$model?o[n].$model.tag_guid:o[n]);$e.doc_info.document_tag_guids=i.join(";")}},createTag:function(){var e=Ee.val();if("disabled"==Ee.attr("disabled"))return!1;Ee.attr("disabled","disabled");var t=function(e){Ee.attr("disabled",!1),e&&Ee.val("")};return w.trigger(Fe.EventManager,[Fe.CreateTagFromDocView,{tagName:e,callback:t}]),!1},personalCategoryRenameHandler:function(e){$e.dd_path=e.displayLocation},personalKBTagRenameHandler:function(e){for(var t=Re.kbtags.length,n=0;t>n;n++)if(Re.kbtags[n].tag_guid==e.tag_guid){Re.kbtags[n].tag_name=e.tag_name;break}var r=Re.tags.length;for(n=0;r>n;n++)if(Re.tags[n].tag_guid==e.tag_guid){Re.tags[n].tag_name=e.tag_name;break}},groupKBTagRenameHandler:function(e){$e.doc_info.document_tag_guids==e.id&&qe.getDocPath($e.doc_info)},tagNewHandler:function(e){return Re.kbtags.push({tag_guid:e.tag_guid,tag_name:e.tag_name}),!1},hideDocDetailHandler:function(e){var t=$(e.target);t.attr("id")===Be.docDetailBtn||t.parents("#"+Be.docDetailBtn).length>0||t.attr("id")===Be.docDetailCtn||t.parents("#"+Be.docDetailCtn).length>0||Ze.hideDocDetail()},hideCategoryLayerHandler:function(e){var t=$(e.target);t.attr("id")===Be.categoryBtn||t.parents("#"+Be.categoryBtn).length>0||t.attr("id")===Be.categoryLayer||t.parents("#"+Be.categoryLayer).length>0||Ze.hideCategoryLayer()},hideTagLayerHandler:function(e){var t=$(e.target);t.attr("id")===Be.addTagBtn||t.parents("#"+Be.addTagBtn).length>0||t.attr("id")===Be.tagUl||t.parents("#"+Be.tagUl).length>0||t.attr("id")===Be.addTagLayer||t.parents("#"+Be.addTagLayer).length>0||Re.stopAddTag()}},qe={getDocPath:function(e){var t=e.kb_guid,n=e.document_tag_guids;C.models.groupInfo.getGroup(t)?w.trigger(Fe.EventManager,[Pe.GetTags,{kb_guid:t},a.web.modelStamp.DocTagName,function(){$e.dd_path=this.getTagNameForGroup(t,n)}]):$e.dd_path=C.models.category.formatLocation(e.document_category)},getDocTags:function(e){var t={kb_guid:e.kb_guid};w.trigger(Fe.EventManager,[Pe.GetTags,t,a.web.modelStamp.DocEditAllTags,function(t){if(t&&s.noteCur.docInfo.document_guid===e.document_guid){var n,r,o,i,a=[],u=e.document_tag_guids.replace(/\*/gi,";").split(";");for(n=0,r=u.length;r>n;n++)i=u[n],o=C.models.tag.getTagName(e.kb_guid,i),o&&a.push({tag_guid:i,tag_description:"",tag_name:o});Re.initTag(a)}}])},getEditingDocumentInfo:function(){var e=s.noteCur.docInfo;if(!e||e.document_guid!=$e.doc_info.document_guid)return null;e={kb_guid:e.kb_guid,document_category:e.document_category,document_tag_guids:e.document_tag_guids,document_guid:e.document_guid,document_title:Y.prop("value"),document_body:f.getDocBody(e.document_body)};var t=Re.tagArr,n=!!C.models.groupInfo.getGroup(e.kb_guid);return!n&&t&&t.length>0?e.document_tag_guids=t.join(";"):n||(e.document_tag_guids=""),e},getEditDocumentInfo:function(){var e=s.noteCur.docInfo,t=$e.title;if(!e||e.document_guid!=$e.doc_info.document_guid)return null;if(!t||t.length<0)return C.showErrorMessage({msg:u.docDocument.label.unTitleConfirm}),null;e.document_body=f.getDocBody(e.document_body),e.document_title=t;var n=Re.tagArr,r=!!C.models.groupInfo.getGroup(e.kb_guid);return!r&&n&&n.length>0?e.document_tag_guids=n.join(";"):r||(e.document_tag_guids=""),e},getBizUserList:function(e,t){var n=C.models.groupInfo.getGroup(e.kb_guid);e.biz_guid=n?n.bizGuid:"",w.trigger(Fe.EventManager,[Pe.GetBizMemberListForAt,e,a.web.modelStamp.BizUserListForAt,t])},getCategory:function(){var e=s.noteCur.docInfo,t={kb_guid:e.kb_guid},n=!!C.models.groupInfo.getGroup(e.kb_guid),r=n?a.web.modelStamp.DocEditTagTree:a.web.modelStamp.DocEditCategoryTree;n?w.trigger(Fe.EventManager,[Pe.GetTags,t,r,function(e){e&&Ze.showCategoryTree(e,n)}]):w.trigger(Fe.EventManager,[Pe.GetCategory,t,r,function(e){e&&Ze.showCategoryTree(e,n)}])},getDocument:function(e){if(e.switchKb&&s.noteCur.docInfo&&s.noteCur.docInfo.document_guid==e.doc_guid)return void Ze.switchKbFormDoc();if(A.removeClass(Oe.modalEntry),qe.getShareInfo({kb_guid:e.kb_guid,document_guid:e.doc_guid}),$e.editByOther=!1,$e.editByOtherInfo="",qe.checkEditCount(e.kb_guid,e.doc_guid,null),!s.noteCur.docInfo||s.noteCur.docInfo.document_guid!=e.doc_guid){Ze.showLoading(),Ze.clearDocument(),qe.getBizUserList({kb_guid:e.kb_guid},Ze.initAutoComplete);var t=function(t){if(s.noteCur.docGuid===e.doc_guid){Ze.hideLoading();var n;if(t&&200==t.code){t=t.document_info,Ze.showDocument(t),e.switchKb&&Ze.switchKbFormDoc(),n={kb_guid:t.kb_guid,document_guid:t.document_guid},qe.getAttachment(n),qe.searchComment(n);var r=t.kb_guid;return qe.getAllTags(r,function(e){Re.initKbTags(e)}),A.addClass(Oe.modalEntry),b.checkShareFileType(),void w.trigger(Fe.EventManager,[Fe.ShowEmptyInfo])}var o=t&&500==t.code?u.docDocument.err.document_getBody_500:u.docDocument.err.document_getBody;w.trigger(Fe.EventManager,[Fe.ShowEmptyInfo,a.web.note.emptyType.docNotFound,o])}};w.trigger(Fe.EventManager,[Pe.GetDocument,e,a.web.modelStamp.DocInfo,t])}},getAttachment:function(e){w.trigger(Fe.EventManager,[Pe.GetAttachment,e,a.web.modelStamp.DocAttachment,function(e){e&&Ze.showAttachments(e)}])},getShareInfo:function(e){function t(e){$e.hasShare=e&&e.url}_WIZ_CONFIG.oem.getData("HideMyShare")||b.getShareInfo(e,t)},saveDocument:function(e){var t=qe.getEditDocumentInfo();Ue=!0,D.removeClass(Oe.active),I.addClass(Oe.active);var n=function(n,r){Ue=!1,r.document_guid?(setTimeout(function(){Ue||(I.removeClass(Oe.active),D.addClass(Oe.active)),setTimeout(function(){D.removeClass(Oe.active)},1500)},800),s.setLastDocSave(t),C.models.docList.saveDocumentListByDocument(t),w.trigger(Fe.EventManager,[Fe.UpdateDocument,{docInfo:t}]),e&&e()):Ue||I.removeClass(Oe.active)};$e.doc_info.document_body=t.document_body,Ze.setDocBody(t),w.trigger(Fe.EventManager,[Pe.SaveDocument,{doc_info:t},n])},searchComment:function(e){w.trigger(Fe.EventManager,[Pe.GetCommentList,e,a.web.modelStamp.DocComment,function(e){Ze.showComment(e)}])},addComment:function(){if("disabled"!=oe.attr("disabled")&&se.hasClass(Oe.hide)){var e=$.trim(Ne.getValue());if(e){ie.html(u.docComment.label.publishing),oe.addClass(Oe.disabled).attr("disabled","disabled");var t={kb_guid:M.attr("data-kbguid"),document_guid:M.attr("data-docguid"),comment_body:e,parent_sn:oe.parentSn||null,parent_user_guid:oe.parentUserGuid||null};w.trigger(Fe.EventManager,[Pe.AddComment,t,function(e){setTimeout(function(){ie.html(u.docComment.label.publish),oe.removeClass(Oe.disabled).attr("disabled",!1)},300),e&&(Ne.setValue(""),$(".editor-preview").empty(),Ze.quitMarkdownPreview(),oe.parentUserGuid=null,oe.parentSn=null,Ze.checkCommentTxtCount(),We.newCmt(t))}])}}},deleteComment:function(e){var t=e.getAttribute("data-comment-sn"),n=e.getAttribute("data-item-id"),r={kb_guid:M.attr("data-kbguid"),document_guid:M.attr("data-docguid"),comment_sn:t};w.trigger(Fe.EventManager,[Pe.DeleteComment,r,function(e,t){e&&We.removeOne(n)}])},getAllTags:function(e,t){var n={kb_guid:e};w.trigger(Fe.EventManager,[Pe.GetTags,n,a.web.modelStamp.DocEditAllTags,function(e){var n,r,o=[];if(e)for(n=0,r=e.length;r>n;n++)e[n].cmd!==a.web.note.menuCmd.create&&o.push(e[n]);t(o)}])},getTagNameForGroup:function(e,t,n){var r={kb_guid:e};w.trigger(Fe.EventManager,[Pe.GetTags,r,a.web.modelStamp.DocEditTagName,function(n){return n?C.models.tag.getTagNameForGroup(e,t):""}])},checkFileSize:function(e){return e.size/1048576<Ye},docCanEditor:function(e){var t=l.editDoc(e.kb_guid,e.document_owner);return wizUI.note.isImportExcel(e.document_body)&&(t.can=!1,t.msg=u.docDocument.err.document_excel_edit),t},addEditCount:function(e,t){y.startAdd(e,t)},checkEditCount:function(e,t,n){y.startGet(e,t,n)},onAddEditCount:function(e){},onGetEditCount:function(e){$e.editByOther=e&&e.length>0,$e.editByOtherInfo=y.getEditInfo()},stopEditCount:function(){}},Xe=d.extend({initCategoryTree:function(e,t){var n=s.noteCur.docInfo,r=null;l.modifyCategory(n.kb_guid)?U.removeClass(Oe.readonly):U.addClass(Oe.readonly),we=this.initTree(U,this.getSetting(),e),we.kbGuid=n.kb_guid,t?(r=we.getNodeByParam("tag_guid",n.document_tag_guids),we.type=a.web.note.menuType.tag):(r=we.getNodeByParam("location",n.document_category),we.type=a.web.note.menuType.category),we.selectNode(r)},addCategoryAndTag:function(e,t,n,r){return r.type==a.web.note.menuType.tag&&je.tagNewHandler(r),!1},renameCategoryAndTag:function(e,t,n){e===M.attr("data-kbguid")&&(n.type===a.web.note.menuType.category&&$e.doc_info.document_category===n.oldLocation?je.personalCategoryRenameHandler(n):n.type===a.web.note.menuType.tag&&(C.models.groupInfo.getGroup(e)?je.groupKBTagRenameHandler(n):je.personalKBTagRenameHandler({tag_guid:n.tag_guid,tag_name:n.tag_name})))},removeCategoryAndTag:function(e,t,n){return n.type==a.web.note.menuType.tag&&Re.deleteTagHandler(n.tag_guid),!1},nodeOnClick:function(e,t,n){this._super.apply(this,arguments),n.type==a.web.note.menuType.category?($e.dd_path=n.displayLocation,s.noteCur.docInfo.document_category=n.location):n.type==a.web.note.menuType.tag&&($e.dd_path=C.models.tag.getTagNameForGroup(s.noteCur.docInfo.kb_guid,n.tag_guid),s.noteCur.docInfo.document_tag_guids=n.tag_guid),Ze.hideCategoryLayer()}}),Je=new Xe;t.exports={init:r,getDocument:qe.getDocument,clearDocument:Ze.clearDocument,showEmptyInfo:Ze.showEmptyInfo,saveDocument:je.saveDocHandler,getEditingDocument:qe.getEditingDocumentInfo,editContentFocus:Ze.editContentFocus,addCategoryAndTag:Je.addCategoryAndTag,renameCategoryAndTag:Je.renameCategoryAndTag,removeCategoryAndTag:Je.removeCategoryAndTag,cancelShare:Ze.cancelShare,isShare:Ze.isShare}},{"../../../common/avalon-extend/calendarTime":2,"../../../common/kramed/kramed.js":3,"../../../common/prettify/prettify":5,"../../../component/markdown-editor/editor":7,"../../../config/wizConf":13,"../../database/wizCenter":18,"../../model/Authority":20,"../../util/GlobalUtil":35,"../../viewer-common/loading":44,"./docEditor":48,"./docFrame":49,"./docViewEditCount":52,"./docViewShare":53,"./menuSetting":56,"./menuTree":57,"./menuTreeTools":58,locale:"locale"}],52:[function(e,t,n){function r(e,t){o=$("body"),i=e,v.init(t)}var o,i,a,s=e("../../database/wizCenter"),u=e("../../../config/wizConf"),l=e("locale"),c=u.web.frameEventType,d=u.web.dataOperateType,g=null,f=[],h=!1,p=!1,m={onGet:null,onAdd:null,onDelete:null},v={init:function(e){e.callback.onGet&&(m.onGet=e.callback.onGet),e.callback.onAdd&&(m.onAdd=e.callback.onAdd),e.callback.onDelete&&(m.onDelete=e.callback.onDelete)},startAdd:function(e,t){if(e&&t){if(s.userInfo.kb_guid==e)return void v.stop();var n=b.getObjId(e,t);g===n&&h||(v.stop(),g=n,h=!0,p=!1,b.addCount())}},startGet:function(e,t,n){if(e&&t){if(s.userInfo.kb_guid==e)return v.stop(),void(n&&n());var r=b.getObjId(e,t);(n||g!==r||!p)&&(v.stop(),g=r,h=!1,p=!0,b.getCount(n))}},stop:function(){h&&b.deleteCount(),h=!1,p=!1,a&&(clearTimeout(a),a=null)}},b={getObjId:function(e,t){return e+"/"+t},addCount:function(){if(h&&g){var e={obj_id:g,user_id:b.getAlias()};o.trigger(c.EventManager,[d.AddEditCount,e,b.onAddCount])}},onAddCount:function(e){h&&(m.onAdd&&m.onAdd(e),a=setTimeout(function(){b.addCount()},u.baseModel.editCountAuto))},deleteCount:function(){if(g){var e={obj_id:g,user_id:b.getAlias()};o.trigger(c.EventManager,[d.DeleteEditCount,e,b.onDeleteCount])}},onDeleteCount:function(e){m.onDelete&&m.onDelete(e)},getCount:function(e){function t(t){t&&b.onGetCount(t),e&&e(t)}if(p&&g){var n={obj_id:g};o.trigger(c.EventManager,[d.GetEditCount,n,t])}},onGetCount:function(e){if(p){var t,n,r,o=b.getAlias();for(t=0,n=e.length;n>t;t++)if(r=e[t],r===o||r===s.userInfo.user_id){e.splice(t,1);break}f=e,m.onGet&&m.onGet(e),a=setTimeout(function(){b.getCount(null)},u.baseModel.editCountAuto)}},getAlias:function(){var e,t=s.noteCur.kb&&s.noteCur.kb.bizGuid;return t?(e=i.models.bizMemberListForAt.getUserByUserId({kb_guid:s.noteCur.kb.kbGuid},s.userInfo.user_id),e?e.alias:s.userInfo.user_id):s.userInfo.displayname},getEditInfo:function(){var e;return e=f&&0!==f.length?1==f.length?l.docDocument.label.otherEditing.replace("$1",f.join(", ")):2==f.length?l.docDocument.label.otherEditing2.replace("$1",f[0]).replace("$2",f[1]):l.docDocument.label.otherEditing3.replace("$1",f[0]).replace("$2",f[1]).replace("$3",f.length):""},getEditAlert:function(){var e;return e=f&&0!==f.length?l.docDocument.err.otherEditing.replace("$1",f.join(", ")):""}};t.exports={init:r,startAdd:v.startAdd,startGet:v.startGet,stop:v.stop,getEditInfo:b.getEditInfo,getEditAlert:b.getEditAlert}},{"../../../config/wizConf":13,"../../database/wizCenter":18,locale:"locale"}],53:[function(e,t,n){function r(e){s=$("body"),v=$("#"+A.shareCopyBtn),b=$("#"+A.shareCreateBtn),m=$("#"+A.shareCreateModal),g=$("#"+A.shareNotVerifiedEmailContainer),d=$("#"+A.shareNotVipContainer),f=$("#"+A.shareErrorInfoContainer),h=$("#"+A.shareCreateContainer),p=$("#"+A.shareSettingEntry),l=$("#"+A.share2Weibo),c=$("#"+A.share2Weixin),_=$("#"+A.newPassword),y=$("#"+A.passwordCtn),w=$("#"+A.shareDateInputCtn),k=$("#"+A.shareSettingValue),C=$("#"+A.shareCountsInputCtn),M=$("#"+A.dateSettingArea),L=$("#"+A.countsSettingArea),S=$("#"+A.toVerifiedEmailBtn),T=$("#"+A.shareUrlInput),x=$("#"+A.shareBlackList),u=e,R.init(),H.bind()}var o,i,a,s,u,l,c,d,g,f,h,p,m,v,b,y,_,w,C,k,M,L,S,T,x,z=e("../../database/wizCenter"),I=e("../../../config/wizConf"),D=e("locale"),E=e("../../../common/moment/moment"),G=e("../../../common/qrcode/qrcode"),A={shareCreateContainer:"share-create-container",shareNotVerifiedEmailContainer:"share-notVerifiedEmail-container",shareNotVipContainer:"share-notVip-container",shareErrorInfoContainer:"share-error-info-container",shareSettingEntry:"share-setting-entry",share2Weibo:"share2weibo",share2Weixin:"share2weixin",shareCreateModal:"share-create-modal",shareCopyBtn:"share-copy-btn",shareCreateBtn:"share-create-btn",passwordCtn:"password-ctn",newPassword:"newPassword",shareDateInputCtn:"share-date-input",shareCountsInputCtn:"share-counts-input",shareSettingValue:"share-setting-value",dateSettingArea:"share-date-setting-area",countsSettingArea:"share-counts-setting-area",toVerifiedEmailBtn:"toVerifiedEmail",qrcode:"share2weixin-qrcode",shareUrlInput:"share-url-text",shareBlackList:"share-is-blacklist"},N={hide:"hide",shareLimitLabel:"share-limit-label",setting:"setting",weixin:"weixin",wrongFileType:"wrongFileType",btnPrimary:"btn-primary"},B={NONE:"none",TIMES:"t",DAYS:"d"},O=I.web.frameEventType,F=I.web.dataOperateType,P=!1,U=!1,W={setShareInfo:function(e){z.setCurShareInfo(e),a.share=e,e&&e.url&&(a.hasShare=!0),R.initWeixinQrcode(),R.defaultShare()},cancelShare:function(){Y.cancelShare(a.share.shareId)},isShare:function(){return a.share&&a.share.url},goShareUrl:function(){a.share&&a.share.url&&window.open(a.share.url)},goVip:function(){$(".modal-close-btn",m).trigger("click"),s.trigger(O.EventManager,[O.ShowWizFrame,{url:I.url.user.vipPrice}])},setPassword:function(){a.share.newPassword=a.share.newPassword?null:Math.random().toString(10).substr(3,4),W.isShare()&&W.commitSetting(!1)},selectLimitType:function(){if(a.vip){var e=$(this),t=e.data("type");t==B.NONE&&e.hasClass(N.btnPrimary)||(a.share.newLimitType=t,k.val(t==B.NONE?t:t.substr(1)))}},share2Weibo:function(){if(a.share.url){var e=z.noteCur.docInfo.document_title,t={appkey:I.web.note.share.weibo.appkey,title:I.web.note.share.weibo.title.replace("$1",e),url:a.share.url,ralateUid:I.web.note.share.weibo.ralateUid},n=wizUI.util.getWeiboShareURL(t);window.open(n)}},hideWeixin:function(){h.removeClass(N.weixin)},showWeixin:function(e){!a.share.url||e&&h.hasClass(N.weixin)?h.removeClass(N.weixin):h.addClass(N.weixin).removeClass(N.setting)},cancelSetting:function(){R.resetSettingValue(),R.hideShareSetting()},createShare:function(){a.creating||(a.creating=!0,Y.createShare(function(){a.creating=!1,R.hideShareSetting(),W.showWeixin(!1)}))},confirmSetting:function(){if(!W.isShare())return R.hideShareSetting(),void Y.updateSetting(Y.getShareSetting());var e=a.share.newLimitType;k.val(e==B.NONE?e:e.substr(1)),W.commitSetting(!0)},commitSetting:function(e){Y.createShare(function(){e&&R.hideShareSetting()})}};avalon.ready(function(){a=avalon.define("docShare",function(e){e.share={documentGuid:"",shareId:"",limitType:B.NONE,expiredAt:"",expiredValue:"",expiredTxt:"",expiredDaysSet:0,readCount:0,readCountLimit:"",readCountValue:"",readCountTxt:"",readCountSet:"",password:"",newLimitType:B.NONE,newPassword:"",url:"",urlForClipboard:"",createdAt:"",err:!1},e.hasShare=!1,e.creating=!1,e.settingShare=!1,e.vip="vip"==z.userInfo.user_type,e.cancelShare=W.cancelShare,e.setPassword=W.setPassword,e.selectLimitType=W.selectLimitType,e.goVip=W.goVip,e.share2Weibo=W.share2Weibo,e.share2Weixin=function(){W.showWeixin(!0)},e.hideWeixin=W.hideWeixin,e.createShare=W.createShare,e.confirmSetting=W.confirmSetting,e.cancelSetting=W.cancelSetting,e.goShareUrl=W.goShareUrl}),avalon.scan($("#share-setting-layer")[0],"docShare")});var R={init:function(){R.initClipboard()},initClipboard:function(){wizUI.Clipboard(v,{moviePath:I.url.common.zeroclipboardSwf},function(e){e?u.showWarningMessage({msg:D.common.err.clipboard}):u.showSuccessMessage({msg:D.common.success.clipboard})})},initWeixinQrcode:function(){var e={width:128,height:128,text:a.share.url,colorDark:"#333333",typeNumber:6,correctLevel:0};o?i!==e.text&&(i=e.text,o.clear(),o.makeCode(e.text)):(i=e.text,o=new G($("#"+A.qrcode)[0],e))},resetSettingValue:function(){var e,t=a.share.limitType;a.share.newLimitType=t,t==B.NONE?e=t:0===t.indexOf(B.DAYS)?e=a.share.expiredValue:0===t.indexOf(B.TIMES)&&(e=a.share.readCountLimit),k.val(e)},defaultShare:function(){g.hasClass(N.hide)&&d.hasClass(N.hide)&&(W.showWeixin(!1),h.removeClass(N.hide),f.addClass(N.hide).removeClass(N.wrongFileType))},showShareError:function(e){f.addClass(e).removeClass(N.hide),h.addClass(N.hide)},showNotVerifiedEmail:function(){g.removeClass(N.hide),h.addClass(N.hide)},showNotVip:function(){d.removeClass(N.hide),h.addClass(N.hide)},showIsBlackList:function(){x.html(D.myShare.label.tableIsBlackList.replace("$1",I.web.companyInfo.hotline)).removeClass(N.hide),h.addClass(N.hide)},hideShareSetting:function(){h.removeClass(N.setting)},showShareSetting:function(){h.hasClass(N.setting)?W.cancelSetting():h.addClass(N.setting).removeClass(N.weixin)}},H={bind:function(){p.on("click",R.showShareSetting),$(".modal-close-btn",m).on("click",W.cancelSetting),S.on("click",H.toVerifiedEmail)},toVerifiedEmail:function(){$(".modal-close-btn",m).trigger("click"),s.trigger(O.EventManager,[O.ShowWizFrame,{url:I.url.user.account_setting}])}},Y={initShare:function(){var e=Y.getDefaultShareInfo();a.hasShare=!1,W.setShareInfo(e),R.hideShareSetting()},checkShareFileType:function(){var e=/^\.(xls|xlsx)$/i;return e.test(z.noteCur.docInfo.document_filetype)?(R.showShareError(N.wrongFileType),!1):!0},createShare:function(e){function t(t){if(P=!1,a.share.err=!1,t&&200==t.code)a.settingShare=!1,a.hasShare||(a.share.documentGuid=z.noteCur.docGuid,a.share.shareId=t.shareId,a.share.url=I.url.common.shareURL+t.shareId,a.share.readCount=t.readCount,a.share.createdAt=t.createdAt,a.hasShare=!0),Y.updateSetting(r),a.share.urlForClipboard=Y.urlForClipboard(a.share),z.setCurShareInfo(a.$model.share),s.trigger(O.EventManager,[O.UpdateShareDocument,!0,a.share.documentGuid]),R.initWeixinQrcode();else if(t&&3379===t.code)console.log("Non VIP users can not set expire and read count limit!");else{if(t&&3373===t.code)return void Y.getShareInfo({kb_guid:z.noteCur.kb.kbGuid,document_guid:z.noteCur.docGuid},e);if(t&&3374===t.code)return a.hasShare=!1,void Y.createShare(e);t&&3372===t.code?R.showNotVerifiedEmail():a.share.err=!0}T.attr("placeholder",a.share.err?D.myShare.label.linkErrPlaceHolder:D.myShare.label.linkPlaceHolder),e&&e(a.share)}if(!P&&!U&&Y.checkShareFileType()){P=!0,R.defaultShare();var n=z.noteCur.shareInfo;a.hasShare=n&&n.url;var r=Y.getShareSetting();a.hasShare?s.trigger(O.EventManager,[F.UpdateShareDocument,r,t]):s.trigger(O.EventManager,[F.CreateShareDocument,r,t])}},cancelShare:function(e,t){function n(n){e===a.share.shareId&&(U=!1,!n||200!=n.code&&3374!=n.code||(Y.initShare(),s.trigger(O.EventManager,[O.UpdateShareDocument,!1,a.share.documentGuid])),t&&t())}U||(U=!0,s.trigger(O.EventManager,[F.CancelShareDocument,{shareId:e},n]))},getDefaultShareInfo:function(){return{documentGuid:z.noteCur.docGuid,shareId:"",limitType:B.NONE,expiredAt:"",expiredValue:"",expiredTxt:"",readCount:0,readCountLimit:"",readCountValue:"",readCountTxt:"",password:"",newLimitType:B.NONE,newPassword:"",url:"",urlForClipboard:"",createdAt:E().startOf("day").valueOf(),err:!1}},getReadCount:function(e,t){e=e||0,t=t||0;var n=t-e;return n=0>n?0:n},getReadCountTxt:function(e){return D.myShare.label.settingRestReadTimes.replace("$1",e)},getExpired:function(e){var t=E(e).diff(E().startOf("day"),"days");return t=0>t?0:t},getExpiredTxt:function(e){return D.myShare.label.settingRestExpired.replace("$1",e)},getUrlByShareId:function(e){return I.url.common.shareURL+e},urlForClipboard:function(e){return e.password?e.url+" "+D.myShare.label.settingPassword+e.password:e.url},getShareInfo:function(e,t){return"vip"!==z.userInfo.user_type?void R.showNotVip():z.shareBlackList===!0?void R.showIsBlackList():(z.setCurShareInfo(null),void s.trigger(O.EventManager,[F.GetMyShareByDocGuid,e,function(e){if(!z.noteCur.shareInfo){var n=Y.getDefaultShareInfo();if(e&&200==e.code)e.readCountLimit?(n.readCountValue=Y.getReadCount(e.readCount,e.readCountLimit),n.readCountTxt=Y.getReadCountTxt(n.readCountValue),n.readCountLimit=e.readCountLimit,n.readCountSet=e.readCountSet,n.limitType=B.TIMES,n.readCountSet?n.limitType+=n.readCountSet:n.readCountLimit>=100?n.limitType+=100:n.readCountLimit>=50?n.limitType+=50:n.readCountLimit<50&&(n.limitType+=30)):e.expiredAt&&(n.expiredValue=Y.getExpired(e.expiredAt),n.expiredTxt=Y.getExpiredTxt(n.expiredValue),n.expiredDaysSet=e.expiredDaysSet,n.limitType=B.DAYS,n.expiredDaysSet?n.limitType+=n.expiredDaysSet:n.expiredValue>=7?n.limitType+=7:n.expiredValue>=3?n.limitType+=3:n.expiredValue<3&&(n.limitType+=1)),n.shareId=e.shareId,n.readCount=e.readCount,n.newLimitType=n.limitType,n.password=e.password,n.newPassword=e.password,n.password=e.password,n.createdAt=e.createdAt,n.url=Y.getUrlByShareId(e.shareId),n.urlForClipboard=Y.urlForClipboard(n);else if(e&&33701==e.code)return z.shareBlackList=!0,void R.showIsBlackList();W.setShareInfo(n),R.resetSettingValue(),t&&t(n)}}]))},getShareSetting:function(){var e={};return 0===a.share.newLimitType.indexOf(B.DAYS)?(e.expiredAt=E().add(+k.val(),"days").format(),e.expiredDaysSet=k.val()):0===a.share.newLimitType.indexOf(B.TIMES)&&(e.readCountLimit=a.share.readCount+parseInt(k.val(),10),e.readCountSet=k.val()),a.share.newPassword&&(e.password=a.share.newPassword),a.hasShare?e.shareId=a.share.shareId:(e.kbGuid=z.noteCur.kb.kbGuid,e.documentGuid=z.noteCur.docGuid),e},updateSetting:function(e){a.share.limitType=a.share.newLimitType||B.NONE,a.share.password=a.share.newPassword,a.share.expiredAt=e.expiredAt,a.share.expiredValue=Y.getExpired(a.share.expiredAt),a.share.expiredTxt=Y.getExpiredTxt(a.share.expiredValue),a.share.readCountLimit=e.readCountLimit,a.share.readCountValue=Y.getReadCount(a.share.readCount,e.readCountLimit),a.share.readCountTxt=Y.getReadCountTxt(a.share.readCountValue)}};t.exports={init:r,setShareInfo:W.setShareInfo,getShareInfo:Y.getShareInfo,getDefaultShareInfo:Y.getDefaultShareInfo,createShare:Y.createShare,checkShareFileType:Y.checkShareFileType}},{"../../../common/moment/moment":4,"../../../common/qrcode/qrcode":6,"../../../config/wizConf":13,"../../database/wizCenter":18,locale:"locale"}],54:[function(e,t,n){function r(e){o=$("body"),i=e,c.localize(),_WIZ_CONFIG.oem.getData("HidePersonalGroup")&&$("#createPersonalGroupBtn").remove(),c.showGroupList(),d.bind()}var o,i,a,s=e("../../../config/wizConf"),u=e("../../util/GlobalUtil"),l=s.web.frameEventType;avalon.ready(function(){a=avalon.define("groupIndex",function(e){e.personalGroup=[],e.bizList=[],e.createPersonalGroupUrl=s.url.personal.groupCreate,e.createBizGroupUrl=s.url.biz.groupCreate,e.initPersonGroup=function(t,n){e.personalGroup=wizUI.util.clone(t),e.personalGroup.unshift(wizUI.util.clone(n))},e.goCreateGroup=function(e){o.trigger(l.EventManager,[l.ShowWizFrame,{url:e.target.getAttribute("data-url")}])},e.switchKb=function(e){i.onCheckDocChangedHandler(function(t){if(t){var n=$(e.target).closest("li");if(n.length>0){var r=n.attr("data-kbguid");o.trigger(l.EventManager,[s.web.frameEventType.SwitchKb,r]),o.trigger(l.EventManager,[s.web.frameEventType.HideFullGroup])}}})},e.showPersonalGroupManager=function(e){wizUI.util.stopDefault(e),wizUI.util.stopBubble(e);var t=$(e.target).closest("li"),n=t.attr("data-kbguid");return o.trigger(l.EventManager,[l.ShowWizFrame,{url:u.addParamsToUrl(s.url.personal.groupManage,{kb:n})}]),!1},e.showBizManager=function(e){var t=$(e.target).parents("div.biz-kbs"),n=t.attr("data-bizguid");return o.trigger(l.EventManager,[l.ShowWizFrame,{url:u.addParamsToUrl(s.url.biz.manage,{biz:n})}]),!1},e.showBizGroupManager=function(e){wizUI.util.stopDefault(e),wizUI.util.stopBubble(e);var t=$(e.target).closest("li"),n=t.parents("div.biz-kbs"),r=t.attr("data-kbguid"),i=n.attr("data-bizguid");return o.trigger(l.EventManager,[l.ShowWizFrame,{url:u.addParamsToUrl(s.url.biz.groupManage,{biz:i,kb:r})}]),!1},e.collapse=function(e){var t=$(e.target).parents(".kb");t.toggleClass("collapse")}}),avalon.scan($("#groupIndex").get(0),"grouplist")});var c={localize:function(){},showGroupList:function(){var e,t,n=i.models.groupInfo.getAllGroupStructure();c.groupRoleFilter(n.personalGroup),a.initPersonGroup(n.personalGroup,n.personalKb);var r,o=wizUI.util.clone(n.bizList),u=o.length;for(e=0;u>e;e++)t=o[e],r=i.models.bizInfo.getBizByGuid(t.biz_guid),t.isOwner=r&&r.user_group<=s.web.authority.biz.admin,c.groupRoleFilter(t.groups);a.bizList=o},groupRoleFilter:function(e){if(e){var t,n,r;for(t=0,n=e.length;n>t;t++)r=e[t],r.isManager=r.userGroup<=s.web.authority.group.admin}}},d={bind:function(){}};t.exports={init:r}},{"../../../config/wizConf":13,"../../util/GlobalUtil":35}],55:[function(e,t,n){function r(e){o=$("body"),a=$("#"+v.sidebarSwitch),s=$("#"+v.groupListSwitch),u=$("#"+v.msgListCtn),l=$("#"+v.msgBtn),g.isBizUser&&l.removeClass(b.hide),
i=e,m.init(e),D.localize(),E.bind()}var o,i,a,s,u,l,c,d=e("../../../config/wizConf"),g=e("../../database/wizCenter"),f=e("locale"),h=e("../../util/GlobalUtil"),p=e("../../util/notify"),m=e("./userInfo"),v={kbName:"kbname",kbGroupName:"kbGroupName",sidebarSwitch:"sc-entry",groupListSwitch:"kb-info",msgListCtn:"head-msglist-ctn",msgBtn:"user-msg",wizFav:"wizFav"},b={hide:"hide",deleteMsgBtn:"delete-msg-btn"},y={msgRecently:"recently",msgUnRead:"unread"},_="/favicon.ico",w="image/x-icon",C="/favicon.png",k="image/png",M=d.web.frameEventType,L=d.web.dataOperateType,S=null,T=!1,x=!1,z=10,I={changeMsgType:function(e){var t=$(e.target);c.msgType=t.attr("data-type")},markAllReadStatus:function(){G.markAllReadStatus(),c.unReadEmpty=!0},goToMoreMsg:function(){D.hideMsgList(),D.hideGroupList(),g.noteCur.kb&&i.onCheckDocChangedHandler(function(e){e&&(o.trigger(M.EventManager,[M.SwitchMsgCenter,{msgType:d.web.note.msgType.all}]),o.trigger(M.EventManager,[M.HideFullGroup]))})},incUpdate:function(e,t){var n,r,o,i=t.length;i=i>=z?i:z;var a=h.arrayCompare(t,e.slice(0,i),"id",["version","read_status"]);for(n=a.update.length-1;n>=0;n--)o=a.update[n],t[n].version=e[o].version,t[n].read_status=e[o].read_status;for(n=a.del.length-1;n>=0;n--)t.splice(a.del[n],1);for(n=0,r=a.add.length;r>n;n++)o=a.add[n],t.splice(o,0,e[o])},readMsgHandler:function(e){var t=$(e.target),n=t.closest("a");if(!n||!n.hasClass(b.deleteMsgBtn)){var r=t.closest("li"),o=r.attr("data-msgid"),i=r.attr("data-kbguid"),a=r.attr("data-docguid");I.readMsg(o,i,a)}},readMsg:function(e,t,n){G.setMsgStatus(e),o.trigger(d.web.frameEventType.EventManager,[d.web.frameEventType.ShowDocument,{kb_guid:t,doc_guid:n,switchKb:!0}]),D.hideMsgList(),D.hideGroupList()},showMsgList:function(){0===c.msgList_unRead.length&&(c.msgType=y.msgRecently),D.showMsgList(!0)},setMsgList:function(e){if(e){e=wizUI.util.clone(e);for(var t,n=[],r=[],o=0,i=e.length;i>o;o++)t=e[o],t.showAlias=t.sender_alias?t.sender_alias:t.sender_id.substr(0,t.sender_id.indexOf("@")),0===t.read_status&&n.push(t),r.push(t);c.msgUnReadCount=n.length,D.showUnReadCountByFavicon(c.msgUnReadCount),c.unReadInfo=c.msgUnReadCount?f.docMsg.label.unReadInfo.replace("$1",c.msgUnReadCount):"",setTimeout(function(){c.msgLastUnReadCount=n.length},1500),I.incUpdate(n,c.msgList_unRead),I.incUpdate(r,c.msgList_recently),c.unReadEmpty=!1;var a,s=G.getAddMsgCount();x?s>0&&(a=s>1?{id:"",kb_guid:"",document_guid:"",userIcon:g.userInfo.icon,showAlias:f.docMsg.label.nodify_title,message_body:f.docMsg.label.nodify_info.replace("$1",s)}:c.msgList_unRead[0],p.show(a.userIcon,a.showAlias,a.message_body,{onClick:function(){s>1?I.goToMoreMsg():I.readMsg(a.id,a.kb_guid,a.document_guid)}})):x=!0}}};avalon.ready(function(){c=avalon.define("header",function(e){e.kbName="",e.kbGroupName="",e.msgList_recently=[],e.msgList_unRead=[],e.msgUnReadCount=0,e.unReadInfo="",e.msgLastUnReadCount=0,e.msgPause=!1,e.msgType=y.msgUnRead,e.unReadEmpty=!1,e.readMsg=I.readMsgHandler,e.showMsgList=I.showMsgList,e.changeMsgType=I.changeMsgType,e.goToMoreMsg=I.goToMoreMsg,e.markAllReadStatus=I.markAllReadStatus}),avalon.scan($("header").get(0),"header")});var D={localize:function(){},setTitle:function(e,t){c.kbName=e,c.kbGroupName=t},setSidebarSwitchTitle:function(){a.attr("title",g.noteFrameStatus.sidebar?f.docHead.label.switchOff:f.docHead.label.switchOn)},updateMsgList:function(){I.setMsgList(i.models.msg._getCacheData({message_type:"-"}))},showMsgList:function(e){return e&&!u.hasClass(b.hide)?void D.hideMsgList():(u.removeClass(b.hide),void E.bindMsgListAutoHide())},hideMsgList:function(){u.addClass(b.hide),E.unbindMsgListAutoHide()},showGroupList:function(e){o.trigger(M.EventManager,[e&&g.noteFrameStatus.fullGroup?M.HideFullGroup:M.ShowFullGroup])},hideGroupList:function(){o.trigger(M.EventManager,[M.HideFullGroup])},setFavicon:function(e,t){var n=document.getElementById(v.wizFav),r=n.parentNode;r.removeChild(n);var o=document.createElement("link");o.id=v.wizFav,o.setAttribute("rel","icon"),o.setAttribute("type",t),o.setAttribute("href",e),r.insertBefore(o,null)},showUnReadCountByFavicon:function(e){return wizUI.support.canvas?e?void D.drawUnReadCount(e.toString()):void D.setFavicon(_,w):void 0},drawUnReadCount:function(e){S=document.createElement("img"),S.onload=function(){D.drawNumberCanvas.apply(this,[e])},S.src=C},drawNumberCanvas:function(e){var t=document.createElement("canvas");t.setAttribute("width",this.width+"px"),t.setAttribute("height",this.height+"px");var n=t.getContext("2d");n.width=this.width,n.height=this.height,n.drawImage(this,0,0),1===e.length?(D.drawNumberBg(n,e),D.drawNumber(n,e,19,14)):2===e.length?(e=e.toString(),D.drawNumberBg(n,e),D.drawNumber(n,e.charAt(0),9,14),D.drawNumber(n,e.charAt(1),19,14)):(e="...",D.drawNumberBg(n,e)),D.setFavicon(t.toDataURL(),k),t=null},drawNumberBg:function(e,t){1===t.length?D.drawRoundRect(e,16,15,16,17,8):2===t.length?D.drawRoundRect(e,6,15,26,17,8):(D.drawRoundRect(e,6,15,26,17,8),e.fillStyle="#FFFFFF",e.beginPath(),e.arc(11,23,2,0,2*Math.PI,!0),e.arc(19,23,2,0,2*Math.PI,!0),e.arc(27,23,2,0,2*Math.PI,!0),e.closePath(),e.fill())},drawRoundRect:function(e,t,n,r,o,i){2*i>r&&(i=r/2),2*i>o&&(i=o/2),e.fillStyle="#FF0000",e.beginPath(),e.moveTo(t+i,n),e.arcTo(t+r,n,t+r,n+o,i),e.arcTo(t+r,n+o,t,n+o,i),e.arcTo(t,n+o,t,n,i),e.arcTo(t,n,t+r,n,i),e.closePath(),e.fill()},drawNumber:function(e,t,n,r){e.save(),e.fillStyle="#ffffff",e.font="bold 18px arial",e.textBaseline="top",e.fillText(t,n,r),e.restore()}},E={bind:function(){this.bindSidebarSwitch(),this.bindGroupListSwitch()},bindSidebarSwitch:function(){return _WIZ_CONFIG.oem.getData("Web_HideSideBar")?(a.hide(),void o.trigger(M.EventManager,[M.HideSidebar])):void a.bind("click",function(){o.trigger(M.EventManager,[g.noteFrameStatus.sidebar?M.HideSidebar:M.ShowSidebar])})},bindGroupListSwitch:function(){s.bind("click",function(){D.showGroupList(!0)})},bindMsgListAutoHide:function(){i.globalEvent.bind(o,"click",E.msgListAutoHideHandler)},unbindMsgListAutoHide:function(){i.globalEvent.unbind(o,"click",E.msgListAutoHideHandler)},msgListAutoHideHandler:function(e){var t=$(e.target);t.attr("id")===v.msgBtn||t.parents("#"+v.msgBtn).length>0||D.hideMsgList()},setMsgListener:function(e){function t(e){!c.msgPause&&e&&I.setMsgList(e)}if(g.isBizUser){if(!e)return c.msgPause=!0,T=!1,void i.models.msg._autoLoadClear();c.msgPause=!1,T||(T=!0,G.getMessageList(t))}}},G={getAddMsgCount:function(){return i.models.msg.getAddMsgCount()},getMessageList:function(e){var t={message_type:"-",doc_guid:null,auto:!c.msgPause};o.trigger(M.EventManager,[L.GetBizMessage,t,d.web.modelStamp.MessageList,e])},markAllReadStatus:function(){o.trigger(M.EventManager,[L.MarkAllReadStatus,function(){o.trigger(M.EventManager,[M.UpdateMsgList])}])},setMsgStatus:function(e){o.trigger(M.EventManager,[L.SetBizMessageStatus,e,{read_status:1},function(){o.trigger(M.EventManager,[M.UpdateMsgList])}])}};t.exports={init:r,setTitle:D.setTitle,setSidebarSwitchTitle:D.setSidebarSwitchTitle,setMsgListener:E.setMsgListener,updateMsgList:D.updateMsgList}},{"../../../config/wizConf":13,"../../database/wizCenter":18,"../../util/GlobalUtil":35,"../../util/notify":40,"./userInfo":62,locale:"locale"}],56:[function(e,t,n){function r(e,t){o=$("body"),i=$("#"+w.menuSetting),s=$("#"+w.sRefresh),u=$("#"+w.sCreateCategory),l=$("#"+w.sCreateSubCategory),c=$("#"+w.sDeleteCategory),d=$("#"+w.sCreateTag),g=$("#"+w.sCreateSubTag),f=$("#"+w.sDeleteTag),h=$("#"+w.sGroupProperty),p=$("#"+w.sRename),_=e,k.refreshTree=t.refreshTree,k.createNode=t.createNode,k.renameNode=t.renameNode,k.removeNode=t.removeNode,k.localize(),k.init(),M.bind()}var o,i,a,s,u,l,c,d,g,f,h,p,m,v=e("../../../config/wizConf"),b=e("../../database/wizCenter"),y=e("../../util/GlobalUtil"),_=null,w={categoryTree:"categoryTree",menuSetting:"menu-setting",sRefresh:"setting-refresh",sCreateCategory:"setting-createCategory",sCreateSubCategory:"setting-createSubCategory",sDeleteCategory:"setting-deleteCategory",sCreateTag:"setting-createTag",sCreateSubTag:"setting-createSubTag",sDeleteTag:"setting-deleteTag",sGroupProperty:"setting-groupProperty",sRename:"setting-rename"},C={liItem:"menu-item-area",tree:"ztree",level0:"level0",root:"root",parent:"parent",item:"item",popFloat:"pop-float",active:"active",setting:"setting",up:"up"},k={localize:function(){},init:function(){m=$(document.createDocumentFragment())},showMenuItem:function(e){var t=e.attr("id"),n=e.parentsUntil("div").last(),r=n.attr("id"),o=$.fn.zTree.getZTreeObj(r),a=o.getNodeByTId(t),s=C.item;w.categoryTree===r&&a.children&&a.children.length>0&&(s=C.parent);var u=[C.popFloat,r+"-"+(e.hasClass(C.level0)?C.root:s)];i.attr("class",u.join(" ")),i.treeId=r,i.nodeTId=t},showMenuSetting:function(e,t){if(a=t,e.is(i.btn))return k.hideMenuSetting(),!1;var n=e.parents("."+C.liItem).first(),r=e.parents("."+C.tree).first();k.cancelLastActive(),r.is(i.contentObj)||(r.append(i),i.contentObj=r,i.css({top:"0px"})),i.itemContentObj=n,i.itemContentObj.css({"z-index":650}),k.showMenuItem(e.parentsUntil("ul").last());var s=y.getDomPosition(e),u=y.getDomPosition(a),l=y.getDomPosition(r),c=r.scrollTop(),d=s.top-l.top+c+5,g=d;e.addClass(C.active),i.btn=e;var f=parseInt(i.css("height"),10);return d+f-c+l.top-u.top>u.height?(d-=f-s.height-3,d-c+l.top-u.top<0&&(d=g),i.addClass(C.up)):i.removeClass(C.up),i.css({top:d+"px"}),i.addClass(C.active),_.globalEvent.bind(o,"click",M.docOnClick),!1},cancelLastActive:function(){i.btn&&(i.btn.removeClass(C.active),delete i.btn),i.itemContentObj&&(i.itemContentObj.css({"z-index":""}),delete i.itemContentObj)},hideMenuSetting:function(){delete i.treeId,delete i.nodeTId,k.cancelLastActive(),i.removeClass(C.active)},appendFragment:function(){i.contentObj=null,m.append(i)}},M={bind:function(){M.bindSettings()},bindSettings:function(){i.delegate("li","click",function(){if(i.treeId&&i.nodeTId){var e=$.fn.zTree.getZTreeObj(i.treeId),t=e.getNodeByTId(i.nodeTId);this.id==w.sRefresh?k.refreshTree(e):this.id==w.sCreateCategory||this.id==w.sCreateSubCategory||this.id==w.sCreateTag||this.id==w.sCreateSubTag?k.createNode(e,t):this.id==w.sDeleteCategory||this.id==w.sDeleteTag?k.removeNode(e,t):this.id==w.sRename?k.renameNode(e,t):this.id==w.sGroupProperty&&(b.biz.owner&&b.cur.kb.biz_guid==b.biz.owner.biz_guid?_.showSetting(v.url.user.bizManager):_.showSetting(v.url.user.groupPersonalProp,{kb:b.cur.kb.kb_guid})),k.hideMenuSetting()}})},docOnClick:function(e,t){var n=$(t)||$(e.target);n.hasClass(C.setting)||n.attr("id")===w.menuSetting||n.parents("#"+w.menuSetting).length>0||k.hideMenuSetting()}};t.exports={init:r,showMenuSetting:k.showMenuSetting,appendFragment:k.appendFragment}},{"../../../config/wizConf":13,"../../database/wizCenter":18,"../../util/GlobalUtil":35}],57:[function(e,t,n){function r(e){o=$("body"),a=$("#"+I.main),s=$("#"+I.menuTree),u=$("#"+I.menuNail),l=$("#"+I.menuContent),c=$("#"+I.categoryTree),d=$("#"+I.tagTreeP),g=$("#"+I.tagTreeG),m=$("#"+I.latelyIcon),v=$("#"+I.latelyText),b=$("#"+I.myShareIcon),y=$("#"+I.myShareText),_=$("#"+I.searchKeyword),w=$("."+D.msgBtn),i=e,x.init(i,{refreshTree:F.refreshTree,createNode:F.createNode,renameNode:F.renameNode,removeNode:F.startRemoveNode}),_WIZ_CONFIG.oem.getData("HideMyShare")&&$("#myShare").remove(),A.localize(),A.init(),N.bind()}var o,i,a,s,u,l,c,d,g,f,h,p,m,v,b,y,_,w,C=e("../../../config/wizConf"),k=e("../../database/wizCenter"),M=e("locale"),L=e("../../util/GlobalUtil"),S=e("./menuTreeTools"),T=e("./docList"),x=e("./menuSetting"),z=e("../../model/Authority"),I={main:"main",menuTree:"menu-tree",menuNail:"menu-nail",menuContent:"menu-content",lastModify:"lately",search:"search",myShare:"myShare",category:"category",tag:"tag",fullMsg:"view-msg",atMsg:"view-at-msg",unReadMsg:"view-unread-msg",commentedMsg:"view-commented-msg",cmtReplyMsg:"view-cmt-reply-msg",modifiedMsg:"view-modified-msg",categoryTree:"categoryTree",tagTreeP:"tagTreeForPersonal",tagTreeG:"tagTreeForGroup",latelyIcon:"lately-icon",latelyText:"lately-dcb",myShareIcon:"myShare-icon",myShareText:"myShare-dcb",searchKeyword:"search-keyword"},D={kb:"note",group:"group",msg:"msg",menuItem:"menu-item-area",content:"content",lastModify:"lastModify",myShare:"myShare",msgBtn:"view-msg-btn",fullMsg:"fullMsg",unReadMsg:"unReadMsg",atMsg:"atMsg",commentedMsg:"commentedMsg",cmtReplyMsg:"cmtReplyMsg",modifiedMsg:"modifiedMsg",search:"search",category:C.web.note.menuType.category,tag:"tag",menuCollapse:"menu-collapse",active:"active",hover:"hover",setting:"setting",loading:"loading",up:"up",readonly:"readonly"},E=C.web.frameEventType,G=C.web.dataOperateType,A={localize:function(){},init:function(){F.initCategoryTree(),F.initTagTreeForPersonal(),F.initTagTreeForGroup()},clearMenuTree:function(){k.noteCur.menuParams=null,_.val(""),f&&f.cancelSelectedNode(),p&&p.cancelSelectedNode(),h&&h.cancelSelectedNode()},clearIconActive:function(){$("li."+D.active,l).removeClass(D.active)},clearIconHover:function(){$("li."+D.hover,l).removeClass(D.hover)},clearEditNode:function(){f&&f.cancelEditName(),p&&p.cancelEditName(),h&&h.cancelEditName()},showMessageMenu:function(){A.kbGuid=null,s.removeClass(D.kb+" "+D.group).addClass(D.msg),A.clearMenuTree()},showKbMenu:function(e){if(e!=A.kbGuid){A.kbGuid=e;var t={kb_guid:e};k.noteCur.kb==k.personalKb?(s.removeClass(D.msg+" "+D.group).addClass(D.kb),B.searchCategory(t),B.searchTagP(t),g.hide(),c.show(),d.show()):(s.removeClass(D.msg).addClass(D.kb+" "+D.group),B.searchTagG(t),c.hide(),d.hide(),g.show())}},setMenuItemActive:function(e){var t=$("li."+D.active+"."+D.menuItem,l);t.get(0)&&t.attr("id")==e||(t.removeClass(D.active),$("#"+e).addClass(D.active))},setMenuType:function(e,t){switch(t.kb_guid&&t.doc_guid&&o.trigger(E.EventManager,[E.ShowDocument,{kb_guid:t.kb_guid,doc_guid:t.doc_guid}]),z.modifyCategory(t.kb_guid)?g.removeClass(D.readonly):g.addClass(D.readonly),e==C.web.note.menuType.myShare&&_WIZ_CONFIG.oem.getData("HideMyShare")&&(e=C.web.note.menuType.lastModify),e){case C.web.note.menuType.messageCenter:A.showMessageMenu(),A.goMessage(t);break;case C.web.note.menuType.lastModify:A.goLastModify(t);break;case C.web.note.menuType.search:_.val(t.keyword),A.showKbMenu(t.kb_guid),A.showSearch(t);break;case C.web.note.menuType.category:A.showKbMenu(t.kb_guid),A.goCategory(t);break;case C.web.note.menuType.tag:A.showKbMenu(t.kb_guid),A.goTag(t);break;case C.web.note.menuType.myShare:A.goMyShare(t)}t.doc_guid&&k.noteCur&&k.noteCur.editFlag&&o.trigger(E.EventManager,[E.EditDocument,{docInfo:k.noteCur.docInfo}])},goMessage:function(e){var t,n=parseInt(e.msgType,10);t=null===n||void 0===n?C.web.note.msgType.all:e.msgType;var r={action_cmd:C.web.note.docListType.Msg,action_value:t,doc_guid:e.doc_guid},i=D.fullMsg,a=M.docMsg.label.all,s="";if(isNaN(n))t==C.web.note.msgType.unRead?(i=D.unReadMsg,a=M.docMsg.label.msgUnRead,s=I.unReadMsg):s=I.fullMsg;else switch(n){case 0:i=D.atMsg,a=M.docMsg.label.at,s=I.atMsg;break;case 10:i=D.commentedMsg,a=M.docMsg.label.commented,s=I.commentedMsg;break;case 30:i=D.cmtReplyMsg,a=M.docMsg.label.cmtReply,s=I.cmtReplyMsg;break;case 1:i=D.modifiedMsg,a=M.docMsg.label.modified,s=I.modifiedMsg}A.setPath(a),A.setMenuItemActive(s),l.attr("class",D.content+" "+i),o.trigger(E.EventManager,[E.ShowMsgDocList,r])},showSearch:function(e){i.onCheckDocChangedHandler(function(t){t&&(A.goSearch({keyword:e.keyword,doc_guid:e.doc_guid}),A.setPath(M.docMenu.label.search+": "+e.keyword),A.setMenuItemActive(I.search),l.attr("class",D.content+" "+D.search))})},goCategory:function(e){var t=C.web.note.docListType.Category,n={kb_guid:k.noteCur.kb.kbGuid,action_cmd:t,action_value:e.location,count:C.web.searchMaxCount,doc_guid:e.doc_guid};l.attr("class",D.content+" "+D.category),A.clearMenuTree(),A.clearIconHover(),f&&f.selectNode(f.getNodeByParam("location",e.location)),A.setMenuItemActive(I.category),k.noteCur.menuParams=n,o.trigger(E.EventManager,[E.ShowMsgDocList,n])},goTag:function(e){var t=e.tag_guid,n=t?C.web.note.docListType.Tag:C.web.note.docListType.NoTag,r={kb_guid:k.noteCur.kb.kbGuid,action_cmd:n,action_value:t?t:"",count:C.web.searchMaxCount,doc_guid:e.doc_guid};l.attr("class",D.content+" "+D.tag),A.clearMenuTree(),A.clearIconHover(),i.models.groupInfo.getGroup(r.kb_guid)?p.selectNode(p.getNodeByParam(t?"tag_guid":"cmd",t?t:C.web.note.docListType.NoTag)):h.selectNode(h.getNodeByParam(t?"tag_guid":"cmd",t?t:C.web.note.docListType.NoTag)),A.setMenuItemActive(I.tag),k.noteCur.menuParams=r,o.trigger(E.EventManager,[E.ShowMsgDocList,r])},goLastModify:function(e){i.onCheckDocChangedHandler(function(t){t&&(A.setPath(M.docMenu.label.recentNotes),A.showKbMenu(e.kb_guid),A.goSearch({keyword:"",doc_guid:e.doc_guid}),A.setMenuItemActive(I.lastModify),l.attr("class",D.content+" "+D.lastModify))})},goMyShare:function(e){i.onCheckDocChangedHandler(function(t){t&&(A.setPath(M.docMenu.label.myShare),A.showKbMenu(e.kb_guid),A.goMyShareList(),A.setMenuItemActive(I.myShare),l.attr("class",D.content+" "+D.myShare))})},goSearch:function(e){var t=C.web.note.docListType.Search,n={kb_guid:k.noteCur.kb.kbGuid,action_cmd:t,action_value:e.keyword,count:C.web.searchMaxCount,doc_guid:e.doc_guid};A.clearMenuTree(),A.clearIconHover(),_.val(e.keyword||""),k.noteCur.menuParams=n,o.trigger(E.EventManager,[E.ShowMsgDocList,n])},goMyShareList:function(){var e={kb_guid:k.noteCur.kb.kbGuid,action_cmd:C.web.note.docListType.myShare,action_value:""};A.clearMenuTree(),A.clearIconHover(),k.noteCur.menuParams=e,o.trigger(E.EventManager,[E.ShowMyShare,e])},setPath:function(e){T.setPath(e)},setPathFromTree:function(e,t){var n="";n=e==h?M.docMenu.label.tag+": "+t.tag_name:e==p?i.models.tag.getTagNameForGroup(k.noteCur.kb.kbGuid,t.tag_guid):t.displayLocation,A.setPath(n)},clearTreePosition:function(){$("ul.ztree",l).css({top:"",height:""}).parent().css({top:"",height:""})},setTreePosition:function(e){var t=L.getDomPosition(T.getListContent()),n=e.offset().top;$("ul.ztree",e).css({top:"0",height:t.height+"px"}).parent().css({top:t.top-n+"px",height:t.height+"px"})},expandTreeRoot:function(e){e&&e.expandNode(e.getNodes()[0],!0)},setMenuSwitchTitle:function(){u.attr("title",k.noteFrameStatus.menuExpand?M.docMenu.label.collapseMenu:M.docMenu.label.expandMenu)}},N={timer:{},bind:function(){this.bindMenuNail(),this.bindIcon()},bindMenuNail:function(){u.bind("click",function(){A.clearIconHover();var e=E.MenuExpand;k.noteFrameStatus.menuExpand?(e=E.MenuCollapse,_.get(0).blur()):A.clearTreePosition(),A.clearEditNode(),A.expandTreeRoot(f),A.expandTreeRoot(p),A.expandTreeRoot(h),o.trigger(E.EventManager,[e])})},bindIcon:function(){m.bind("click",function(){A.goLastModify({kb_guid:k.noteCur.kb.kbGuid})}),v.bind("click",function(){A.goLastModify({kb_guid:k.noteCur.kb.kbGuid})}),b.bind("click",function(){A.goMyShare({kb_guid:k.noteCur.kb.kbGuid})}),y.bind("click",function(){A.goMyShare({kb_guid:k.noteCur.kb.kbGuid})}),_.bind("keyup",function(e){13==e.keyCode&&A.showSearch({keyword:_.val()})}),w.bind("click",function(){A.clearIconHover(),A.goMessage({msgType:this.getAttribute("data-msg-type")})}),l.delegate("li."+D.menuItem,"mouseover mouseout click",function(e){if(a.hasClass(D.menuCollapse)){var t=this,n=this.id,r=$(t);N.timer[n]&&clearTimeout(N.timer[n]),"mouseover"!=e.type||r.hasClass(D.hover)?"mouseout"==e.type&&(N.timer[n]=setTimeout(function(){$(t).removeClass(D.hover),_.get(0).blur()},300)):N.timer[n]=setTimeout(function(){A.clearIconHover(),(t.id==I.category||t.id==I.tag)&&A.setTreePosition(r),r.addClass(D.hover)},100)}}),c.delegate("span."+D.setting,"click",function(e){return c.trigger("click",[e.target]),x.showMenuSetting($(e.target),l)}),d.delegate("span."+D.setting,"click",function(e){return d.trigger("click",[e.target]),x.showMenuSetting($(e.target),l)}),g.delegate("span."+D.setting,"click",function(e){return g.trigger("click",[e.target]),x.showMenuSetting($(e.target),l)})}},B={getCurLocation:function(){var e="/My Notes/";if(f){var t=f.getSelectedNodes()[0];t&&(e=t.location||"")}return e},getCurTagGuid:function(){var e="";if(p){var t=p.getSelectedNodes()[0];t&&(e=t.tag_guid||"")}return e},makeSearchCallback:function(e,t,n){F.setTreeLoading(e,!0);var r,o=function(t){F.setTreeLoading(e,!1),F.addNodes(e,t),F.setDefaultNode(e)};return t&&(r=o,o=function(){this.refresh(n.params,n.asyncStamp,r)}),o},searchTagG:function(e,t){var n=C.web.modelStamp.LeftTagGTree;o.trigger(E.EventManager,[G.GetTags,e,n,B.makeSearchCallback(p,t,{params:e,asyncStamp:n})])},searchTagP:function(e,t){var n=C.web.modelStamp.LeftTagPTree;o.trigger(E.EventManager,[G.GetTags,e,n,B.makeSearchCallback(h,t,{params:e,asyncStamp:n})])},searchCategory:function(e,t){var n=C.web.modelStamp.LeftCategoryTree;o.trigger(E.EventManager,[G.GetCategory,e,n,B.makeSearchCallback(f,t,{params:e,asyncStamp:n})])}},O=S.extend({initCategoryTree:function(){var e=[{name:M.docMenu.label.category,type:C.web.note.menuType.category,id:"/",pId:""}];f=this.initTree(c,this.getSetting(),e),f.type=C.web.note.menuType.category},initTagTreeForPersonal:function(){var e=[{name:M.docMenu.label.tag,type:C.web.note.menuType.tag,id:"/",pId:""}];h=this.initTree(d,this.getSetting(),e),h.type=C.web.note.menuType.tag},initTagTreeForGroup:function(){var e=[{name:"",type:C.web.note.menuType.tag,id:"/",pId:""}];p=this.initTree(g,this.getSetting(),e),p.type=C.web.note.menuType.tag},refreshTree:function(e){var t={kb_guid:e.kbGuid};switch(e){case p:B.searchTagG(t,!0);break;case h:B.searchTagP(t,!0);break;case f:B.searchCategory(t,!0)}},addNodes:function(e,t){e.kbGuid=k.noteCur.kb.kbGuid;var n=e.getNodes()[0];p==e&&(n.name=k.noteCur.kb.kbName,e.updateNode(n)),e.removeChildNodes(n),e.addNodes(n,t)},createNode:function(e,t){A.clearEditNode(),this._super.apply(this,arguments)},renameNode:function(e,t){A.clearEditNode(),this._super.apply(this,arguments)},removeNode:function(e,t){var n=e.getSelectedNodes()[0];n===t&&(n=t.getNextNode(),n&&n.cmd!=C.web.note.menuCmd.create||(n=t.getPreNode()||t.getParentNode()),0===n.level?A.goLastModify({kb_guid:k.noteCur.kb.kbGuid}):n&&$("#"+n.tId+"_a").trigger("click")),e.removeNode(t),this.removeCallback(e.kbGuid,e.setting.treeId,t)},setTreeLoading:function(e,t){var n=e.getNodes()[0],r=$("#"+n.tId+"_"+D.setting,e.setting.treeObj);t?r.removeClass(D.setting).addClass(D.loading):r.addClass(D.setting).removeClass(D.loading)},setDefaultNode:function(e){var t=k.noteCur.menuParams;if(t){var n="tag_guid",r=t.action_value;e==f?n="location":(t.action_cmd==C.web.note.docListType.NoTag||t.action_cmd==C.web.note.docListType.myShare)&&(n="cmd",r=C.web.note.docListType.NoTag);var o=e.getNodeByParam(n,r);o&&(A.setPathFromTree(e,o),e.selectNode(o))}},addCategoryAndTag:function(e,t,n,r){if(k.noteCur.kb&&e==k.noteCur.kb.kbGuid){var o=!!i.models.groupInfo.getGroup(e),a=o?p:r.type==C.web.note.menuType.tag?h:f,s=r.type===C.web.note.menuType.tag?a.getNodeByParam("tag_guid",r.tag_guid):a.getNodeByParam("location",r.location);s||(n=n?o?a.getNodeByParam("tag_guid",n.tag_guid):a.getNodeByParam("location",n.location):a.getNodes()[0],r=a.addNodes(n,r,!0)[0],0===n.level&&a.moveNode(r.getPreNode(),r,"prev"))}},renameCategoryAndTag:function(e,t,n){if(k.noteCur.kb&&e==k.noteCur.kb.kbGuid){var r=!!i.models.groupInfo.getGroup(e),o=r?p:n.type==C.web.note.menuType.tag?h:f,a=n.type===C.web.note.menuType.tag?o.getNodeByParam("tag_guid",n.tag_guid):o.getNodeByParam("location",n.oldLocation);t!==o.setting.treeId&&(a.name=n.name,o==f?(a.category_name=n.category_name,a.displayLocation=n.displayLocation,a.location=n.location):a.tag_name=n.tag_name,o.updateNode(a)),a=o.getSelectedNodes()[0],a&&(a.location&&a.location==n.location||a.tag_guid&&a.tag_guid==n.tag_guid)&&(A.setPathFromTree(o,a),$("#"+a.tId+"_a").trigger("click"))}},nodeBeforeClick:function(e,t){if(!this._super.apply(this,arguments))return!1;var n=this,r=$.fn.zTree.getZTreeObj(e);return 0!==t.level||k.noteFrameStatus.menuExpand?0===t.level?(r.expandNode(t),!1):(t.isParent&&!t.open&&r.expandNode(t),i.onCheckDocChangedHandler(function(o){o&&(r.selectNode(t),n.nodeOnClick(null,e,t))}),!1):!1},nodeOnClick:function(e,t,n){this._super.apply(this,arguments),n.type==C.web.note.docListType.Category?A.goCategory({location:n.location}):n.type==C.web.note.docListType.Tag&&A.goTag({tag_guid:n.cmd===C.web.note.docListType.NoTag?null:n.tag_guid}),A.setPathFromTree($.fn.zTree.getZTreeObj(t),n)},nodeBeforeRemove:function(e,t){if(!this._super.apply(this,arguments))return!1;var n=$.fn.zTree.getZTreeObj(e),r=!1,a="",s={kb_guid:k.noteCur.kb.kbGuid};switch(n){case p:a=M.docCategory.label.deleteCategory.replace("{$1}",t.name),s.tag_node=t;break;case h:a=M.docCategory.label.deleteTag.replace("{$1}",t.name),s.tag_node=t;break;case f:r=!0,s.category_node=t,a=M.docCategory.label.deleteCategory.replace("{$1}",t.name)}var u={content:a,target:$("#"+t.tId+"_a"),layout:C.web.confirm.Type.RightUp};return i.confirmMessage(u,function(e){e&&(r?o.trigger(E.EventManager,[G.DeleteCategory,s,function(e,r){r&&(i.models.docList.clearDocumentListByCategory(e,t.location),F.removeNode(n,t))}]):o.trigger(E.EventManager,[G.DeleteTag,s,function(e,r){r&&F.removeNode(n,t)}]))}),!1},createTagFromDocView:function(e,t){var n=h.setting.treeId,r={tId:"tmpNew",pId:h.getNodes()[0].id,parentTId:h.getNodes()[0].tId,_operateType:C.web.note.menuCmd.create,type:h.type,name:"",parent:null,level:1};F.updateCreate(n,r,e,!1,t)}}),F=new O;t.exports={init:r,setMenuType:A.setMenuType,getCurLocation:B.getCurLocation,getCurTagGuid:B.getCurTagGuid,addCategoryAndTag:F.addCategoryAndTag,renameCategoryAndTag:F.renameCategoryAndTag,createTagFromDocView:F.createTagFromDocView,setMenuSwitchTitle:A.setMenuSwitchTitle}},{"../../../config/wizConf":13,"../../database/wizCenter":18,"../../model/Authority":20,"../../util/GlobalUtil":35,"./docList":50,"./menuSetting":56,"./menuTreeTools":58,locale:"locale"}],58:[function(e,t,n){var r,o,i=e("../../../config/wizConf"),a=e("locale"),s=e("../../util/GlobalUtil"),u=e("../../util/Class"),l={setting:"setting"},c=i.web.frameEventType,d=i.web.dataOperateType;r=$("body");var g=u.extend({init:function(){this._controller=o},getSetting:function(){var e=this;return{data:{simpleData:{enable:!0}},view:{dblClickExpand:!1,selectedMulti:!1,showLine:!1,addDiyDom:this.addMenuSettingBtn},callback:{beforeClick:function(){return e.nodeBeforeClick.apply(e,arguments)},onClick:function(){e.nodeOnClick.apply(e,arguments)},onNodeCreated:function(){e.initNodeDom.apply(e,arguments)},beforeRename:function(){return e.nodeBeforeRename.apply(e,arguments)},onRename:function(){e.nodeOnRename.apply(e,arguments)},beforeRemove:function(){return e.nodeBeforeRemove.apply(e,arguments)},onRemove:function(){e.nodeOnRemove.apply(e,arguments)},onRightClick:function(){e.nodeOnRightClick.apply(e,arguments)}}}},initTree:function(e,t,n){return $.fn.zTree.init(e,t,n)},initNodeDom:function(e,t,n){s.modifyTreeNodeDom(t,n)},addMenuSettingBtn:function(e,t){if(t.cmd!==i.web.note.menuCmd.create&&t.cmd!==i.web.note.menuCmd.noTag){var n=$.fn.zTree.getZTreeObj(e);$("#"+t.tId+"_"+l.setting,n.setting.treeObj).get(0)||$("#"+t.tId+"_a",n.setting.treeObj).append('<span id="'+t.tId+"_"+l.setting+'" class="button icon-hb icon-ab '+l.setting+'"></span>')}},createNode:function(e,t){e.lastSelectedNode=e.getSelectedNodes()[0];var n={name:"",_operateType:i.web.note.menuCmd.create,type:e.type};n=e.addNodes(t,n,!0)[0],e.setting.edit.editNameSelectAll=!0,e.cancelEditName();var r=e.getNodeByParam("cmd",i.web.note.menuCmd.create);r&&n.level==r.level?(e.moveNode(n.getPreNode(),n,"prev"),e.editName(n)):e.editName(n)},renameNode:function(e,t){e.setting.edit.editNameSelectAll=!1,e.editName(t)},startRemoveNode:function(e,t){e.removeNode(t,!0)},removeCreateNode:function(e){var t=e.getNodeByParam("_operateType",i.web.note.menuCmd.create);t&&e.removeNode(t,!1),e.lastSelectedNode&&e.selectNode(e.lastSelectedNode)},checkNodeName:function(e,t,n){function r(e){return e.type===t.type&&e.level===t.level&&e.name===n&&e.tId!=t.tId&&e.parentTId===t.parentTId}var u=t.type,l=!0,c="";return(""===n||""===$.trim(n))&&(l=!1,c=a.docCategory.err.nameCannotEmpty),u===i.web.note.menuType.category&&s.isConSpeCharacters(n)&&(l=!1,c=a.docCategory.err.categoryNameRules),e.getNodesByFilter(r,!0)&&(l=!1,c=a.docCategory.err.same[o.models.groupInfo.getGroup(e.kbGuid)?i.web.note.menuType.category:t.type].replace("{$1}",n)),l||(this._controller.showErrorMessage({msg:c}),setTimeout(function(){e.editName(t)},10)),l},updateCreate:function(e,t,n,o,a){n=$.trim(n);var s=$.fn.zTree.getZTreeObj(e),u=this;if(!n)return this.removeCreateNode(s),a&&a(!1),!1;delete s.lastSelectedNode;var l=this.checkNodeName(s,t,n);if(!l)return a&&a(!1),!1;if(o)return!0;var g=$("#"+t.tId+"_input");g.attr("disabled","disabled");var f=function(r,o){if(g.attr("disabled",!1),!o)return u.removeCreateNode(s),void(a&&a(!1));t.type===i.web.note.menuType.category?(t.category_name=o.category_name,t.location=o.location,t.displayLocation=o.displayLocation):t.type===i.web.note.menuType.tag&&(t.tag_guid=o.tag_guid,t.tag_name=o.tag_name,t.tag_group_guid=o.tag_group_guid),t.name=n,t.editNameFlag?s.cancelEditName():s.updateNode(t),delete t._operateType,$("#"+t.tId+"_a").trigger("click");var l=t.getParentNode?t.getParentNode():null;u.createCallback(s.kbGuid,e,l,t),a&&a(!0)};return t.type===i.web.note.menuType.category?r.trigger(c.EventManager,[d.AddCategory,{kb_guid:s.kbGuid,name:n,category_node:t},f]):t.type===i.web.note.menuType.tag&&r.trigger(c.EventManager,[d.AddTag,{kb_guid:s.kbGuid,name:n,tag_node:t,parent:t.getParentNode?t.getParentNode():null},f]),!1},updateEdit:function(e,t,n,o){n=$.trim(n);var s=$.fn.zTree.getZTreeObj(e),u=this;if(!o&&!n)return this._controller.showErrorMessage({msg:a.docCategory.label.nameCannotEmpty}),setTimeout(function(){s.editName(t)},10),!1;if(o||t.name==n)return!0;var l=this.checkNodeName(s,t,n);if(!l)return!1;var g=$("#"+t.tId+"_input");g.attr("disabled","disabled");var f=function(r,o){g.attr("disabled",!1),o&&(t.name=n),t.editNameFlag?s.cancelEditName():s.updateNode(t),u.renameCallback(s.kbGuid,e,t)};return t.type===i.web.note.menuType.category?r.trigger(c.EventManager,[d.RenameCategory,{kb_guid:s.kbGuid,name:n,category_node:t},f]):t.type===i.web.note.menuType.tag&&r.trigger(c.EventManager,[d.RenameTag,{kb_guid:s.kbGuid,name:n,tag_node:t},f]),!1},nodeBeforeClick:function(e,t){return t.cmd===i.web.note.menuCmd.create?(this.createNode($.fn.zTree.getZTreeObj(e),t.getParentNode()),!1):!0},nodeOnClick:function(e,t,n){},nodeBeforeRename:function(e,t,n,r){return t._operateType===i.web.note.menuCmd.create?this.updateCreate(e,t,n,r,null):this.updateEdit(e,t,n,r)},nodeOnRename:function(){},nodeBeforeRemove:function(){return!0},nodeOnRemove:function(e,t,n){},nodeOnRightClick:function(e,t,n){if(n){var r=$("#"+n.tId+"_setting");r.is(":visible")&&r.trigger("click")}},createCallback:function(e,t,n,o){var i={kb_guid:e,treeId:t,parentNode:n,newNode:o};r.trigger(c.EventManager,[c.AddCategoryAndTagMenuTree,i])},renameCallback:function(e,t,n){var o={kb_guid:e,treeId:t,node:n};r.trigger(c.EventManager,[c.RenameCategoryAndTagMenuTree,o])},removeCallback:function(e,t,n){var o={kb_guid:e,treeId:t,node:n};r.trigger(c.EventManager,[c.RemoveCategoryAndTagMenuTree,o])}});g.setController=function(e){o=e},t.exports=g},{"../../../config/wizConf":13,"../../util/Class":34,"../../util/GlobalUtil":35,locale:"locale"}],59:[function(e,t,n){function r(e){d=$("body"),f=$("#"+_.myShareList),h=$("#"+_.myShareItems),p=$("#"+_.qrcodeModal),m=$("#"+_.checkAll),g=e,"vip"!==i.userInfo.user_type&&f.addClass(w.noVip),S.localize(),T.bind()}var o=e("../../../config/wizConf"),i=e("../../database/wizCenter"),a=e("locale"),s=e("../../../common/moment/moment"),u=e("../../../common/qrcode/qrcode"),l=e("../../viewer-common/loading"),c=e("../../../common/avalon-extend/calendarTime");c.init();var d,g,f,h,p,m,v,b,y,_={myShareList:"myShare-list",loadingLayer:"myShare-loading",checkAll:"checkAll",myShareItems:"myshare-table-items",qrcodeModal:"shareList-qrcode-modal",qrcode:"shareList2weixin-qrcode"},w={share2weixin:"item-share2weixin",active:"active",
hover:"hover",hide:"hide",check:"icon-check",checked:"icon-checked",blueIcon:"icon-b",noVip:"no-vip",wizRow:"wiz-row"},C=o.web.frameEventType,k=o.web.dataOperateType,M=13,L={setShareList:function(e){function t(e){e?g.showWarningMessage({msg:a.common.err.clipboard}):g.showSuccessMessage({msg:a.common.success.clipboard})}if(!e||200!==e.code)return 33701===e.code&&(i.shareBlackList=!0,$("#shareList-empty").find("p")[0].innerHTML=a.myShare.label.tableIsBlackList.replace("$1",o.web.companyInfo.hotline)),void(v.shareList=[]);var n,r,u,l;for(n=0,r=e.content.length;r>n;n++)u=e.content[n],u.expiredAt?(l=s(u.expiredAt).diff(s().startOf("day"),"days"),l=0>l?0:l,u.restDays=l+a.common.unit.day):u.restDays="-",u.readCountLimit?(l=u.readCountLimit-u.readCount,l=0>l?0:l,u.restTimes=l+a.common.unit.times):u.restTimes="-",u.spamStatusText=2==u.spamStatus||3==u.spamStatus?a.myShare.err.shareFail:"",u.readTimes=u.readCount+a.common.unit.times,u.wizUrl="wiz://open_document?guid="+u.documentGuid+"&kbguid="+i.personalKb.kbGuid,u.shareUrl=o.url.common.shareURL+u.shareId,u.shareUrlTxt=o.url.common.shareURL+u.shareId.replace(/^(.{5,5}).*(.{5,5})$/gi,"$1...$2"),u.shareClipboardTxt=o.url.common.shareURL+u.shareId,u.password&&(u.shareClipboardTxt+=" "+a.myShare.label.sharePassword+u.password);v.shareList=e.content,setTimeout(function(){var e,n,r;for(e=0,n=v.shareList.length;n>e;e++)r=v.shareList[e],wizUI.Clipboard($("#share_clipboard_btn_"+r.documentGuid),{moviePath:o.url.common.zeroclipboardSwf},t)},100)},setPagination:function(e){if(!e)return!1;var t,n,r=v.page.pageActive,o=e.totalPages;v.page.first=e.first,v.page.last=e.last,v.page.totalPages=o,4>r?(t=1,n=5>o?o:5):r+2>o?(n=o,t=5>o?1:o-4):(t=r-2,n=r+2),v.page.pageArray=avalon.range(t,n+1)},handlePage:function(e){function t(t){v.page.pageActive=e,L.setShareList(t),L.setPagination(t),S.hideLoadingTimer=setTimeout(function(){S.hideLoading()},300)}var n=$(this);return n.hasClass("disabled")?!1:(S.showLoading(),void x.getMyShareList(e,t))},showShareURL:function(e){var t=$(e.target),n=t.closest("."+w.wizRow),r=n.attr("data-documentGuid"),o=$("#share_"+r),i=n.hasClass(w.hover);t.closest(".checkItem").length>0||t.closest(".wiz-doc-link").length>0||t.closest(".cancelShareItem").length>0||(i?(n.removeClass(w.hover),o.removeClass(w.hover)):($("."+w.wizRow+"."+w.hover,f).removeClass(w.hover),n.addClass(w.hover),o.addClass(w.hover)))},checkAll:function(e){m.hasClass(w.checked)?S.setCheck(!1,$("."+w.checked,h)):S.setCheck(!0,$("."+w.check,h)),S.showChecked()},checkItem:function(e){var t=$(e.target);t.hasClass(w.checked)?S.setCheck(!1,t):S.setCheck(!0,t),S.showChecked()},cancelShareAll:function(e){var t=$("."+w.checked,h),n={content:a.myShare.label.cancelShareMoreConfirm};g.confirmMessage(n,function(e){function n(){--r>0||L.deleteShareItem(o)}if(e){var r=t.length,o={},i={};t.each(function(e,t){var r=$(t),a=r.closest("."+w.wizRow),s=a.attr("data-shareId");x.cancelShareItem(s,function(e){e&&200==e.code?o[s]=1:i[s]=1,n()})})}})},cancelShareItem:function(e){var t=$(e.target),n=t.closest("."+w.wizRow),r=n.attr("data-shareId"),o={content:a.myShare.label.cancelShareOneConfirm};g.confirmMessage(o,function(e){e&&x.cancelShareItem(r,function(e){e&&200==e.code&&L.deleteShareItem(r)})})},deleteShareItem:function(e){var t,n;for(t=v.shareList.length-1;t>=0;t--)n=v.shareList[t],(n.shareId===e||"object"==typeof e&&e[n.shareId])&&v.shareList.splice(t,1);S.showChecked()},getShareInfoByShareId:function(e){var t,n;for(t=v.shareList.length-1;t>=0;t--)if(n=v.shareList[t],n.shareId===e||"object"==typeof e&&e[n.shareId])return n},share2Weibo:function(e){var t=$(e.target),n=t.closest("."+w.wizRow),r=n.attr("data-shareId"),i=L.getShareInfoByShareId(r),a={appkey:o.web.note.share.weibo.appkey,title:o.web.note.share.weibo.title.replace("$1",i.title),url:i.url,ralateUid:o.web.note.share.weibo.ralateUid},s=wizUI.util.getWeiboShareURL(a);window.open(s)},share2Weixin:function(e){var t=$(e.target),n=t.closest("."+w.wizRow),r=n.attr("data-shareId"),o=L.getShareInfoByShareId(r);S.showQrcode(o,t)}};avalon.ready(function(){v=avalon.define("myShareList",function(e){e.shareList=[],e.checkedInfo="",e.showShareURL=L.showShareURL,e.checkAll=L.checkAll,e.checkItem=L.checkItem,e.cancelShareAll=L.cancelShareAll,e.cancelShareItem=L.cancelShareItem,e.share2Weibo=L.share2Weibo,e.share2Weixin=L.share2Weixin,e.handlePage=L.handlePage,e.page={pageArray:[0],totalPages:1,pageActive:1,first:!0,last:!0}}),avalon.scan($("#myshare-list").get(0),"myShare")});var S={localize:function(){},isLoading:!1,showLoading:function(){S.hideLoadingTimer&&clearTimeout(S.hideLoadingTimer),S.loading=!0,l.show(_.loadingLayer,f)},hideLoading:function(){S.loading=!1,l.hide(_.loadingLayer,f)},setCheck:function(e,t){e?t.removeClass(w.check).addClass(w.blueIcon+" "+w.checked):t.addClass(w.check).removeClass(w.blueIcon+" "+w.checked)},showMyShareList:function(){function e(e){L.setShareList(e),L.setPagination(e),S.hideLoadingTimer=setTimeout(function(){S.hideLoading()},300)}S.showLoading(),x.getMyShareList(1,e)},showChecked:function(){var e=m.closest("."+w.wizRow),t=$("."+w.checked,h),n=$("."+w.check,h);0===n.length&&t.length>0?(S.setCheck(!0,m),e.addClass(w.active)):0===t.length?(S.setCheck(!1,m),e.removeClass(w.active)):(S.setCheck(!1,m),e.addClass(w.active)),v.checkedInfo=a.myShare.label.checkedInfo.replace("$1",t.length)},initWeixinQrcode:function(e){var t={width:128,height:128,text:e.shareUrl,colorDark:"#333333",typeNumber:6,correctLevel:0};y?b!==t.text&&(b=t.text,y.clear(),y.makeCode(t.text)):(b=t.text,y=new u($("#"+_.qrcode)[0],t))},showQrcode:function(e,t){S.initWeixinQrcode(e),p.addClass(w.active),t.addClass(w.hover),T.bindHideQrcode();var n,r,o=f.width(),i=f.height(),a=p.width(),s=p.height(),u=t.width(),l=t.height(),c=f.offset(),d=t.offset(),g=10,h=!1;r=d.left-c.left+u+g,r+a>=o&&(r=o-a-g,h=!0),n=d.top-c.top-g,h&&(n=d.top-c.top+l+g),n+s>=i&&(n=h?d.top-c.top-s-g:d.top-c.top+l-s+g),g>n&&(n=g),p.css({top:n+"px",left:r+"px"})},hideQrcode:function(){$("."+w.share2weixin+"."+w.hover,f).removeClass(w.hover),p.removeClass(w.active),T.unbindHideQrcode()}},T={bind:function(){$(".modal-close-btn",p).bind("click",S.hideQrcode)},bindHideQrcode:function(){d.bind("click",T.hideQrcodeHandler)},unbindHideQrcode:function(){d.unbind("click",T.hideQrcodeHandler)},hideQrcodeHandler:function(e){var t=$(e.target);t.attr("id")===_.qrcodeModal||t.parents("#"+_.qrcodeModal).length>0||t.hasClass(w.share2weixin)||S.hideQrcode()}},x={getMyShareList:function(e,t){d.trigger(C.EventManager,[k.GetMyShareDocuments,{kb_guid:i.personalKb.kbGuid,page:e-1,size:M},t])},cancelShareItem:function(e,t){d.trigger(C.EventManager,[k.CancelShareDocument,{shareId:e},t])}};t.exports={init:r,show:S.showMyShareList}},{"../../../common/avalon-extend/calendarTime":2,"../../../common/moment/moment":4,"../../../common/qrcode/qrcode":6,"../../../config/wizConf":13,"../../database/wizCenter":18,"../../viewer-common/loading":44,locale:"locale"}],60:[function(e,t,n){function r(){var e,t;for(e=0,t=G.length;t>e;e++)a.removeClass(G[e]);return E.length>0?void a.addClass(E.pop()):void h.off()}function o(){a.trigger(I.FrameResize)}var i,a,s,u,l,c,d,g=e("locale"),f=e("../../util/GlobalUtil"),h=e("../../util/mouseWheelToMask"),p=e("../../../config/wizConf"),m=e("../../database/wizCenter"),v=e("../../viewer-common/urlOperator"),b=e("../../viewer-common/loading"),y=e("../../viewer-common/wizFrame"),_=e("./header"),w=e("./sidebar"),C=e("./menuTree"),k=e("./myShare.61722e00List"),M=e("./docList"),L=e("./docView"),S=e("./docEditor"),T={main:"main",groupIndex:"groupIndex",noteSortTool:"note-sort",readMain:"read",shareModal:"share-create-modal"},x={hide:"hide",wizFrame:"wiz-frame",historyFrame:"history-frame",showSidebar:"focus-sidebar",showMyShare:"myShare",modalEntry:"modal-entry",active:"active"},z={sidebar:"wiz_sidebar",leftMenu:"wiz_leftMenu"},I=p.web.frameEventType,D=p.web.dataOperateType,E=[],G=[x.wizFrame,x.historyFrame],A=!1,N=function(e,t){B[t]&&B[t].apply(this,arguments)},B={};B[D.GetBizMessage]=function(e,t,n,r,o){i.models.msg.getBase(n,r,o)},B[D.SetBizMessageStatus]=function(e,t,n,r,o){i.models.msg.setMessageStatus(n,r,o)},B[D.DeleteBizMessage]=function(e,t,n,r){i.models.msg.deleteMessage(n,r)},B[D.MarkAllReadStatus]=function(e,t,n){i.models.msg.markAllReadStatus(n)},B[D.GetCategory]=function(e,t,n,r,o){i.models.category.getBase(n,r,o)},B[D.AddCategory]=function(e,t,n,r){i.models.category.addCategory(n,r)},B[D.RenameCategory]=function(e,t,n,r){i.models.category.renameCategory(n,r)},B[D.DeleteCategory]=function(e,t,n,r){i.models.category.deleteCategory(n,r)},B[D.GetTags]=function(e,t,n,r,o){i.models.tag.getBase(n,r,o)},B[D.AddTag]=function(e,t,n,r){i.models.tag.addTag(n,r)},B[D.RenameTag]=function(e,t,n,r){i.models.tag.renameTag(n,r)},B[D.DeleteTag]=function(e,t,n,r){i.models.tag.deleteTag(n,r)},B[D.GetDocumentList]=function(e,t,n,r,o){i.models.docList.getBase(n,r,o)},B[D.GetDocumentSummary]=function(e,t,n,r,o){i.models.docSummary.getBase(n,r,o)},B[D.GetDocument]=function(e,t,n,r,o){i.models.doc.getBase(n,r,o)},B[D.CreateDocument]=function(e,t,n,r){i.models.doc.createDocument(n,r)},B[D.GetAttachment]=function(e,t,n,r,o){i.models.attachment.getBase(n,r,o)},B[D.SaveDocument]=function(e,t,n,r){i.models.doc.saveDocument(n,r)},B[D.DeleteDocument]=function(e,t,n,r){i.models.doc.deleteDocument(n,r)},B[D.DeleteAttachment]=function(e,t,n,r){i.models.attachment.deleteAttachment(n,r)},B[D.GetCommentList]=function(e,t,n,r,o){i.models.comment.getBase(n,r,o)},B[D.AddComment]=function(e,t,n,r){i.models.comment.addComment(n,r)},B[D.DeleteComment]=function(e,t,n,r){i.models.comment.deleteComment(n,r)},B[D.GetBizMemberListForAt]=function(e,t,n,r,o){i.models.bizMemberListForAt.getBase(n,r,o)},B[D.CancelShareDocument]=function(e,t,n,r){i.models.doc.cancelShare(n,r)},B[D.CreateShareDocument]=function(e,t,n,r){i.models.doc.createShare(n,r)},B[D.UpdateShareDocument]=function(e,t,n,r){i.models.doc.updateShare(n,r)},B[D.GetMyShareDocuments]=function(e,t,n,r){i.models.doc.getMyShare(n,r)},B[D.GetMyShareByDocGuid]=function(e,t,n,r){i.models.doc.getMyShareByDocGuid(n,r)},B[D.AddEditCount]=function(e,t,n,r){i.models.doc.addEditCounter(n,r)},B[D.DeleteEditCount]=function(e,t,n,r){i.models.doc.deleteEditCounter(n,r)},B[D.GetEditCount]=function(e,t,n,r){i.models.doc.getEditCounter(n,r)},B[I.ForceClientRefresh]=function(e,t,n){A=!0},B[I.HideMainLoading]=function(){b.hide("loading",a)},B[I.ShowWizModal]=function(e,t,n){$("#"+$(n).attr("data-modal")).addClass(x.active)},B[I.FrameResizeTrigger]=function(){setTimeout(o,200),setTimeout(o,500),setTimeout(o,1e3)},B[I.ShowWizFrame]=function(e,t,n,o){if(window.ActiveXObject&&document.documentMode)return window.open(n.url),void(o&&o());r(),h.on(),a.addClass(x.wizFrame);var i={url:f.addParamsToUrl(n.url,{client_type:p.web.clientType})};n["class"]&&(i["class"]=n["class"]),y.show(i,o)},B[I.ShowSidebar]=function(){m.noteFrameStatus.sidebar=!0,_.setSidebarSwitchTitle(),a.addClass(x.showSidebar),wizUI.util.cookie(z.sidebar,1,wizUI.util.getCookieOptions(100)),B[I.FrameResizeTrigger]()},B[I.HideSidebar]=function(){m.noteFrameStatus.sidebar=!1,_.setSidebarSwitchTitle(),a.removeClass(x.showSidebar),wizUI.util.cookie(z.sidebar,null,wizUI.util.getCookieOptions()),B[I.FrameResizeTrigger]()},B[I.ShowFullGroup]=function(){m.noteFrameStatus.fullGroup=!0,u.addClass(T.groupIndex),v.push({gidx:1})},B[I.HideFullGroup]=function(){m.noteFrameStatus.fullGroup=!1,u.removeClass(T.groupIndex),v.push({gidx:""})},B[I.MenuExpand]=function(){m.noteFrameStatus.menuExpand=!0,C.setMenuSwitchTitle(),u.removeClass("menu-collapse"),wizUI.util.cookie(z.leftMenu,1,wizUI.util.getCookieOptions(100)),B[I.FrameResizeTrigger]()},B[I.MenuCollapse]=function(){m.noteFrameStatus.menuExpand=!1,C.setMenuSwitchTitle(),u.addClass("menu-collapse"),wizUI.util.cookie(z.leftMenu,null,wizUI.util.getCookieOptions()),B[I.FrameResizeTrigger]()},B[I.SwitchKb]=function(e,t,n,r){var o;o=n?i.models.groupInfo.getGroup(n):null;var a=r?p.web.note.docListType[r.action_cmd]:null;o||m.isBizUser&&a==p.web.note.docListType.msg||(o=m.personalKb);var s=r&&r.doc_guid?r.doc_guid:"",u={kb_guid:o?o.kbGuid:null,doc_guid:s},l=m.noteCur.kb===o;if(r&&r.changeUrl&&(m.noteCur.cmd=r.action_cmd+","+r.action_value,v.push({cmd:m.noteCur.cmd})),!l||r&&r.fromUrl){if(m.isBizUser&&a==p.web.note.docListType.Msg)return u.msgType=r.action_value,u.fromUrl=r.fromUrl,void B[I.SwitchMsgCenter](null,null,u);m.noteCur.kb=o,l||(o==m.personalKb?_.setTitle(o.kbName,""):o.bizGuid?_.setTitle(o.bizName,o.kbName):_.setTitle(g.docMenu.label.myGroup,o.kbName),w.selectKb(o.kbGuid)),r&&r.onlySwitchKb||(a==p.web.note.docListType.Search&&r.action_value?(u.keyword=r.action_value,B[I.ResetMenuTree](null,null,p.web.note.menuType.search,u)):a==p.web.note.docListType.Category?(u.location=r.action_value,B[I.ResetMenuTree](null,null,p.web.note.menuType.category,u)):a==p.web.note.docListType.Tag||a==p.web.note.docListType.NoTag?(u.tag_guid=r.action_value,B[I.ResetMenuTree](null,null,p.web.note.menuType.tag,u)):a==p.web.note.docListType.myShare?B[I.ResetMenuTree](null,null,p.web.note.menuType.myShare,u):B[I.ResetMenuTree](null,null,p.web.note.menuType.lastModify,u))}},B[I.SwitchMsgCenter]=function(e,t,n){(m.noteCur.kb||n.fromUrl)&&(_.setTitle(g.docMenu.label.msgCenter,""),w.selectKb(p.web.note.kb.msg),m.noteCur.kb=null,B[I.ResetMenuTree](null,null,p.web.note.menuType.messageCenter,n))},B[I.ResetMenuTree]=function(e,t,n,r){n&&(n==p.web.note.menuType.messageCenter||r&&r.kb_guid)&&C.setMenuType(n,r)};var O;B[I.ShowMsgDocList]=function(e,t,n){O&&clearTimeout(O),l.removeClass(x.hide),c.removeClass(x.hide),u.removeClass(x.showMyShare),_.setMsgListener("msg"==n.action_cmd?!1:!0),m.noteCur.cmd=p.web.note.docListTypeParams[n.action_cmd]+","+n.action_value,M.showMsgDocList(n)},B[I.UpdateMsgList]=function(e){_.updateMsgList()},B[I.ShowMyShare]=function(e,t){u.addClass(x.showMyShare),M.clearMsgDocList(),L.clearDocument(),k.show(),v.push({cmd:p.web.note.docListTypeParams.myShare+",",dc:""}),_.setMsgListener(!0),O=setTimeout(function(){l.addClass(x.hide),c.addClass(x.hide)},500)},B[I.UpdateShareDocument]=function(e,t,n,r){r===m.noteCur.docGuid&&(n?L.isShare():(L.cancelShare(),d.removeClass(x.active)))},B[I.ShowEmptyInfo]=function(e,t,n,r){L.showEmptyInfo(n,r)},B[I.ShowDocument]=function(e,t,n){var r=m.noteCur.cmd?{cmd:m.noteCur.cmd}:{};return r.gidx="",n&&n.kb_guid&&n.doc_guid?(r.kb=n.kb_guid,r.dc=n.doc_guid,v.push(r),m.noteCur.docGuid=n.doc_guid,void L.getDocument(n)):(L.clearDocument(),r.kb=n&&n.kb_guid?n.kb_guid:"",r.dc="",void v.push(r))},B[I.CreateTagFromDocView]=function(e,t,n){C.createTagFromDocView(n.tagName,n.callback)},B[I.AddCategoryAndTagMenuTree]=function(e,t,n){C.addCategoryAndTag(n.kb_guid,n.treeId,n.parentNode,n.newNode),L.addCategoryAndTag(n.kb_guid,n.treeId,n.parentNode,n.newNode)},B[I.RenameCategoryAndTagMenuTree]=function(e,t,n){C.renameCategoryAndTag(n.kb_guid,n.treeId,n.node),L.renameCategoryAndTag(n.kb_guid,n.treeId,n.node)},B[I.RemoveCategoryAndTagMenuTree]=function(e,t,n){L.removeCategoryAndTag(n.kb_guid,n.treeId,n.node)},B[I.EditDocument]=function(e,t,n){L.editContentFocus(),S.editDocument(n)},B[I.SaveDocument]=function(e,t,n){clearTimeout(F),L.saveDocument()};var F,P="";B[I.AutoSaveDocument]=function(e,t,n){P===m.noteCur.lastSaved.document_guid&&m.noteCur.editFlag&&m.checkCurDocChanged(L.getEditingDocument())&&(clearTimeout(F),F=setTimeout(function(){m.noteCur.editFlag&&m.checkCurDocChanged(L.getEditingDocument())&&L.saveDocument()},p.web.note.autoSave)),P=m.noteCur.lastSaved.document_guid},B[I.UpdateDocument]=function(e,t,n){M.updateSpecficNote(n.docInfo)},B[I.RemoveDocument]=function(e,t,n){M.removeDocument(n.docInfo)};var U={initObj:function(){a=$("body"),s=$(document),u=$("#"+T.main),l=$("#"+T.noteSortTool),c=$("#"+T.readMain),d=$("#"+T.shareModal),$(".modal-close-btn").bind("click",function(){r(),A&&location.reload()}),h.init([])},initFrame:function(){var e=100;setTimeout(function(){wizUI.util.cookie(z.sidebar)?B[I.ShowSidebar]():B[I.HideSidebar]()},e),setTimeout(function(){wizUI.util.cookie(z.leftMenu)?B[I.MenuExpand]():B[I.MenuCollapse]()},e)},bindEvent:function(){i.globalEvent.bind(s,I.EventManager,N),s.on("click","."+x.modalEntry,function(e){s.trigger(I.EventManager,[I.ShowWizModal,e.currentTarget])})}};t.exports={init:function(e){i=e,U.initObj(),U.bindEvent(),U.initFrame()}}},{"../../../config/wizConf":13,"../../database/wizCenter":18,"../../util/GlobalUtil":35,"../../util/mouseWheelToMask":39,"../../viewer-common/loading":44,"../../viewer-common/urlOperator":46,"../../viewer-common/wizFrame":47,"./docEditor":48,"./docList":50,"./docView":51,"./header":55,"./menuTree":57,"./myShare.61722e00List":59,"./sidebar":61,locale:"locale"}],61:[function(e,t,n){function r(e){o=$("body"),a=$("#"+g.sideTree),i=e,h.localize(),h.initSideTree(),m.bind()}var o,i,a,s,u=e("../../../config/wizConf"),l=e("../../database/wizCenter"),c=e("locale"),d=e("../../util/GlobalUtil"),g={sideTree:"shortcut"},f=u.web.frameEventType,h={localize:function(){},initSideTree:function(){var e=p.getTreeNodes();s=$.fn.zTree.init(a,v,e)},initNodeDom:function(e,t,n){d.modifyTreeNodeDom(t,n),s=$.fn.zTree.getZTreeObj(t),n.isParent||$("#"+n.tId+"_ico",s.setting.treeObj).addClass("icon-c")},selectKb:function(e){if(e){var t=s.getNodeByParam("id",e);t&&s.selectNode(t)}},setMenuTree:function(e,t){o.trigger(f.EventManager,[u.web.frameEventType.SwitchKb,e,t]),o.trigger(f.EventManager,[u.web.frameEventType.HideFullGroup])}},p={getTreeNodes:function(){var e=i.models.groupInfo.getAllGroupStructure(),t=[{id:l.personalKb.kbGuid,name:c.docMenu.label.myNotes,type:u.web.note.kb.personal,isKb:!0}];_WIZ_CONFIG.oem.getData("HidePersonalGroup")||t.push({id:"",name:c.docMenu.label.myGroup,type:u.web.note.kb.myGroup,isKb:!1,isParent:!0,children:p.getNodesForTree(e.personalGroup)}),l.isBizUser&&t.unshift({id:u.web.note.kb.msg,name:c.docMenu.label.msgCenter,type:u.web.note.kb.msg,isMsg:!0});var n,r,o;for(n=0,r=e.bizList.length;r>n;n++)o=e.bizList[n],t.push({id:o.biz_guid,name:o.biz_name,type:u.web.note.kb.bizGroup,isKb:!1,children:p.getNodesForTree(o.groups)});return t},getNodesForTree:function(e){var t,n,r,o=[];for(t=0,n=e.length;n>t;t++)r=e[t],o.push({id:r.kbGuid,name:r.kbName,type:r.bizGuid?u.web.note.kb.bizGroup:u.web.note.kb.myGroup,isKb:!0});return o}},m={bind:function(){},groupNodeBeforeClick:function(e,t){return t.isParent?(s.expandNode(t),!1):(i.onCheckDocChangedHandler(function(n){n&&($.fn.zTree.getZTreeObj(e).selectNode(t),m.groupNodeOnClick(null,e,t))}),!1)},groupNodeOnClick:function(e,t,n){n.isKb?h.setMenuTree(n.id):n.isMsg&&h.setMenuTree(null,{action_cmd:u.web.note.docListType.Msg})}},v={view:{dblClickExpand:!1,selectedMulti:!1,showLine:!1},callback:{beforeClick:m.groupNodeBeforeClick,onClick:m.groupNodeOnClick,onNodeCreated:h.initNodeDom}};t.exports={init:r,selectKb:h.selectKb}},{"../../../config/wizConf":13,"../../database/wizCenter":18,"../../util/GlobalUtil":35,locale:"locale"}],62:[function(e,t,n){function r(e){o=$("body"),a=$("#"+h.userBtn),s=$("#"+h.userIcon),u=$("#"+h.userName),l=$("#"+h.popUserName),i=e,v.showUserInfo(),v.localize(),_WIZ_CONFIG.oem.getData("Web_HideUserInfo")||(v.initSettingMenu(),b.bind())}var o,i,a,s,u,l,c,d=e("../../../config/wizConf"),g=e("../../database/wizCenter"),f=e("locale"),h={userBtn:"avatar",userIcon:"pop-user-icon",userName:"user-name",userMenu:"pop-user-setting",popUserName:"pop-user-name",userSettingMainTmpl:"user-setting-tmpl",userSettingItemTmpl:"user-setting-item-tmpl",userSettingIconTmpl:"user-setting-item-icon-tmpl"},p={itemTxt:"setting-item-txt",active:"active",menuList:"a.wiz-menu-item",userEmailNotVerify:"not-verify",normalSettingIcon:"icon-cog",warnSettingIcon:"icon-cog-exclamation"},m=d.web.frameEventType,v={localize:function(){},hasBiz:function(){return!$.isEmptyObject(g.biz.owner)||g.biz.manageList>0},initSettingMenu:function(){var e;e=v.hasBiz()?f.userSetting.label.bizManager:f.userSetting.label.openBizServer;var t={icon:!0,menuId:h.userMenu,template:{enable:!0,ctn:$(a),main:$("#"+h.userSettingMainTmpl).html(),item:$("#"+h.userSettingItemTmpl).html(),icon:$("#"+h.userSettingIconTmpl).html()},menuItems:[{id:"user-name",text:g.userInfo.displayname,icon:!1},{id:"bizManager",text:e,icon_name:"icon-person-shield",url:d.url.biz.manage},{id:"account_setting",text:f.userSetting.label.account_setting,icon_name:g.userInfo.email_verified?"icon-cog":"icon-cog-exclamation",url:d.url.user.account_setting},{id:"inviteFriend",text:f.userSetting.label.invite,icon_name:"icon-envelop",url:d.url.user.inviteFriend},{id:"helpDoc",text:f.userSetting.label.helpDoc,icon_name:"icon-quz-circle",url:d.url.personal.helpDoc},{id:"logoff",text:f.userSetting.label.logoff,icon_name:"icon-power-off"}]};_WIZ_CONFIG.oem.getData("HideInviteFriend")&&t.menuItems.splice(3,1),!v.hasBiz()&&_WIZ_CONFIG.oem.getData("ForbidCreateBiz")&&t.menuItems.splice(1,1),c=new wizUI.ContextMenu(t).bind("click",function(e,t){var n=c.getMenuItem(t);"logoff"===t?i.logoff():"helpDoc"===t?(window.open(n.url),v.hideUserMenu()):"user-name"!==t&&(v.hideUserMenu(),o.trigger(m.EventManager,[m.ShowWizFrame,{url:n.url}]))})},showUserInfo:function(){u.text(g.userInfo.displayname),s.attr("src",g.getUserIcon(null,!0)),_WIZ_CONFIG.oem.getData("Web_ShowUserName")&&(l.text(g.userInfo.displayname),l.addClass(p.active))},showUserMenu:function(){c.show(),a.addClass(p.active)},hideUserMenu:function(){c.hide(),a.removeClass(p.active)}},b={bind:function(){this.bindUserBtn()},bindUserBtn:function(){a.bind("click",function(e){var t=$(e.target);t.attr("id")===h.userMenu||t.parents("#"+h.userMenu).length>0||(a.hasClass(p.active)?v.hideUserMenu():v.showUserMenu())}),i.globalEvent.bind(o,"click",b.hideUserInfoHandler)},hideUserInfoHandler:function(e){var t=$(e.target);t.attr("id")===h.userBtn||t.parents("#"+h.userBtn).length>0||t.attr("id")===h.userMenu||t.parents("#"+h.userMenu).length>0||v.hideUserMenu()}};t.exports={init:r}},{"../../../config/wizConf":13,"../../database/wizCenter":18,locale:"locale"}]},{},[14]);X"$Z      UɭUɭ;vU\   9:http://note.wiznote.com/libs/entity/web-flat.0f25eaa3.js necko:classified 1 request-method GET response-head HTTP/1.1 200 OK
Server: nginx
Date: Tue, 11 Aug 2015 08:10:03 GMT
Content-Type: application/x-javascript
Content-Length: 506427
Last-Modified: Mon, 10 Aug 2015 09:03:06 GMT
Etag: "55c868ca-7ba3b"
Accept-Ranges: bytes
 uncompressed-len 0  ;