/*
æœç´¢æœåŠ¡ https://code.csdn.net/CSDN_Dev/csdn_searchservice_fe

ä¾èµ–jQueryï¼Œä½¿ç”¨ç¤ºä¾‹(é™¤éæ˜ç¡®è¦æ±‚å¿…å¡«ï¼Œéƒ½æ˜¯å¯é€‰å‚æ•°ï¼›é™¤éæ˜ç¡®è¯´æ˜é»˜è®¤å€¼ï¼Œé»˜è®¤å€¼å°±æ˜¯ç¤ºä¾‹ä¸­çš„å€¼):

  <script type="text/javascript" src="http://csdnimg.cn/rabbit/search-service/main.js" charset="utf-8"></script>
  <script type="text/javascript">
    searchService({
      index: 'blog',
        // å¿…å¡«ï¼Œä½¿ç”¨çš„ç´¢å¼•åç§°ï¼Œé»˜è®¤å€¼æ˜¯''
      appendTo: '#output',
        // æœç´¢ç»“æœæ˜¾ç¤ºåˆ°æŒ‡å®šå…ƒç´ é‡Œé¢ï¼Œå¦‚æœæƒ³æ‰‹å·¥å¤„ç†å¯ä»¥å¿½ç•¥ï¼Œé»˜è®¤å€¼æ˜¯''
      query: {text: {'title,body':'java'}},
        // å¿…å¡«ï¼ŒæŸ¥è¯¢æ¡ä»¶ï¼Œè¯¦ç»†è¯·å‚é˜…æœç´¢ç³»ç»ŸAPI
      tmpl: '<li><a href="#{ object.url }" title="#{ object.title }">#{ object.title }</a></li>',
        // æ˜¾ç¤ºåˆ°appendToçš„å…ƒç´ æ¨¡æ¿ï¼Œå¯ä½¿ç”¨çš„æ¨¡æ¿æ ‡ç­¾ä¸»è¦ç”±è¿”å›çš„æ•°æ® hits æ•°æ®å…ƒç´ çš„ç»“æ„å†³å®šï¼›
        // é™¤æ­¤ä¹‹å¤–è¿˜å¯ä»¥ä½¿ç”¨ item å’Œ dataï¼Œåˆ†åˆ«ä»£è¡¨æ¯ä¸€æ¡æ•°æ®çš„åŸå§‹ç»“æ„å’Œè¿”å›çš„æ•´ä¸ªæ•°æ®
        // ä¹Ÿå¯ä»¥è®¿é—®windowä¸‹çš„å˜é‡
      from: 0,
        // è¦ä»æœç´¢ç»“æœä¸­ç¬¬å¤šå°‘æ¡å¼€å§‹è·å–æ•°æ®
      size: 6,
        // è¦ä»æœç´¢ç»“æœä¸­è·å–å¤šå°‘æ¡æ•°æ®
      filter: {"range":{"created_at":{"from":2010072320,"to":2010072330}}},
        // é»˜è®¤ä¸ä¼ é€’è¿™ä¸ªå‚æ•°ï¼Œè¿‡æ»¤æ¡ä»¶ï¼Œè¯¦ç»†è¯·å‚é˜…æœç´¢ç³»ç»ŸAPI
      sort: { 'updated_at': 'desc' },
        // é»˜è®¤ä¸ä¼ é€’è¿™ä¸ªå‚æ•°ï¼Œæ’åºå­—æ®µ, è¯¦ç»†è¯·å‚é˜…æœç´¢ç³»ç»ŸAPI
      fields: ['title', 'url'],
        // æœ€ç»ˆæ˜¾ç¤ºçš„å­—æ®µï¼Œè¯¦ç»†è¯·å‚é˜…æœç´¢ç³»ç»ŸAPI
      token: 'search_js_dkuyqthzbajmncbsb_token'
        // è®¿é—®æ§åˆ¶æ ‡è¯†
    }, function(err, data, options){
      // å¤„ç†å®Œæˆæ—¶çš„å›è°ƒ
      // erræ˜¯é”™è¯¯ä¿¡æ¯ï¼Œå¦‚æœæ— é”™å°†ä¸ºnull
      // dataæ˜¯æœç´¢åˆ°çš„åŸå§‹æ•°æ®
      // optionsæ˜¯ä¸Šé¢è°ƒç”¨æœ€ç»ˆä½¿ç”¨çš„å‚æ•°
    });
  </script>

 */
;(function(definition, undefined){
  var global = this, exports = {}, $ = global.jQuery;
  definition(global, exports, $);

  if(global.csdn === undefined){
    global.csdn = exports;
  } else {
    $.extend(global.csdn, exports);
  }
  $.extend(global, exports);

}(function(global, exports, $, undefined){
  document.domain = 'csdn.net';

  var searchServiceReady = false
    , searchArgs = []
    , searchService = exports.searchService = function(){
      var args = [].slice.call(arguments, 0);
      if(searchServiceReady){
        searchServiceFunc.apply(null, args);
      }else{
        searchArgs.push(args);
      }
    }
    , render = searchService.render = function(tmpl, item, data){
      return tmpl.replace(/#\{ +([^}]+) +\}/gm, function($0, $1){
        var fieldN = $1;
        if(eval('item.' + $1) !== undefined) $1 = 'item.' + $1;
        //return eval($1);
        var val = eval($1);
        if (fieldN.toLowerCase() == "title") {
          var reg=/[^`~!\$%\^\*\(\)=\|\{\}':;',\\\[\\\]\.<>\/\?~ï¼ï¿¥%â€¦â€¦*\ï¼ˆ\ï¼‰â€”â€”\|\{\}ã€ã€‘â€˜ï¼›ï¼šâ€â€œâ€™ã€‚ï¼Œã€ï¼Ÿ]/g;
          var titleFilter = val.match(reg).join( '' );
          val = titleFilter;
        }
        return val;
      });
    }
    , ajaxProxyCaches = {}
    , ajaxProxy = searchService.ajaxProxy = function(proxyUrl, opts){
      var c = ajaxProxyCaches[proxyUrl];
      if(c === undefined){
        c = ajaxProxyCaches[proxyUrl] = [];
        var func = arguments.callee;
        $('<iframe src="' + proxyUrl + '" style="display:none">').load(function(){
          c.contentWindow = this.contentWindow;
          func(proxyUrl, opts);
        }).prependTo('body');
      }else if(c.contentWindow === undefined){
        c.push(opts);
      }else{
        do{
          c.contentWindow.jQuery.ajax(opts);
        }while(opts = c.shift());
      }
    }
    , trackingAd = function(ele){
      if(typeof window.csdn !== 'undefined' && typeof window.csdn.trackingAd === 'function'){
        window.csdn.trackingAd(ele);
      }else{
        $(document).bind('trackingAd-ready', function(){
          trackingAd(ele);
        });
      }
    }
    , searchServiceFunc = function(opts, callback){
      var tmpl = ( opts.url == 'search' ) ? '<li><a href="#{ object.url }" title="#{ object.title }">#{ object.title }</a></li>' : '<li><a href="#{ url }" title="#{ title }" strategy="#{ strategy }">#{ title }</a></li>';
      opts = $.extend({
        index: '',
        appendTo: '',
        query: '',
        tmpl: tmpl,
        from: 0,
        size: 6,
        fields: ['title', 'url'],
        token: 'search_js_dkuyqthzbajmncbsb_token',
        render: render
      }, opts);

      if(!opts.index || !opts.query) return;

      var postData = {};
      if ( opts.url == 'recommend' )
      {
        var userId = $.cookie( 'UserName' ) || 'fake_userId';
        var uuid = $.cookie( 'uuid_tt_dd' ) || 'fake_uuid';
        var reg = /(\d+)$/;
        var href = window.location.href;
        var downId = reg.test( href ) ? RegExp.$1 : '';
        // var query = $( '.info' ).find( 'h1' ).attr( 'title' ) || $( '.info h1' ).text();

        postData = {
          userId: userId,
          size: 10,
          his: opts.his + ':' + downId,
          client: opts.client || 'download_cf_enhance',
          query: opts.query,
          cid: uuid
        };

        $.ajax( {
          type: 'GET',
          url: 'http://recdm.csdn.net/getRecommendList.html',
          data: postData,
          dataType: 'jsonp',
          jsonp: 'jsonp',
          success: function ( data ) {
            var appendTo = opts.appendTo, tmpl = opts.tmpl;
            if(data === null || data.ok === false && data.message){
              var msg = data !== null ? data.message : 'è¯·æ±‚å¤±è´¥';
              if(appendTo){
                $(appendTo).append(render('<div class="search-error">#{ item }</div>', msg));
              }
              if(typeof callback === 'function') {
                callback(msg, data, opts);
              }
            }else if( data.length > 0 ){
              if( appendTo ){
                $(appendTo).append($.map(data, function(i){
                  return opts.render(tmpl, i, data);
                }).join(''));
                trackingAd(appendTo);
              }
              if(typeof callback === 'function') {
                callback(null, data, opts);
              }
            }
          }
        } );
      }
      else if ( opts.url == 'search' )
      {
        $.map(['query', 'from', 'size', 'filter', 'sort', 'fields'], function(k){
          if(opts.hasOwnProperty(k)){
            postData[k] = opts[k];
          }
        });
        ajaxProxy('http://search.api.csdn.net/proxy.html', {
          type: 'POST',
          url: 'http://search.api.csdn.net/' + opts.index + '/csdn/_search',
          data: JSON.stringify(postData),
          dataType: 'json',
          headers: {
            'X-ACL-TOKEN': opts.token
          },
          success: function(data){
            var appendTo = opts.appendTo, tmpl = opts.tmpl;
            if(data === null || data.ok === false && data.message){
              var msg = data !== null ? data.message : 'è¯·æ±‚å¤±è´¥';
              if(appendTo){
                $(appendTo).append(render('<div class="search-error">#{ item }</div>', msg));
              }
              if(typeof callback === 'function') {
                callback(msg, data, opts);
              }
            }else if(data.hits){
              if(appendTo){
                $(appendTo).append($.map(data.hits, function(i){
                  return opts.render(tmpl, i, data);
                }).join(''));
                trackingAd(appendTo);
              }
              if(typeof callback === 'function') {
                callback(null, data, opts);
              }
            }
          }
        });
      }
    }
    ;

  if(global.JSON === undefined){
    $.getScript('http://csdnimg.cn/rabbit/search-service/json2.js', function(){
      searchServiceReady = true;
      var args;
      while(args = searchArgs.shift()){
        searchService.apply(null, args);
      }
    });
  }else{
    searchServiceReady = true;
  }

}));.ÔÄ!ş%      UÉ®‰UÉ®‰;vçUĞD   2:http://c.csdnimg.cn/rabbit/search-service/main.js necko:classified 1 request-method GET response-head HTTP/1.1 200 OK
Server: Tengine
Content-Type: application/javascript; charset=utf-8
Content-Length: 8376
Date: Fri, 17 Jul 2015 03:36:35 GMT
Cache-Control: max-age=2592001
Expires: Sun, 16 Aug 2015 03:36:36 GMT
Last-Modified: Tue, 02 Dec 2014 10:51:34 GMT
Etag: "547d99b6-20b8"
Access-Control-Allow-Origin: *
Accept-Ranges: bytes
Via: cache11.l2et2-1[0,304-0,H], cache64.l2et2-1[0,0], kunlun8.cn172[0,304-0,H], kunlun9.cn172[1,0]
Age: 2176582
X-Cache: HIT TCP_IMS_HIT dirn:11:465731265
X-Swift-SaveTime: Sun, 12 Jul 2015 11:46:55 GMT
X-Swift-CacheTime: 2592000
 uncompressed-len 0    ¸